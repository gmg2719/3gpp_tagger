1 scope
the present document defines the stage?2 service description for the evolved 3gpp packet switched domain - also known as the evolved packet system (eps) in this document. the evolved 3gpp packet switched domain provides ip connectivity using the evolved universal terrestrial radio access network (e-utran).
the specification covers both roaming and non-roaming scenarios and covers all aspects, including mobility between e-utran and pre-e-utran 3gpp radio access technologies, policy control and charging, and authentication.
the radio access network functionality is documented only to the extent necessary to describe the overall system. ts?36.300?[5] contains the overall description of the evolved universal terrestrial radio access (e-utra) and evolved universal terrestrial radio access network (e-utran).
itu-t recommendation i.130?[3] describes a three-stage method for characterisation of telecommunication services, and itu-t recommendation q.65?[4] defines stage?2 of the method.
ts?23.402?[2] is a companion specification to this specification.
an evolved packet system architecture optimised for the support of cellular iot (internet of things) applications is also defined in this document.
the evolved packet system also provides support for the e-utran to control a dual connectivity radio connection that uses a combination of e-utra and another radio access technology (e.g. nr). ts?36.300?[5] contains the overall description for dual connectivity.
enhancements to support interworking of eps with 5gs are captured in ts?23.501?[83] and ts?23.502?[84].
2 references
the following documents contain provisions which, through reference in this text, constitute provisions of the present document.
- references are either specific (identified by date of publication, edition number, version number, etc.) or non specific.
- for a specific reference, subsequent revisions do not apply.
- for a non-specific reference, the latest version applies. in the case of a reference to a 3gpp document (including a gsm document), a non-specific reference implicitly refers to the latest version of that document in the same release as the present document.
[1] 3gpp?tr?21.905: "vocabulary for 3gpp specifications".
[2] 3gpp?ts?23.402: "architecture enhancements for non-3gpp accesses".
[3] itu t recommendation?i.130: "method for the characterization of telecommunication services supported by an isdn and network capabilities of an isdn".
[4] itu t recommendation?q.65: "the unified functional methodology for the characterization of services and network capabilities".
[5] 3gpp?ts?36.300: "evolved universal terrestrial radio access (e-utra) and evolved universal terrestrial radio access network (e-utran); overall description; stage 2".
[6] 3gpp?ts?23.203: "PCC architecture".
[7] 3gpp?ts?23.060: "general packet radio service (gprs); service description; stage?2".
[8] 3gpp?ts?43.129: "packet-switched handover for geran a/gb mode; stage?2".
[9] 3gpp?ts?23.003: "numbering, addressing and identification".
[10] 3gpp?ts?23.122: "non-access-stratum (nas) functions related to mobile station in idle mode".
[11] 3gpp?ts?43.022: "functions related to ms in idle mode and group receive mode".
[12] 3gpp?ts?25.304: "ue procedures in idle mode and procedures for cell re-selection in connected mode".
[13] 3gpp?ts?23.246: "multimedia broadcast/multicast service (mbms); architecture and functional description".
[14] 3gpp?ts?29.060: "gprs tunnelling protocol (gtp) across the gn and gp interface".
[15] 3gpp?ts?43.051: "geran overall description - stage?2".
[16] 3gpp?ts?25.401: "utran overall description".
[17] ietf?rfc?1034 (1987): "domain names ? concepts and facilities" (std 13).
[18] ietf?rfc?4862: "ipv6 stateless address autoconfiguration".
[19] ietf?rfc?2131: "dynamic host configuration protocol".
[20] ietf?rfc?3736: "stateless dynamic host configuration protocol (dhcp) service for ipv6".
[21] ietf?rfc?3633: "ipv6 prefix options for dynamic host configuration protocol (dhcp) version 6".
[22] 3gpp?ts?25.413: "utran iu interface radio access network application part (ranap) signalling".
[23] 3gpp?ts?44.064: "mobile station - serving gprs support node (ms-sgsn); logical link control (llc) layer specification".
[24] 3gpp?ts?23.251: "network sharing; architecture and functional description".
[25] ietf?rfc?4039: "rapid commit option for the dynamic host configuration protocol version 4 (dhcpv4)".
[26] ietf?rfc?768: "UDP".
[27] 3gpp?ts?23.221: "architectural requirements".
[28] 3gpp?ts?23.008: "organization of subscriber data".
[29] 3gpp?ts?23.078: "customized applications for mobile network enhanced logic (camel) phase x; stage?2".
[30] 3gpp?ts?23.236: "intra-domain connection of radio access network (ran) nodes to multiple core network (cn) nodes".
[31] ietf?rfc?3588: "diameter base protocol".
[32] ietf?rfc?4861: "neighbor discovery for ip version 6 (ipv6)".
[33] 3gpp?ts?25.331: "radio resource control (rrc); protocol specification".
[34] 3gpp?ts?36.304: "evolved universal terrestrial radio access (e-utra); user equipment (ue) procedures in idle mode".
[35] ietf?rfc?4960: "stream control transmission protocol".
[36] 3gpp?ts?36.413: "evolved universal terrestrial access network (e-utran); s1 application protocol (s1ap)".
[37] 3gpp?ts?36.331: "evolved universal terrestrial radio access (e-utra); radio resource control (rrc); protocol specification".
[38] 3gpp?ts?29.061: "interworking between the public land mobile network (plmn) supporting packet based services and packet data networks (pdn)".
[39] void.
[40] 3gpp?ts?33.102: "3g security; security architecture".
[41] 3gpp?ts?33.401: "3gpp system architecture evolution: security architecture".
[42] 3gpp?ts?48.018: "general packet radio service (gprs); base station system (bss) - serving gprs support node (sgsn); bss gprs protocol (bssgp)".
[43] 3gpp?ts?29.274: "3gpp evolved packet system (eps); evolved general packet radio service (gprs) tunnelling protocol for CP (gtpv2-c); stage 3".
[44] 3gpp?ts?32.251: "telecommunication management; charging management; packet switched (ps) domain charging".
[45] 3gpp?ts?24.007: "mobile radio interface signalling layer 3; general aspects".
[46] 3gpp?ts?24.301: "non-access-stratum (nas) protocol for evolved packet system (eps); stage?3".
[47] 3gpp?ts?24.008: "mobile radio interface layer 3 specification; core network protocols; stage?3".
[48] 3gpp?ts?23.041: "technical realization of cell broadcast service (cbs)".
[49] 3gpp?ts?22.042: "network identity and time zone (nitz) service description; stage?1".
[50] void.
[51] 3gpp?ts?32.240: "charging architecture and principles".
[52] 3gpp?ts?23.228: "ip multimedia subsystem (ims); stage 2".
[53] 3gpp?ts?24.285: "allowed closed subscriber group (csg) list; management object (mo)".
[54] 3gpp?ts?23.261: "ip flow mobility and seamless wireless local area network (wlan) offload; stage 2".
[55] ietf?rfc?3168: "the addition of explicit congestion notification (ecn) to ip".
[56] 3gpp?ts?26.114: "ip multimedia subsystem (ims); multimedia telephony; media handling and interaction".
[57] 3gpp?ts?23.271: "functional stage?2 description of lcs".
[58] 3gpp?ts?23.272: "circuit switched (cs) fallback in evolved packet system (eps); stage 2".
[59] 3gpp?ts?23.107: "quality of service (qos) concept and architecture".
[60] 3gpp?ts?23.292: "ip multimedia subsystem (ims) centralized services; stage 2".
[61] 3gpp?ts?29.303: "domain name system procedures; stage 3".
[62] ietf?rfc?3376: "internet group management protocol, version 3".
[63] ietf?rfc?3810: "multicast listener discovery version 2 (mldv2) for ipv6".
[64] ietf?rfc?3927: "dynamic configuration of ipv4 link-local addresses".
[65] ietf?rfc?4291: "ip version 6 addressing architecture".
[66] 3gpp?ts?22.368: "service requirements for machine-type communications (mtc); stage 1".
[67] 3gpp?ts?22.011: "service accessibility".
[68] 3gpp?ts?22.153: "multimedia priority service".
[69] 3gpp?ts?24.368: "non-access stratum (nas) configuration management object (mo)".
[70] ietf?rfc?6603: "prefix exclude option for dhcpv6-based prefix delegation".
[71] 3gpp?ts?23.002: "network architecture".
[72] 3gpp?ts?23.007: "restoration procedures".
[73] 3gpp?ts?22.173: "ip multimedia core network subsystem (ims) multimedia telephony service and supplementary services; stage 1".
[74] 3gpp?ts?23.682: "architecture enhancements to facilitate communications with packet data networks and applications".
[75] 3gpp?ts?23.380: "ims restoration procedures".
[76] 3gpp?ts?36.423: "evolved universal terrestrial radio access network (e-utran); x2 application protocol (x2ap)".
[77] ietf?rfc?5795: "the robust header compression (rohc) framework".
[78] 3gpp?ts?36.323: "evolved universal terrestrial radio access (e-utra); packet data convergence protocol (pdcp) specification".
[79] 3gpp?ts?29.128: " mobility management entity (mme) and serving gprs support node (sgsn) interfaces for interworking with packet data networks and applications".
[80] 3gpp?ts?22.101: "3rd generation partnership project; technical specification group services and systems aspects; service aspects; service principles".
[81] 3gpp?ts?23.167: "3rd generation partnership project; technical specification group services and systems aspects; ip multimedia subsystem (ims) emergency sessions".
[82] 3gpp?ts?36.306: "evolved universal terrestrial radio access (e-utra); user equipment (ue) radio access capabilities".
[83] 3gpp?ts?23.501: "system architecture for the 5g system; stage 2".
[84] 3gpp?ts?23.502: "procedures for the 5g system; stage 2".
[85] 3gpp?ts?37.340: "evolved universal terrestrial radio access (e-utra) and nr; multi-connectivity; stage 2".
[86] 3gpp?ts?29.002: "mobile application part (map) specification".
[87] 3gpp?ts?36.321: "evolved universal terrestrial radio access (e-utra); medium access control (mac) protocol specification".
3 definitions and abbreviations
3.1 definitions
for the purposes of the present document, the terms and definitions given in tr?21.905?[1] and the following apply. a term defined in the present document takes precedence over the definition of the same term, if any, in tr?21.905?[1].
mme pool area: an mme pool area is defined as an area within which a ue may be served without need to change the serving mme. an mme pool area is served by one or more mmes ("pool of mmes") in parallel. mme pool areas are a collection of complete tracking areas. mme pool areas may overlap each other.
serving gw service area: a serving gw service area is defined as an area within which a ue may be served without need to change the serving gw. a serving gw service area is served by one or more serving gws in parallel. serving gw service areas are a collection of complete tracking areas. serving gw service areas may overlap each other.
pdn connection: the association between a pdn represented by an apn and a ue, represented by one ipv4 address and/or one ipv6 prefix (for ip pdn type) or by the ue identity (for non-ip pdn type).
default bearer: the eps bearer which is first established for a new pdn connection and remains established throughout the lifetime of the pdn connection.
default apn: a default apn is defined as the apn which is marked as default in the subscription data and used during the attach procedure and the ue requested pdn connectivity procedure when no apn is provided by the ue.
ecall only mode: a ue configuration option that allows the ue to attach at eps and register in ims to perform only ecall over ims, and an ims call to a non-emergency msisdn or uri for test and/or terminal reconfiguration services. for a short period following either such call, an incoming call (e.g. callback from a psap or hplmn operator) or other incoming session (e.g. for usim reconfiguration) is possible. at other times when the ue is configured in this mode, the ue is required to refrain from any signaling to a network. use of ecall only mode is configured in the usim for the ue.
en-gnb: as defined in ts?37.340?[85].
pdn connection to the scef: the association between a ue, represented by the ue identity, and a pdn represented by an apn to external packet data network via scef to allow transfer of non-ip data. it includes establishment and persistence of t6 connection between mme and scef (see ts?29.128?[79]).
emergency attached ue: a ue which only has bearer(s) related to emergency bearer service.
note?1: the above term is equivalent to the term "attached for emergency bearer services" as specified in ts?24.301?[46].
lipa pdn connection: a pdn connection for local ip access for a ue connected to a henb.
sipto at local network pdn connection: a pdn connection for sipto at local network for a ue connected to a (h)enb.
correlation id: for a lipa pdn connection, correlation id is a parameter that enables direct UP path between the henb and l-gw.
sipto correlation id: for a sipto at local network pdn connection, sipto correlation id is a parameter that enables direct UP path between the (h)enb and l-gw when they are collocated.
local home network: a set of (h)enbs and l-gws in the standalone gw architecture, where the (h)enbs have ip connectivity for sipto at the local network via all the l-gws.
local home network id: an identifier that uniquely identifies a local home network within a plmn.
presence reporting area: an area defined within 3gpp packet domain for the purposes of reporting of ue presence within that area due to policy control and/or charging reasons. in case of e-utran, a presence reporting area may consist in a set of neighbor or non-neighbor tracking areas, or enbs and/or cells. there are two types of presence reporting areas: "ue-dedicated presence reporting areas" and "core network pre-configured presence reporting areas" that apply to an mme pool.
ran UP congestion: ran UP congestion occurs when the demand for ran resources exceeds the available ran capacity to deliver the user data for a prolonged period of time.
note?2: short-duration traffic bursts is a normal condition at any traffic load level, and is not considered to be ran UP congestion. likewise, a high-level of utilization of ran resources (based on operator configuration) is considered a normal mode of operation and might not be ran UP congestion.
iops-capable enb: an enb that has the capability of iops mode operation, which provides local ip connectivity and public safety services to iops-enabled ues via a local epc when the enb has lost backhaul to the macro epc or it has no backhaul to the macro epc.
iops network: an iops network consists of one or more enbs operating in iops mode and connected to a local epc.
local epc: a local epc is an entity which provides functionality that enbs in iops mode of operation use, instead of the macro epc, in order to support public safety services.
macro epc: the epc which serves an enb when it is not in iops mode of operation.
nomadic eps: a deployable system which has the capability to provide radio access (via deployable iops-capable enb(s)), local ip connectivity and public safety services to iops-enabled ues in the absence of normal eps
iops-enabled ue: is an ue that is configured to use networks operating in iops mode.
cellular iot: cellular network supporting low complexity and low throughput devices for a network of things. cellular iot supports both ip and non-ip traffic.
narrowband-iot: a 3gpp radio access technology that forms part of cellular iot. it allows access to network services via e-utra with a channel bandwidth limited to 180 khz (corresponding to one prb). unless otherwise indicated in a clause, narrowband-iot is a subset of e-utran.
lte-m: a 3gpp rat type identifier used in the core network only, which is a sub-type e-utran rat type, and defined to identify in the core network the e-utran when used by a ue indicating category m in its ue radio capability.
wb-e-utran: in the ran, wb-e-utran is the part of e-utran that excludes nb-iot. in the core network, the wb-e-utran also excludes lte-m.
dcn-id: dcn identity identifies a specific dedicated core network (dcn).
for the purposes of the present document, the following terms and definitions given in ts?23.167?[81] apply:
ecall over ims: see ts?23.167?[81].
3.2 abbreviations
for the purposes of the present document, the abbreviations given in tr?21.905?[1] and the following apply. an abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in tr?21.905?[1].
5gs 5g system
af application function
arp allocation and retention priority
ambr aggregate maximum bit rate
cbc cell broadcast centre
cbe cell broadcast entity
ciot cellular iot
csg closed subscriber group
csg id closed subscriber group identity
c-sgn ciot SGW node
css csg subscriber server
dcn dedicated core network
denb donor enode b
dl tft downlink traffic flow template
drx discontinuous reception
ecgi e-utran cell global identifier
ecm eps connection management
ecn explicit congestion notification
emm eps mobility management
enb evolved node b
epc evolved packet core
eps evolved packet system
e-rab e-utran radio access bearer
e-utran evolved universal terrestrial radio access network
gbr guaranteed bit rate
gummei globally unique mme identifier
guti globally unique temporary identity
gw gateway
henb home enode b
henb gw home enode b gateway
hfn hyper frame number
iops isolated e-utran operation for public safety
iot internet of things
isr idle mode signalling reduction
laa licensed assisted access
lbi linked eps bearer id
l-gw local gateway
lipa local ip access
lwa lte/wlan aggregation
lwip lte/wlan radio level integration with ipsec tunnel
mbr maximum bit rate
mme mobility management entity
mmec mme code
mtc machine-type communications
m-tmsi m-temporary mobile subscriber identity
nb-iot narrowband iot
nr NR
ocs online charging system
ofcs offline charging system
omc-id operation and maintenance centre identity
p gw PGW
pcc PCC
pcrf policy and charging rules function
pra presence reporting area
pdcp packet data convergence protocol
pmip proxy mobile ip
psap public safety answering point
psm power saving mode
pti procedure transaction id
qci qos class identifier
rcaf ran congestion awareness function
rfsp rat/frequency selection priority
rn relay node
ruci ran UP congestion information
s gw SGW
s-tmsi s-temporary mobile subscriber identity
sdf SDF
sipto SIPTO
tac tracking area code
tad traffic aggregate description
tai tracking area identity
tau tracking area update
ti transaction identifier
tin temporary identity used in next update
urrp-mme ue reachability request parameter for mme
ul tft uplink traffic flow template
ulr-flags update location request flags

4 architecture model and concepts
4.1 general concepts
local breakout of ip traffic via the visited plmn is supported, when network policies and user subscription allow it. local breakout may be combined with support for multiple simultaneous pdn connections, described in clause?5.10.
ciot eps optimisations provide improved support of small data transfer, described in clause?4.11.
4.2 architecture reference model
4.2.1 non-roaming architecture

figure 4.2.1-1: non-roaming architecture for 3gpp accesses

figure 4.2.1-2: non-roaming architecture for 3gpp accesses. single gateway configuration option
note?1: also in this configuration option, s5 can be used between non collocated SGW and PGW.
note?2: additional interfaces for 2g/3g access are shown in ts?23.060?[7].
4.2.2 roaming architecture

figure 4.2.2-1: roaming architecture for 3gpp accesses. home routed traffic
note?1: additional interfaces/reference points for 2g/3g accesses are documented in ts?23.060?[7].
the figures 4.2.2-2 and 4.2.2-3 represent the roaming with local breakout case with application function (af) in the home network and in the visited network respectively. the concurrent use of af's in the home network and af's in the visited network is not excluded.

figure 4.2.2-2: roaming architecture for local breakout, with home operator's application functions only
note?2: see ts?23.203?[6] for the role of and functions related to home and visited pcrf and s9/rx reference points.
note?3: in figure?4.2.2 2, the CP signalling and the UP for accessing to home operator's services traverse over the sgi reference point via the visited operator's pdn.

figure 4.2.2-3: roaming architecture for local breakout, with visited operator's application functions only
4.2.3 reference points
s1-mme: reference point for the CP protocol between e-utran and mme.
s1-u: reference point between e-utran and serving gw for the per bearer UP tunnelling and inter enodeb path switching during handover. s1-u does not apply to the CP ciot eps optimisation.
s3: it enables user and bearer information exchange for inter 3gpp access network mobility in idle and/or active state. this reference point can be used intra-plmn or inter-plmn (e.g. in the case of inter-plmn ho).
s4: it provides related control and mobility support between gprs core and the 3gpp anchor function of serving gw. in addition, if direct tunnel is not established, it provides the UP tunnelling.
s5: it provides UP tunnelling and tunnel management between serving gw and pdn gw. it is used for serving gw relocation due to ue mobility and if the serving gw needs to connect to a non-collocated pdn gw for the required pdn connectivity.
s6a: it enables transfer of subscription and authentication data for authenticating/authorizing user access to the evolved system (aaa interface) between mme and hss.
gx: it provides transfer of (qos) policy and charging rules from pcrf to PCEF (pcef) in the pdn gw.
s8: inter-plmn reference point providing user and CP between the serving gw in the vplmn and the pdn gw in the hplmn. s8 is the inter plmn variant of s5.
s9: it provides transfer of (qos) PCC information between the home pcrf and the visited pcrf in order to support local breakout function.
s10: reference point between mmes for mme relocation and mme to mme information transfer. this reference point can be used intra-plmn or inter-plmn (e.g. in the case of inter-plmn ho).
s11: reference point providing CP between mme and serving gw. in addition, in order to support CP ciot eps optimisation, the s11-u reference point provides UP between mme and serving gw.
s12: reference point between utran and serving gw for UP tunnelling when direct tunnel is established. it is based on the iu-u/gn-u reference point using the gtp-u protocol as defined between sgsn and utran or respectively between sgsn and ggsn. usage of s12 is an operator configuration option.
s13: it enables ue identity check procedure between mme and eir.
sgi: it is the reference point between the pdn gw and the packet data network. packet data network may be an operator external public or private packet data network or an intra operator packet data network, e.g. for provision of ims services. this reference point corresponds to gi for 3gpp accesses.
rx: the rx reference point resides between the af and the pcrf in the ts?23.203?[6].
note?1: except where stated otherwise, this specification does not make an explicit assumption as to whether an interface is intra-plmn or inter-plmn.
when data forwarding is used as part of mobility procedures different UP routes may be used based on the network configuration (e.g. direct or indirect data forwarding). these routes can be between enodeb and rnc, enodeb and sgsn, rnc and s gw or between s gw and sgsn. explicit reference points are not defined for these routes. these UP forwarding routes can cross inter-plmn boundaries (e.g. in the case of inter-plmn ho).
protocol assumption:
- the s1-u is based on gtp-u protocol;
- the s3 is based on gtp protocol;
- the s4 and s11 are based on gtp protocol;
- the s5 is based on gtp protocol. pmip variant of s5 is described in ts?23.402?[2];
- the s8 is based on gtp protocol. pmip variant of s8 is described in ts?23.402?[2].
- s3, s4, s5, s8, s10 and s11 interfaces are designed to manage eps bearers as defined in clause?4.7.2.
note?2: redundancy support on reference points s5 and s8 should be taken into account.
4.2.4 warning system architecture
refer to ts?23.041?[48] and ts?23.002?[71] for the warning system architecture.
4.3 high level functions
4.3.1 general
the following list gives the logical functions performed within this system. several functional groupings (meta functions) are defined and each encompasses a number of individual functions:
- network access control functions.
- packet routing and transfer functions.
- mobility management functions.
- security functions.
- radio resource management functions.
- network management functions.
4.3.2 network access control functions
4.3.2.1 general
network access is the means by which a user is connected to the evolved packet core system.
4.3.2.2 network/access network selection
it is the means by which a ue selects a plmn/access network from which to gain connectivity. the network/access network selection procedure varies for different access technologies. for 3gpp access networks, the network selection principles are described in ts?23.122?[10]. for 3gpp access networks, the access network selection procedures are described in ts?36.300?[5], ts?43.022?[11] and ts?25.304?[12].
architectural impacts stemming from support for network/access network selection procedures for non-3gpp access and between 3gpp access and non-3gpp accesses are described in ts?23.402?[2].
4.3.2.3 authentication and authorisation function
this function performs the identification and authentication of the service requester, and the validation of the service request type to ensure that the user is authorised to use the particular network services. the authentication function is performed in association with the mobility management functions.
4.3.2.4 admission control function
the purpose of admission control is to determine if the requested resources are available, and then reserve those resources.
4.3.2.5 PCEF
this includes all the functionality of pcef as defined by ts?23.203?[6]. the pcef encompasses SDF detection, policy enforcement and flow based charging functionalities as defined in ts?23.203?[6].
4.3.2.6 lawful interception
lawful interception is the action, performed by a network operator / access provider / service provider, of making available certain information and providing that information to a law enforcement monitoring facility.
4.3.2a support for dual connectivity
dual connectivity involves two ran nodes, i.e. master and secondary ran nodes (see ts?36.300?[5] for the definitions), in providing radio resources to a given ue (with active radio bearers), while a single s1-mme termination point exists for an ue between a mme and the e-utran. the e-utran architecture and related functions to support dual connectivity with e-utran is further described in ts?36.300?[5]. dual connectivity with e-utran as master ran node and nr as secondary ran node is further described in ts?37.340?[85].
dual connectivity defines "master cell group (mcg) bearer" and "secondary cell group (scg) bearer" alternatives (see ts?36.300?[5]). for e-rabs configured as "mcg bearers" the u-plane termination points are maintained, whereas for e-rabs configured as "scg bearers" it enables changing the u-plane termination point in the e-utran by means of s1-mme signalling without changing the s1-mme termination point.
dual connectivity also defines a "split bearer" alternative ts?36.300?[5]. the "split bearer" in the e-utran is transparent to the core network entities (e.g. mme, s-gw etc.) with the exception of the csg membership verification by the mme when the secondary enb is a hybrid access enb.
the e-utran uses the per-ue information supplied by the mme and local e-utran configuration data to determine whether or not to use dual connectivity for that ue, and, on a per eps bearer basis the e-utran decides whether to use an mcg bearer or scg bearer, and, whether or not that bearer is a "split bearer".
note?1: typically, the mme and sgw cannot determine whether the ran termination point(s) for the s1-u interface are located on a master ran node that has multiple ip addresses, or, on a secondary ran node.
if the mme has an access restriction for nr for a ue (either signalled from the hss, or, locally generated by vplmn policy in the mme) then the mme shall signal this to the e-utran as part of handover restriction list and to the ue in attach and tau accept as defined in clauses 5.3.2.1, 5.5.2.2.3, 5.5.2.4.3 and d.3.6 respectively.
an enb supporting dual connectivity with nr checks whether the ue is allowed to use nr. if the ue is not allowed to use nr, the enb shall not establish dual connectivity with nr as a secondary rat.
the mme uses "ue support for dual connectivity with nr" for sgw and pgw selection when the ue indicates support for nr and there is no access restriction for nr for the ue.
an e-utran cell, based on operator configuration, broadcasts whether it is capable of supporting dual connectivity with locally available nr secondary cell(s).
at inter-rat handover from geran/utran, the access restriction for nr is either already in the mme's ue context, or, is obtained from the hss during the subsequent tracking area update procedure (i.e. not from the source sgsn or source ran). in both inter-rat handover cases, any nr access restriction is then signalled to the e-utran.
note?2: this signalling of the access restriction during the tau after the inter-rat handover procedure means that there is a small risk that nr resources are transiently allocated.
the enb, at which the s1-mme terminates, performs all necessary s1-mme related functions (as specified for any serving enb) such as mobility management, relaying of nas signalling, e-rab handling, etc. and manages the handling of UP connection of s1-u.
additional functional characteristics are:
- user location information reporting is based on the identity of the cell that is serving the ue and supported by the enb terminating s1-mme.
- path update signalling for e-rabs configured as "scg bearers" and serving gw relocation cannot occur at the same time.
- during handover with dual connectivity, the requirement of forwarding "end marker" packets to target node is also applicable to secondary ran node if it is the source node for s1-u bearer.
- after handover with data forwarding, the e-utran initiated e-rab modification procedure of clause?5.4.7 should not be initiated by the target enb before "end marker" packet is received at the target ran node or a timer in target enb expires.
- relaying function is not supported.
- csg function may be supported in case the secondary enb is a hybrid access enb (see more details in clause?5.4.7 and in ts?36.300?[5]).
note?3: a henb cannot be the master enb, i.e. a henb cannot initiate the secondary enb addition procedure.
note?4: a henb is not allowed to be the secondary enb if the henb is a closed access enb.
- when the secondary enb is a hybrid access enb, the master enodeb may ask csg membership verification to the mme using e-rab modification indication message (for scg bearers) or ue context modification indication (for split bearers) message. the mme shall determine the csg membership based on the csg membership information as specified in ts?36.300?[5] and shall respond to the master enodeb using respectively a e-rab modification confirm or a ue context modification confirm, but shall not update the user csg information in the core network.
- the lipa function may be supported for the scg bearer alternative, in the case that the secondary enb is a henb with a collocated l-gw (see more details in ts?36.300?[5]).
- "sipto at the local network with l-gw function collocated with the (h)enb" function may be supported (see more details in ts?36.300?[5]):
- for the mcg and split bearer alternatives, in case the master enb is collocated with a l-gw; and/or
- for the scg bearer alternative, in case the secondary enb is a (h)enb with a collocated l-gw.
note?5: lipa or sipto at the local network pdn connection can be established if the senb has already been added before the ue requests establishment of the lipa or sipto at the local network pdn connection.
note?6: lipa or sipto at the local network pdn connection can be established if the ue is in the coverage of the candidate senb when the ue requests establishment of the lipa or sipto at the local network pdn connection, but the senb has not yet been added. in this case, there is a time gap between the moment when the pdn connection establishment is completed and the moment when the senb addition procedure is completed.
- "sipto at the local network with stand-alone gw" function may be supported for the mcg, scg, and split bearer alternatives if the master and secondary enbs belong to the same lhn (see more detail in ts?36.300?[5]).
4.3.3 packet routing and transfer functions
4.3.3.1 general
a route is an ordered list of nodes used for the transfer of packets within and between the plmn(s). each route consists of the originating node, zero or more relay nodes and the destination node. routing is the process of determining and using, in accordance with a set of rules, the route for transmission of a message within and between the plmn(s).
the eps is an ip network and uses the standard routing and transport mechanisms of the underlying ip network.
the maximum transfer unit (mtu) size considerations in clause?9.3 of ts?23.060?[7] are also applicable to eps.
4.3.3.2 ip header compression function
the ip header compression function optimises use of radio capacity by ip header compression mechanisms.
when CP ciot eps optimisation is supported for pdn connections of ip pdn type, if the ip header compression based on rohc framework ietf?rfc?5795?[77] is implemented in the mme and the ue, the rohc profiles defined in ts?36.323?[78] may be supported.
4.3.3.3 packet screening function
the packet screening function provides the network with the capability to check that the ue is using the exact ipv4-address and/or ipv6-prefix that was assigned to the ue.
4.3.3.4 ip multicast forwarding between a network accessed by lipa and a ue
the home enodeb l-gw should support ip forwarding of packets to multicast groups between the ue and the network accessed by lipa.
4.3.4 security functions
the security functions are described in clause?5.3.10.
4.3.5 mobility management functions
4.3.5.1 general
the mobility management functions are used to keep track of the current location of a ue.
intra-rat mobility for nb-iot ues is supported.
inter-rat idle mode mobility between nb-iot and wb-eutran/utran/geran is supported. tracking area list management as defined in clause?4.3.5.3 is required to ensure that at inter-rat mobility, the ue performs a tau or rau procedure.
4.3.5.2 reachability management for ue in ecm-idle state
the location of a ue in ecm-idle state is known by the network on a tracking area list granularity. all cells of the tracking areas in which a ue in ecm-idle is currently registered needs to be taken into account for paging. the ue may be registered in multiple tracking areas. all the tracking areas in a tracking area list to which a ue is registered are served by the same serving mme.
an emm-registered ue performs periodic tracking area updates with the network after the expiry of the periodic tau timer.
the mme may allocate long periodic tau timer value to the ue according to clause?4.3.17.3.
if the ue is out of e-utran coverage (including the cases when the ue is camped on geran/utran cells) when its periodic tau timer expires, the ue shall:
- if isr is activated, start the e-utran deactivate isr timer. after the e-utran deactivate isr timer expires the ue shall deactivate isr by setting its tin to "p-tmsi".
- if isr is activated and the ue is camping on a geran/utran cell (or returns to coverage in geran/utran) and the ue is eps/imsi attached, perform a lau procedure in nmo ii or a combined ra/la update procedure in nmo i.
- when emm-registered, perform a tracking area update when it next returns to e utran coverage.
if the ue is camped on an e utran cell or is in ecm connected state when the ue's periodic rau timer expires, the ue shall:
- if isr is activated, start the geran/utran deactivate isr timer. after the geran/utran deactivate isr timer expires the ue shall deactivate isr by setting its tin to "guti".
- perform a routing area update when it next returns to geran/utran coverage.
if the ue is eps attached only and either camps on an e utran cell or is in ecm connected state when the ue's periodic lau timer expires, the ue shall perform a location area update procedure in nmo ii or combined ra/la update in nmo i when it next returns to geran/utran coverage.
the e-utran deactivate isr timer is stopped when the ue performs a successful tracking area update or combined ta/la update; and the geran/utran deactivate isr timer is stopped when the ue performs a successful routing area update or combined ra/la update.
expiry of the periodic tau timer, or, the periodic rau timer, or, the periodic lau timer shall not cause the ue to change rat.
the ue's periodic tau timer is restarted from its initial value whenever the ue enters ecm idle mode and when the ue leaves the e utran connection due to handover to geran/utran. utran rrc state transitions and geran gprs standby/ready state transitions shall have no other impact on the periodic tau timer.
e utran rrc state transitions shall have no impact on the periodic rau timer or periodic lau timer except that handover from geran/utran to e utran shall cause the periodic rau timer to be started from its initial value.
handover from e utran to utran/geran shall cause the periodic tau timer to be started from its initial value.
typically, the mme runs a mobile reachable timer. whenever the ue enters ecm idle mode the timer is started with a value similar to the ue's periodic tau timer. if this timer expires in the mme, the mme can deduce that the ue is not reachable. however, the mme does not know for how long the ue is not reachable, so, the mme shall not immediately delete the ue's bearers. instead the mme should clear the ppf flag in the mme and start an implicit detach timer, with a relatively large value and if isr is activated, at least slightly larger than the ue's e-utran deactivate isr timer.
if mme has allocated an active time to the ue, then the mme starts the active timer with the value of active time whenever the ue enters ecm idle mode. if this timer expires in the mme, the mme can deduce that the ue is not reachable and should clear the ppf flag in the mme.
with the ppf clear, the mme does not page the ue in e utran coverage and shall send a downlink data notification reject message to the serving gw when receiving a downlink data notification message from the serving gw. if the implicit detach timer expires before the ue contacts the network, then the mme can deduce that the ue has been 'out of coverage' for a long period of time and implicitly detach the ue as described in clause?5.3.8.3 "mme-initiated detach procedure".
if the mme is requested to monitor reachability for data and the ue enters ecm-connected, the mme sends a monitoring report message to the address that was indicated in the related monitoring request as described in ts?23.682?[74].
when the mme applies general nas level mobility management congestion control to a ue, the mme may need to adjust the mobile reachable timer and/or implicit detach timer (as clause?4.3.7.4.2.4).
note?1: the sgsn has similar functionality as the mme.
note?2: alternative mme implementations are permitted, however, the externally visible mme behaviour should conform to the above description.
4.3.5.3 tracking area list management
tracking area list management comprises the functions to allocate and reallocate a tracking area identity list to the ue. all the tracking areas in a tracking area list to which a ue is registered are served by the same serving mme.
the "tracking area list concept" is used with e-utran. with this concept, when the ue registers with the network, the mme allocates a set (a "list") of tracking areas to the ue. by making the centre of this set of tracking areas close to the ue's current location, the chance of a ue rapidly making another tracking area update can be reduced.
if sipto at local network with stand-alone gw, serving gw relocation without mobility and isr are supported in the core network the tracking area list should only contain either tracking areas inside one local network or inside the macro network. if the tracking area list covers both local network and macro network, the isr shall not be activated if the ue is allowed to use sipto at local network.
the mme determines the rat type the ue is camping on, i.e. nb-iot or wb-e-utran, based on the tracking area indicated in the initial ue message by the enb.
to ensure a ue initiates tracking area updating procedure when perfoming inter-rat mobility between nb-iot and wb-e-utran, the e-utran shall be configured such that a tracking area does not contain both wb-e-utran and nb-iot cells, and, the mme shall not allocate a tracking area identity list that contains both nb-iot and wb-e-utran tracking areas.
to ensure the ue initiates tracking area update procedure when it moves to and from an mme that supports 15 eps bearers per ue as defined in clause?4.12 to an mme that does not support 15 eps bearers per mme and vice versa, the mme shall allocate a tracking area identity list that provides homogenous support for 15 eps bearers per ue.
other features (e.g. UP ciot eps optimisation, supporting up to 15 eps bearers per ue) may require the mme to adapt how it creates the "list" of tais.
note: this tai list functionality is different to the sgsn behaviour in geran and utran systems. in geran/utran the ue is only registered in one routeing area at a time.
4.3.5.4 inter-enodeb mobility anchor function
the inter-enodeb mobility anchor is the functional entity that anchors the UP for e-utran mobility.
4.3.5.5 inter-3gpp mobility anchor function
the inter-3gpp mobility anchor is the functional entity that anchors the UP for mobility between 3gpp 2g/3g access systems and the e-utra access system.
4.3.5.6 idle mode signalling reduction function
the idle mode signalling reduction (isr) function provides a mechanism to limit signalling during inter-rat cell-reselection in idle mode (ecm-idle, pmm-idle, gprs standby states).
note?1: the idle mode signalling reduction function is mandatory for e-utran ues that support geran and/or utran and optional for core network. the ue's isr capability in the ue core network capability element is for test purpose.
the mme/sgsn activates isr only if the serving gw supports the isr. how mme/sgsn determines a serving gw supports isr is implementation dependent.
isr shall be activated by decision of the cn nodes and shall be explicitly signalled to the ue as "isr activated" in the rau and tau accept messages. the ue may have valid mm parameters both from mme and from sgsn. the "temporary identity used in next update" (tin) is a parameter of the ue's mm context, which identifies the ue identity that the ue shall indicate in the next rau request, tau request or attach request message. the tin also identifies the status of isr activation in the ue.
the tin can take one of the three values, "p tmsi", "guti" or "rat-related tmsi". the ue shall set the tin when receiving an attach accept, a tau accept or rau accept message according to the rules in table?4.3.5.6-1.
table 4.3.5.6-1: setting of the tin
message received by ue
current tin value stored by ue
tin value to be set by the ue when receiving message
attach accept via e-utran
(never indicates "isr activated")
any value
guti
attach accept via geran/utran
(never indicates "isr activated")
any value
p-tmsi
tau accept
not indicating "isr activated"
any value
guti
tau accept
indicating "isr activated"
guti
p tmsi or rat-related tmsi
guti
rat-related tmsi
rau accept
not indicating "isr activated"
any value
p tmsi
rau accept
indicating "isr activated"
p tmsi
guti or rat-related tmsi
p tmsi
rat-related tmsi

when "isr activated" is indicated by the rau/tau accept message but the ue shall not set the tin to "rat-related tmsi" is a special situation. here the ue has deactivated isr due to special situation handling. by maintaining the old tin value the ue remembers to use the rat specific tmsi indicated by the tin when updating with the cn node of the other rat.
only if the tin is set to "rat-related tmsi" isr behaviour is enabled for the ue, i.e. the ue can change between all registered areas and rats without any update signalling and it listens for paging on the rat it is camped on. if the tin is set to "rat-related tmsi", the ue's p tmsi and rai as well as its guti and tai(s) shall remain registered with the network and shall remain valid in the ue.
table?4.3.5.6-2: temporary ue identity that the ue shall indicate in attach request and tau/rau request (as "old guti" or as "old p tmsi/rai" information element)
message to be sent by ue
tin value: p-tmsi
tin value: guti
tin value: rat-related tmsi
tau request
guti mapped from p tmsi/rai
guti
guti
rau request
p-tmsi/rai
p tmsi/rai mapped from guti
p tmsi/rai
attach request via e-utran
guti mapped from p tmsi/rai
guti
guti
attach request via geran/utran
p tmsi/rai
p tmsi/rai mapped from guti
p tmsi/rai

table?4.3.5.6-2 shows which temporary identity the ue shall indicate in a tracking or routing area update request or in an attach request message, when the ue stores these as valid parameters.
situations may occur that cause unsynchronized state information in the ue, mme and sgsn. such special situations trigger a deactivation of isr locally in the ue.
the ue shall deactivate isr locally by setting its tin to the temporary identity of the currently used rat in following special situations:
- modification of any eps bearer context or pdp context which was activated before the isr is activated in the ue;
- at the time when the ue moves from e utran to geran/utran or moves from geran/utran to e utran by means other than psho, if any eps bearer context or pdp context activated after the isr was activated in the ue exists;
- at the time when the ue moves from geran/utran to e utran by means other than psho and cs to ps srvcc, if the pdp contexts were suspended in geran and not successfully resumed before returning to e utran;
- after updating either mme or sgsn about the change of the ue specific drx parameters to guarantee that the other cn node is also updated;
- after updating either mme or sgsn about the change of the ue core network capabilities to guarantee that the other cn node is also updated;
- e-utran selection by a utran-connected ue (e.g. when in ura_pch to release iu on utran side);
- e-utran selection from geran ready state;
- geran selection by an e-utran-connected ue via cell change order that is not for cs fallback;
- after a lau procedure if the ue has cs fallback and/or sms over sgs activated.
- for a ue that is ims registered for voice, then after that ue moves from a registration area that supports ims voice over ps sessions (see 4.3.5.8 for more information) to one that does not, and vice versa. it shall be possible, e.g. using device management or initial provisoning, to configure the ue to apply/not apply this particular exception.
note?2: a ue moving between registration areas that both support ims voice over ps sessions, or, both that do not support ims voice over ps sessions, is unaffected by the above.
the ue shall deactivate isr locally by setting its tin to the temporary identity of the rat that is still available to the ue in following special situations:
- after the rat-specific deactivate isr timer expires, e.g. because the coverage of that rat is lost or the rat is no more selected by the ue (this may result also in implicit detach by sgsn or mme).
isr shall be deactivated in the ue by the cn node using normal update signalling, i.e. by omitting the signalling of "isr activated", in following special situations:
- cn node change resulting in context transfer between the same type of cn nodes (sgsn to sgsn or mme to mme);
- serving gw change;
- when the ue only has bearers related to emergency bearer service;
- tau or rau when ue moves over the border between local and macro network where sipto at local network with stand-alone gw and serving gw relocation without mobility are supported in the core network.
- tau or rau when the network confirms to use psm for the ue.
if tracking area list or routing area covers both local network and macro network, the isr shall not be activated if the ue is allowed to use sipto at local network and serving gw relocation without mobility are supported in the core network.
4.3.5.7 mobility restrictions
mobility restrictions comprises the functions for restrictions to mobility handling of a ue in e-utran access. the mobility restriction functionality is provided by the ue, the radio access network and the core network.
mobility restriction functionality in state ecm-idle is executed in ue based on information received from the core network. mobility restriction functionality in state ecm-connected is executed in the radio network and the core network.
in state ecm-connected, the core network provides the radio network with a handover restriction list. the handover restriction list specifies roaming, area and access restrictions. if roaming restriction to geran or utran access needs to be enforced, a mme that is connected to enbs that may handover or invoke release with redirection to utran or geran is configured with a list of hplmn ids that are permitted to access geran or utran unless restricted by the ue individual access restriction information received from hss.
4.3.5.8 ims voice over ps session supported indication
the serving plmn shall send an indication toward the ue during the attach procedure and tracking area update procedures if an ims voice over ps session is supported. the serving plmn uses this indicator to indicate to the ue whether it can expect a successful ims voice over ps session according to ts?22.173?[73] with a bearer that supports conversational voice as specified in ts?23.203?[6]. a ue with "ims voice over ps" voice capability should take this indication into account when establishing voice over ps sessions (as specified in ts?23.221?[27]) as well as when determining whether to deactivate the special handling of isr locally (as detailed in clause?4.3.5.6).
the serving plmn provides this indication based e.g. on local policy, hplmn, voice support match indicator, the srvcc capability of the network and ue and/or extends of e-utran/utran coverage. the serving plmn shall indicate to the ue that the ue can expect a successful ims voice over ps session only if the mme is configured to know that the serving plmn has a roaming agreement for ims voice with the hplmn of the ue. this indication is per tai list.
on request by the hss, the mme shall indicate the following:
- whether or not an ims voice over ps session is supported in the ta(s) that are registered for the ue ("ims voice over ps session supported indication"), together with the time of the last radio contact with the ue; and
- the current rat type.
note: in order to support routing of incoming ims voice calls to the correct domain (ps or cs), the network-based t-ads (see ts?23.292?[60] and ts?23.221?[27]) requires that there is homogeneous support/non-support of ims voice over ps session for all registered tas of the ue.
4.3.5.8a homogenous support of ims voice over ps sessions indication
the "homogenous support of ims voice over ps sessions" indication is provided by the mme to the hss, and can be used by the hss to avoid requesting the serving nodes whether or not an ims voice over ps session according to ts?22.173?[73] with a bearer that supports conversational voice as specified in ts?23.203?[6] is supported. this indication is stored in the mme mm context.
the mme shall behave as follows whenever it sends a update location request or a notify request message to the hss:
- if "ims voice over ps sessions" is supported homogeneously in all tas in the serving mme for the ue, the mme shall include the "homogenous support of ims voice over ps sessions" indication set to "supported".
- if none of the tas of the serving mme supports "ims voice over ps sessions" for the ue, the mme shall include the "homogenous support of ims voice over ps sessions" indication set to "not supported".
- if "ims voice over ps sessions" support is either non-homogeneous or unknown, the mme shall not include the "homogenous support of ims voice over ps sessions" indication.
regarding homogenous support/non-support of ims voice over ps session for all registered tas of the ue, see clause?4.3.5.8.
4.3.5.9 voice domain preference and ue's usage setting
if the ue supports cs fallback, or the ue is configured to support ims voice, or both, the ue shall include the information element "voice domain preference and ue's usage setting" in attach request, tracking area update request and routing area update request messages. the purpose of this information element is to signal to the network the ue's usage setting and voice domain preference for e-utran. the ue's usage setting indicates whether the ue behaves in a voice centric or data centric way (as defined in ts?23.221?[27]). the voice domain preference for e utran indicates whether the ue is configured as cs voice only, cs voice preferred and ims ps voice as secondary, ims ps voice preferred and cs voice as secondary, or ims ps voice only (as defined in ts?23.221?[27]).
in this release of the specifications, inter-rat mobility to/from the nb-iot rat is not supported, and gbr bearers are not supported in the nb-iot rat. hence the ue should not include the "voice domain preference and ue's usage setting" ie when sending an attach request or tracking area update request on the nb-iot rat.
note: depending on operator's configuration, the ue's usage setting and voice domain preference for e utran can be used by the network to choose the rfsp index in use (see clause?4.3.6). as an example, this enables the enforcement of selective idle mode camping over geran/utran for voice centric ues relying on cs fallback for voice support in e utran.
4.3.5.10 preferred and supported network behaviour
a ue includes in a preferred network behaviour indication the network behaviour the ue can support and what it would prefer to use.
the preferred network behaviour includes this information:
- whether CP ciot eps optimisation is supported.
- whether UP ciot eps optimisation is supported.
- whether CP ciot eps optimisation is preferred or whether UP plane ciot eps optimisation is preferred.
- whether s1-u data transfer is supported.
- whether sms transfer without combined attach is requested.
- whether attach without pdn connectivity is supported.
- whether header compression for CP ciot eps optimisation is supported.
if sms transfer without combined eps attach is requested by the ue, a supporting mme provides sms transfer without the ue performing the combined eps attach specified in ts?23.272?[58]. an mme connected to nb-iot should support sms transfer without the ue being required to perform a combined attach.this feature is only available to ues that only support nb-iot.
if s1-u data transfer is supported is indicated by the ue, the ue supports data transfer that is not subject to ciot eps optimisations. if the ue indicates support of UP ciot eps optimisation then it shall also indicate support of s1-u data transfer.
if attach without pdn connection is supported, the ue need not establish a pdn connection as part of the attach procedure and the ue and mme may at any time release all the pdn connections and remain eps attached.
the mme indicates the network behaviour the network accepts in the supported network behaviour information. this indication is per tai list. the mme may indicate one or more of the following:
- whether CP ciot eps optimisation is supported.
- whether UP ciot eps optimisation is supported.
- whether s1-u data transfer is supported.
- whether sms transfer without combined attach is accepted.
- whether attach without pdn connectivity is supported.
- whether header compression for CP ciot eps optimisation is supported.
if the mme indicates support of UP ciot eps optimisation then it shall also indicate support of s1-u data transfer. if the ue and mme indicate support for UP ciot eps optimisation, mme sets the ue UP ciot support indicator to "supported" in s1-ap messages as defined in ts?36.413?[36].
for nb-iot ues that only support CP ciot eps optimisation, the mme shall include support for CP ciot eps optimisation in nas accept messages.
a ue that supports the nb-iot shall always indicate support for CP ciot eps optimisation.
in a network that supports dedicated core networks (see clause?5.19), the preferred network behaviour indication from the ue may be used to influence policy decisions that can cause rerouting of the attach or tau from an mme to another mme.
other ciot eps optimisations include "attach without pdn connection establishment"; "pdn type = non-ip"; and "ue connection to scef". these features are requested by implicit and explicit signalling described within the relevant clauses of this ts.
4.3.6 radio resource management functions
radio resource management functions are concerned with the allocation and maintenance of radio communication paths, and are performed by the radio access network. the rrm strategy in e-utran may be based on user specific information.
to support radio resource management in e-utran the mme provides the parameter 'index to rat/frequency selection priority' (rfsp index) to an enodeb across s1. the rfsp index is mapped by the enodeb to locally defined configuration in order to apply specific rrm strategies. the rfsp index is ue specific and applies to all the radio bearers. examples of how this parameter may be used by the e-utran:
- to derive ue specific cell reselection priorities to control idle mode camping.
- to decide on redirecting active mode ues to different frequency layers or rats.
the mme receives the subscribed rfsp index from the hss (e.g., during the attach procedure). for non-roaming subscribers the mme chooses the rfsp index in use according to one of the following procedures, depending on operator's configuration:
- the rfsp index in use is identical to the subscribed rfsp index, or
- the mme chooses the rfsp index in use based on the subscribed rfsp index, the locally configured operator's policies and the ue related context information available at the mme, including ue's usage setting and voice domain preference for e-utran, if received during attach and tracking area update procedures (see clause?4.3.5.9).
note: one example of how the mme can use the "ue voice capabilities and settings" is to select an rfsp value that enforces idle mode camping on 2g/3g for a ue acting in a "voice centric" way and provisioned with "cs voice preferred, ims voice as secondary", in order to minimize the occurrancy of rat changes. another example is the selection of an rfsp value that prevents idle mode camping on 2g for a ue provisioned with "ims ps voice preferred, cs voice as secondary" if other rats supporting ims voice are available, as the ue would in such case always select the cs domain for its voice calls.
for roaming subscribers the mme may alternatively choose the rfsp index in use based on the visited network policy, but can take input from the hplmn into account (e.g., an rfsp index value pre-configured per hplmn, or a single rfsp index value to be used for all roamers independent of the hplmn).
the mme forwards the rfsp index in use to the enodeb across s1. the rfsp index in use is also forwarded from source enodeb to target enodeb when x2 is used for intra-e utran handover.
the mme stores the subscribed rfsp index value received from the hss and the rfsp index value in use. during the tracking area update procedure, the mme may update the rfsp index value in use (e.g. the mme may need to update the rfsp index value in use if the ue related context information in the mme has changed). when the rfsp index value in use is changed, the mme immediately provides the updated rfsp index value in use to enodeb by modifying an existing ue context or by establishing an new ue context in the enodeb or by being configured to include the updated rfsp index value in use in the downlink nas transport message if the UP establishment is not needed. during inter-mme mobility procedures, the source mme forwards both rfsp index values to the target mme. the target mme may replace the received rfsp index value in use with a new rfsp index value in use that is based on the operator's policies and the ue related context information available at the target mme.
the s1 messages that transfer the rfsp index to the enodeb are specified in ts?36.413?[36]. refer to ts?36.300?[5] for further information on e-utran.
4.3.7 network management functions
4.3.7.1 general
network management functions provide mechanisms to support o&m functions related to the evolved packet system.
4.3.7.1a gtp-c signalling based load and overload control
4.3.7.1a.1 gtp-c load control
gtp-c load control feature is an optional feature which allows a gtp CP node to send its load control information to a peer gtp CP node which the receiving gtp CP peer node uses to augment existing gw selection procedure (i.e. as described in "pdn gw selection" and "serving gw selection" according to clauses?4.3.8.1, and 4.3.8.2 respectively). load control information reflects the operating status of the resources of the originating gtp CP node.
note?1: how a node computes its load control information is implementation dependent.
where certain pre-condition as described in clause?12.2.4.1 of ts?29.274?[43], is applicable, an optional feature apn level load control may be supported and activated in the network. if this feature is activated, the pdn gw may convey the load control information at apn level (reflecting the operating status of the resources at the apn level), besides at node level.
gtp-c load control feature allows the serving gw to send its load control information to the mme/sgsn.
gtp-c load control feature also allows the pdn gw to send its load control information to the mme/sgsn via a serving gw.
upon receiving load control information the mme/sgsn supporting gtp-c load control feature uses it according to clauses?4.3.8.1, and 4.3.8.2 for "pdn gw selection" and "serving gw selection" respectively.
a node supporting gtp-c load control feature sends load control information in any gtp CP request or response message such that exchange of load control information does not trigger extra signalling.
a node supporting gtp-c load control feature sends load control information to a peer gtp control node based on whether local configuration allows for it.
a node supporting gtp-c load control feature may decide to send different values of load control information on inter-network (roaming) and on intra-network (non-roaming) interfaces based on local configuration.
local configuration may allow the vplmn to decide whether or not to act upon load control information sent from a peer gtp CP node in the hplmn.
note?2: refer to clause?12 of ts?29.274?[43] for the details, such as exact format of the load control information, mechanisms to discover the support of the feature by the peer node, interfaces for which this feature is applicable, apn level load control, etc.
4.3.7.1a.2 gtp-c overload control
gtp-c overload control feature is an optional feature. nodes using gtp CP signalling may support communication of overload control information in order to mitigate overload situation for the overloaded node through actions taken by the peer node(s). this feature is supported over s4, s11, s5 and s8 interfaces via gtpv2 CP protocol.
a gtp-c node is considered to be in overload when it is operating over its nominal capacity resulting in diminished performance (including impacts to handling of incoming and outgoing traffic). overload control information reflects an indication of when the originating node has reached such situation. this information, when transmitted between gtp-c nodes may be used to reduce and/or throttle the amount of gtp-c signalling traffic between these nodes. as such, the overload control information provides guidance to the receiving node to decide actions which leads to mitigation towards the sender of the information.
note?1: how a node determines its overload control information is implementation dependent.
the overload control information may convey information regarding the node itself and/or regarding specific apn(s) status. in order to mitigate overload,
- it shall be possible to signal control information about the overload of a gtp-c node (e.g. s-gw, p-gw);
- the pdn gw may detect overload for certain apns, e.g. based on diameter overload indication received from a pcrf or from an external aaa server, or e.g. based on shortage of resources for an apn (ip address pool). it shall be possible to signal appropriate control information about the apn status in addition to the mechanism described in clause?4.3.7.5.
for a given apn, the pdn gw shall either activate the congestion control by conveying the overload control information at apn level or by conveying the "pdn gw back-off time" (as specified in clause?4.3.7.5), but not both at the same time, as specified in more detail in clause?12.3.8 of ts?29.274?[43].
gtp-c overload control feature allows the mme/sgsn to send its overload control information to the pdn gw via serving gw.
gtp-c overload control feature allows the serving gw to send its overload control information to the mme/sgsn and p-gw.
gtp-c overload control feature also allows the pdn gw to send its overload control information to the mme/sgsn via a serving gw.
gtp-c overload control feature should continue to allow for preferential treatment of priority users (emps) and emergency services as per existing specifications.
an mme/sgsn may during esm and emm procedures apply certain restrictions towards gws (serving gw and/or pdn gw as applicable) that have indicated overload, e.g.:
- reject eps session management requests from the ue (e.g. pdn connectivity, bearer resource allocation or bearer resource modification requests) with a session management back-off timer as described in clause?4.3.7.4.2;
- reject mobility management signalling requests from ues (such as attach, detach, service request, tracking area update) with a mobility management back-off timer (e.g. reject service request requiring to activate UP bearers in an overloaded sgw) as described in clause?4.3.7.4.2;
- reject or accept requests for data transmission via CP ciot eps optimisation from ues (e.g. CP service request and esm data transport) with a CP data back-off timer as described in clause?4.3.7.4.2.7;
- may reduce/throttle messages towards the gws indicating overload status;
- other implementation specific mechanisms, which are outside the scope of 3gpp specifications.
a pdn gw may take the following actions for mme/sgsn which have indicated overload:
- limit or completely block non-gbr dedicated bearer establishment;
- limit or completely block all dedicated bearer establishments or modification, except qci=1 bearers;
- limit or completely block all dedicated bearer establishments, including the qci=1 bearers;
- other implementation specific mechanisms, which are outside the scope of 3gpp specifications.
a node supporting gtp-c overload control feature sends overload control information in any gtp CP request or response message such that exchange of overload control information does not trigger extra signalling.
the computation and transfer of the overload control information shall not add significant additional load to the node itself and to its corresponding peer nodes. the calculation of overload control information should not severely impact the resource utilization of the node.
based on local policies/configuration, a gtp-c node may support overload control feature and act upon or ignore overload control information in the vplmn when received from hplmn and in the hplmn when received from vplmn. when this feature is supported, a gtp-c node may decide to send different values of overload control information on inter-network (roaming) and on intra-network (non-roaming) interfaces based on local policies/configuration.
note?2: refer to clause?12 of ts?29.274?[43] for the details, such as exact format of the overload control information, mechanisms to discover the support of the feature by the peer node, interfaces for which this feature is applicable, apn level overload control, etc.
4.3.7.2 load balancing between mmes
the mme load balancing functionality permits ues that are entering into an mme pool area to be directed to an appropriate mme in a manner that achieves load balancing between mmes. this is achieved by setting a weight factor for each mme, such that the probability of the enodeb selecting an mme is proportional to its weight factor. the weight factor is typically set according to the capacity of an mme node relative to other mme nodes. the weight factor is sent from the mme to the enodeb via s1-ap messages (see ts?36.413?[36]). if a henb gw is deployed, the weight factor is sent from the mme to the henb gw.
note?1: an operator may decide to change the weight factor after the establishment of s1-mme connectivity as a result of changes in the mme capacities. e.g., a newly installed mme may be given a very much higher weight factor for an initial period of time making it faster to increase its load.
note?2: it is intended that the weight factor is not changed frequently. e.g. in a mature network, changes on a monthly basis could be anticipated, e.g. due to the addition of ran or cn nodes.
in some networks, the enodeb may be configured to select specific mme for ues configured for low access priority with a different load balance to that used for mme selection for other ues.
note?3: the enodeb can determine whether or not the "ue is configured for low access priority" from information received in the rrc establishment or rrc resume signalling.
when dcns are used, load balancing by enodeb is only performed between mmes that belong to the same dcn within the same mme pool area, i.e. mmes with the same plmn and mmegi value. when an mme serves multiple dcns and one dcn is supported by multiple mmes, in order to achieve load balancing across the mmes of the same mme pool area supporting the same dcn, each dcn supported by this mme may have its own weight factor (weight factor per dcn). the weight factor per dcn is set according to the capacity of an mme node for a specific dcn relative to other mme nodes' capacity for that dcn within the same mme pool area. the enb is provided with per dcn weight factors, if any, by the connected mmes at the set-up of the s1 connection. the dcn load balancing functionality permits ues that are entering into a pool area or being re-directed to an appropriate dcn to be distributed in a manner that achieves load balancing between the cn nodes of the same dcn. the enodeb may be configured to select mme(s) from a specific cn for ues configured for low access priority only for the case that no other information and configuration is available for selecting an mme from a specific dcn.
4.3.7.3 load re-balancing between mmes
the mme load re-balancing functionality permits ues that are registered on an mme (within an mme pool area) to be moved to another mme.
note?1: an example use for the mme load re-balancing function is for the o+m related removal of one mme from an mme pool area.
note?2: typically, this procedure should not be used when the mme becomes overloaded because the load balancing function should have ensured that the other mmes in the pool area are similarly overloaded.
the enodebs may have their load balancing parameters adjusted beforehand (e.g. the weight factor is set to zero if all subscribers are to be removed from the mme, which will route new entrants to the pool area into other mmes).
in addition the mme may off-load a cross-section of its subscribers with minimal impacts on the network and users (e.g. the mme should avoid offloading only the low activity users while retaining the high activity subscribers. gradual rather than sudden off-loading should be performed as a sudden re-balance of large number of subscribers could overload other mmes in the pool. with minimal impact on network and the user's experience, the subscribers should be off-loaded as soon as possible). the load re-balancing can off-load part of or all the subscribers.
to off-load ecm-connected mode ues, the mme initiates the s1 release procedure with release cause "load balancing tau required" (clause 5.3.5). the s1 and rrc connections are released and the ue initiates a tau but provides neither the s-tmsi nor the gummei to enodeb in the rrc establishment.
note?3: special care needs to be taken when offloading relay nodes. this is because there may be ues connected to the rn and some of these ues may be registered on other mmes.
the mme should not release all s1 connections which are selected to be released immediately when offloading is initiated. the mme may wait until the s1 release is performed due to inactivity. when the mme is to be offloaded completely the mme can enforce an s1 release for all remaining ues that were not offloaded by normal tau procedures or by s1 releases caused by inactivity.
to off-load ues which perform ta updates or attaches initiated in ecm-idle mode, the mme completes that procedure and the procedure ends with the mme releasing s1 with release cause "load balancing tau required". the s1 and rrc connections are released and the ue initiates a tau but provides neither the s-tmsi nor the gummei to enodeb in the rrc establishment.
when the ue provides neither the s-tmsi nor the gummei in the rrc establishment, the enodeb should select an mme based on the weight factors of the mmes in the pool.
to off-load ues in ecm-idle state without waiting for the ue to perform a tau or perform service request and become ecm connected, the mme first pages ue to bring it to ecm-connected state. if paging the ue fails and isr is activated, the mme should adjust its paging retransmission strategy (e.g. limit the number of short spaced retransmissions) to take into account the fact that the ue might be in geran/utran coverage.
hardware and/or software failures within an mme may reduce the mme's load handling capability. typically such failures should result in alarms which alert the operator/o+m system. only if the operator/o+m system is sure that there is spare capacity in the rest of the pool, the operator/o+m system might use the load re-balancing procedure to move some load off this mme. however, extreme care is needed to ensure that this load re-balancing does not overload other mmes within the pool area (or neighbouring sgsns) as this might lead to a much wider system failure.
when the dedicated core network (dcn) feature is used, the dcn load re-balancing functionality permits ues that are registered on an mme in the dcn (within a pool area) to be moved to another mme in the same dcn in a manner that achieves load balancing between the cn nodes of the dcn and pool area. the dcn load re-balancing is triggered by the source mme (within a dcn). the details are as follows:
- if the ue is in ecm-idle state, the nas message redirection procedure (see clause?5.19.1) is triggered at the next intra-mme tracking area update request enabling enodeb to load balance between mmes of the same dcn. to off-load ues in ecm-idle state without waiting for the ue to perform a tau or perform service request, the mme first pages the ue to bring it to ecm-connected state and proceeds as decribed for the ecm-connected case below.
- if the ue is in ecm-connected state, the mme performs the guti reallocation procedure, includes the unchanged guti of the ue and a non-broadcast tai to induce the ue to peform a tau procedure, and forces the ue to go to ecm-idle state. during the subsequent tau procedure the mme uses the nas message redirection procedure (see clause?5.19.1) to redirect the ue to another mme within the same dcn.
4.3.7.4 mme control of overload
4.3.7.4.1 general
the mme shall contain mechanisms for avoiding and handling overload situations. these can include the use of nas signalling to reject nas requests from ues.
in addition, under unusual circumstances, the mme shall restrict the load that its enodebs are generating on it if it is configured to enable the overload restriction. this can be achieved by the mme invoking the s1 interface overload procedure (see ts?36.300?[5] and ts?36.413?[36]) to all or to a proportion of the enodeb's with which the mme has s1 interface connections. to reflect the amount of load that the mme wishes to reduce, the mme can adjust the proportion of enodebs which are sent s1 interface overload start message, and the content of the overload start message.
the mme should select the enodebs at random (so that if two mmes within a pool area are overloaded, they do not both send overload start messages to exactly the same set of enodebs).
the mme may optionally include a traffic load reduction indication in the overload start message. in this case the enodeb shall, if supported, reduce the type of traffic indicated according the requested percentage (see ts?36.413?[36]).
note?1: the mme implementation may need to take into account the fact that enodebs compliant to release 9 and earlier version of the specifications do not support the percentage overload indication.
an mme supporting CP ciot eps optimisation may include an indication in the overload start message indicating overload from data transfers via CP ciot eps optimisation.
using the overload start message, the mme can request the enodeb to:
- reject rrc connection requests that are for non-emergency, non-exception reporting and non-high priority mobile originated services; or
note?2: this blocks ps service and service provided by msc following an eps/imsi attach procedure.
- reject new rrc connection requests for eps mobility management signalling (e.g. for ta updates) for that mme;
- only permit rrc connection requests for emergency sessions and mobile terminated services for that mme. this blocks emergency session requests from ues with usims provisioned with access classes 11 and 15 when they are in their hplmn/ehplmn and from ues with usims provisioned with access classes 12, 13 and 14 when they are in their home country (defined as the mcc part of the imsi, see ts?22.011?[67]); or.
note?3: the mme can restrict the number of responses to paging by not sending paging messages for a proportion of the events that initiate paging. as part of this process, the mme can provide preference for paging ues with emergency bearer services and terminations associated with mps arp.
- only permit rrc connection requests for high priority sessions, exception reporting and mobile terminated services for that mme;
- reject new rrc connection requests from ues that access the network with low access priority;
- not accept rrc connection requests with rrc establishment cause "mo-data" or "delaytolerantaccess" from ues that only support CP ciot eps optimisation.
note?4: the rrc connection requests listed in this clause?also include the request for rrc connection resume.
when rejecting an rrc connection request for overload reasons the enodeb indicates to the ue an appropriate timer value that limits further rrc connection requests for a while.
an enodeb supports rejecting of rrc connection establishments for certain ues as specified in ts?36.331?[37]. additionally, an enodeb provides support for the barring of ues configured for extended access barring, as described in ts?22.011?[67]. these mechanisms are further specified in ts?36.331?[37]. if the ue is camping on nb-iot, extended access barring does not apply.
an enodeb may initiate extended access barring when:
- all the mmes connected to this enb request to restrict the load for ues that access the network with low access priority; or
- requested by o&m.
if an mme invokes the s1 interface overload procedure to restrict the load for ues that access the network with low access priority, the mme should select all enodebs with which the mme has s1 interface connections. alternatively, the selected enodebs may be limited to a subset of the enodebs with which the mme has s1 interface connection (e.g. particular location area or where devices of the targeted type are registered).
during an overload situation the mme should attempt to maintain support for emergency bearer services (see clause?4.3.12) and for mps (see clause?4.3.18).
when the mme is recovering, the mme can either:
- send overload start messages with new percentage value that permit more traffic to be carried, or
- the mme sends overload stop messages.
to some, or all, of the enodeb(s).
in addition, to protect the network from overload the mme has the option of rejecting nas request messages which include the low access priority indicator before rejecting nas request messages without the low access priority indicator (see clause?4.3.7.4.2 for more information).
note?5: it cannot be guaranteed that voice services will be available for mobile terminated calls while the mobility management back-off timer is running. it is recommended, that ues requiring voice services are not configured for low access priority.
in addition, for ues that don't support the service gap control feature (see clause?4.3.17.9), the mme may use "general nas level mobility management control" as defined in clause?4.3.7.4.2.1.
4.3.7.4.1a throttling of downlink data notification requests
under unusual circumstances (e.g. when the mme load exceeds an operator configured threshold), the mme may restrict the signalling load that its sgws are generating on it, if configured to do so.
the mme can reject downlink data notification requests for non-priority traffic for ues in idle mode or to further offload the mme, the mme can request the sgws to selectively reduce the number of downlink data notification requests it sends for downlink non-priority traffic received for ues in idle mode according to a throttling factor and for a throttling delay specified in the downlink data notification ack message.
the sgw determines whether a bearer is to be subjected to the throttling of downlink data notification requests on the basis of the bearer's arp priority level and operator policy (i.e. operator's configuration in the sgw of the arp priority levels to be considered as priority or non- priority traffic). while throttling, the sgw shall throttle the downlink data notification requests for low and normal priority bearers by their priority. the mme determines whether a downlink data notification request is priority or non-priority traffic on the basis of the arp priority level that was received from the sgw and operator policy.
if isr is not active for the ue, during the throttling delay, the sgw drops downlink packets received on all its non-priority bearers for ues known as not UP connected (i.e. the sgw context data indicates no downlink UP teid) served by that mme in proportion to the throttling factor, and sends a downlink data notification message to the mme only for the non throttled bearers.
if isr is active for the ue, during the throttling delay, the sgw does not send ddn to the mme and only sends the ddn to the sgsn. if both mme and sgsn are requesting load reduction, the sgw drops downlink packets received on all its non-priority bearers for ues known as not UP connected (i.e. the sgw context data indicates no downlink UP teid) in proportion to the throttling factors.
the sgw resumes normal operations at the expiry of the throttling delay. the last received value of the throttling factor and throttling delay supersedes any previous values received from that mme. the reception of a throttling delay restarts the sgw timer associated with that mme.
4.3.7.4.1b throttling of nidd submit requests
under unusual circumstances (e.g. when the mme load exceeds an operator configured threshold), the mme may restrict nidd submit request messages that its scefs are generating on it, if configured to do so.
4.3.7.4.2 nas level congestion control
4.3.7.4.2.1 general
nas level congestion control contains the functions: "apn based congestion control" and "general nas level mobility management control".
the use of the apn based congestion control is for avoiding and handling of emm and esm signalling congestion associated with ues with a particular apn. both ues and network shall support the functions to provide apn based emm and esm congestion control.
the mme may detect the nas signalling congestion associated with the apn and start and stop performing the apn based congestion control based on criteria such as:
- maximum number of active eps bearers per apn;
- maximum rate of eps bearer activations per apn;
- one or multiple pdn gws of an apn are not reachable or indicated congestion to the mme;
- maximum rate of mm signalling requests associated with the devices with a particular subscribed apn; and/or
- setting in network management.
the mme may detect the nas signalling congestion associated with the ues belonging to a particular group. the mme may start and stop performing the group specific nas level congestion control based on criteria such as:
- maximum rate of mm and sm signalling requests associated with the devices of a particular group; and/or
- setting in network management.
the mme may detect the nas signalling congestion associated with the ues that belong to a particular group and are subscribed to a particular apn. the mme may start and stop performing the apn and group specific nas level congestion control based on criteria such as:
- maximum number of active eps bearers per group and apn;
- maximum rate of mm and sm signalling requests associated with the devices of a particular group and a particular subscribed apn; and/or
- setting in network management.
the mme should not apply nas level congestion control for high priority access and emergency services.
with general nas level mobility management control, the mme may also use the reject of nas level mobility management signalling requests under general congestion conditions such as detecting congestion of one or several dcns in an mme serving multiple dcns.
in addition, for ues that don't support the service gap control feature (see clause?4.3.17.9), the mme may return a mobility management back-off timer to the ue in responses to requests where the intention is to send mo data or re-attach with pdn connectivity when the service gap timer for the ue is running at the mme.
4.3.7.4.2.2 apn based session management congestion control
the apn based session management congestion control may be activated by mme due to e.g. congestion situation at mme, or by oam at mme, or by a restart or recovery condition of a pdn?gw, or by a partial failure or recovery of a pdn?gw for a particular apn(s).
the mme may reject the eps session management (esm) requests from the ue (e.g. pdn connectivity, or bearer resource allocation requests) with a session management back-off timer when esm congestion associated with the apn is detected. if the ue provides no apn, then the mme uses the apn which is used in pdn?gw selection procedure.
the mme may deactivate pdn connections belonging to a congested apn by sending the nas deactivate eps bearer context request message to the ue with a session management back-off timer. if session management back-off timer is set in the nas deactivate eps bearer context request message then the cause "reactivation requested" should not be set.
note?1: ues that don't support the session management back-off timer (including earlier release of ue) might contribute to increasing the signalling load in the mme by reattempting session management procedure.
the mme may store a session management back-off time per ue and apn when congestion control is active for an apn if a request without the low access priority indicator is rejected by the mme. the mme may immediately reject any subsequent request from the ue targeting to the apn before the stored session management back-off time is expired. if the mme stores the session management back-off time per ue and apn and the mme decides to send a session management request message to a ue connected to the congested apn (e.g. due to decreased congestion situation), the mme shall clear the session management back-off time prior to sending any session management request message to the ue.
note?2: the above functionality is to diminish the performance advantage for ues that do not support the nas level back-off timer (e.g. pre-rel 10 ues) compared to ues that do support it.
upon reception of the session management back-off timer in the eps session management reject message or in the nas deactivate eps bearer context request message, the ue shall take the following actions until the timer expires:
- if apn is provided in the rejected eps session management request message or if the session management back-off timer is received in the nas deactivate eps bearer context request message, the ue shall not initiate any session management procedures for the congested apn. the ue may inititate session management procedures for other apns.
- if apn is not provided in the rejected eps session management request message, the ue shall not initiate any session management requests of any pdn type without apn. the ue may initiate session management procedures for specific apn.
- cell/ta/plmn/rat change do not stop the session magement back-off timer.
- the ue is allowed to initiate the session management procedures for high priority access and emergency services even when the session management back-off timer is running.
- the ue is allowed to initiate bearer resource modification procedure to report 3gpp ps data off status change when the eps session management back off timer is running.
- if the ue receives a network initiated eps session management request message for the congested apn while the session management back-off timer is running, the ue shall stop the session management back-off timer associated with this apn and respond to the mme.
- if the ue is configured with a permission for overriding low access priority and the session management back-off timer is running due to a reject message received in response to a request with low access priority, the upper layers in the ue may request the initiation of session management procedures without low access priority.
the ue is allowed to initiate pdn disconnection procedure (e.g. sending pdn disconnection request) when the eps session management back off timer is running.
note?3: the ue does not delete the related session management back-off timer when disconnecting a pdn connection.
the ue shall support a separate session management back-off timer for every apn that the ue may activate.
to avoid that large amounts of ues initiate deferred requests (almost) simultaneously, the mme should select the session management back-off timer value so that deferred requests are not synchronized.
the apn based session management congestion control is applicable to the nas esm signalling initiated from the ue in the CP. the session management congestion control does not prevent the ue to send and receive data or initiate service request procedures for activating UP bearers towards the apn(s) that are under esm congestion control.
4.3.7.4.2.3 apn based mobility management congestion control
the mme may perform the apn based congestion control for ues with a particular subscribed apn by rejecting attach procedures with a mobility management back-off timer.
when congestion control is active for ues with a particular subscribed apn, a mobility management back-off timer may be sent by the mme to ue.
if mme maintains the ue context, the mme may store the back-off time per ue if a request without the low access priority indicator is rejected by the mme. the mme may immediately reject any subsequent request from the ue before the stored back-off time is expired.
note?1: the above functionality is to diminish the performance advantage for ues that do not support the nas level back-off timer (e.g. pre-rel 10 ues) compared to ues that do support it.
after rejecting attach requests, the mme should keep the subscriber data for some time. this allows for rejection of subsequent requests without hss signalling when the congestion situation resulting from ues with a particular subscribed apn persists.
note?2: prior to the reject of attach messages of a ue by the mme, subscriber data for a ue may be present at the mme because it was not deleted after the ue's detach. in this case when apn based congestion control is active for a particular apn in the mme, the first reject of an attach message by the mme for this ue, may be done without hss signaling as well.
while the mobility management back-off timer is running, the ue shall not initiate any nas request for mobility management procedures. however, the ue is allowed to initiate the mobility management procedures for high priority access and emergency services even when the mobility management back-off timer is running. while the mobility management back-off timer is running, the ue is allowed to perform tracking area update if it is already in connected mode.
while the mobility management back-off timer is running, the ue configured with a permission for overriding low access priority is allowed to initiate the mobility management procedures without low access priority if the mobility management back-off timer was started due to a reject message received in response to a request with low access priority and the upper layers in the ue request to activate a pdn connection without low access priority or the ue has an activated pdn connection that is not with low access priority.
to avoid that large amounts of ues initiate deferred requests (almost) simultaneously, the mme should select the mobility management back-off timer value so that deferred requests are not synchronized.
note?3: when receiving the mobility management back-off timer the ue behaviour is not apn specific.
4.3.7.4.2.4 general nas level mobility management congestion control
under general overload conditions the mme may reject mobility management signalling requests from ues. when a nas request is rejected, a mobility management back-off timer may be sent by the mme and mme may store the back-off time per ue if a request without the low access priority indicator is rejected by the mme and if mme maintains the ue context. the mme may immediately reject any subsequent request from the ue before the stored back-off time is expired. while the mobility management back-off timer is running, the ue shall not initiate any nas request for mobility management procedures except for detach procedure and except for high priority access, emergency services and mobile terminated services. after any such detach procedure, the back-off timer continues to run. while the mobility management back-off timer is running, the ue is allowed to perform tracking area update if it is already in connected mode. if the ue receives a paging request from the mme while the mobility management back off timer is running, the ue shall stop the mobility management back-off timer and initiate the service request procedure or the tracking area update procedure as described in clause?5.3.3.0.
while the mobility management back-off timer is running, the ue configured with a permission for overriding low access priority is allowed to initiate the mobility management procedures without low access priority if the mobility management back-off timer was started due to a reject message received in response to a request with low access priority and the upper layers in ue request to establish a pdn connection without low access priority or the ue has an established pdn connection that is without low access priority.
while the mobility management back-off timer is running, the ue configured with permission for sending exception reporting is allowed to initiate the CP service request procedure for exception reporting. if the mobility management back-off timer was started due to a reject message received in response to a request for exception reporting, the ue shall not initiate the CP service request procedure for exception reporting while the mobility management back-off timer is running.
the mobility management back-off timer shall not impact cell/rat and plmn change. cell/rat and ta change do not stop the mobility management back-off timer. the mobility management back-off timer shall not be a trigger for plmn reselection. the back-off timer is stopped as defined in ts?24.301?[46] when a new plmn that is not an equivalent plmn is accessed.
to avoid that large amounts of ues initiate deferred requests (almost) simultaneously, the mme should select the mobility management back-off timer value so that the deferred requests are not synchronized.
when the ue receives a handover command, the ue shall proceed with the handover procedure regardless of whether mobility management back-off timer is running.
the mme should not reject tracking area update procedures that are performed when the ue is already in connected mode.
for idle mode inter cn node mobility, the mme may reject tracking area update procedures and include a mobility management back off timer value in the tracking area reject message.
if the mme rejects tracking area update request or service request with a mobility management back-off timer which is larger than the sum of the ue's periodic tau timer plus the implicit detach timer, the mme should adjust the mobile reachable timer and/or implicit detach timer such that the mme does not implicitly detach the ue while the mobility management back-off timer is running.
note: this is to minimize unneeded signalling after the mobility management back-off timer expires.
4.3.7.4.2.5 group specific nas level congestion control
the group specific nas level congestion control applies to a specific group of ues. each group has a group identifier assigned.
a ue belongs to a group, if the corresponding group identifier is stored in the ue's subscription data in the hss. a ue may belong to multiple groups and the mme may perform the group specific nas level congestion control to an ue as described below independent of whether group specific nas level congestion control is activated for one, multiple, or all groups the ue belongs to. the group identifier shall be stored per ue in the hss and obtained by the mme as part of normal hss signalling. a ue is not aware of a group subscription.
the group specific nas level congestion control may be activated for session management signalling, or for mobility management signalling, or both. the group specific nas level congestion control is activated based on operator policies.
when the group specific nas level congestion control for session management signalling is active for a particular group, the mme's behaviour is similar to that in clause?4.3.7.4.2.2, with the following modifications:
- mme may apply esm congestion control to all subscribed apns for ues that belong to this particular group.
note: how the mme applies esm congestion control to all subscribed apns is left to stage 3.
- the mme rejects the eps session management (esm) request(s) from the ue belonging to this particular group (e.g. pdn connectivity, or bearer resource allocation requests) with a session management back-off timer.
when group specific nas level congestion control for mobility management signalling is active for a particular group, the mme's behaviour is similar to that in clause?4.3.7.4.2.3, but applied to ues subscribed to this particular group rather that subscribed to a particular apn.
group specific nas level congestion control is performed at the mme based on the ue's subscription information provided by the hss. there is no impact on the ue, and hence, ue's behaviour as described in clauses 4.3.7.4.2.2 and 4.3.7.4.2.3 does not change.
4.3.7.4.2.6 apn and group specific nas level congestion control
the apn and group specific nas level congestion control is the interclause?of apn specific nas level congestion control and group specific nas level congestion control, i.e. it applies to a specific group of ues with a particular subscribed apn. each group of ues has a group identifier assigned and stored in the hss.
a ue may belong to multiple groups and the mme may perform the apn and group specific nas level congestion control to an ue as described below independent of whether the apn and group specific nas level congestion control is activated for one, multiple or all groups the ue belongs to. the group identifier(s) shall be stored per ue in the hss and obtained by the mme as part of normal hss signalling. a ue is not aware of the group identifier(s) that the ue belongs to.
the apn and group specific nas level congestion control may be activated for session management signalling, or for mobility management signalling, or both. the apn and group specific nas level congestion control is activated based on operator policies.
when the apn and group specific nas level congestion control for session management signalling is activated for a ue belonging to a particular group and initiating signalling to a particular apn, the mme's behaviour is similar to that in clause?4.3.7.4.2.2, with the following modifications:
- the eps session management (esm) congestion control is applied to this particular apn, and for ues belonging to this particular group,
- the mme may reject esm requests from the ues belonging to this particular group and attaching to this particular apn (e.g. pdn connectivity, or bearer resource allocation requests) with a session management back-off timer. if the ue provides no apn, then the mme uses the apn which is used in pdn gw selection procedure.
- the mme may deactivate pdn connections of the ues, belonging to this particular group and attaching to this particular apn, by sending the nas deactivate eps bearer context request message to the ue with a session management back-off timer.
when the apn and group specific nas level congestion control for mobility management signalling is activated for a ue belonging to a particular group and with a particular subscribed apn, the mme's behaviour is similar to that in clause?4.3.7.4.2.3, but applied to ues with this particular subscribed apn and belonging to this particular group.
apn and group specific nas level congestion control is performed at the mme based on the ue's subscription information provided by the hss. there is no impact on the ue, and hence, ue's behaviour described in clauses?4.3.7.4.2.2 and 4.3.7.4.2.3 does not change.
4.3.7.4.2.7 CP data specific nas level congestion control
under overload conditions the mme may restrict requests from ues for data transmission via CP ciot eps optimisation. a CP data back-off timer may be returned by the mme (e.g.in attach/tau/rau accept messages, service reject message or service accept message). while the CP data back-off timer is running, the ue shall not initiate any data transfer via CP ciot eps optimisation, i.e. the ue shall not send any CP service request with esm data transport message as defined in ts?24.301?[46]. the mme shall store the CP data back-off timer per ue and shall reject any further request (other than exception reporting and a response to paging) for data transmission via CP service request from that ue while the CP data back-off timer is still running.
note?1: the CP data back-off timer does not affect any other mobility management or session management procedure.
note?2: the CP data back-off timer does not apply to UP data communication.
if the ue is allowed to send exception reporting, the ue may initiate CP service request for exception reporting even if CP data back-off timer is running.
the ue may respond with CP service request without esm data transport to a paging even if the CP data back-off timer is running.
if the mme receives a CP service request in reponse to paging, and the mme has a CP data back-off timer running for the ue, and the mme is not overloaded, and mme decides to accept the CP service request, then the mme shall respond with service accept message without the CP data back-off timer and stop the CP data back-off timer. if the ue receives a service accept message without the CP data back-off timer from the mme while the CP data back-off timer is running, the ue shall stop the CP data back-off timer. the CP data back-off timer in the ue and the mme is stopped at plmn change.
if the mme receives a CP service request with esm data transport message, and decides to send the ue a CP data back-off timer, the mme may decide to process the CP service request with esm data transport message, i.e. decrypt and forward the data payload, or not based on the following:
- if the ue has additionally indicated in a nas release assistance information in the nas pdu that no further uplink or downlink data transmissions are expected, then the mme may process (integrity check/decipher/forward) the received CP data packet, and send service accept to the ue with CP data back-off timer. the ue interprets this as successful transmission of the CP data packet and starts the CP data back-off timer.
- for all other cases, the mme may decide to not process the received CP data packet and sends service reject to the ue with CP data back-off timer. the ue interprets this indication as unsuccessful delivery of the CP data packet and starts the CP data back-off timer. then mme may take into consideration whether the pdn connection is set to CP only to make the decision whether to reject the packet and send service reject or move the pdn connection to UP and process the data packet.
- alternatively, if ue has not provided in the in CP service request the nas release assistance information, and the eps bearer belongs to a pdn connection not set to CP only, and ue supports UP ciot optimisation (or legacy s1-u), then the mme may initiate establishment of s1-u bearer during data transport in CP ciot eps optimisation (according to the procedure defined in clause?5.3.4b.4). in this case mme may also return a CP data back-off timer within the nas message.
the mme only includes the CP data back-off timer if the ue has indicated support for CP data back-off timer in the attach/tau/rau request.
note?3: if the mme is overloaded or close to overload, but the ue has not indicated support for CP data back-off timer, the mme can use other overload control mechanisms, e.g. mobility management back-off timer or use UP data communication.
4.3.7.5 pdn gw control of overload
the pdn gw may provide mechanisms for avoiding and handling overload situations. these include the rejection of pdn connection requests from ues.
the pdn gw may detect apn congestion and start and stop performing overload control based on criteria such as:
- maximum number of active bearers per apn; and/or
- maximum rate of bearer activations per apn.
when performing overload control the pdn gw rejects pdn connection requests. when receiving the rejection from the pdn gw, the mme rejects the ue's pdn connection request as specified in clause?4.3.7.4.2. in addition the pdn gw may indicate a "pdn?gw back-off time" for a specific apn to the mme. the mme should reject pdn connection requests, for the specific apn related to that pdn gw during the "pdn gw back-off time", by the means specified in clause?4.3.7.4.2. if a pdn gw indicates apn congestion by the "pdn gw back-off time" the mme may select another pdn gw of that apn instead of rejecting pdn connection requests unless there is already an existing pdn connection to the same apn for the ue, in which case, the mme shall reject pdn connection request.
4.3.8 selection functions
4.3.8.1 pdn gw selection function (3gpp accesses)
the pdn gw selection function allocates a pdn gw that shall provide the pdn connectivity for the 3gpp access. the function uses subscriber information provided by the hss and possibly additional criteria such as sipto/lipa support per apn configured in the sgsn/mme, ue support for dual connectivity with nr, 15 eps bearers support by the ue, ciot eps optimisation(s) impacting pdn gw e.g. non-ip support, nb-iot rat support (for generation of accounting information), etc.
note?1: selection of pdn gws optimised for different rats (e.g. nb-iot) can be achieved by the allocation of different apns to subscribers allowed to use specific rats and/or using the ue usage type.
the criteria for pdn gw selection may include load balancing between pdn gws. when the pdn gw ip addresses returned from the dns server include weight factors, the mme should use it if load balancing is required. the weight factor is typically set according to the capacity of a pdn gw node relative to other pdn gw nodes serving the same apn. for further details on the dns procedure see ts?29.303?[61].
when the mme supports the gtp-c load control feature, it takes into account the load information received from the pdn gw in addition to the weight factors received from the dns server to perform selection of an appropriate pdn gw.
note?2: how weight factors can be used in conjunction with load information received via gtp CP signalling is left up to stage 3.
the pdn subscription contexts provided by the hss contain:
- the identity of a pdn gw and an apn (pdn subscription contexts with subscribed pdn gw address are not used when there is interoperation with pre rel 8 2g/3g sgsn), or
- an apn and an indication for this apn whether the allocation of a pdn gw from the visited plmn is allowed or whether a pdn gw from the home plmn shall be allocated. optionally an identity of a pdn gw may be contained for handover with non-3gpp accesses.
- optionally for an apn, an indication of whether sipto above ran, or sipto at the local network, or both, is allowed or prohibited for this apn.
- optionally for an apn, an indication of whether lipa is conditional, prohibited, or only lipa is supported for this apn.
in the case of static address allocation, a static pdn gw is selected by either having the apn configured to map to a given pdn gw, or the pdn gw identity provided by the hss indicates the static pdn gw.
the hss also indicates which of the pdn subscription contexts is the default one for the ue.
to establish connectivity with a pdn when the ue is already connected to one or more pdns, the ue provides the requested apn for the pdn gw selection function.
if one of the pdn subscription contexts provided by the hss contains a wild card apn (see ts?23.003?[9]), a pdn connection with dynamic address allocation may be established towards any apn requested by the ue. an indication that sipto (above ran, at the local network, or both) is allowed or prohibited for the wild card apn allows or prohibits sipto for any apn that is not present in the subscription data.
if the hss provides the identity of a statically allocated pdn gw, or the hss provides the identity of a dynamically allocated pdn gw and the request type indicates "handover", no further pdn gw selection functionality is performed. if the hss provides the identity of a dynamically allocated pdn gw, the hss also provides information that identifies the plmn in which the pdn gw is located.
note?3: the mme uses this information to determine an appropriate apn-oi and s8 protocol type (pmip or gtp) when the mme and pdn gw are located in different plmns.
if the hss provides the identity of a dynamically allocated pdn gw and the request type indicates "initial request", either the provided pdn gw is used or a new pdn gw is selected. when a pdn connection for an apn with sipto-allowed is requested, the pdn gw selection function shall ensure the selection of a pdn gw that is appropriate for the ue's location. the pdn gw identity refers to a specific pdn gw. if the pdn gw identity includes the ip address of the pdn gw, that ip address shall be used as the pdn gw ip address; otherwise the pdn gw identity includes an fqdn which is used to derive the pdn gw ip address by using domain name service function, taking into account the protocol type on s5/s8 (pmip or gtp).
note?4: provision of a pdn gw identity of a pdn gw as part of the subscriber information allows also for a pdn gw allocation by hss.
if the hss provides a pdn subscription context that allows for allocation of a pdn gw from the visited plmn for this apn and, optionally, the mme is configured to know that the visited vplmn has a suitable roaming agreement with the hplmn of the ue, the pdn gw selection function derives a pdn gw identity from the visited plmn. if a visited pdn gw identity cannot be derived, or if the subscription does not allow for allocation of a pdn gw from the visited plmn, then the apn is used to derive a pdn gw identity from the hplmn. the pdn gw identity is derived from the apn, subscription data and additional information by using the domain name service function. if the pdn gw identity is a logical name instead of an ip address, the pdn gw address is derived from the pdn gw identity, protocol type on s5/s8 (pmip or gtp) by using the domain name service function. the s8 protocol type (pmip or gtp) is configured per hplmn in mme/sgsn.
in order to select the appropriate pdn gw for sipto above ran service, the pdn gw selection function uses the tai (tracking area identity), the serving enodeb identifier, or tai together with serving enodeb identifier depending on the operator's deployment during the dns interrogation as specified in ts?29.303?[61] to find the pdn gw identity. in roaming scenario pdn gw selection for sipto is only possible when a pdn gw in the visited plmn is selected. therefore in a roaming scenario with home routed traffic, pdn gw selection for sipto is not performed.
in order to select the appropriate gw for sipto at the local network service with a stand-alone gw (with s-gw and l-gw collocated), the pdn gw selection function uses the apn and the local home network id during the dns interrogation as specified in ts?29.303?[61] to find the pdn gw identity. the local home network id is provided to the mme by the (h)enb in every initial ue message and every uplink nas transport control message as specified in ts?36.413?[36]. the mme uses the local home network id to determine if the ue has left its current local network and if s-gw relocation is needed.
for sipto at the local network with l-gw function collocated with the (h)enb the pdn gw selection function uses the l-gw address proposed by the (h)enb in the s1-ap message, instead of dns interrogation.
in order to select the appropriate l-gw for lipa service, if permitted by the csg subscription data and if the ue is roaming, the vplmn lipa is allowed, the pdn gw selection function uses the l-gw address proposed by henb in the s1-ap message, instead of dns interrogation. if no l-gw address is proposed by the henb and the ue requested an apn with lipa permissions set to "lipa-only", the request shall be rejected. if no l-gw address is proposed by the henb and the ue requested an apn with lipa permissions set to "lipa-conditional", the mme uses dns interrogation for pdn gw selection to establish a non-lipa pdn connection. the pdn subscription context for an apn with lipa permissions set to "lipa-only" shall not contain a statically configured pdn address or a statically allocated pdn gw. a static pdn address or a static pdn gw address, if configured by hss for an apn with lipa permissions set to "lipa-conditional", is ignored by mme when the apn is established as a lipa pdn connection. when establishing a pdn connection for a lipa apn, the vplmn address allowed flag is not considered.
the pdn gw domain name shall be constructed and resolved by the method described in ts?29.303?[61], which takes into account any value received in the apn oi replacement field for home routed traffic. otherwise, or when the resolution of the above pdn gw domain name fails, the pdn gw domain name shall be constructed by the serving node using the method specified in annex?a of ts?23.060?[7] and clause?9 of ts?23.003?[9]. if the domain name service function provides a list of pdn gw addresses, one pdn gw address is selected from this list. if the selected pdn gw cannot be used, e.g. due to an error, then another pdn gw is selected from the list. the specific interaction between the mme/sgsn and the domain name service function may include functionality to allow for the retrieval or provision of additional information regarding the pdn gw capabilities (e.g. whether the pdn gw supports pmip based or gtp-based s5/s8, or both).
note?5: the apn as constructed by the mme/sgsn for pdn gw resolution takes into account the apn-oi replacement field. this differs from the apn that is provided in charging data to another sgsn and mme over the s3, s10 and s16 interfaces as well as to serving gw and pdn gw over the s11, s4 and s5/s8 interfaces, in that the apn-oi replacement field is not applied. see clause?5.7.2 of the present document for more details.
if the ue provides an apn for a pdn, this apn is then used to derive the pdn gw identity as specified for the case of hss provided apn if one of the subscription contexts allows for this apn.
if there is an existing pdn connection to the same apn used to derive the pdn gw address, the same pdn gw shall be selected.
as part of pdn gw selection, an ip address of the assigned pdn gw may be provided to the ue for use with host based mobility as defined in ts?23.402?[2], if the pdn gw supports host-based mobility for inter-access mobility towards accesses where host-based mobility can be used. if a ue explicitly requests the address of the pdn gw and the pdn gw supports host based mobility then the pdn gw address shall be returned to the ue.
when dcns with dedicated pdn gws are used, the dns procedure (ts?29.303?[61]) for pdn gw selection may be used such that a pdn gw belonging to a dcn serving a particular category of ues, e.g. identified by ue usage type, is selected. when ues with the same ue usage type are served by multiple dcns, it shall also be possible to select the pdn gw belonging to the dcn serving the particular ue.
4.3.8.2 serving gw selection function
the serving gw selection function selects an available serving gw to serve a ue. the selection bases on network topology, i.e. the selected serving gw serves the ue's location and for overlapping serving gw service areas, the selection may prefer serving gws with service areas that reduce the probability of changing the serving gw. when sipto is allowed then it is also considered as a criterion for serving gw selection, e.g. when the first pdn connection is requested. other criteria for serving gw selection should include load balancing between serving gws, ue support for dual connectivity with nr, ciot eps optimisation(s) impacting serving gw e.g. non-ip support, nb-iot rat support (for generation of accounting information), etc. when the serving gw ip addresses returned from the dns server include weight factors, the mme should use it if load balancing is required. the weight factor is typically set according to the capacity of a serving gw node relative to other serving gw nodes serving the same tracking area. for further details on dns procedure see ts?29.303?[61].
when the mme supports the gtp-c load control feature, it takes into account the load information received from the serving gw in addition to the weight factors received from the dns server to perform selection of an appropriate serving gw.
note?1: how weight factors can be used in conjuction with load information received via gtp CP signalling is left up to stage 3.
if a subscriber of a gtp only network roams into a pmip network, the pdn gws selected for local breakout support the pmip protocol, while pdn gws for home routed traffic use gtp. this means the serving gw selected for such subscribers may need to support both gtp and pmip, so that it is possible to set up both local breakout and home routed sessions for these subscribers. for a serving gw supporting both gtp and pmip, the mme/sgsn should indicate the serving gw which protocol should be used over s5/s8 interface. the mme/sgsn is configured with the s8 variant(s) on a per hplmn granularity.
if a subscriber of a gtp only network roams into a pmip network, the pdn gws selected for local breakout may support gtp or the subscriber may not be allowed to use pdn gws of the visited network. in both cases a gtp only based serving gw may be selected. these cases are considered as roaming between gtp based operators.
if combined serving and pdn gws are configured in the network the serving gw selection function may preferably derive a serving gw that is also a pdn gw for the ue.
in order to provide sipto at the local network service with stand-alone gw, the l-gw and serving gw shall be co-located. the serving gw selection function in the mme is used to ensure that the serving gw is provided according to operator policy as described in clause?4.3.15a. when the l-gw is collocated with the (h)enb, the serving gw remains located in the mobile operator's core network.
the domain name service function may be used to resolve a dns string into a list of possible serving gw addresses which serve the ue's location. the specific interaction between the mme/sgsn and the domain name service function may include functionality to allow for the retrieval or provision of additional information regarding the serving gw capabilities (e.g. whether the serving gw supports pmip-based or gtp-based s5/s8, or both). the details of the selection are implementation specific.
for handover from non-3gpp accesses in roaming scenario, the serving gw selection function for local anchoring is described in ts?23.402?[2].
the serving gw selection function in the mme is used to ensure that all tracking areas in the tracking area list belong to the same serving gw service area.
when dcns with dedicated serving gws are used, the dns procedure (ts?29.303?[61]) for serving gw selection may be used such that a serving gw belonging to a dcn serving a particular category of ues, e.g. identified by ue usage type, is selected. when ues with the same ue usage type are served by multiple dcns, it shall also be possible to select the serving gw belonging to the dcn serving the particular ue.
note?2: selection of serving gws optimised for different rats (e.g. nb-iot) can be achieved by using ue usage type and/or by using different tais for different rats.
4.3.8.3 mme selection function
the mme selection function selects an available mme for serving a ue. the selection is based on network topology, i.e. the selected mme serves the ue's location and for overlapping mme service areas, the selection may prefer mmes with service areas that reduce the probability of changing the mme. when a mme/sgsn selects a target mme, the selection function performs a simple load balancing between the possible target mmes. in networks that deploy dedicated mmes/sgsns for ues configured for low access priority, the possible target mme selected by source mme/sgsn is typically restricted to mmes with the same dedication.
when a mme/sgsn supporting dcns selects a target mme, the selected target mme should be restricted to mmes that belong to the same dcn. the dns procedure may be used by the source cn node to select the target mme from a given dcn. if both low access priority and ue usage type parameter are used for mme selection, selection based on ue usage type parameter overrides selection based on the low access priority indication.
when a mme supporting ciot eps optimisation(s) selects a target mme, the selected mme should all support the ciot eps optimisations applicable to the given ue's attachment. in case the source mme is unable to find a target mme matching all ciot eps optimisation(s) applicable to a given ue's attachment, then the source mme, based on implementation, selects a target mme which provides the ciot eps optimisation(s) best applicable to that ue's attachment.
when an enodeb selects an mme, the enodeb may use a selection function which distinguishes if the gummei is mapped from p-tmsi/rai or is a native gummei. the indication of mapped or native gummei shall be signalled by the ue to the enodeb as an explicit indication. the enodeb may differentiate between a gummei mapped from p tmsi/rai and a native gummei based on the indication signalled by the ue. alternatively, the differentiation between a gummei mapped from p-tmsi/rai and a native gummei may be performed based on the value of most significant bit of the mme group id, for plmns that deploy such mechanism. in this case, if the msb is set to "0" then the gummei is mapped from p-tmsi/rai and if msb is set to "1", the gummei is a native one. alternatively the enodeb makes the selection of mme only based on the gummei without distinguishing on mapped or native.
when an enodeb selects an mme, the selection shall achieve load balancing as specified in clause?4.3.7.2.
when dcns are deployed, to maintain a ue in the same dcn when the ue enters a new mme pool area, the enodeb's nnsf should have configuration that selects, based on the mmegis or nris of neighbouring pool areas, a connected mme from the same dcn. alternately, for plmn wide inter-pool intra-rat mobility, the operator may divide up the entire mmegi and nri value space into non-overlapping sets with each set allocated to a particular dcn. in this case all enodebs may be configured with the same mme selection configuration. if ue assisted dcn selection feature is supported and a dcn-id is provided by the ue, the dcn-id shall be used in the enodeb for mme selection to maintain the same dcn when the serving mme is not available.
when selecting an mme for a ue that is using the nb-iot rat, and/or for a ue that signals support for ciot eps optimisations in rrc signalling (as specified in ts?36.331?[37], for nb-iot, ue indicates whether it supports "UP ciot eps optimisation" and "eps attach without pdn connectivity". and for wb-e-utran, ue indicates whether it supports "CP ciot eps optimisation", "UP ciot eps optimisation" and "eps attach without pdn connectivity"), the enodeb's mme selection algorithm shall select an mme taking into account the mme's support (or non-support) for the release 13 nas signalling protocol.
when dcn are deployed for the purpose of ciot eps optimisation, ue included ciot eps optimisation information in the rrc signalling, may depending on enb configuration, be used to perform initial dcn selection.
4.3.8.4 sgsn selection function
the sgsn selection function selects an available sgsn to serve a ue. the selection is based on network topology, i.e. the selected sgsn serves the ue's location and for overlapping sgsn service areas, the selection may prefer sgsns with service areas that reduce the probability of changing the sgsn. when a mme/sgsn selects a target sgsn, the selection function performs a simple load balancing between the possible target sgsns. in networks that deploy dedicated mmes/sgsns for ues configured for low access priority, the possible target sgsn selected by source mme/sgsn is typically restricted to sgsns with the same dedication.
when a mme/sgsn supporting dcns selects a target sgsn, the selected target sgsn should be restricted to sgsns that belong to the same cn. the dns procedure may be used by the source cn node to select the target sgsn from a given dcn. if both low access priority and ue usage type parameter are used for sgsn selection, selection based on ue usage type parameter overrides selection based on the low access priority indication.
4.3.8.5 selection of pcrf
the pdn?gw and af may be served by one or more pcrf nodes in the hplmn and, in roaming with local breakout scenarios, one or more pcrf nodes in the vplmn.
the selection of pcrf and linking of the different ue's pcc sessions over the multiple pcrf interfaces (e.g. rx session, gx session, s9 session etc.) for a ue ip can session is described in ts?23.203?[6].
4.3.9 ip network related functions
4.3.9.1 domain name service function
the domain name service function resolves logical pdn gw names to pdn gw addresses. this function is standard internet functionality according to rfc?1034?[17], which allows resolution of any name to an ip address (or addresses) for pdn gws and other nodes within the eps.
4.3.9.2 dhcp function
the dynamic host configuration function allows to deliver ip configuration information for ues. this function is standard internet functionality according to rfc?2131?[19], rfc?3736?[20], rfc?3633?[21] and rfc?4039?[25].
4.3.9.3 explicit congestion notification
the e utran/utran and the ue support the rfc?3168?[55] explicit congestion notification (ecn), as described in ts?36.300?[5], ts?25.401?[16] and ts?26.114?[56].
4.3.10 functionality for connection of enodebs to multiple mmes
an enodeb may connect to several mmes. this implies that an enodeb must be able to determine which of the mmes, covering the area where an ue is located, should receive the signalling sent from a ue. to avoid unnecessary signalling in the core network, a ue that has attached to one mme should generally continue to be served by this mme as long as the ue is in the radio coverage of the pool area to which the mme is associated. the concept of pool area is a ran based definition that comprises one or more ta(s) that, from a ran perspective, are served by a certain group of mmes. this does not exclude that one or more of the mmes in this group serve tas outside the pool area. this group of mmes is also referred to as an mme pool.
to enable the enodeb to determine which mme to select when forwarding messages from an ue, this functionality defines a routing mechanism (and other related mechanism). a routing mechanism (and other related mechanism) is defined for the mmes. the routing mechanism is required to find the correct old mme (from the multiple mmes that are associated with a pool area). when a ue roams out of the pool area and into the area of one or more mmes that do not know about the internal structure of the pool area where the ue roamed from, the new mme will send the identification request message or the context request message to the old mme using the guti. the routing mechanism in both the mmes and the enodeb utilises the fact that every mme that serves a pool area must have its own unique value range of the guti parameter within the pool area.
4.3.11 e-utran sharing function
e utran sharing is an agreement between operators and shall be transparent to the user. this implies that an e utran ue needs to be able to discriminate between core network operators available in a shared radio access network and that these operators can be handled in the same way as operators in non-shared networks. e utran terminals support e utran sharing.
an e utran sharing architecture allows different core network operators to connect to a shared radio access network. the operators do not only share the radio network elements, but may also share the radio resources themselves. in addition to this shared radio access network the operators may or may not have additional dedicated radio access networks, like for example, 3g or 2g radio access networks. for e utran both multi-operator core network (mocn) configuration and gateway core network (gwcn) configuration as defined in ts?23.251?[24] are supported over the s1 reference point. e utran terminals shall support shared networks and hence, only functions for "supporting ues" in ts?23.251?[24] applies for e utran sharing.
e utran radio access network sharing functions is further described in ts?36.300?[5].
in networks that support network sharing as defined in ts?23.251?[24], for a ue in state ecm-connected, the handover restriction list provided by the core-network to the radio access network is also used to inform the radio access network about the selected plmn and equivalent plmns as defined in ts?36.413?[36].
4.3.12 ims emergency session support
4.3.12.1 introduction
clause?4.3.12 ims emergency session provides an overview about functionality for emergency bearer services in a single clause. this overview applies to ecall over ims unless stated otherwise. the specific functionality is described in the affected procedures and functions of this specification. for discrepancies between this overview clause and the detailed procedure and function descriptions the latter take precedence.
emergency bearer services are provided to support ims emergency sessions. emergency bearer services are functionalities provided by the serving network when the network is configured to support emergency services. emergency bearer services are provided to normal attached or emergency attached ues and depending on local regulation, to ues that are in limited service state. receiving emergency services in limited service state does not require a subscription. depending on local regulation and an operator's policy, the mme may allow or reject an emergency attach request for ues in limited service state. four different behaviours of emergency bearer support have been identified as follows:
a. valid ues only. no limited service state ues are supported in the network. only ues that have a valid subscription, are authenticated and authorized for ps service in the attached location are allowed. ues should be attached to the network and then perform a pdn connection request when an ims emergency session is detected by the ue.
b. only ues that are authenticated are allowed. these ues must have a valid imsi. these ues are authenticated and may be in limited service state due to being in a location that they are restricted from service. a ue that can not be authenticated will be rejected.
c. imsi required, authentication optional. these ues must have an imsi. if authentication fails, the ue is granted access and the unauthenticated imsi retained in the network for recording purposes. the imei is used in the network as the ue identifier. imei only ues will be rejected (e.g., uiccless ues).
d. all ues are allowed. along with authenticated ues, this includes ues with an imsi that can not be authenticated and ues with only an imei. if an unauthenticated imsi is provided by the ue, the unauthenticated imsi is retained in the network for recording purposes. the imei is used in the network to identify the ue.
to provide emergency bearer services, the mme is configured with mme emergency configuration data that are applied to all emergency bearer services that are established by an mme on ue request. the mme emergency configuration data contain the emergency apn which is used to derive a pdn gw, or the mme emergency configuration data may also contain the statically configured pdn gw for the emergency apn.
ues that are in limited service state, as specified in ts?23.122?[10], initiate the attach procedure with indicating that the attach is to receive emergency services. also ues that had attached for normal services and do not have emergency bearers established and are camped on a cell in limited service state (e.g. because of restricted tracking area or not allowed csg) shall initiate this attach procedure, indicating that the attach is to receive emergency services. the network supporting emergency services for ues in limited service state provides emergency bearer services to these ue, regardless whether the ue can be authenticated, has roaming or mobility restrictions or a valid subscription, depending on local regulation. for emergency services other than ecall, the ues in limited service state determine that the cell supports emergency services over e-utran from a broadcast indicator in as. emergency calls for ecall over ims are only performed if the ue has a uicc.
a serving network shall provide an access stratum broadcast indication to ues as to whether ecall over ims is supported.
note?1: the access stratum broadcast indicator is determined according to operators' preference and minimally indicates that the plmn, or all of the plmns in the case of network sharing, and at least one emergency centre or psap to which an ecall over ims session can be routed, support ecall over ims.
a ue in limited service state determines that the cell supports ecall over ims using both the broadcast indicator for support of emergency services over e-utran and the broadcast indicator for ecall over ims.
note?2: the broadcast indicator for ecall over ims does not indicate whether ues in limited service state are supported, as such the broadcast indicator for support of emergency services over e-utran that indicates limited service state support needs to also be applied.
for a ue that is emergency attached, if it is unauthenticated the eps security context is not set up on ue.
ues that camp normally on a cell, i.e. without any conditions that result in limited service state, initiate the normal initial attach procedure if not already attached. normal attached ues initiate the ue requested pdn connectivity procedure to receive emergency bearer services. the ues that camp normally on a cell are informed that the plmn supports emergency bearer services over e-utran from the emergency service support indicator in the attach and tau procedures. ues that camp normally on a cell may also use the emergency attach procedure under conditions specified in ts?24.301?[46], e.g. when the mm back-off timer is running.
note?3: failure of the normal initial attach may occur e.g. when the network rejects the request with a back-off time.
note?4: the establishment of the emergency bearer services may fail when the ue needs to perform a tau prior to the ue requested pdn connectivity procedure, i.e. the ue moved into a non-registered tracking area with the mm back-off timer running in the ue.
note?5: the emergency service support indicator in the attach and tau procedures does not enable support for ecall over ims.
for a ue that is emergency attached, normal plmn selection principles apply after the end of the ims emergency session.
for emergency bearer services any epc functions, procedures and capabilities are provided according to clause?4 except when specified differently in the following clauses.
for emergency bearer services, there is a risk of service disruption due to failed inter plmn mobility attempts.
for emergency bearer services, handover from non-3gpp access to e-utran access is supported as specified in ts?23.402?[2] clause?4.5.7.2.10.
the ue shall set the rrc establishment cause or rrc resume cause to emergency as defined in ts?36.331?[37] when it requests an rrc connection in relation to an emergency session. specific situations that require setting the rrc establishment cause or rrc resume cause to emergency are described in ts?24.301?[46].
support for emergency bearer services is not available when the ue is using nb-iot, i.e. the mme shall not indicate support for emergency bearer services using the emergency service support indicator in the attach and tau procedures to a ue that accesses the network using a rat type equal to nb-iot, and an nb-iot cell shall not indicate support for emergency services in any broadcast information in as.
when a plmn supports ims and emergency bearer services, all mmes in that plmn shall have the same capability to support emergency bearer services.
note?6: idle mode signalling reduction (isr) is not supported by the network for ues that only have bearers related to emergency bearer service.
for emergency services other than ecall, a ue that is not in in limited service state, as specified in ts?23.122?[10] determines from a nas indicator whether additional emergency numbers/types received via wlan from trusted sources may be used for detecting emergency calls.
4.3.12.2 architecture reference model for emergency services
according to clause?4.2, the non-roaming architectures (figure?4.2.1-1 and figure?4.2.1-2) and roaming architecture with the visited operator's application function (figure?4.2.2-3) apply for emergency services. the other roaming architectures with services provided by the home network do not apply for emergency services.
4.3.12.3 mobility and access restrictions for emergency services
when emergency services are supported and local regulation requires emergency sessions to be provided regardless of mobility or access restrictions, the mobility restrictions in clause?4.3.5.7, should not be applied to ues receiving emergency services. when the e-rabs for emergency bearers are established, the arp value for emergency bearer services indicates the usage for emergency services to the e-utran.
during handovers, the source e-utran and source mme ignore any ue related restrictions during handover evaluation when there are active emergency bearers. e utran shall not initiate handover to geran ps domain. during handover to a csg cell, if the ue is not a csg member of target csg cell and has emergency bearer services, the target enodeb only accepts the emergency bearers and the target mme releases the non-emergency pdn connections that were not accepted by the target enodeb as specified in clause?5.10.3. such ues behave as emergency attached.
during tracking area update procedures, including a tau as part of a handover, the target mme ignores any mobility or access restrictions for ue with emergency bearer services where required by local regulation. any non emergency bearer services are deactivated, according to clause?5.10.3, by the target mme when not allowed by the subscription for the target location. such ues behave as emergency attached. to allow the emergency attached ue to get access to normal services after the emergency session has ended and when it has moved to a new area that is not stored by the ue as a forbidden area, the ue may explicitly detach and reattach to normal services without waiting for the emergency pdn connection deactivation by the pdn gw.
this functionality applies to all mobility procedures.
4.3.12.3a reachability management for ue in ecm-idle state
an emergency attached ue when its periodic tau update timer expires shall not initiate a periodic tau procedure but enter emm-deregistered state. for emergency attached ues the mme runs a mobile reachable timer with a similar value to the ue's periodic tau timer. any time after expiry of this timer the mme may change the emm state of an emergency attached ue to emm-deregistered. the mme assigns the periodic tau timer value to emergency attached ue. this timer keeps the ue emergency attached after change to emm-idle state to allow for a subsequent emergency service without a need to emergency attach again.
4.3.12.4 pdn gw selection function (3gpp accesses) for emergency services
when a pdn gw is selected for ims emergency services support, the pdn gw selection function described in clause?4.3.8.1 for normal bearer services is applied to the emergency apn or the mme selects the pdn gw directly from the mme emergency configuration data. if the pdn gw selection function described in clause?4.3.8.1 is used it shall always derive a pdn gw in the visited plmn, which guarantees that also the ip address is allocated by the visited plmn. in networks that support handover between e utran and hrpd accesses, the mme selects a pdn gw that is statically configured in the mme emergency configuration data. in networks that support handover between e utran and wlan accesses, when the ue has been authorized but has not been authenticated, the mme selects the pdn gw that is statically configured in the mme emergency configuration data. the pdn gw selection does not depend on subscriber information in the hss since emergency service support is a local, not subscribed service. the mme emergency configuration data contains the emergency apn which is used to derive a pdn gw, or the mme emergency configuration data may also contain the statically configured pdn gw for the emergency apn.
this functionality is used by the attach procedure and by the ue requested pdn connectivity procedure, in both cases when establishing emergency bearer services.
note: it is assumed that the pdn gw that is statically configured in the mme emergency configuration data is the same as the pdn gw configured in wlan and hrpd accesses.
4.3.12.5 qos for emergency services
where local regulation require supporting calls from an unauthorised caller, the mme may not have subscription data. additionally, the local network may want to provide ims emergency services support differently than what is allowed by a ue subscription. therefore, the initial qos values used for establishing emergency bearer services are configured in the mme in the mme emergency configuration data.
note: for ims emergency services prior to this release of this specification, dynamic pcc support was not required in the specifications. in such cases, the pdn?gw sets the arp value that is reserved for emergency services, which the pdn?gw bases on the usage of the emergency apn.
this functionality is used by the attach procedure and by the ue requested pdn connectivity procedure, in both cases when establishing emergency bearer services.
4.3.12.6 pcc for emergency services
dynamic pcc is used for ues establishing emergency service, the procedures are as described in ts?23.203?[6]. when establishing emergency bearer services with a pdn gw, according to clause?4.7.5, the pcrf provides the pdn gw with the qos parameters, including an arp value reserved for the emergency bearers to prioritize the bearers when performing admission control. dynamic pcc shall be used to manage ims emergency sessions when an operator allows ims emergency sessions.
note: for ims emergency services prior to this release of this specification, dynamic pcc support was not required in the specifications. according to clause?4.7.5, when solely using voice/gtt, local configuration of static policy functions is also allowed prior to this release of this specification and is not subject to standardization.
the pcrf ensures that the emergency pdn connection is used only for ims emergency sessions. the pcrf rejects an ims session established via the emergency pdn connection if the af (i.e. p-cscf) does not provide an emergency indication to the pcrf.
4.3.12.7 load re-balancing between mmes for emergency services
as per load re-balancing procedures in clause?4.3.7.3, the mme is allowed to off-load ecm-connected mode ues by initiating s1 release procedures. when a ue is in ecm-connected mode with an active emergency bearer service, the mme should not release the ue for load re-balancing. the mme should wait until the ue initiates a tau or becomes inactive. the mme may release the ue under critical conditions such as the need to perform an mme node restart.
4.3.12.8 ip address allocation
emergency bearer service is provided by the serving plmn. the ue and plmn must have compatible ip address versions in order for the ue to obtain a local emergency pdn connection. ip address allocation in the serving plmn is provided per clause?5.3.1 with the exception that the pdn gw associated with the emergency apn shall support pdn type ipv4 and pdn type ipv6.
4.3.12.9 handling of pdn connections for emergency bearer services
the default and dedicated eps bearers of a pdn connection associated with the emergency apn shall be dedicated for ims emergency sessions and shall not allow any other type of traffic. the emergency bearer contexts shall not be changed to non-emergency bearer contexts and vice versa. the pdn gw shall block any traffic that is not from or to addresses of network entities (e.g. p-cscf) providing ims emergency service. dynamic pcc shall be deployed in order to support ims emergency sessions, the procedures are as described in ts?23.203?[6]. if there is already an emergency pdn gw connection, the ue shall not request another emergency pdn connection. the mme shall reject any additional emergency pdn connection requests. the ue shall not request any bearer resource modification for the emergency pdn connection. the pdn gw shall reject any ue requested bearer resource modification that is for the emergency pdn connection. the arp reserved for emergency bearer service shall only be assigned to eps bearers associated with an emergency pdn connection.
4.3.12.10 isr function for emergency bearer services
when ue has only emergency bearer service, isr does not apply.
4.3.12.11 support of ecall only mode
for service requirements for ecall only mode, refer to ts?22.101?[80].
a ue configured for ecall only mode shall remain in emm-deregistered state, shall camp on a network cell when available but shall refrain from any mobility management or other signalling with the network. the ue may instigate mobility management and connection management procedures in order to establish, maintain and release an ecall over ims session or a session to any non-emergency msisdn(s) or uri(s) configured in the uicc for test and/or terminal reconfiguration services. following the release of either session, the ue starts a timer whose value depends on the type of session (i.e. whether ecall or a session to a non-emergency msisdn or uri for test/reconfiguration). while the timer is running, the ue shall perform normal mobility management procedures and is permitted to respond to paging to accept and establish an incoming session (e.g. from an emergency centre, psap or hplmn operator). when the timer expires, the ue shall perform a ue-initiated detach procedure if still attached and enter emm-deregistered state.
note?1: an hplmn operator can change the ecall only mode configuration state of a ue in the uicc. an hplmn operator can also instead add, modify or remove a non-emergency msisdn or uri in the uicc for test and/or terminal reconfiguration services. this can occur following a ue call to a non-emergency msisdn or uri configured for reconfiguration. when the ecall only mode configuration is removed, the ue operates as a normal ue that can support ecall over ims.
note?2: a test call and a reconfiguration call can be seen as normal (non-emergency) call by a serving plmn and normal charging rules can apply depending on operator policy.
note?3: an msisdn configured in the uicc for test and/or terminal reconfiguration services for ecall over ims can differ from an msisdn configured in the uicc for test services for ecall over the cs domain.
when attaching to eps for e-utran access, a ue configured for ecall only mode may indicate support for radio capabilities for irat handover (for utran) or srvcc handover (for geran), but shall not indicate support for ims voice over rats other than e-utran.
note?4: access to the ps domain for a ue configured for ecall only mode is only supported by e-utran in this version of the specification.
4.3.13 closed subscriber group functions
closed subscriber group identifies a group of subscribers who are permitted to access one or more csg cells of the plmn as a member of the csg for a henb. the following csg related functions are defined:
- csg subscription handling function stores and updates the user's csg subscription data at the ue and the network.
- for closed mode, csg access control function ensures a ue has valid subscription at a csg where it performs an access.
- admission and rate control function is used to provide different admission and rate control for csg and non-csg members for a hybrid csg cell.
- csg charging function enables per csg charging for a subscriber consuming network services via a csg cell or a hybrid cell.
- csg paging optimisation function is optionally used to filter paging messages as described in clause?5.3.4.3.
- vplmn autonomous csg roaming function is optionally supported whereby a vplmn, if allowed by the hplmn, stores and manages vplmn specific csg subscription information for roaming ues without interaction with the hss.
- csg membership verification without updating the user csg information in the core network in case of dual connectivity when the secondary enb is a hybrid access enb.
4.3.14 location service functions
lcs procedures are described in the lcs stage 2 specification, see ts?23.271?[57].
in addition, in the detach and bearer deactivation procedures, the mme shall inform the s-gw of the last known location of the ue, and shall provide information to enable the determination of the time at which the ue was in that location. the s-gw shall (if necessary taking into account information from the sgsn) inform the pdn gw of the last known location of the ue, and shall provide information to enable the determination of the time at which the ue was in that location. if requested by the pcrf the pdn gw shall indicate this information to the pcrf as defined in ts?23.203?[6]. the information can also be made available on the sgi interface as specified in ts?29.061?[38] and on the cdrs at network elements such as the s-gw and pdn gw as specified in ts?32.251?[44].
4.3.15 SIPTO (sipto) function
the sipto function enables an operator to offload certain types of traffic at a network node close to that ue's point of attachment to the access network.
sipto above ran can be achieved by selecting a set of gws (s-gw and p-gw) that is geographically/topologically close to a ue's point of attachment.
sipto above ran corresponds to a traffic offload through a p-gw located in the mobile operator's core network.
sipto applies to both the non-roaming case and, provided appropriate roaming agreements are in place between the operators, to the roaming case.
offload of traffic for a ue is available for utran and e-utran accesses only. when the ue enters to utran/e-utran from another type of access network (e.g., from geran), it is the responsibility of the new sgsn/mme to decide whether to perform deactivation with reactivation request for a given pdn connection, depending on sipto permissions for the relevant apn.
realization for sipto above ran relies on the same architecture models and principles as for local breakout described in clause?4.2.
in order to select a set of appropriate gw (s-gw and p-gw) based on geographical/topological proximity to ue, the gw selection function specified in ts?29.303?[61] uses the ue's current location information.
in order for the operator to allow/prohibit sipto on per user and per apn basis, subscription data in the hss is configured to indicate to the mme if offload is allowed or prohibited. if the sipto permissions information from the hss conflicts with mme's configuration for that ue, then sipto is not used.
if hss indicates vplmn address not allowed, then vplmn (i.e. mme) shall not provide sipto.
in the absence of any sipto permissions indication from the hss the vplmn (i.e mme) shall not provide sipto.
the mme may be configured on a per apn basis as to whether or not to use sipto (e.g. to handle the case where the hss is not configured with sipto information for the ue).
for sipto above ran, as a result of ue mobility (e.g. detected by the mme at tau or sgsn at rau or movement from geran), the target mme may wish to redirect a pdn connection towards a different gw that is more appropriate for the ue's current location, e.g. mme may know whether the ue's new location is served by the same gw as the old one. when the mme decides upon the need for gw relocation, the mme deactivates the impacted pdn connections indicating "reactivation requested" as specified in clause?5.10.3. if all of the pdn connections for the ue need to be relocated, the mme may initiate the "explicit detach with reattach required" procedure as specified in clause?5.3.8.3.
note: if either of the above procedures for gw relocation are initiated while the ue has active applications, it may cause disruption of services that are affected if the ip address changes.
4.3.15a SIPTO (sipto) at the local network
4.3.15a.1 general
the sipto at the local network function enables an ip capable ue connected via a (h)enb to access a defined ip network (e.g. the internet) without the UP traversing the mobile operator's network.
the subscription data in the hss are configured per user and per apn to indicate to the mme if offload at the local network is allowed or not.
sipto at the local network can be achieved by selecting a l-gw function collocated with the (h)enb or selecting stand-alone gws (with s-gw and l-gw collocated) residing in the local network. in both cases the selected ip traffic is offloaded via the local network.
specific to the henb subsystem, the applicability of sipto at the local network does not depend on csg membership and the feature can be applied to any ue, as long as the ue is allowed to access the cell.
for this release of the specification, no interface between the l-gw and the pcrf is specified and there is no support for dedicated bearers on the pdn connection used for sipto at the local network. the local gw (l-gw) shall reject any ue requested bearer resource modification.
for this release of the specification, sipto at the local network is intended for offloading internet traffic only, thus the l-gw does not provide apn specific connectivity. therefore if the subscription data in the hss indicate that offload at the local network is allowed, this implies that the related apn is typically used for providing internet connectivity.
if the mme detects a change in sipto permissions in the subscription data for a given subscriber for a given apn and the subscriber has already established a sipto at the local network pdn connection to that apn, the mme shall release the sipto at the local network pdn connection for that apn with "reactivation requested" cause as specified in clause?5.10.3.
note: in this release of the specification it is assumed that the target s-gw selected during the handover also has connectivity to the l-gw.
4.3.15a.2 sipto at the local network with stand-alone gw (with s-gw and l-gw collocated) function
sipto at the local network is achieved using a stand-alone gw (with s-gw and l-gw collocated) residing in the local network.
a (h)enb supporting sipto at the local network with the stand-alone gw includes the local home network id to the mme in every initial ue message, every uplink nas transport control message, handover notify and path switch request messages.
if a sipto pdn connection is initiated as an additional subsequent pdn connection, the mme should check if the s gw is optimal for the user's current location. if it is not, and if the network supports s-gw relocation without being triggered by a mobility event, the mme may decide to perform an mme triggered serving gw relocation according to clause?5.10.4, when possible (e.g. no other restrictions apply).
for sipto at the local network with a stand-alone gw, the location of the serving gw may be determined based on the operator policy and user's profile regarding support of sipto at local network so that:
- at attachment to the (h)enb, a local s-gw can always be selected independent of whether a sipto at the local network pdn connection is established or not. if mobility is performed to the macro network without having a sipto connection, a s-gw relocation can be performed as specified via existing mobility procedures with s-gw relocation.
- at attachment to a (h)enb, a macro s-gw may be allocated for pdn connection in the operator's network. if a new pdn connection is requested by the ue that requires that a local s-gw is selected to provide for sipto at the local network, s-gw relocation from the macro s-gw to the local s-gw shall be performed as specified in clause?5.10.4.
as ip data session continuity for sipto at the local network pdn connection is not supported in this release of the specification, subsequent to handover completion the (target) mme should disconnect the sipto at the local network pdn connection with "reactivation requested" cause as specified in clause?5.10.3, unless the local home network id is not changed. the ip data session should be maintained if the local home network id is not changed. if the ue has no other pdn connection and the local home network id is changed, the (target) mme initiates "explicit detach with reattach required" procedure according to clause?5.3.8.3.
upon completion of tracking area update procedure, the (new) mme shall trigger the re-establishment of the sipto at the local network pdn connection when it detects that the ue has moved away from the (h)enb and to a (h)enb with different local home network id, as specified in clause?5.3.3 and clause?5.3.4.
note: it is expected that all mmes/sgsns in a plmn have support for sipto at the local network where the operator deploys this feature, in order to support mobility procedures. for a mobility event where target mme/sgsn does not support sipto at the local network, the handling of pdn deactivation for sipto at local network pdn connection is not specified.
4.3.15a.3 sipto at the local network with l-gw function collocated with the (h)enb
sipto at the local network is achieved using a local gw (l-gw) function collocated with the (h)enb and using the same procedures as described in clause?4.3.15, with the following additions:
- the (h)enb supporting the sipto at the local network function includes the local gw address to the mme in every initial ue message and every uplink nas transport control message specified in ts?36.413?[36].
- the pdn gw selection function uses the l-gw address proposed by (h)enb in the s1-ap message, instead of dns interrogation.
- specific to the henb subsystem, the local gw information for sipto at the local network is signalled on s1 separately from the local gw information for lipa. the l-gw shall be able to discriminate between pdn connection for sipto at the local network and for lipa.
note?1: the protocol option (i.e. gtp or pmip) supported on the s5 interface between local gw and s gw is configured on the mme.
the direct UP path between the (h)enb and the collocated l-gw is enabled with a sipto correlation id parameter that is associated with the default eps bearer on the pdn connection used for sipto at the local network. upon establishment of the default eps bearer the mme sets the sipto correlation id equal to the pdn gw teid (gtp-based s5) or the pdn gw gre key (pmip-based s5). the sipto correlation id is then signalled by the mme to the (h)enb as part of e-rab establishment and is stored in the e-rab context in the (h)enb. the sipto correlation id is used in the (h)enb for matching the radio bearers with the direct UP path connections from the collocated l-gw for sipto at local network pdn connection.
as ip data session continuity for the sipto at the local network pdn connection is not supported in this release of the specification, the sipto at the local network pdn connection shall be re-established when the ue moves away from (h)enb. during the handover procedure, when the source (h)enb releases its resources related to the ue, the (h)enb shall request using intra-node signalling the collocated l-gw to re-establish the sipto at the local network pdn connection. the l-gw starts a timer. when the timer expires, the l-gw shall initiate the release of the sipto at the local network pdn connection using the pdn gw initiated bearer deactivation procedure according to clause?5.4.4.1 with the "reactivation requested" cause value.
4.3.16 local ip access (lipa) function
the lipa function enables an ip capable ue connected via a henb to access other ip capable entities in the same residential/enterprise ip network without the UP traversing the mobile operator's network except henb subsystem.
the local ip access is achieved using a local gw (l-gw) colocated with the henb.
lipa is established by the ue requesting a new pdn connection to an apn for which lipa is permitted, and the network selecting the local gw associated with the henb and enabling a direct UP path between the local gw and the henb. the henb supporting the lipa function includes the local gw address to the mme in every initial ue message and every uplink nas transport control message as specified in ts?36.413?[36].
note?1: the protocol option (i.e. gtp or pmip) supported on the s5 interface between local gw and s gw is configured on the mme.
for this release of the specification no interface between the l-gw and the pcrf is specified and there is no support for dedicated bearers on the pdn connection used for local ip access. the local gw (l-gw) shall reject any ue requested bearer resource modification.
the direct UP path between the henb and the collocated l-gw is enabled with a correlation id parameter that is associated with the default eps bearer on a pdn connection used for local ip access. upon establishment of the default eps bearer the mme sets the correlation id equal to the pdn gw teid (gtp-based s5) or the pdn gw gre key (pmip-based s5). the correlation id is then signalled by the mme to the henb as part of e-rab establishment and is stored in the e-rab context in the henb. the correlation id is used in the henb for matching the radio bearers with the direct UP path connections from the collocated l-gw.
if the ue is roaming and if the hss indicates lipa roaming allowed for this ue in this vplmn, then the vplmn (i.e. mme) may provide lipa for this ue. furthermore, in the absence of any lipa information for the requested apn from the hss, the vplmn (i.e mme) shall not provide lipa. the vplmn address allowed flag is not considered when establishing a lipa pdn connection.
lipa is supported for apns that are valid only when the ue is connected to a specific csg. lipa is also supported for "conditional" apns that can be authorized to lipa service when the ue is using specific csg. apns marked as "lipa prohibited" or without a lipa permission indication cannot be used for lipa.
mme shall release a lipa pdn connection to an apn if it detects that the ue's lipa csg authorization data for this apn has changed and the lipa pdn connection is no longer allowed in the current cell.
as mobility of the lipa pdn connection is not supported in this release of the specification, the lipa pdn connection shall be released when the ue moves away from h(e)nb. before starting the handover procedure towards the target ran, the h(e)nb shall request using an intra-node signalling the collocated l-gw to release the lipa pdn connection. the h(e)nb determines that the ue has a lipa pdn connection from the presence of the correlation id in the ue (e-)rab context. the l-gw shall then initiate and complete the release of the lipa pdn connection using the pdn gw initiated bearer deactivation procedure as per clause?5.4.4.1 or ggsn initiated pdp context deactivation procedure as specified in ts?23.060?[7]. the h(e)nb shall not proceed with the handover preparation procedure towards the target ran until the ue's (e-)rab context is clear for the correlation id.
at the handover, the source mme checks whether the lipa pdn connection has been released. if it has not been released:
- and the handover is the s1-based handover or the inter-rat handover, the source mme shall reject the handover.
- and the handover is x2-based handover, the mme shall send a path switch request failure message (see more detail in ts?36.413?[36]) to the target henb. the mme performs explicit detach of the ue as described in the mme initiated detach procedure of clause?5.3.8.3.
note?2: the direct signalling (implementation dependent) from the h(e)nb to the l-gw is only possible since mobility of the lipa pdn connection is not supported in this release.
during idle state mobility events, the mme/sgsn shall deactivate the lipa pdn connection when it detects that the ue has moved away from the henb.
4.3.17 support for machine type communications (mtc)
4.3.17.1 general
this clause provides an overview about functionality for machine type communications according to service requirements described in ts?22.368?[66]. the specific functionality is described in the affected procedures and features of this and other specifications. for discrepancies between this overview clause?and the detailed procedure and function descriptions, the latter take precedence.
mtc functionality is provided by the visited and home networks when the networks are configured to support machine type communication. it applies to both the non-roaming case and the roaming case and some functionality may be dependent upon the existence of appropriate roaming agreements between the operators.
some of the mtc functions are controlled by subscriber data. other mtc functions are based on indicators sent by the ue to the network. mtc functionality is performed by ues that are configured to support different options as described in clause?4.3.17.4.
though motivated by scenarios and use cases defined in ts?22.368?[66], the functions added to support mtc have general applicability and are in no way constrained to any specific scenario or use case except where explicitly stated.
4.3.17.2 overview of protection from potential mtc related overload
the number of mtc devices may be several orders of magnitude greater than "traditional" devices. many (but not all) mtc devices will be relatively stationary and/or generate low volumes of traffic. however, these ues have the capability to generate normal quantities of signalling. as normal signalling from large numbers of ues may cause overload independently whether the ue is used for mtc or not, generic functionality for overload and congestion control is required.
the total signalling from large numbers of ues is a concern in at least two situations:
- when an application (running in many ues) requests many ues to do "something" at the same time; and/or
- when many ues are roamers and their serving network fails, then they can all move onto the local competing networks, and potentially overload the not (yet) failed network(s).
to counter these potential problems, the following standardised indications and mechanisms are provided in a generic manner. these permit node specific features to be developed to protect the networks.
a) where applicable, ues can be configured for enhancements as described in subsequent bullets post-manufacturing configuration can be performed remotely as described in clause?4.3.17.4.
b) for mobile originated services, ues configured for low access priority provide the e-utran with information indicating that the rrc connection establishment request has low access priority (see clause?4.3.17.4). clause?4.3.17.4 describes when low access priority is not applicable.
c) rrc signalling has the capability of providing 'extended wait timers' when rejecting messages from ues. these 'extended wait timers' are only used by ues that access the network with low access priority.
d) the mme can initiate rejection of rrc connection establishments in the e-utran for ues that access the network with low access priority as described in clause?4.3.7.4.1. in addition, mme signalling or o&m can trigger e-utran to initiate extended access barring. these mechanisms are further described in clause?4.3.7.4.1.
e) overload messages from the mme to e-utran are extended to aid the ran in performing the functionality in bullets b, c and d above.
f) ues configured with a long minimum periodic plmn search time limit (see ts?24.368?[69]) have an increased minimum time in between their searches for more preferred plmns.
note?1: following the failure of a more preferred plmn, ues configured as above might change to other local competing networks. expiry of this search timer will lead to the ue re-attempting to access the failed network, and then, if that network has not yet recovered, reaccessing one of the local competing networks. use of a too short timer for the more preferred plmn search can both prevent the failed network from recovering, and, impose more load on the local competing networks.
g) at plmn change, ues configured to perform attach with imsi at plmn change (see ts?24.368?[69]) do this rather than a ta update with guti (thus avoiding the need to reject the ta update, and to request the imsi following the subsequent attach with guti).
note?2: in the case of a network failure, this reduces the message processing load on a local competing network and hence makes that network more likely to survive the failure of the other network.
h) for mobile originated services, ues configured for low access priority (see ts?24.368?[69]) provide a low access priority indication to the mme in nas signalling that permit the mme to undertake protective measures (e.g. to permit the mme to immediately command the ue to move to a state where it does not need to generate further signalling messages and/or does not reselect plmns), as described in clause?4.3.7.4.1. clause?4.3.17.4 describes when low access priority is not applicable.
i) using periodic tau timer value sent by the hss and/or ue provided low access priority indication (bullet h above), the mme can allocate a long periodic tau timer value to the ue. a long periodic tau timer is likely to slow down the rate at which a ue detects a network failure and thus it slows down the rate of movement of ues from a failed network to other local competing networks (see clause?4.3.17.3).
j) mechanisms for the mme and p-gw to detect congestion associated with a particular apn (see clauses 4.3.7.4.2 and 4.3.7.5).
k) the addition of 'back off timers' to emm and esm signalling messages (e.g. to rejection messages). these include some time randomisation to guard against a repeat of a load peak. the mme should be able to apply this behaviour on a per-apn basis. as described in clause?4.3.7.4.2
l) signalling that permits the p-gw to request the mme to generate the above esm signalling with 'back off timers' (see clause?4.3.7.5).
m) an mme overload control mechanism to selectively limit the number of downlink data notification requests the s-gw sends to the mme for downlink low priority traffic received for ues in idle mode (see clause?4.3.7.4.1a).
n) ue configured for specific handling of the invalid usim state, the "forbidden plmn list", the "forbidden plmns for attach in s1mode list" and the "forbidden plmns for gprs service list" remembers that the usim is invalid and keeps the plmn forbidden lists even if the ue is switched off and then switched on.
o) when the ue has an activated pdn connection without low access priority or the ue is requested to establish such a pdn connection and the ue is configured with a permission for overriding low access priority the ue doesn't provide a low access priority indication to the mme in nas mm signalling and also not to the ran in the rrc requests. in the nas request for activating a pdn connection this ue always indicates what the upper layers requested, i.e. the ue indicates low access priority in that nas request unless the upper layers request activation of a pdn connection without low access priority.
p) when the ue has an activated pdn connection that is without low access priority or the ue is requested to activate such a pdn connection and the ue is configured with a permission for overriding extended access barring, then the ue ignores any extended access barring (if it is activated in the network) as defined in ts?22.011?[67].
note?3: it is assumed that the mechanisms described in this entire clause are designed by stage?3 in a manner that allows extensibility and forward compatibility.
q) the enodeb may use the low access priority indication provided by the ue to steer ues configured for low access priority to specific mmes.
4.3.17.3 optimising periodic tau signalling
to reduce network load from periodic tau signalling and to increase the time until the ue detects a potential need for changing the rat or plmn (e.g. due to network problems) the longer values of the periodic tau timer and mobile reachable timer shall be supported.
a long periodic rau/tau timer value may be locally configured at mme or may be stored as part of the subscription data in hss. during attach and tau procedures the mme allocates the periodic rau/tau timer value as periodic tau timer to the ue based on vplmn operator policy, low access priority indication from the ue, periodic rau/tau timer value requested by ue and subscription information received from the hss.
if mme receives a subscribed periodic rau/tau timer value from the hss it allocates the subscribed value to the ue as periodic tau timer. a visited plmn mme may use subscribed periodic rau/tau timer value, if available, as an indication to decide for allocating a locally configured periodic rau/tau timer value to the ue.
if no subscribed periodic rau/tau timer value is received from the hss, the mme should:
- if the periodic rau/tau timer value requested by ue is within the boundaries of the vplmn operator policy, allocate the value requested by the ue;
- if the periodic rau/tau timer value requested by ue is higher than allowed per the vplmn operator policy, allocate the highest allowed value per the vplmn operator policy;
- if the periodic rau/tau timer value requested by ue is lower than allowed per the vplmn operator policy, allocate the lowest allowed value per the vplmn operator policy.
4.3.17.4 ue configuration and usage of indicators
a subscriber can by agreement with its operator be required to use ues that are configured (see ts?24.368?[69]) to support one or more of the following options:
- ue configured for low access priority; and/or
- ue configured with a permission for overriding low access priority, which is only applicable for a ue that is also configured for low access priority; and/or
- ue configured to perform attach with imsi at plmn change; and/or
- ue configured with a long minimum periodic plmn search time limit; and/or
- ue configured for specific handling of the invalid usim state, the "forbidden plmn list", the "forbidden plmns for attach in s1mode list" and the "forbidden plmns for gprs service list"; and/or
- ue configured for extended access barring; and/or
- ue configured with a permission for overriding extended access barring, which is only applicable for a ue that is also configured for extended access barring.
note?1: when a ue is accessing the network with low access priority, then the ue may be subject for longer backoff timers at overload and consequently need to be designed to be tolerant to delays when accessing the network.
ues can be configured for one or more of the above options with the following restrictions:
- in this release of the specification, a ue that is configured for low access priority shall also be configured for extended access barring; and
- in this release of the specification, a ue that is configured for extended access barring shall be configured for low access priority.
- in this release of the specification, a ue that is configured for overriding low access priority shall also be configured for overriding extended access barring; and
- in this release of the specification, a ue that is configured for overriding extended access barring shall also be configured for overriding low access priority.
ues can be configured for one or more of the above options. post-manufacturing configuration of these options in the ue can be performed only by oma dm or (u)sim ota procedures. ues capable of the above options should support configuration of these options by both oma dm and (u)sim ota procedures.
a ue configured for low access priority shall transmit the low access priority indicator to the mme during the appropriate nas signalling procedures and transmit the corresponding low access priority to the e-utran during rrc connection establishment procedures.
note?2: the low access priority indicator in nas signalling and the corresponding low access priority for rrc connection establishment are used by the network to decide whether to accept the nas request or the setup of the rrc connection respectively.
low access priority shall not be applicable in the following situations:
- for all procedures related to an emergency pdn connection; used for ims emergency sessions that are to be prioritized as per the requirements for ims emergency session procedures (see clause?4.3.12). when an emergency pdn connection gets established, the mme may, based on mme configuration, initiate the deactivation of any non-emergency pdn connection using the mme requested pdn disconnection procedure described in clause?5.10.3;
- for all procedures when preferential access to the network is provided to the ue by the access class 11-15 mechanism according to ts?36.331?[37] and ts?22.011?[67] e.g. for multimedia priority services as described in clause?4.3.18;
note?3: the configuration of a ue for low access priority and access class 11-15 are configured independently of each other. however, the home operator can take care to prevent a subscription for access class 11-15 from being used in a ue configured for low access priority.
- for rrc connection establishment procedures when responding to paging;
- for a ue configured with a permission for overriding low access priority under conditions described by bullet o in clause?4.3.17.2; or
- other specific situations described in ts?24.301?[46].
if the nas session management request message used to establish a new pdn connection contains a low access priority indication, the mme shall forward the low access priority indication in the create session request message to the s-gw/p gw. the low priority indication gets associated with a pdn connection when it is established and it shall not change until the pdn connection is deactivated.
the low access priority indication may be included in charging records by the visited and home networks. in order to permit the s-gw to include the low access priority indicator in the charging records, the low access priority indicator should be stored in the mme eps bearer contexts and should be passed as part of these contexts to other sgsn/mme or s-gw nodes in mobility management procedures.
note?4: in this release there is no other usage of storing the low access priority indicator in eps bearer contexts other than for the purpose to include it in charging records. particularly, the low access priority indicator in eps bearer contexts is not used by the network to make overload control decisions.
a network node may invoke one or more of the following mechanisms based on the indicators received in signalling from ues or forwarded by other network nodes:
- based on the low access priority indicator in nas request messages, bullets e, h, i, k and l as defined in clause?4.3.17.2; and/or
- based on the low access priority for rrc connection establishment, bullets b, c and q as defined in clause?4.3.17.2.
a ue shall invoke one or more of the following mechanisms based on the configuration and capabilities of the ue:
- when ue is configured with a long minimum periodic plmn search time limit, the ue invokes actions as described in bullet f in clause?4.3.17.2; and/or
- when ue is configured to perform attach with imsi at plmn change, the ue invokes actions as described in bullet g in clause?4.3.17.2; and/or
- when a ue is configured for low access priority, the ue invokes actions as described in bullets b and h in clause?4.3.17.2; and/or
- when ue is configured for specific handling of the invalid usim state, the "forbidden plmn list", the "forbidden plmns for attach in s1mode list" and the "forbidden plmns for gprs service list", the ue invokes actions as defined in bullet n in clause?4.3.17.2; and/or
- when ue is configured for extended access barring, the ue invokes actions as defined in bullet d in clause?4.3.17.2; and/or
- when a ue is configured with a permission for overriding low access priority and configured with a permission for overriding extended access barring, the ue invokes actions as described in bullets o) and p) in clause?4.3.17.2.
4.3.17.5 void

4.3.17.6 support of ues configured for low access priority, extended access barring and permission for override
the feature is specified in ts?23.060?[7] clause?5.3.13.6.
4.3.17.7 high latency communication
functions for high latency communication may be used to handle mobile terminated (mt) communication with ues being unreachable while using power saving functions e.g. ue power saving mode (see clause?4.3.22) or extended idle mode drx (see clause?5.13a) depending on operator configuration. "high latency" refers to the initial response time before normal exchange of packets is established. that is, the time it takes before a ue has woken up from its power saving state and responded to the initial downlink packet(s). the feature is described in ts?23.682?[74].
the high latency communication includes invoking extended buffering of mt data at the serving gw when the ue is in a power saving state and not reachable. the handling is specified in the network triggered service request procedure, clause?5.3.4.3. establishing the UP for delivering the buffered data when the ue contacts the mme or sgsn by signalling shall be done in the tracking area update and routing area update procedures. the mme/sgsn uses its parameter dl data buffer expiration time in the mm context information to remember if there is buffered dl data to be delivered when the ue becomes reachable. when set, the dl data buffer expiration time shall be cleared at any UP setup to the ran, i.e. buffered dl data can been delivered. at tau/rau procedures with mme/sgsn change, the old mme/sgsn shall indicate in the context response to the new mme/sgsn that buffered dl data is waiting and hence the new mme/sgsn shall establish the UP for delivery of the buffered dl data. when the dl data buffer expiration time has expired, the mme/sgsn considers no dl data to be buffered and no indications of buffered dl data waiting are sent during context transfers at tau procedures. at tau/rau procedures with serving gw change, the buffered dl data is forwarded to the new serving gw or gn/gp-sgsn.
for CP ciot eps optimisation, the high latency communication includes invoking the buffering of mt data at the serving gw or the mme as specified in mobile terminated data transport in CP ciot eps optimisation with p-gw connectivity, clause?5.3.4b.3. when the ue contacts mme, mme delivers the buffered data using nas pdus. if mt data is buffered in mme, at tau procedures with mme change the buffered data in the old mme is discarded.
the high latency communication also includes sending event notifications to application servers that have requested "ue reachability" or "availability after ddn failure" monitoring events. event notifications are sent when a ue becomes reachable, for example as part of the attach procedure, tau/rau procedures and the ue triggered service request procedure.
when "ue reachability" moniorting is requested for ue's that are using extended idle mode drx, an event notification is sent to the application server when the ue is about to become reachable for paging.
if the mme is aware that some signalling or data is pending in the network for an ue that is known as being unreachable for a long duration, e.g. for ue's having extended idle mode drx or psm enabled, the mme may include a pending data indication in the next s1-ap message towards an enb. if the enb receives this indication, the enb may take this information into account when determining user inactivity. at inter-ran node handovers, if some signalling or data are still pending, the target mme may send a pending data indication to the target ran node.
4.3.17.8 support for non-ip data delivery (nidd)
4.3.17.8.1 general
the support of non-ip data is part of the ciot eps optimisations. a pdn type "non-ip" is used for non-ip data. the non-ip data delivery to scs/as is accomplished by one of two mechanisms:
- delivery using scef as defined in clause?4.3.17.8.3.2.
- delivery using a point-to-point (ptp) sgi tunnel as defined in clause?4.3.17.8.3.3.
when the reliable data service is not used, non-ip data in-sequence delivery cannot be guaranteed and data pdus may be lost requiring higher protocol layers to ensure guaranteed delivery when needed. the reliable data service is defined in ts?23.682?[74].
note: if ues use protocols that require broadcast/multicast mechanisms (e.g. use "ip stacks" on top of pdn connections of type "non-ip"), this may cause increased traffic and power consumption to the ue and the network.
the sms service may also be used to deliver data without use of the ip protocol. the sms service is always supported for ciot eps optimisations, i.e. can be used simultaneously with non-ip and ip data. when only the sms service is needed, an attach without pdn connection establishment can be used, see clause?5.3.2.
dedicated bearers are not supported for the non-ip data.
4.3.17.8.2 esm procedures 
the ue indicates in the esm connection request, e.g. in attach or pdn connectivity request, that a non-ip pdn type shall be used. the subscription information has a default apn for pdn type non-ip, which the mme uses for the first received non-ip connectivity request unless the ue has included an apn in the request.
4.3.17.8.3 delivery mechanism
4.3.17.8.3.1 general
at each pdn connectivity request, the mme decides which delivery mechanism (scef based delivery or sgi based delivery) is used for delivering the non-ip data between ran and as. an indication associated with the used apn determines if scef based delivery or sgi based delivery shall be used.
4.3.17.8.3.2 scef based delivery
when the mme decides to use scef based delivery mechanism for non-ip data, a pdn connection is established towards the selected scef. such a pdn connection is also known as an "scef connection". the apn used for scef based delivery is an fqdn, which either resolves to an scef hostname or to an scef ip addresss.
the scef based delivery is applicable only to the CP ciot eps optimisation (see clause?4.10).
the support of non-ip data via the scef is further defined in ts?23.682?[74].
4.3.17.8.3.3 sgi based delivery
4.3.17.8.3.3.1 general
when support of non-ip data is provided at the sgi interface, different point-to-point tunneling techniques may be used. point-to-point tunneling by udp/ip encapsulation can be used as described in clause?4.3.17.8.3.3.2 below. other techniques as described in clause?4.3.17.8.3.3 below may be used.
support for the sgi based delivery of non-ip data can be used by any ue. that is, it is independent of support for the UP ciot eps optimisation and the CP ciot eps optimisation (see clause?4.10).
the p-gw decides at pdn connection establishment based on pre-configuration which point-to-point tunneling technique is used for the sgi based delivery between the p-gw and the as.
note: the pre-configuration can be done in the p-gw per apn or based on other criterion such as sla between operator and 3rd party application service provider, etc.
4.3.17.8.3.3.2 sgi ptp tunnelling based on udp/ip
sgi ptp tunnelling based on udp/ip may be used to deliver non-ip data to as via sgi.
a point-to-point tunnel is used by the p-gw towards the as. the tunnel parameters (i.e. destination ip address and udp port) for sgi ptp tunneling based on udp/ip are pre-configured on the p-gw. ip address allocation procedures for pdn connections are performed locally (e.g. without involving the ue) by the p-gw based on apn configuration and according to clause?5.3.1. only single ip address is used (i.e. both ipv4 and ipv6 addresses are not allocated).
the p-gw acts as a transparent forwarding node for the payload between the ue and the as.
for uplink non-ip data, the p-gw forwards the received data to the as over the sgi ptp tunnel using udp/ip encapsulation. when the reliable data service is enabled, the p-gw processes the reliable data service header. the reliable data service configuration is pre-configured on the p-gw. the reliable data service configuration is defined in ts?23.682?[74].
for downlink non-ip data, the as sends the data using udp/ip encapsulation with the ip address of the ue and the 3gpp defined udp port for "non-ip" data. the p-gw decapsulates the received data (i.e. removes the udp/ip headers) and forwards the data to s-gw on the gtp-u tunnel identified by the ip address of the ue (i.e. pdn connection) for delivery to the ue. when the reliable data service is enabled, the p-gw adds the reliable data service header.
the p-gw performs the ip related operations (e.g. allocates ip address for the pdn connection), but the ip address or ip prefix is not provided to the ue (i.e. slaac / router advertisements are not performed. dhcp or dhcpv6 are not used). in case of ipv6 the p-gw assigns an interface identifier for the pdn connection. the allocated ip address or ipv6 prefix identifies the pdn connection of the ue. the p-gw may inform the mme of the assigned ipv6 prefix for a given ue. however, the ue is not informed about the assigned ipv6 prefix.
note?1: whether the p-gw informs s-gw/mme of the assigned ip v6 prefix or not is left to stage 3 decision.
note?2: it is recommended to use ipv6 for ciot. ipv4 based addressing is deprecated for machine type communication used over 3gpp accesses, see ts?23.221?[27].
4.3.17.8.3.3.3 other sgi ptp tunnelling mechanisms
sgi ptp tunnelling mechanisms such as pmipv6/gre, l2tp, gtp-c/u, etc, may be used to deliver non-ip data to as via sgi. the general handling of such delivery mechanisms is as described below.
a point-to-point tunnel is established by the p-gw towards the as. depending on the type of protocol employed on the sgi ptp tunnel, the sgi ptp tunnel setup may be done at the time of attach or at the time of first mo datagram being sent by the ciot ue. the p-gw selects the as based on the p-gw configuration (e.g. per apn, or per ptp tunnel type etc.). however, ip address allocation procedures for the ue (according to clause?5.3.1) are not performed by the p-gw.
note: an as can be dedicated for handling a specific non-ip data protocol.
the p-gw acts as a transparent forwarding node between the ue and the as.
for uplink non-ip data, the p-gw forwards the received data to the as over the established sgi ptp tunnel.
for downlink non-ip data, the as locates the right sgi ptp tunnel for the ue (using information such as ue identifiers in the non-ip protocol itself, etc) to forward the data. the as sends the data to p-gw over the established sgi ptp tunnel. the p-gw in turn sends the data to s-gw on the gtp-u tunnel identified by the associated sgi ptp tunnel for delivery to the ue.
4.3.17.9 service gap control
service gap control is an optional feature intended for mtc/ciot ues to control the frequency at which these ues can access the network. that is, to ensure a minimum time gap between consecutive mobile originated data communications initiated by the ue. this helps reducing peak load situations when there are a large number of these ues in an operator network. service gap control is intended to be used for "small data allowance plans" for mtc/ciot ues where the applications are tolerant to service latency.
note?1: time critical applications, such as emergency services and regulatory prioritised services can suffer from the latency caused by the service gap control feature. therefore service gap control feature is not recommended for subscriptions with such applications and services.
service gap time is a subscription parameter used to set the service gap timer and is enforced in the ue and in the mme on a per ue level (i.e. the same service gap timer applies for all pdn connections that the ue has). the ue indicates its capability of support for service gap control in the attach request message and tau request message to the mme. the mme passes the service gap time to the ue in the attach accept message and/or tracking area update accept message for ue that has indicated its supports of the service gap control. the service gap control shall be applied in a ue when a service gap time is stored in the ue context and applied in the mme when the service gap time is stored in the mm context.
service gap control requires the ue to stay in ecm-idle mode for at least the whole duration of the service gap timer before triggering mobile originated user data transmission, except for procedures that are exempted (see ts?24.301?[46]). the service gap timer shall be started each time a ue moves from ecm-connected to ecm-idle, unless the connection request was initiated by the paging of a mobile terminated event, or after a tau procedure without active flag or signalling active flag, which shall not trigger a new or extended service gap interval. when a service gap timer expires, the ue is allowed to send a connection request again. if the ue does so, the service gap timer will be restarted at the next ecm-connected to ecm-idle transition.
the service gap control is applied in ecm-idle state only and does not impact ue mobile originated user data transmission or mobile originated signaling in ecm-connected state. the service gap timer is not stopped upon ecm-idle state to ecm-connected state transition. the ue shall not initiate connection requests for mo UP data, mo CP data, or mo sms when a service gap timer is running. the ue shall also not initiate attach requests when a service gap timer is running, unless it is attach request without pdn connectivity or emergency attach which are allowed.
note?2: as a consequence of allowing attach without pdn connectivity procedure, the ue with a running service gap timer does not initiate further mo signalling, except for tracking area updating procedure, until the ue receives mt signalling or after the ue has moved to ecm-idle state and the service gap timer is not running.
note?3: implementations need to make sure that latest and up-to-date data are always sent when a service gap timer expires.
the mme may enforce the service gap timer by rejecting connection request for mo UP data, mo CP data, or mo sms when a service gap timer is running. the mme may enforce the service gap timer by not allowing attach requests when a service gap timer is running, unless it is attach request without pdn connectivity or emergency attach which are allowed. when rejecting the connection requests and the attach requests while the service gap timer is running, the mme may include a mobility management back-off timer corresponding to the time left of the current service gap timer. for the ues that does not support service gap control (e.g. pre-release-15 ues), service gap control may be enforced using "general nas level mobility management control" as defined in clause?4.3.7.4.2.1.
when the mme starts the service gap timer, the mme should invoke the service gap timer with a value that is slightly shorter than the service gap time value provided to the ue in the subscription information received from the hss.
note?4: this ensures that the mme doesn't reject any ue requests just before the service gap timer expires e.g. because of slightly unsynchronized timers between ue and mme.
a ue which transitions from a psm or edrx power saving state shall apply service gap control when it wakes up if the service gap timer is still running.
additional aspects of service gap control:
- service gap control applies in all plmns.
- when the service gap timer is running and the ue receives paging, the ue shall respond as normal.
- service gap control applies to low priority (delaytolerant) and normal traffic.
- service gap control does not apply to exception reporting for nb-iot.
- emergency attach and attach without pdn connectivity are allowed when a service gap timer is running.
- service gap control shall be effective also for ues performing detach and reattach unless it is attach request without pdn connectivity or emergency attach.
- tracking area update with active flag or signalling active flag is not allowed when a service gap timer is running.
- if the service gap timer is running, the service gap is applied at plmn selection as follows:
a) re-attach to the registered plmn: the remaining service gap timer value survives and controls the re-attach.
b) attach or tracking area update to a different plmn: the remaining service gap timer value survives and controls the attach/tracking area update to the new plmn.
c) usim swap: the service gap timer is no longer running and the service gap feature does not apply, unless re-instatiated by the serving plmn.
- multiple uplink packets and downlink packets are allowed during one rrc connection for ue operating within its apn rate control limits.
the following procedures are impacted by service gap control:
- e-utran initial attach, see clause?5.3.2.1;
- tracking area update procedures, see clause?5.3.3;
- ue triggered service request, see clause?5.3.4.1;
- connection resume request, see clause?5.3.5a.
note?5: since ue triggered service request and connection resume request are prevented by service gap timer, this implictly prevents the ue from initiating mo data in CP eps optimisations (see clause?5.3.4b.2), mo nidd procedure (see ts?23.682?[74]) and mo sms (see ts?23.272?[58]).
4.3.18 multimedia priority service
4.3.18.1 general
multimedia priority service (mps) allows certain subscribers (i.e. service users as per ts?22.153?[68]) priority access to system resources in situations such as during congestion, creating the ability to deliver or complete sessions of a high priority nature. service users are government-authorized personnel, emergency management officials and/or other authorized users. mps supports priority sessions on an "end-to-end" priority basis.
mps is based on the ability to invoke, modify, maintain and release sessions with priority, and deliver the priority media packets under network congestion conditions. mps is supported in a roaming environment when roaming agreements are in place and where regulatory requirements apply.
note?1: if a session terminates on a server in the internet (e.g. web-based service), then the remote end and the internet transport are out of scope for this specification.
a service user obtains priority access to the radio access network by using the access class barring mechanism according to ts?36.331?[37] and ts?22.011?[67]. this mechanism provides preferential access to ues based on its assigned access class. if a service user belongs to one of the special access-classes as defined in ts?22.011?[67], the ue has preferential access to the network compared to ordinary users in periods of congestion.
mps subscription allows users to receive priority services, if the network supports mps. mps subscription entitles a usim with special access class(es). mps subscription includes indication for support of eps bearer priority service, ims priority service and cs fallback priority service support for the end user. priority level regarding eps bearer and ims are also part of the mps subscription information. the usage of priority level is defined in ts?23.203?[6] and ts?23.228?[52].
service users is treated as on demand mps subscribers or not, based on regional/national regulatory requirements. on demand service is based on service user invocation/revocation explicitly and applied to the pdn connections for an apn. when not on demand, mps service does not require invocation, and provides priority treatment for all eps bearers for a given service user after attachment to the eps network.
note?2: according to regional/national regulatory requirements and operator policy, on-demand mps service users can be assigned the highest priority.
for this release of the specification, mps is supported for e-utran access only in case of 3gpp accesses.
since the service user has an access class within the range for priority services, the establishment cause in rrc connection request is set to highpriorityaccess. when the enodeb receives mobile initiated signalling with establishment cause set to highpriorityaccess, the enodeb handles the rrc connection request with priority. when the mme receives and verifies mobile initiated signalling with establishment cause set to highpriorityaccess, the mme establishes the s1 bearer with priority.
the terminating network identifies the priority of the mps session and applies priority treatment, including paging with priority, to ensure that the mps session can be established with priority to the terminating user (either a service user or normal user).
priority treatment for mps includes priority message handling, including priority treatment during authentication, security, and location management procedures.
priority treatment for mps session requires appropriate arp and qci (where necessary for non-gbr bearers) setting for bearers according to the operator's policy.
when an mps session is requested by a service user, the following bearer management principles apply in the network:
- eps bearers (including default bearer) employed in an mps session shall be assigned arp value settings appropriate for the priority level of the service user.
- setting arp pre-emption capability and vulnerability for mps bearers, subject to operator policies and depending on national/regional regulatory requirements.
- pre-emption of non-service users over service users during network congestion situation, subject to operator policy and national/regional regulations.
priority treatment is applicable to ims based multimedia services, priority eps bearer services (ps data without ims interaction) and cs fallback.
for multimedia priority services any epc functions, procedures and capabilities are provided according to this clause's specification except when specified differently in the following clauses.
4.3.18.2 ims-based multimedia priority services
4.3.18.2.1 originating ims-based mps session
ims based mps sessions are permitted to be originated from any ue, in addition to mps-subscribed ues.
the mps-subscribed ue, based on the mps ims subscription information, operator's policy and national/regional regulations, may be given priority treatment for the default bearer and the eps bearer carrying ims signalling in the eps prior to and during ims-based mps invocation. further, priority treatment in the eps for signalling and media bearers may be modified/established via dynamic pcc based on the session authorization information received from the af.
as the ims media bearer is established after the ims session of the mps service has been established, it can be assigned with correct arp value when it is established. however ims signalling related eps bearer needs to be upgraded if it has not been assigned with an appropriate arp setting for the mps service when the ims session of the mps service has been initiated.
also to avoid cases where the default bearer may not be allocated resources in the handover case, due to low arp priority for the pdn connection, it is necessary to assure that the default bearer has an arp setting appropriate for the mps service.
4.3.18.2.2 terminating ims-based mps session
the terminating network identifies the priority of the ims-based mps session and applies priority treatment to ensure that the call is delivered with priority to the terminating user (either a service user or normal user).
if the existing arp of the default or dedicated eps bearer that is used to transport ims signalling are not appropriate for the mps service, then pcrf updates to the appropriate settings.
s-gw triggers a new priority paging towards mme in case the ongoing paging is lower priority than the incoming data received in the s-gw for ims terminating session.
4.3.18.3 priority eps bearer services
the service user receives on demand priority treatment according to its mps profile, i.e. on-demand. if the service user is not authorized to use on-demand priority request, the service user receives priority treatment (i.e. appropriate arp and qci ) at initial attach for all bearers, based on user profile data stored in the hss/spr and authorized by the pcrf (see ts?23.203?[6], clause?7.2).
an on-demand service user requires explicit invocation/revocation via spr mps user profile update (see ts?23.203?[6], clause?7.5). since mps user profile are part of inputs for pcc rules, the update will trigger pcc rules modification to achieve appropriate arp and qci settings for bearers (see ts?23.203?[6], clause?7.4.2).
when the enodeb receives mobile initiated signalling with establishment cause set to highpriorityaccess, the enodeb handles the rrc connection request with priority. when the mme receives and verifies mobile initiated signalling with establishment cause set to highpriorityaccess, the mme establishes the s1 bearer with priority. based on mps eps priority subscription, mme can verify whether the ue is permitted to handle the request preferentially comparing to other ues not prioritized.
an af for mps priority service is used to provide priority eps bearer services using network-initiated resource allocation procedures (via interaction with pcc) for originating accesses.
note: use of 3rd party af for mps services for service users is outside the scope of 3gpp specification.
4.3.18.4 cs fallback
cs fallback allows users to fallback to geran/utran/1x rtt while in e-utran access thus allowing the network to transfer the call towards geran/utran cs domain. in order to ensure that a priority csfb call to/from a service user is given proper priority treatment in the eps, mps subscription indicates the user's cs priority status, i.e. mps cs priority, which is provided to mme with user's subscription information. when the enodeb receives mobile initiated signalling with establishment cause set to highpriorityaccess, the enodeb handles the rrc connection request with priority. when the mme receives and verifies mobile initiated signalling with establishment cause set to highpriorityaccess, the mme establishes the s1 bearer with priority.
details on the priority treatment of csfb, see ts?23.272?[58].
4.3.18.5 network congestion controls for mps
based on regional/national requirements and network operator policy, mps shall be exempted from network congestion controls up to the point where further exemptions cause network instability. the mme should not apply nas level congestion control for mobile initiated signalling with establishment cause set to highpriorityaccess. the mme should not apply congestion control for termination requests related with an arp associated with mps.
4.3.18.6 load re-balancing between mmes for mps
when a ue is in ecm-connected mode with a bearer having an arp associated with mps, the mme should not release the ue for load re-balancing, except under critical conditions such as the need to perform an mme node restart. the mme should wait until the ue initiates a tau or becomes ecm-idle before initiating load re-balancing.
4.3.19 core network node resolution
4.3.19.1 general
the indication of mapped or native guti shall be signalled by the ue to the mme as an explicit indication in attach request and tau request messages. the indication of mapped or native p-tmsi/rai shall be signalled by the ue to the sgsn as an explicit indication in attach request and rau request messages. the mme/sgsn resolves the old mme/sgsn using old guti respective old p-tmsi/rai sent in the attach request and tau/rau request messages , and determines if the old guti or the old p-tmsi/rai is mapped or native by one of the following two methods:
- indication using most significant bit (msb) in lac and mme group id.
- explicit indication sent from ue to mme and sgsn.
4.3.19.2 msb in lac and mme group id
for plmns deployed with such mechanism the mme differentiates between a gummei mapped from p-tmsi/rai and a native gummei based on the value of most significant bit of the mme group id; i.e. the msb is set to "0" then the gummei is mapped from p-tmsi/rai and if msb is set to "1", the gummei is a native one, as specified in ts?23.003?[9].
for plmns deployed with such mechanism the s4-sgsn differentiates between a p-tmsi/rai mapped from guti and a native p-tmsi/rai based on the value of most significant bit of the lac; i.e. the msb is set to "1" then the p tmsi/rai is mapped from guti and if msb is set to "0", the p-tmsi/rai is a native one, as specified in ts?23.003?[9].
4.3.19.3 explicit indication
for plmns deployed with such mechanism the mme differentiates between a guti mapped from p-tmsi/rai or a native guti based on the explicit indication sent by the ue.
for plmns deployed with such mechanism the s4-sgsn differentiates between a p-tmsi/rai mapped from guti or a native p-tmsi/rai based on the explicit indication sent by the ue.
4.3.20 relaying function
4.3.20.1 general
the relaying function enables an operator to improve and extend the coverage area by having a relay node (rn) wirelessly connected to an enb serving the rn, called donor enb (denb), via a modified version of the e-utra radio interface called the un interface as specified in ts?36.300?[5].
the relaying function and use of rn/denb entities in a network is transparent to the operations of the ues connected to it and associated core network entities (e.g. mme, s/p-gw, pcrf etc.) for the ues.
the relaying architecture is shown in figure 4.3.20.1-1.

figure 4.3.20.1-1: relaying architecture
note?1: impact to core network elements from the introduction of rns and denb is minimized by reusing the existing nodes and protocols when interacting with the core network.
note?2: functions of the mme for the rn and mme for the ue may be collocated in a single mme.
the rn supports the enb functionality like termination of the radio protocols of the e-utra radio interface and the s1 and x2 interfaces. the rn also supports a subset of the ue functionality and protocols to wirelessly connect to the denb.
in addition to supporting enb functionality, the denb also embeds and provides the s-gw/p-gw-like functions needed for the rn operation. this includes creating a session for the rn and managing eps bearers for the rn as shown in clause?4.3.20.3, as well as terminating the s1-ap and s11 interfaces towards the mme serving the rn. due to the proxy functionality, the denb appears as an mme (for s1), an enb (for x2) and an s-gw to the rn.
the rn and denb also perform mapping of signalling and data packets onto eps bearers that are setup for the rn. the mapping is based on existing qos mechanisms defined for the ue and the p-gw and are described in ts?36.300?[5].
4.3.20.2 rn startup and attach procedure
4.3.20.2.1 general
the startup procedure for the relay node is based on the normal ue attach procedure and consists of the following two phases:
- phase i: attach for rn preconfiguration.
- phase ii: attach for rn operation (mme of the rn).
note: when the certificate-based solution is used, the rn uses usim-ini in phase i and usim-rn in phase ii with necessarily different imsis. when pre-shared key is used, there is only need for one usim and the rn uses the same imsi during phase i and phase ii. the mme does not treat certificate-based and pre-shared key-based solution differently. the use of the certificate-based and pre-shared key solutions is specified in annex?d of ts?33.401?[41].
4.3.20.2.2 attach for rn preconfiguration
the rn attaches to the e-utran/epc as a ue at power-up (i.e. the rn shall not include the rn indication in the rrc connection establishment signalling). the enb treats the rn as a normal ue when performing mme selection.
because the enb does not indicate that this is a rn in the s1 interface initial ue message, the mme does not perform any further rn specific actions (e.g. it ignores any indication from the hss that "this subscription includes a permission to operate as a rn").
the authentication of the "rn acting as an ue" is performed by the mme during this attach procedure, using the information obtained from the hss.
the mme performs the s-gw and p-gw selection as for a normal ue.
note: it is the responsibility of the hss operator to ensure that the rn subscription includes an apn configuration that ensures that the rn subscription cannot be used for other purposes, e.g. only a single apn is configured for the use of rns in phase i, and, that this apn is reserved for rns only.
the rn retrieves initial rn configuration parameters as UP traffic, across the sgi reference point, from rn oam (e.g. list of denb cells and selected plmn).
after this operation is complete, the rn detaches from the network using the normal ue initiated detach procedure, see clause?5.3.8.2.1 and the rn triggers phase ii.
4.3.20.2.3 attach for rn operation
to start relay operations, the normal attach procedure, with the following exceptions, is applied:
- the rn and the usim-rn perform local security operations (e.g. establishment of a secure channel between them) as specified in ts?33.401?[41];
- the rn selects a cell from the list acquired during phase i;
- the rn establishes an rrc connection with the denb, indicating that the connection is for a rn;
- the denb is aware of the mmes that support rn functionality. in all cases when the rn indication is recieved, the denb shall ensure that the current or (re)selected mme supports rn functionality;
note?1: the rn follows normal ue behaviour, e.g. the rn's nas may use either an imsi or a guti. also, the rn's nas may or may not provide an s-tmsi to the rn's as, and hence, the rrcconnectionrequest may either contain an s-tmsi or a random value.
- in the s1 interface initial ue message, the denb sends the rn indication to the mme. this message also carries the ip address of the s gw/p-gw function embedded in the denb;
- the subscription data supplied to the mme by the hss for usim-rn includes an indication that the subscription is permitted to be used by a rn.
- if the s1 interface initial ue message indicates that this is a rn, but the subscription data does not indicate that the subscription includes a permission to operate as a rn, then the mme shall reject the nas procedure (e.g. attach request, tracking area update request, service request, etc) with an appropriate cause value (e.g. one that avoids retries on this plmn yet does not harm a rn that has unexpectedly performed plmn reselection).
note?2: it is anticipated that the mme checks that the hplmn of the usim-rn is authorised to attach rns to this mme.
- the mme and rn perform the normal eps authentication procedures.
- mme (rn) selects the s-gw/p-gw in denb for the rn based on the ip address included in the initial ue message (i.e. all gw selection and apn related procedures are bypassed during this phase). the mme performs s11 interface signalling with the s-gw/p-gw located in the denb;
- the mme accepts the attach procedure and sets up an s1 context with the denb.
when relay function is enabled, mmes in a pool should all have the same relaying function capability in order to have consistent support for functions such as redundancy, load balancing.

figure 4.3.20.2-1: rn attach procedure
the detach procedure for the rn is the same as the normal ue detach procedure, though the rn should ensure that no ue is connected to the rn cells before detaching. it is up to rn implementation how it ensures no ue is connected.
4.3.20.3 denb e-rab activation/modification
this procedure is used by the denb to change the eps bearer allocation for the rn. the procedure is the same as the normal network-initiated bearer activation/modification procedure with the exception that the s-gw/p gw functionality (steps 1 and 6) is performed by the denb.

figure 4.3.20.3-1: denb-initiated bearer activation/modification procedure
note: it is up to implementation if and when the denb sets up and modifies eps bearers for the rn, in addition to the initial bearer set up procedures at attach.
4.3.21 core network assisted enodeb parameters tuning
4.3.21.1 cn assistance information
core network assisted enodeb parameters tuning aids the enodeb to minimize the ue state transitions and achieve optimum network behaviour. how the enb uses the core network assistance information is not in scope of this specification and is implementation specific.
core network assistance information may be derived by the mme per ue in the mme based on collection of ue behaviour statistics or other available information about the expected ue behaviour (such as subscribed apn, imsi ranges or other subscription information). if the hss provides the communication pattern (cp) parameters (see ts?23.682?[74]) within the subscription profile information, then the mme may use the cp parameters for selecting the cn assisted enb parameters. the cp parameters received from the hss are used by the mme as input to derive the cn assisted enb parameter values. for the case of statistics-based core network assistance information collection, this may be enabled based on local configuration (e.g. subscribed apn, imsi ranges or other subscription information). this information provides the enb with a way to understand the ue behaviour for these aspects:
- "expected ue activity behaviour", i.e. the expected pattern of the ue's changes between ecm-connected and ecm-idle states. this may be derived e.g. from statistical information or from subscription information.
- "expected ho interval", i.e. the expected time interval between inter-enb handovers. this may be derived e.g. from statistical information or from subscription information. the "expected ho interval" parameter is not based on subscription information. highly mobile ues may have the ecm-connected state reduced to reduce handover signalling, unless the activity data do not justify that, as reduced handover signalling would be outweighed by more service request signalling).
- "ue differentiation information" including the communication pattern parameters (see ts?23.682?[74]) to support uu operation optimisation for nb-iot ue differentiation.
the respective signalling to support this feature is specified in ts?36.413?[36]. the cases where the traffic profile (see see ts?23.682?[74]) is not used are described in clauses 5.3.4b.2 and 5.3.4b.3.
the mme decides when to send this information to the enb as "expected ue behaviour" carried in s1-ap signalling over the s1-mme interface as per procedure documented in clause?4.3.21.3.
note?1: the calculation of the core network assistance information, i.e. the algorithms used and related criteria, and the decision when it is considered suitable and stable to send to the enb are vendor specific. unreliable information should not be provided to the enb as it may drive undesirable system effects.
note?2: it is recommended the mme or, depending on where this assessment is performed, the enb, can consider the average times in the ecm-connected and ecm-idle states an accurate representation of the traffic patterns if the average time in ecm-connected mode is short enough to assume the ue is generally actively transmitting and/or receiving data while in ecm-connected state.
note?3: when there are multiple overlapping cp parameter sets received from the hss for one ue, then the mme considers a merge per cp parameter when deriving the cn assisted enb parameters, e.g. based on the scheduled communication time and/or communication duration time parameters. a conflict on the stationary indication parameter can be resolved by considering the ue as "mobile".
4.3.21.2 void

4.3.21.3 core network assistance procedures
the mme provides cn assistance information to the enodeb if available, during the setup of the s1 signalling connection (e.g., attach, service request).
the following figure is a high level description of the transfer of information from an mme to enodeb during a service request procedure.

figure 4.3.21.3-1: core network assisted enodeb parameters tuning
4.3.22 ue power saving mode
a ue may adopt a psm that is described in ts?23.682?[74]. if a ue is capable of adopting a psm and it wants to use the psm it shall request an active time value and may request a periodic tau/rau timer value during every attach and tau procedures, which are handled as described in ts?23.682?[74]. the ue shall not request a periodic tau/rau timer value if it is not requesting an active time value. the network shall not allocate an active time value if the ue has not requested it.
psm has no support in the cs domain on the network side.
note?1: when the psm is activated the ue might not be available for paging of mobile terminated cs services even though the ue is registered in the cs domain.
note?2: the attach and tau procedures of this specification are not showing the details of the periodic tau time and active time negotiation, i.e. are not showing the related ies.
if the network allocates an active time value, the ue and the mme starts the active timer (see clause?4.3.5.2) with the active time value allocated by the network when transitioning from ecm_connected to ecm_idle. the ue shall stop the active timer, if running, when a transition to ecm_connected mode is made. when the active timer expires, the ue deactivates its access stratrum functions and enters psm. in psm, due to deactivation of access stratum functions, the ue stops all idle mode procedures, but continues to run any nas timers that may apply, e.g. the periodic tau timer. the ue shall resume access stratum functions and idle mode procedures before the periodic tau timer expires for performing the periodic tau procedure as applicable. the ue may resume idle mode procedures and access stratum functions any time while in psm, e.g. for mobile originated communications. any timers and conditions that remain valid during power-off, e.g. for nas-level back-off, apply in the same way during psm.
when the active timer expires for the ue, the mme knows that the ue entered psm and is not available for paging. the mme handles availability for paging as detailed in clause?4.3.5.2.
on ue side the psm complies with some substates of emm_registered, as specified in ts?24.301?[46]. the mme considers the ue to be emm_registered, but not reachable. the ue's access stratum functions are considered as deactivated during psm.
for mobile terminated data while a ue is in psm, the functions for high latency communication may be used as described in clause?4.3.17.7.
when the ue has bearers for emergency services, the ue shall not apply psm.
4.3.23 access network selection and traffic steering based on ran-assisted wlan interworking
as described in ts?36.300?[5], ts?36.304?[34], ts?36.331?[37] and ts?25.331?[33], utran and e-utran may provide ran assistance parameters to the ue via rrc signalling. the ran assistance parameters may e.g. include e-utran signal strength and quality thresholds, wlan channel utilization thresholds, wlan backhaul data rate thresholds, a list of wlan identifiers and offload preference indicator (opi). the ue uses the ran assistance parameters to perform access network selection and traffic steering decisions between 3gpp access and wlan using procedures defined in ts?36.304?[34] or using andsf policies defined in ts?23.402?[2]. co-existence between the procedures defined in ts?36.304?[34] and andsf policies is described in ts?23.402?[2].
for traffic steering decisions using procedures defined in ts?36.304?[34] the mme may provide information to the ue indicating which pdn connection can be offloaded to wlan and which pdn connection shall not be offloaded to wlan. when provided by the mme, this indication is provided in nas signalling on a per pdn connection basis when a pdn connection is established. the mme may provide a per-rat indication for the pdn connection, e.g. if the indication is different for utran and for e-utran. if the mme provides a single indication, the ue shall apply such indication both to e-utran and utran.
traffic steering decisions using procedures defined in ts?36.304?[34] are not applicable to non-seamless wlan offload (see ts?23.402?[2] for the definition of non-seamless wlan offload).
in order for the operator to allow/prohibit wlan offloading on per user and per apn basis, subscription data in the hss may be configured to indicate if wlan offload is allowed or prohibited for an apn.
the mme determines the wlan offloading permissions for the ue and pdn connection as described below:
- the mme determines the offloadability of a pdn connection based on subscription data and locally configured policy (e.g. for roaming users or when the subscription data does not include any wlan offloadability indication).
- when the ue establishes a new pdn connection, the mme may indicate whether this pdn connection is offloadable or not offloadable to wlan.
- the mme may provide an updated wlan offloadability indication of a pdn connection to the ue. this may be initiated by hss as part of the insert subscriber data procedure as described in clause?5.3.9.2. it can also be initiated by the mme by initiating steps?4 to 7 of the bearer modification procedure in clause?5.4.3, figure 5.4.3-1 or by adding the wlan offloadability indication to a session management nas message sent to the ue as part of an existing procedure. the mme shall not trigger signaling to an ecm-idle ue solely for the purpose of updating the wlan offloadability indication.
when the ue applies the procedures defined in ts?36.304?[34] and ts?25.304?[12], if the ue has local operating environment information (loei), as defined in ts?23.261?[54], the ue shall consider the ran rules in combination with the non-radio related aspects of loei, and shall give priority to loei in case it indicates wlan is not acceptable for non-radio related reasons. for example, if the active ran rule indicates that traffic shall be moved to wlan access, but the loei in the ue indicates that wlan access is unacceptable due to non-radio related causes (e.g. due to authentication issues, low battery power, etc.), the ue shall not move the traffic to wlan.
when the ue applies the procedures defined in ts?36.304?[34], the ue takes into account the wlan offloadability indication from mme to perform handover between 3gpp access and wlan access using the handover procedures described in ts?23.402?[2].
when the ue receives a wlan offloadability indication from the network for a pdn connection the ue stores it for the lifetime of that pdn connection and updates it if a new value is received from the network. the ue shall apply the latest indication previously received for the pdn connection.
the indication of whether a pdn connection is offloadable or not offloadable should be passed from the source to the target serving node in mobility management procedures from a mme to a mme/sgsn. this allows the target sgsn/mme to learn the indication previously provided to the ue and to decide the need for providing an updated indication to the ue.
4.3.23a access network selection and traffic steering based on ran-controlled wlan interworking
as described in ts?36.300?[5] e-utran may support ran-controlled wlan interworking (rclwi) for controlling traffic steering between e-utran and wlan for ues in rrc_connected. when e-utran sends an "offload" command to the ue, the ue passes an indication to the upper layers indicating that traffic steering to/from wlan is needed. the upper layers determine to initiate traffic steering to/from wlan based on the ue capability and the configuration information that has received from nas layer indicating which pdn connections are offloadable. when the ue receives the "offload" command from the eutran, the ue shall perform handover to wlan only the pdn connections that have been authorized for offloading.
the nas level indication about "offloadability" of pdn connections is defined in clause?4.3.23.
the ue uses the rclwi procedures to perform access network selection and traffic steering decisions between 3gpp access and wlan or using andsf policies defined in ts?23.402?[2]. co-existence between the procedures defined for rclwi, andsf policies and user preference is described in ts?23.402?[2].
4.3.24 ran UP congestion management function
4.3.24.1 general
the UP congestion management function addresses how the system can effectively mitigate ran UP congestion in order to reduce the negative impact on the perceived service quality. the congestion mitigation measures include traffic prioritization, traffic reduction and limitation of traffic, and shall be able to manage UP traffic across a range of variables including the user's subscription, the type of application, and the type of content. congestion mitigation can be performed in the ran or in the cn, or in a combined way both in the ran and in the cn.
4.3.24.2 ran UP congestion mitigation in the ran
editor's note: text to be added depending on the outcome of the upcon study.
4.3.24.3 ran UP congestion mitigation in the cn
ran UP congestion mitigation in the cn uses ran oam information, collected by the ran congestion awareness function (rcaf), to detect congestion. the ran congestion awareness function is further described in clause?4.4.12. this functionality is applicable only in case of utran/e-utran accesses.
note?1: the criteria used for detection of ran UP congestion (including detection of congestion abatement) are outside the scope of 3gpp specifications.
note?2: the interface to the ran's oam system is not standardized.
the rcaf can transfer ran UP congestion information (ruci) to the pcrf over the np reference point in order to mitigate the congestion by measures selected by the pcrf, as specified in ts?23.203?[6]. decisions to apply congestion mitigation measures may take into account operator policies and subscriber information and all additional available ip-can session information.
different mechanisms and mitigation actions applicable as described in ts?23.203?[6] in order to mitigate ran UP congestion. those mechanisms include e.g. service/application gating, service/application bandwidth limitation, deferring of services.
note?3: co-existence between congestion mitigation in ran and cn can be assured by appropriate network configuration of applicable policies for congestion mitigation, as well as related ran parameter alignment/tuning, such as tuning of parameters for e.g., load balancing, carrier aggregation, co-ordinated multipoint, dual connectivity. this parameter alignment/tuning is not further specified.
note?4: a condition leading to interoperability issues which may lead to suboptimal situation is that the time scales for actions of congestion mitigation in ran and in cn are of comparable duration. therefore, congestion mitigation in ran and cn cannot have comparable time scales, otherwise interoperability is affected.
4.3.25 dedicated core networks (dcns)
4.3.25.1 general
this feature enables an operator to deploy multiple dcns within a plmn with each dcn consisting of one or multiple cn nodes. each dcn may be dedicated to serve specific type(s) of subscriber. this is an optional feature and enables dcns to be deployed for one or multiple rats (e.g. geran, utran, e-utran, wb-e-utran and nb-iot). there can be several motivations for deploying dcns, e.g. to provide dcns with specific characteristics/functions or scaling, to isolate specific ues or subscribers (e.g. m2m subscribers, subscribers belonging to a specific enterprise or separate administrative domain, etc.).
a dcn comprises of one or more mme/sgsn and it may comprise of one or more sgw/pdn gw/pcrf. this feature enables subscribers to be allocated to and served by a dcn based on subscription information ("ue usage type"). the feature in this clause?handles both dcn selections without any specific ue functionality, i.e. it works also with ues of earlier releases and ue assisted dcn selection.
the main specific functions are for routing and maintaining ues in their respective dcn. the following deployment scenarios are supported for dcn:
- dcns may be deployed to support one rat only, (e.g. only dedicated mmes are deployed to support e-utran and dedicated sgsns are not deployed), to support multiple rats, or to support all rats.
- networks deploying dcns may have a default dcn, which is managing ues for which a dcn is not available or if sufficient information is not available to assign a ue to a dcn. one or multiple dcns may be deployed together with a default dcn that all share the same ran.
- the architecture supports scenarios where the dcn is only deployed in a part of the plmn e.g. only for one rat or only in a part of the plmn area. such heterogeneous or partial deployment of dcns may, depending on operator deployment and configuration, result in service with different characteristics or functionality, depending on whether the ue is inside or outside the service area or rat that supports the dcn.
note?1: heterogeneous or partial deployment of dcns may result in increased occurrence of ues first being served by a cn node in the default dcn and then being redirected to a cn node in the dcn that serves the ue when the ue moves from areas outside of dcn coverage to an area of dcn coverage. it may also result in an increased re-attach rate in the network. as this has impacts on the required capacity of the default cn nodes deployed at edge of dcn coverage, it is not recommended to deploy dcns heterogeneously or partially.
- even if the dcn is not deployed to serve a particular rat or service area of plmn, the ue in that rat or service area may still be served by a pdn gw from the dcn.
high level overview for supporting dcns is provided below. details are captured in appropriate clauses of this specification, ts?23.060?[7] and ts?23.236?[30].
- an optional subscription information parameter ("ue usage type") is used in the selection of a dcn. an operator configures which of his dcn(s) serves which ue usage type(s). the hss provides the "ue usage type" value in the subscription information of the ue to the mme/sgsn. both standardized and operator specific values for ue usage type are possible.
- the serving network selects the dcn based on the operator configured (ue usage type to dcn) mapping, other locally configured operator's policies and the ue related context information available at the serving network, e.g. information about roaming. ues with different ue usage type values may be served by the same dcn. moreover, ues that share the same ue usage type value may be served by different dcns.
- if the configuration shows no dcn for the specific "ue usage type" value in the subscription information, then the serving mme/sgsn serves the ue by the default dcn or selects a dcn using serving operator specific policies.
- some subscribers may be configured without "ue usage type" value. in this case, the mme/sgsn may select the dcn that serves the ue using locally configured operator's policies and the ue related context information available at the serving network (other than ue provided dcn-id). the mme/sgsn performs procedures described in clauses 5.19.1 and 5.19.2.
- the "ue usage type" is associated with the ue (describing its usage characteristic), i.e. there is only one ue usage type" per ue subscription.
- for each dcn, one or more cn nodes may be configured as part of a pool.
- for mme, the mmegi(s) identifies a dcn within the plmn. for sgsns, a group identifier(s) identifies a dcn within the plmn. that is, the group of sgsns that belong to a dcn within a plmn. this identifier may have the same format as nri (e.g. an nri value that does not identify a specific sgsn node in the serving area) in which case it is called "null-nri" or it may have a format independent of nri, in which case it is called "sgsn group id". the "null-nri" or "sgsn group id" is provided by an sgsn to ran which triggers the nnsf procedure to select an sgsn from the group of sgsns corresponding to the null-nri/sgsn group id (see clause?5.19.1).
note?2: sgsn group ids enable to handle deployment scenarios where in a service area all nri values are allocated to sgsns and hence no nri value remains that can be used as null-nri.
- the dedicated mme/sgsn that serves the ue selects a dedicated s-gw and p-gw based on ue usage type.
- at initial access to the network if sufficient information is not available for ran to select a specific dcn, the ran may selects a cn node from the default dcn. a redirection to another dcn may then be required.
- to redirect a ue from one dcn to a different dcn, the redirection procedure via ran, described in clause?5.19.1, is used to forward the nas message of the ue to the target dcn.
- all selection functions are aware of dcn(s), including the network node selection function (nnsf) of ran nodes, for selecting and maintaining the appropriate dcn for the ues.
4.3.25.1a ue assisted dedicated core network selection
this feature is to reduce the need for decor reroute by using an indication (dcn-id) sent from the ue and used by ran to select the correct dcn. the dcn-id shall be assigned to the ue by the serving plmn and is stored in the ue per plmn id. both standardized and operator specific values for dcn-id are possible. the ue shall use the plmn specific dcn-id whenever a plmn specific dcn-id is stored for the target plmn.
the hplmn may provision the ue with a single default standardized dcn-id which shall be used by the ue only if the ue has no plmn specific dcn-id of the target plmn. when a ue configuration is changed with a new default standardized dcn-id, the ue shall delete all stored plmn specific dcn-ids.
the ue provides the dcn-id to ran at registration to a new location in the network, i.e. in attach, tau and rau. ran selects serving node (mme or sgsn) based on the dcn-id provided by the ue and configuration in ran. for e-utran the enb is configured with dcns supported by the connected mmes at the setup of the s1 connection. for utran and geran the bss/rnc is configured with the dcns supported in the connected sgsn via o&m. both standardized dcn-ids and plmn specific dcn-ids can in the ran configuration be assigned to the same network. if information provided by the ue (e.g. guti, nri, etc.) indicates a node (mme or sgsn) for attach/tau/rau and a serving node (mme or sgsn) corresponding to the ue information can be found by the ran node, the normal node selection shall take precedence over the selection based on dcn-id. at registration the mme/sgsn may check if the correct dcn is selected. the check is performed as specified in clause?4.3.25.1. if the mme/sgsn concludes that the selected dcn is not the correct dcn, a decor reroute is performed and the sgsn/mme in the new dcn assigns a new dcn-id to the ue. the serving mme/sgsn can also assign a new dcn-id to the ue if e.g. the dcn-id in the ue has become obsolete or when the ue usage type has been updated in the subscription information leading to a change of dcn. this is performed as part of the guti reallocation procedure.
4.3.25.2 considerations for roaming
in the case of roaming, if the hplmn of the visiting ue does not support dcns, i.e. doesn't provide the ue usage type, the serving mme/sgsn may select the dcn that serves the ue using operator specific policies based on other subscription or ue provided information.
in the case of roaming, if the hplmn provides the ue usage type parameter to the vplmn, this parameter is provided irrespective of its value (standardized or operator specific). the handling of the ue usage type parameter in the vplmn is based on operator policies, e.g. roaming agreements.
if the ue assisted dcn selection feature is supported:
- if the ue has a dcn-id for the vplmn the ue shall send that plmn specific dcn-id to the ran, and
- if the ue has no plmn specific dcn-id for this vplmn and if the ue has a pre-provisioned default standardized dcn-id it shall send the pre-provisioned default standardized dcn-id to the ran.
4.3.25.3 considerations for network sharing
if the network supports the mocn configuration for network sharing (see ts?23.251?[24]), each network sharing operator has separate cn(s). mechanisms for selection of serving operator for supporting and non-supporting ues are defined in ts?23.251?[24]. each of the sharing operators may deploy one or more dcns.
if selected plmn information is provided by the ue, the ran selects the cn operator based on this provided information and then decor rerouting may, if needed, be initiated within the cn of the selected operator. if the ue assisted dcn selection feature is supported and both the selected plmn information and dcn-id is provided by the ue, the ran first selects the cn operator followed by selection of a dcn supported by the selected cn operator.
if selected plmn information is not provided by the ue (may only happen in geran and utran), the network initiates mocn redirection, including cs/ps coordination, to select a cn operator that can serve the ue. after this, decor rerouting is initiated if needed. the serving node in the selected dcn ends the mocn redirection. if the ue assisted dcn selection feature is supported and selected plmn information is not provided by the ue, the network initiates cn operator selection and after the cn operator selection is concluded the dcn is selected based on the ue provided dcn-id. as the plmn information included in the rai is the common plmn (refer to ts?23.251?[24]), which does not reflect the selected cn operator, the network may also return the plmn id of the selected cn operator. when the ue receives the nas accept message, the ue associates the dcn-id with both the plmn id of the selected cn operator and the common plmn ids.
the functions for redirecting or maintaining ues in specific dcns are configured to work within the cns of the same operator.
4.3.26 support for monitoring events
the monitoring events feature is intended for monitoring of specific events in 3gpp system and making such monitoring event information available via the service capability exposure function (scef). the architecture and related functions to support monitoring events are defined in ts?23.682?[74].
4.3.27 paging enhancements
4.3.27.1 paging for enhanced coverage
support of ues in enhanced coverage is specified in ts?36.300?[5].
whenever s1 is released and information for enhanced coverage is available for the ue, the enb sends it to the mme as described in clause?5.3.5.
the mme stores the received information for enhanced coverage and, if enhanced coverage restricted parameter is not set then mme, includes it in every subsequent paging message for all enbs selected by the mme for paging.
4.3.27a restriction of use of enhanced coverage for voice centric ue
support of ues in enhanced coverage is specified in ts?36.300?[5].
if the ue's usage setting is "voice centric" as defined in ts?23.221?[27], it shall not operate in ce mode b.
if the ue supports ce mode b and ue's usage setting is set to "voice centric" in the attach or tau request message then the mme shall indicate to enb that ce mode b is restricted. if the ue supports ce mode b and ue's usage setting is set to "data centric" in the attach or tau request message then, based on operator's policy and the enhanced coverage restricted parameter (see clause?4.3.28), the mme shall indicate to enb that ce mode b is not restricted.
the mme keeps the ce mode b restricted parameter in the mm context. the mme shall send the ce mode b restricted parameter to the enb via s1 signalling indicating whether the ue is "restricted" or "not restricted" for the use of ce mode b, e.g. in paging, initial context setup request, handover request, path switch request acknowledge, connection establishment indication, and downlink nas transport message carrying the tau accept message.
if the ue supports ce mode b and the ce mode b restricted parameter stored in the mme's mm context is set to "not restricted", the mme shall use the extended nas timer settings for the ue as specified in ts?24.301?[46].
4.3.27b enhanced coverage for data centric ues
the support for ues in enhanced coverage is specified in ts?36.300?[5].
the ims impacts for data centric ues in enhanced coverage is specified in annex e of ts?23.228?[52].
4.3.28 restriction of use of enhanced coverage
support of ues in enhanced coverage is specified in ts?36.300?[5].
the usage of enhanced coverage may require use of extensive resources (e.g. radio and signalling resources) from the network. this feature enables the operator to prevent specific subscribers from using enhanced coverage.
the ue indicates its capability of support for restriction of use of enhanced coverage in attach and tau procedure for the rat it is camping on to the mme. mme receives enhanced coverage restricted parameter from the hss. this parameter is kept as part of subscription data in the hss and specifies per plmn whether the enhanced coverage functionality is restricted or not for the ue. for roaming ues, if hss doesn't provide any enhanced coverage restricted parameter or the provided enhanced coverage restricted parameter is in conflict with the roaming agreement, the mme uses default enhanced coverage restricted parameter locally configured in the vplmn based on the roaming agreement with the subscriber's hplmn. the ue shall assume that restriction for use of enhanced coverage is same in the equivalent plmns. if the ue includes the support for restriction of use of enhanced coverage, mme sends enhanced coverage restricted parameter to the ue in the attach/tau accept message. the ue shall use the value of enhanced coverage restricted parameter to determine if enhanced coverage feature is restricted or not.
note: how this parameter is used by ue at as layer is defined in the ran specification.
the ue assumes enhanced coverage is allowed unless explicitly restricted by the network for a plmn.
if the mme has sent the enhanced coverage restricted parameter to the ue, the mme provides an enhanced coverage restricted parameter to the enb via s1 signalling during paging, and whenever the ue context is established in ran, e.g. during service request procedure, attach procedure, and tau procedure.
4.3.29 3gpp ps data off
4.3.29.1 general
this feature, when activated by the user, prevents transport via 3gpp access of all ip packets and non-ip data except for those related to 3gpp ps data off exempt services. the 3gpp ps data off exempt services are a set of operator services, defined in ts?23.221?[27], that are the only allowed services when the 3gpp ps data off feature has been activated by the user.
ues may be configured with up to two lists of 3gpp ps data off exempt services and the list(s) are provided to the ues by hplmn via device management or uicc provisioning. when the ue is configured with two lists, one list is valid for the ues camping in the home plmn and the other list is valid for any vplmn the ue is roaming in. when the ue is configured with a single list, without an indication to which plmns the list is applicable, then this list is valid for the home plmn and any plmn the ue is roaming in.
note?1: the operator needs to ensure coordinated lists of 3gpp data off exempt services provisioned in the ue and configured in the network.
the ue discovers whether a pdn gw supports 3gpp ps data off feature at initial attach and during the establishment of a pdn connection via the presence of the 3gpp ps data off support indication in the create session response message.
note?2: when the ue detects that the pdn gw does not support 3gpp ps data off feature, how the ue reacts to non exempt services mt requests from the network is implementation dependent.
the ue shall report its 3gpp ps data off status in pco (protocol configuration option) to pdn gw during initial attach procedure as described in clause?5.3.2.1 and ue requested pdn connectivity procedure as described in clause?5.10.2.
note?3: this also covers scenarios when the user activates/deactivates 3gpp ps data off while connected via wlan access only, and then a handover to 3gpp access occurs.
if 3gpp ps data off is activated, the ue prevents the sending of uplink ip packets and non-ip data except for those related to 3gpp ps data off exempt services, based on the pre-configured list of data off exempt services.
for those pdn gws that indicated support for the 3gpp ps data off feature during pdn connection setup and at initial attach, the ue shall report immediately a change of its 3gpp ps data off status in pco by using bearer resource modification procedure as described in clause?5.4.5, this also applies to the scenario of inter-rat mobility procedure to e-utran and also to scenarios where the 3gpp ps data off status is changed when the session management back-off timer is running as specified in clause?4.3.7.4.2. if the ue has not received any 3gpp ps data off support indication during the establishment of the pdn connection, it shall not report any change of its 3gpp ps data off status for this pdn connection.
the additional behaviour of the pdn gw for 3gpp ps data off is controlled by local configuration or policy from the pcrf as defined in ts?23.203?[6].
note?4: for the pdn connection used for ims services, the 3gpp data off exempt services are enforced in the ims domain as specified ts?23.228?[52]. policies configured in the pdn gw/pcrf need to ensure those services are always allowed when the 3gpp data off status of the ue is set to "activated".
4.3.30 unlicensed spectrum aggregation (laa/lwa/lwip)
unlicensed spectrum aggregation in eps can either use lte-assisted access (laa) that is using the carrier aggregation (ca) ran configuration defined in ts?36.300?[5] or lwa/lwip aggregation using wlan as secondary rat that is using the dual connectivity architecture defined in clause?4.3.2a and ts?36.300?[5].
for either case if the ue has access restriction for unlicensed spectrum in the form of laa, or lwa/lwip (either signalled from the hss, or, locally generated by vplmn policy in the mme) the mme signals this to the e-utran as part of handover restriction list.
an enb supporting aggregation with unlicensed spectrum in the form of laa, lwa/lwip checks whether the ue is allowed to use unlicensed spectrum. if the ue is not allowed to use unlicensed spectrum, the enb shall not establish dual connectivity or carrier aggregation (ca) with lte in unlicensed spectrum in the form of laa or wlan as a secondary rat in the form of lwa/lwip.
at inter-rat handover from geran/utran, the access restriction for unlicensed spectrum is either already in the mme's ue context, or is obtained from the hss during the subsequent tracking area update procedure (i.e. not from the source sgsn or source ran). in both inter-rat handover cases, any access restriction for use of unlicensed spectrum is then signalled to the e-utran.
note: this signalling of the access restriction during the tau after the inter-rat handover procedure means that there is a small risk that unlicensed spectrum resources are transiently allocated.
4.3.31 subscription handling for aerial ues
this clause?describes subscription information handling in order to support operating aerial ue function over e-utran as defined in ts?36.300?[5] and ts?36.331?[37].
the enb supporting aerial ue function handling uses the per user information supplied by the mme to determine whether or not to allow the ue to use aerial ue function.
support of aerial ue function is stored in the user's subscription information in hss. hss transfers this information to the mme via update location message during attach and tracking area update procedures. home operator may revoke user's subscription authorisation for operating aerial ues at any time.
mme that supports aerial ue function provides the user's subscription information on aerial ue authorisation to the enb via the s1 ap initial context setup request during attach, tracking area update and service request procedures.
for the intra and inter mme s1 based handover (intra rat) or inter-rat handover to e-utran, the aerial ue subscription information for the user is included in the s1-ap ue context modification request message sent to the target enodeb after the handover procedure.
for x2-based handover, the aerial ue subscription information for the user is sent to target enodeb as follows:
- if the source enodeb supports aerial ue function and the user's aerial ue subscription information is included in the ue context, the source enodeb shall include the information in the x2-ap handover request message to the target enodeb.
- the mme shall send the aerial ue subscription information to the target enodeb in the path switch request acknowledge message.
if the aerial ue subscription information has changed, the updated aerial ue subscription information is included in the s1-ap ue context modification request message sent to the enodeb.

4.4 network elements
4.4.1 e-utran
e-utran is described in more detail in ts?36.300?[5].
in addition to the e-utran functions described in ts?36.300?[5], e-utran functions include:
- header compression and UP ciphering (for UP data sent across s1-u);
- mme selection when no routing to an mme can be determined from the information provided by the ue;
- ul bearer level rate enforcement based on ue-ambr and mbr via means of uplink scheduling
(e.g. by limiting the amount of ul resources granted per ue over time);
- dl bearer level rate enforcement based on ue-ambr;
- ul and dl bearer level admission control;
- transport level packet marking in the uplink, e.g. setting the diffserv code point, based on the qci, and optionally the arp priority level, of the associated eps bearer;
- ecn-based congestion control.
4.4.2 mme
mme functions include:
- nas signalling;
- nas signalling security;
- inter cn node signalling for mobility between 3gpp access networks (terminating s3);
- ue reachability in ecm-idle state (including control, execution of paging retransmission and optionally paging policy differentiation);
- tracking area list management;
- mapping from ue location (e.g. tai) to time zone, and signalling a ue time zone change associated with mobility,
- pdn gw and serving gw selection;
- mme selection for handovers with mme change;
- sgsn selection for handovers to 2g or 3g 3gpp access networks;
- roaming (s6a towards home hss);
- authentication;
- authorization;
- bearer management functions including dedicated bearer establishment;
- lawful interception of signalling traffic;
- warning message transfer function (including selection of appropriate enodeb);
- ue reachability procedures;
- support relaying function (rn attach/detach);
- change of ue presence in presence reporting area reporting upon pcc request,
- in the case of change of ue presence in presence reporting area reporting, management of core network pre-configured presence reporting areas.
- for the CP ciot eps optimisation:
a) transport of user data (ip and non-ip);
b) local mobility anchor point;
c) header compression (for ip user data);
d) ciphering and integrity protection of user data;
e) lawful interception of user traffic not transported via the serving gw (e.g. traffic using t6a).
note: the serving gw and the mme may be implemented in one physical node or separated physical nodes. for ciot eps optimisation, the serving gw and the mme can be implemented in one physical node (e.g. c-sgn) or separated physical nodes. the c-sgn can also encompass the pdn gw function.
the mme shall signal a change in ue time zone only in case of mobility and in case of ue triggered service request, pdn disconnection and ue detach. if the mme cannot determine whether the ue time zone has changed (e.g. the ue time zone is not sent by the old mme during mme relocation), the mme should not signal a change in ue time zone. a change in ue time zone caused by a regulatory mandated time change (e.g. daylight saving time or summer time change) shall not trigger the mme to initiate signalling procedures due to the actual change. instead the mme shall wait for the ue's next mobility event or service request procedure and then use these procedures to update the ue time zone information in the pdn gw.
4.4.3 gateway
4.4.3.1 general
two logical gateways exist:
- serving gw (s gw);
- pdn gw (p gw).
note: the pdn gw and the serving gw may be implemented in one physical node or separated physical nodes.
4.4.3.2 serving gw
the serving gw is the gateway which terminates the UP interface towards e-utran (except when user data is transported using the CP ciot eps optimisation).
for each ue associated with the eps, at a given point of time, there is a single serving gw.
the functions of the serving gw, for both the gtp-based and the pmip-based s5/s8, include:
- the local mobility anchor point for inter-enodeb handover (except when user data is transported using the CP ciot eps optimisation);
- sending of one or more "end marker" to the source enodeb, source sgsn or source rnc immediately after the serving gw switches the path during inter-enodeb and inter-rat handover, especially to assist the reordering function in enodeb.
- mobility anchoring for inter-3gpp mobility (terminating s4 and relaying the traffic between 2g/3g system and pdn gw);
- ecm-idle mode downlink packet buffering and initiation of network triggered service request procedure and optionally paging policy differentiation;
- lawful interception;
- packet routing and forwarding;
- transport level packet marking in the uplink and the downlink, e.g. setting the diffserv code point, based on the qci, and optionally the arp priority level, of the associated eps bearer;
- accounting for inter-operator charging. for gtp-based s5/s8, the serving gw generates accounting data per ue and bearer;
- interfacing ofcs according to charging principles and through reference points specified in ts?32.240?[51];
- forwarding of "end marker" to the source enodeb, source sgsn or source rnc when the "end marker" is received from pdn gw and the serving gw has downlink UP established. upon reception of "end marker", the serving gw shall not send downlink data notification.
additional serving gw functions for the pmip-based s5/s8 are captured in ts?23.402?[2].
connectivity to a ggsn is not supported.
4.4.3.3 pdn gw
the pdn gw is the gateway which terminates the sgi interface towards the pdn.
if a ue is accessing multiple pdns, there may be more than one pdn gw for that ue, however a mix of s5/s8 connectivity and gn/gp connectivity is not supported for that ue simultaneously.
pdn gw functions include for both the gtp-based and the pmip-based s5/s8:
- per-user based packet filtering (by e.g. deep packet inspection);
- lawful interception;
- ue ip address allocation;
- transport level packet marking in the uplink and downlink, e.g. setting the diffserv code point, based on the qci, and optionally the arp priority level, of the associated eps bearer;
- accounting for inter-operator charging: for home routed roaming, the p-gw shall collect and report the uplink and downlink data volume (per eps bearer) as received from and sent to the serving node;
- ul and dl service level charging as defined in ts?23.203?[6]
(e.g. based on sdfs defined by the pcrf, or based on deep packet inspection defined by local policy);
- interfacing ofcs through according to charging principles and through reference points specified in ts?32.240?[51].
- ul and dl service level gating control as defined in ts?23.203?[6];
- ul and dl service level rate enforcement as defined in ts?23.203?[6]
(e.g. by rate policing/shaping per sdf);
- ul and dl rate enforcement based on apn-ambr
(e.g. by rate policing/shaping per aggregate of traffic of all sdfs of the same apn that are associated with non-gbr qcis);
- dl rate enforcement based on the accumulated mbrs of the aggregate of sdfs with the same gbr qci
(e.g. by rate policing/shaping);
- dhcpv4 (server and client) and dhcpv6 (client and server) functions;
- the network does not support ppp bearer type in this version of the specification. pre-release 8 ppp functionality of a ggsn may be implemented in the pdn gw;
- the pdn gw may support non-ip data transfer (e.g. with ciot eps optimisations);
- packet screening;
- sending of one or more "end marker" to the source sgw immediately after switching the path during sgw change;
- pcc related features (e.g. involving pcrf and ocs) as described in ts?23.203?[6].
additionally the pdn gw includes the following functions for the gtp-based s5/s8:
- ul and dl bearer binding as defined in ts?23.203?[6];
- ul bearer binding verification as defined in ts?23.203?[6];
- functionality as defined in rfc?4861?[32];
- accounting per ue and bearer.
the p gw provides pdn connectivity to both geran/utran only ues and e utran capable ues using any of e utran, geran or utran. the p gw provides pdn connectivity to e utran capable ues using e utran only over the s5/s8 interface.
4.4.4 sgsn
in addition to the functions described in ts?23.060?[7], sgsn functions include:
- inter epc node signalling for mobility between 2g/3g and e-utran 3gpp access networks;
- pdn and serving gw selection: the selection of s gw/p gw by the sgsn is as specified for the mme;
- handling ue time zone as specified for the mme;
- mme selection for handovers to e-utran 3gpp access network.
4.4.5 geran
geran is described in more detail in ts?43.051?[15].
4.4.6 utran
utran is described in more detail in ts?25.401?[16].
4.4.7 pcrf
4.4.7.1 general
pcrf is the PCC element. pcrf functions are described in more detail in ts?23.203?[6].
in non-roaming scenario, there is only a single pcrf in the hplmn associated with one ue's ip-can session. the pcrf terminates the rx interface and the gx interface.
in a roaming scenario with local breakout of traffic there may be two pcrfs associated with one ue's ip-can session:
- h-pcrf that resides within the h-plmn;
- v-pcrf that resides within the v-plmn.
4.4.7.2 home pcrf (h-pcrf)
the functions of the h-pcrf include:
- terminates the rx reference point for home network services;
- terminates the s9 reference point for roaming with local breakout;
- associates the sessions established over the multiple reference points (s9, rx), for the same ue's ip-can session (pcc session binding).
the functionality of h-pcrf is described in ts?23.203?[6].
4.4.7.3 visited pcrf (v-pcrf)
the functions of the v-pcrf include:
- terminates the gx and s9 reference points for roaming with local breakout;
- terminates rx for roaming with local breakout and visited operator's application function.
the functionality of v-pcrf is described in ts?23.203?[6].
4.4.8 pdn gw's associated aaa server
the PGW may interact with a aaa server over the sgi interface. this aaa server may maintain information associated with ue access to the epc and provide authorization and other network services. this aaa server could be a radius or diameter server in an external pdn network, as defined in ts?29.061?[38]. this aaa server is logically separate from the hss and the 3gpp aaa server.
4.4.9 henb subsystem
a henb subsystem consists of a henb, optionally a henb gw and optionally a local gw.
the local ip access and sipto at the local network with l-gw function collocated with the henb functions are achieved using a local gw (l-gw) colocated with the henb.
figure 4.4.9-1 illustrates the architecture for lipa and/or sipto at the local network with l-gw function collocated with the henb.

figure 4.4.9-1: architecture for lipa or sipto at the local network with l-gw collocated with the henb
note?1: the optional henb gw is not shown in the figure for simplicity.
the henb subsystem is connected by means of the standard s1 interface to the epc (evolved packet core), more specifically to the mme (mobility management entity) by means of the s1-mme interface and to the SGW (s-gw) by means of the s1-u interface. when lipa or sipto at the local network with l-gw function collocated with the henb is activated, the l-gw has a s5 interface with the s-gw.
note?2: in this specification and for simplification the term enodeb refers to the henb subsystem if the ue accesses the network via a henb unless stated otherwise.
note?3: detailed functions of henb and henb gw are described in ts?36.300?[5].
note?4: an l-gwcollocated with a henb may support lipa, or sipto@ln, or both.
the local gw is the gateway towards the ip networks (e.g. residential/enterprise networks, internet) associated with the henb. the local gw has the following pdn gw functions:
- ue ip address allocation;
- dhcpv4 (server and client) and dhcpv6 (client and server) functions;
- packet screening;
- functionality as defined in rfc 4861?[32].
additionally, the local gw has the following functions:
- ecm-idle mode downlink packet buffering;
- ecm-connected mode direct tunnelling towards the henb.
note?5: the architecture for sipto at the local network with l-gw function collocated with a henb depicted in figure 4.4.9-1 also applies to sipto at the local network with l-gw function collocated with an enb.
4.4.10 denb
denb function is described in more detail in ts?36.300?[5].
denb provides the necessary s/p gw functions for the operation of rns connected to the denb.
in order to provide the relay function the denb shall support the following p-gw functions:
- ip address allocation for the ue functionality of the rn;
- downlink transport level packet mapping between the dscp value used over s1-u of the ue (which is the sgi interface of the pdn gw function in the denb) and the eps bearers with an appropriate qci value and optionally arp priority level value, established between the pdn gw function in the denb and the ue function of the rn;
- uplink transport level packet mapping between qci value and optionally arp priority level value, of the eps bearers (established between the pdn gw function in the denb and the ue function of the rn) and the dscp value used over s1-u of the ue (which is the sgi interface of the pdn gw function in the denb).
in order to provide the relay function the denb shall support the following s-gw functions:
- termination the s11 session of the mme(rn).
s-gw functions related to ecm-idle are not required.
s-gw functions related to mobility management are not supported.
4.4.11 csg subscriber server
csg subscriber server (css) is an optional element that stores csg subscription data for roaming subscribers. the css stores and provides vplmn specific csg subscription information to the mme. the css is accessible from the mme via the s7a interface. the css is always in the same plmn as the current mme.
if the same csg id exists in both css subscription data and hss subscription data, the csg subscription data from the hss shall take precedence over the data from css.
figure 4.4.11-1 illustrates css connected to mme.

figure 4.4.11-1: css connected to mme
4.4.12 ran congestion awareness function
the ran congestion awareness function (rcaf) is an element that provides ran UP congestion information (ruci) to the pcrf to enable the pcrf to take the ran UP congestion status into account for policy decisions.
the rcaf collects information related to UP congestion from the ran's oam system based on which the rcaf determines the congestion level (and the identifier) of an enb or e-utran cell.
via the nq interface the rcaf determines the ues served by a congested enb or congested e-utran cell and retrieves the apns of the active pdn connections of those ues. the decision whether the rcaf operates on enb or e-utran cell level is up to operator configuration.
via the np reference point, the rcaf sends the ruci to the pcrfs serving the ues' pdn connections.
note?1: the details of congestion reporting to the pcrf and the np reference point are specified in ts?23.203?[6].
note?2: in the case of roaming or ran sharing as specified in ts?23.251?[24], np is an inter-operator reference point. whether np applies in case of roaming and ran sharing is subject to inter-operator agreements.
figure 4.4.12-1 illustrates the rcaf connected to the mme. the rcaf is located in the same plmn as the serving mme except in network sharing scenarios where the rcaf belongs to the ran operator.

figure 4.4.12-1: rcaf connected to mme
4.5 void

4.6 eps mobility management and connection management states
4.6.1 general
the eps mobility management (emm) states describe the mobility management states that result from the mobility management procedures e.g. attach and tracking area update procedures.
two emm states are described in this document:
- emm-deregistered.
- emm-registered.
note?1: other specifications may define more detailed emm states (see e.g. ts?24.301?[46]).
the eps connection management (ecm) states describe the signalling connectivity between the ue and the epc.
two ecm states are described in this document:
- ecm-idle.
- ecm-connected.
note?2: the ecm-connected and ecm-idle states used in this document correspond respectively to the emm-connected and emm-idle modes defined in ts?24.301?[46].
in general, the ecm and emm states are independent of each other. transition from emm-registered to emm-deregistered can occur regardless of the ecm state, e.g. by explicit detach signalling in ecm-connected or by implicit detach locally in the mme during ecm-idle. however there are some relations, e.g. to transition from emm-deregistered to emm-registered the ue has to be in the ecm-connected state.
4.6.2 definition of main eps mobility management states
4.6.2.1 emm-deregistered
in the emm deregistered state, the emm context in mme holds no valid location or routing information for the ue. the ue is not reachable by a mme, as the ue location is not known.
in the emm-deregistered state, some ue context can still be stored in the ue and mme, e.g. to avoid running an aka procedure during every attach procedure.
during the successful inter-rat tau/rau/handover procedure and isr activated is not indicated to the ue, the old s4 sgsn/old mme changes the emm state of the ue to gprs-idle/pmm-detached/emm-deregistered.
4.6.2.2 emm-registered
the ue enters the emm-registered state by a successful registration with an attach procedure to either e-utran or geran/utran. the mme enters the emm-registered state by a successful tracking area update procedure for a ue selecting an e-utran cell from geran/utran or by an attach procedure via e-utran. in the emm-registered state, the ue can receive services that require registration in the eps.
note: the ue employs a single combined state machine for emm and gmm states.
the ue location is known in the mme to at least an accuracy of the tracking area list allocated to that ue (excluding some abnormal cases).
in the emm-registered state, the ue shall:
- always have at least one active pdn connection (unless the ue supports "attach without pdn connectivity");
- setup the eps security context.
after performing the detach procedure, the state is changed to emm-deregistered in the ue and in the mme. upon receiving the tau reject and attach reject messages the actions of the ue and mme depend upon the 'cause value' in the reject message, but, in many cases the state is changed to emm-deregistered in the ue and in the mme.
if all the bearers belonging to a ue that does not support "attach without pdn connectivity" are released (e.g., after handover from e utran to non-3gpp access), the mme shall change the mm state of that ue to emm-deregistered. if the ue that does not support "attach without pdn connectivity" camps on e-utran and the ue detects that all of its bearers are released, the ue shall change the mm state to emm-deregistered. if all the bearers (pdp contexts) belonging to a ue are released, while the ue camps on geran/utran, the ue shall deactivate isr by setting its tin to "p-tmsi" as specified in ts?23.060?[7]. this ensures that the ue performs tracking area update when it re-selects e-utran. if the ue switches off its e utran interface when performing handover to non-3gpp access, the ue shall automatically change its mm state to emm-deregistered.
the mme may perform an implicit detach any time after the implicit detach timer expires. the state is changed to emm-deregistered in the mme after performing the implicit detach.
4.6.3 definition of eps connection management states
4.6.3.1 ecm-idle
a ue is in ecm-idle state when no nas signalling connection between ue and network exists. in ecm-idle state, a ue performs cell selection/reselection according to ts?36.304?[34] and plmn selection according to ts?23.122?[10].
except for ues that have had their rrc connection suspended, as described in clause?5.3.4a, there exists no ue context in e-utran for the ue in the ecm-idle state. there is no s1_mme and no s1_u connection for the ue in the ecm-idle state.
in the emm-registered and ecm-idle state, the ue shall:
- perform a tracking area update if the current ta is not in the list of tas that the ue has received from the network in order to maintain the registration and enable the mme to page the ue;
- perform the periodic tracking area updating procedure to notify the epc that the ue is available;
- perform a tracking area update if the rrc connection was released with release cause "load balancing tau required";
- perform a tracking area update when the ue reselects an e-utran cell and the ue's tin indicates "p-tmsi";
- perform a tracking area update for a change of the ue's core network capability information or the ue specific drx parameter;
- perform a tracking area update when a change in conditions in the ue require a change in the extended idle mode drx parameters previously provided by the mme.
- perform a tracking area update when the ue manually selects a csg cell, and the csg id and associated plmn of that cell is absent from both the ue's allowed csg list and the ue's operator csg list;
- answer to paging from the mme by performing a service request procedure or, if the ue has had its rrc connection suspended, the ue initiates the connection resume procedure (clause?5.3.5a);
- perform the service request procedure in order to establish the radio bearers when uplink user data is to be sent, or uplink nas signalling is to be sent for ue requested bearer modification procedure (clause?5.4.5), ue requested pdn connectivity (clause?5.10.2), ue requested pdn disconnection (clause?5.10.3), or if the ue has had its rrc connection suspended the ue initiates the connection resume procedure (clause?5.3.5a).
the ue and the mme shall enter the ecm-connected state when the signalling connection is established between the ue and the mme. initial nas messages that initiate a transition from ecm-idle to ecm-connected state are attach request, tracking area update request, service request or detach request. a successful completion of the connection resume procedure, described in clause?5.3.5.a, initiates at ue and mme a state transition from ecm-idle to ecm-connected.
when the ue is in ecm idle state, the ue and the network may be unsynchronized, i.e. the ue and the network may have different sets of established eps bearers. when the ue and the mme enter the ecm connected state, the set of eps bearers is synchronized between the ue and network.
4.6.3.2 ecm-connected
the ue location is known in the mme with an accuracy of a serving enodeb id. the mobility of ue is handled by the handover procedure, except for when the nb-iot is being used, in which case there are no handover procedures.
the ue performs the tracking area update procedure when the tai in the emm system information is not in the list of ta's that the ue registered with the network, or when the ue handovers to an e utran cell and the ue's tin indicates "p-tmsi".
for a ue in the ecm-connected state, there exists a signalling connection between the ue and the mme. the signalling connection is made up of two parts: an rrc connection and an s1_mme connection.
the ue shall enter the ecm-idle state when its signalling connection to the mme has been released or broken. this release or failure is explicitly indicated by the enodeb to the ue or detected by the ue.
the s1 release procedure or, if the ue is enabled to use UP ciot eps optimisation the s1 connection suspend procedure (clause?5.3.4a) changes the state at both ue and mme from ecm-connected to ecm-idle.
note?1: the ue may not receive the indication for the s1 release, e.g. due to radio link error or out of coverage. in this case, there can be temporal mismatch between the ecm-state in the ue and the ecm-state in the mme.
after a signalling procedure, the mme may decide to release the signalling connection to the ue, after which the state at both the ue and the mme is changed to ecm-idle.
note?2: there are some abnormal cases where the ue transitions to ecm-idle.
when a ue changes to ecm connected state and the network initiates establishment of data radio bearers, then if a data radio bearer cannot be established, or the ue cannot maintain a data radio bearer in the ecm-connected state during handovers, the corresponding eps bearer is deactivated. an exception to this is when the ue has been informed by the mme that a specific eps bearer will never use a data radio bearer (e.g.because that eps bearer is for a connection to the scef).
4.6.4 state transition and functions

figure 4.6.4-1: emm state model in ue

figure 4.6.4-2: emm state model in mme

figure 4.6.4-3: ecm state model in ue

figure 4.6.4-4: ecm state model in mme
4.7 overall qos concept
4.7.1 pdn connectivity service
the evolved packet system provides connectivity between a ue and a plmn external packet data network. this is referred to as pdn connectivity service.
the ip pdn connectivity service supports the transport of traffic flow aggregate(s), consisting of one or more SDFs (sdfs).
note: the concept of sdf is defined in the context of pcc, ts?23.203?[6], and is not explicitly visible in the nas signalling.
a pdn connection to an scef has the following characteristics:
- it is only supported for wb-eutra, lte-m and nb-iot rat types;
- it applies only when CP ciot eps optimisation are applicable;
- it does not support the transport of traffic flow aggregate(s);
- it does not support emergency services.
4.7.2 the eps bearer
4.7.2.1 the eps bearer in general
for e-utran access to the epc the pdn connectivity service is provided by an eps bearer for gtp-based s5/s8, and if ip is in use, by an eps bearer concatenated with ip connectivity between serving gw and pdn gw for pmip-based s5/s8.
in this release of the specifications, dedicated bearers are only supported for the ip pdn connectivity service.
when UP (s1-u) is used for data traffic, then an eps bearer uniquely identifies traffic flows that receive a common qos treatment between a ue and a pdn gw for gtp-based s5/s8, and between ue and serving gw for pmip-based s5/s8. the packet filters signalled in the nas procedures are associated with a unique packet filter identifier on per-pdn connection basis.
note?1: the eps bearer identity together with the packet filter identifier is used to reference which packet filter the ue intends to modify or delete, i.e. it is used to implement the unique packet filter identifier.
an eps bearer is the level of granularity for bearer level qos control in the epc/e-utran. that is, all traffic mapped to the same eps bearer receive the same bearer level packet forwarding treatment (e.g. scheduling policy, queue management policy, rate shaping policy, rlc configuration, etc.). providing different bearer level packet forwarding treatment requires separate eps bearers.
note?2: in addition but independent to bearer level qos control, the pcc framework allows an optional enforcement of service level qos control on the granularity of sdfs independent of the mapping of sdfs to eps bearers.
one eps bearer is established when the ue connects to a pdn, and that remains established throughout the lifetime of the pdn connection to provide the ue with always-on ip connectivity to that pdn. that bearer is referred to as the default bearer. any additional eps bearer that is established for the same pdn connection is referred to as a dedicated bearer.
the eps bearer traffic flow template (tft) is the set of all packet filters associated with that eps bearer. an uplink traffic flow template (ul tft) is the set of uplink packet filters in a tft. a downlink traffic flow template (dl tft) is the set of downlink packet filters in a tft. every dedicated eps bearer is associated with a tft. a tft may be also assigned to the default eps bearer. the ue uses the ul tft for mapping traffic to an eps bearer in the uplink direction. the pcef (for gtp-based s5/s8) or the bberf (for pmip-based s5/s8) uses the dl tft for mapping traffic to an eps bearer in the downlink direction. the ue may use the ul tft and dl tft to associate eps bearer activation or modification procedures to an application and to traffic flow aggregates of the application. therefore the pdn gw shall, in the create dedicated bearer request and the update bearer request messages, provide all available traffic flow description information (e.g. source and destination ip address and port numbers and the protocol information).
for the ue, the evaluation precedence order of the packet filters making up the ul tfts is signalled from the p gw to the ue as part of any appropriate tft operations.
note?3: the evaluation precedence index of the packet filters associated with the default bearer, in relation to those associated with the dedicated bearers, is up to operator configuration. it is possible to "force" certain traffic onto the default bearer by setting the evaluation precedence index of the corresponding filters to a value that is lower than the values used for filters associated with the dedicated bearers.
a tft of an uplink unidirectional eps bearer is only associated with ul packet filter(s) that matches the uplink unidirectional traffic flow(s) a tft of a downlink unidirectional eps bearer is associated with dl packet filter(s) that matches the unidirectional traffic flow(s) and a ul packet filter that effectively disallows any useful packet flows (see clause?15.3.3.4 in ts?23.060?[7] for an example of such packet filter.
the ue routes uplink packets to the different eps bearers based on uplink packet filters in the tfts assigned to these eps bearers. the ue evaluates for a match, first the uplink packet filter amongst all tfts that has the lowest evaluation precedence index and, if no match is found, proceeds with the evaluation of uplink packet filters in increasing order of their evaluation precedence index. this procedure shall be executed until a match is found or all uplink packet filters have been evaluated. if a match is found, the uplink data packet is transmitted on the eps bearer that is associated with the tft of the matching uplink packet filter. if no match is found, the uplink data packet shall be sent via the eps bearer that has not been assigned any uplink packet filter. if all eps bearers (including the default eps bearer for that pdn) have been assigned one or more uplink packet filters, the ue shall discard the uplink data packet.
note?4: the above algorithm implies that there is at most one eps bearer without any uplink packet filter. therefore, some ues may expect that during the lifetime of a pdn connection (where only network has provided tft packet filters) at most one eps bearer exists without any uplink packet filter.
to ensure that at most one eps bearer exists without any uplink packet filter, the pcef (for gtp-based s5/s8) or the bberf (for pmip-based s5/s8) maintains a valid state for the tft settings of the pdn connection as defined in clause?15.3.0 of ts?23.060?[7] and if necessary, adds a packet filter which effectively disallows any useful packet flows in uplink direction (see clause?15.3.3.4 in ts?23.060?[7] for an example of such a packet filter) to the tft of a dedicated bearer.
note?5: the default bearer is the only bearer that may be without any uplink packet filter and thus, a packet filter which effectively disallows any useful packet flows in uplink direction will not be added by the pcef/bberf.
the initial bearer level qos parameter values of the default bearer are assigned by the network, based on subscription data (in e-utran the mme sets those initial values based on subscription data retrieved from hss).
in a non-roaming scenario, the pcef may change the qos parameter value received from the mme based on interaction with the pcrf or based on local configuration. when the pcef changes those values, the mme shall use the bearer level qos parameter values received on the s11 reference point during establishment or modification of the default bearer.
in a roaming scenario, based on local configuration, the mme may downgrade the arp or apn-ambr and/or remap qci parameter values received from hss to the value locally configured in mme (e.g. when the values received from hss do not comply with services provided by the visited plmn). the pcef may change the qos parameter values received from the mme based on interaction with the pcrf or based on local configuration. alternatively, the pcef may reject the bearer establishment.
note?6: for certain apns (e.g. the ims apn defined by the gsma) the qci value is strictly defined and therefore remapping of qci is not permitted.
note?7: in roaming scenarios, the arp/apn-ambr/qci values provided by the mme for a default bearer may deviate from the subscribed values depending on the roaming agreement. if the pcc/pcef rejects the establishment of the default bearer, this implies that attach via e-utran will fail. similarly, if the pcef (based on interaction with the pcrf or based on local configuration) upgrades the arp/apn-ambr/qci parameter values received from the mme, the default bearer establishment and attach may be rejected by the mme.
note?8: subscription data related to bearer level qos parameter values retrieved from the hss are not applicable for dedicated bearers.
for wb-e-utra, the decision to establish or modify a dedicated bearer can only be taken by the epc, and the bearer level qos parameter values are always assigned by the epc.
dedicated bearers are not supported over nb-iot. the pdn gw uses the rat type to ensure that no dedicated bearers are active when the ue is accessing over nb-iot. in case of inter-rat mobility from wb-eutra to nb-iot, the ue and mme indicate local deactivation of non-default eps bearers at tau as specified in ts?24.301?[46].
the mme shall not modify the bearer level qos parameter values received on the s11 reference point during establishment or modification of a default or dedicated bearer (except when the conditions described in note?8 apply). consequently, "qos negotiation" between the e-utran and the epc during default or dedicated bearer establishment / modification is not supported. based on local configuration, the mme may reject the establishment or modification of a default or dedicated bearer if the bearer level qos parameter values sent by the pcef over a gtp based s8 roaming interface do not comply with a roaming agreement.
note?9: the mme, based on local policies, can downgrade the arp pre-emption capability, apn-ambr or mbr (for gbr bearers) parameters received over s8 and allow the bearer establishment or modification of a default or dedicated bearer. the hplmn is expected to set eps qos parameters compliant with roaming agreements, therefore the hplmn is not informed about any downgrade of eps bearer qos parameters. the consequences of such a downgrade are that apn-ambr and mbr enforcement at the hplmn and at the ue will not be aligned.
at inter-rat mobility, based on local configuration, the mme may perform a mapping of qci values for which there is no mapping defined in table e.3 or which are not supported in the target rat.
note?10: the pcrf ensures that the eps bearer qci values are aligned with the qci values mapped by the mme for the current rat as described in clause?a.4.1.2 of ts?23.203?[6].
the distinction between default and dedicated bearers should be transparent to the access network (e.g. e-utran).
an eps bearer is referred to as a gbr bearer if dedicated network resources related to a guaranteed bit rate (gbr) value that is associated with the eps bearer are permanently allocated (e.g. by an admission control function in the enodeb) at bearer establishment/modification. otherwise, an eps bearer is referred to as a non-gbr bearer.
note?11: admission control can be performed at establishment / modification of a non-gbr bearer even though a non-gbr bearer is not associated with a gbr value.
a dedicated bearer can either be a gbr or a non-gbr bearer. a default bearer shall be a non-gbr bearer.
note?12: a default bearer provides the ue with ip connectivity throughout the lifetime of the pdn connection. that motivates the restriction of a default bearer to bearer type non-gbr.
4.7.2.2 the eps bearer with gtp-based s5/s8

figure 4.7.2.2-1: two unicast eps bearers (gtp-based s5/s8)
an eps bearer is realized by the following elements:
- in the ue, the ul tft maps a traffic flow aggregate to an eps bearer in the uplink direction;
- in the pdn?gw, the dl tft maps a traffic flow aggregate to an eps bearer in the downlink direction;
- a radio bearer (defined in ts?36.300?[5]) transports the packets of an eps bearer between a ue and an enodeb. if a radio bearer exists, there is a one-to-one mapping between an eps bearer and this radio bearer;
- an s1 bearer transports the packets of an eps bearer between an enodeb and a serving gw;
- an e-rab (e-utran radio access bearer) refers to the concatenation of an s1 bearer and the corresponding radio bearer, as defined in ts?36.300?[5].
- an s5/s8 bearer transports the packets of an eps bearer between a serving gw and a pdn gw;
- a ue stores a mapping between an uplink packet filter and a radio bearer to create the mapping between a traffic flow aggregate and a radio bearer in the uplink;
- a pdn gw stores a mapping between a downlink packet filter and an s5/s8 bearer to create the mapping between a traffic flow aggregate and an s5/s8 bearer in the downlink;
- an enodeb stores a one-to-one mapping between a radio bearer and an s1 bearer to create the mapping between a radio bearer and an s1 bearer in both the uplink and downlink;
- a serving gw stores a one-to-one mapping between an s1 bearer and an s5/s8 bearer to create the mapping between an s1 bearer and an s5/s8 bearer in both the uplink and downlink.
the pdn gw routes downlink packets to the different eps bearers based on the downlink packet filters in the tfts assigned to the eps bearers in the pdn connection. upon reception of a downlink data packet, the pdn gw evaluates for a match, first the downlink packet filter that has the lowest evaluation precedence index and, if no match is found, proceeds with the evaluation of downlink packet filters in increasing order of their evaluation precedence index. this procedure shall be executed until a match is found, in which case the downlink data packet is tunnelled to the serving gw on the eps bearer that is associated with the tft of the matching downlink packet filter. if no match is found, the downlink data packet shall be sent via the eps bearer that does not have any tft assigned. if all eps bearers (including the default eps bearer for that pdn) have been assigned a tft, the pdn gw shall discard the downlink data packet.
4.7.2.3 the eps bearer with pmip-based s5/s8
see clause?4.10.3 in ts?23.402?[2].
4.7.3 bearer level qos parameters
the eps bearer qos profile includes the parameters qci, arp, gbr and mbr, described in this clause. this clause also describes qos parameters which are applied to an aggregated set of eps bearers: apn ambr and ue ambr.
each eps bearer (gbr and non-gbr) is associated with the following bearer level qos parameters:
- qos class identifier (qci);
- allocation and retention priority (arp).
a qci is a scalar that is used as a reference to access node-specific parameters that control bearer level packet forwarding treatment (e.g. scheduling weights, admission thresholds, queue management thresholds, link layer protocol configuration, etc.), and that have been pre-configured by the operator owning the access node (e.g. enodeb). a one-to-one mapping of standardized qci values to standardized characteristics is captured in ts?23.203?[6].
note?1: on the radio interface and on s1, each pdu (e.g. rlc pdu or gtp-u pdu) is indirectly associated with one qci via the bearer identifier carried in the pdu header. the same applies to the s5 and s8 interfaces if they are based on gtp.
note?2: when required by operator policy, the enodeb can be configured to also use the arp priority level in addition to the qci to control bearer level packet forwarding treatment in the enodeb for sdfs having high priority arps.
the arp shall contain information about the priority level (scalar), the pre-emption capability (flag) and the pre-emption vulnerability (flag). the primary purpose of arp is to decide whether a bearer establishment / modification request can be accepted or needs to be rejected due to resource limitations (typically available radio capacity for gbr bearers). the priority level information of the arp is used for this decision to ensure that the request of the bearer with the higher priority level is preferred. in addition, the arp can be used (e.g. by the enodeb) to decide which bearer(s) to drop during exceptional resource limitations (e.g. at handover). the pre-emption capability information of the arp defines whether a bearer with a lower arp priority level should be dropped to free up the required resources. the pre-emption vulnerability information of the arp defines whether a bearer is applicable for such dropping by a pre-emption capable bearer with a higher arp priority level.
once a bearer has been successfully established, the packet handling (e.g. scheduling and rate control) within the enodeb, pdn gw, and serving gw should be solely determined by the following eps bearer qos parameters: qci, gbr and mbr, and by the ambr parameters. however, when required by operator policy, the enodeb can be configured to also use a bearer's arp priority level in addition to the qci to determine the relative priority of the sdfs for packet handling (e.g. scheduling and rate control) in the enodeb as defined in ts?23.203?[6] clause?6.1.7.2. this configuration applies only for bearers with high priority arps as defined in ts?23.203?[6] clause?6.1.7.3.
the arp priority level may be used in addition to the qci to determine the transport level packet marking, e.g. to set the diffserv code point. the arp is not included within the eps qos profile sent to the ue.
note?3: the arp should be understood as "priority of allocation and retention"; not as "allocation, retention, and priority".
note?4: video telephony is one use case where it may be beneficial to use eps bearers with different arp values for the same ue. in this use case an operator could map voice to one bearer with a higher arp, and video to another bearer with a lower arp. in a congestion situation (e.g. cell edge) the enodeb can then drop the "video bearer" without affecting the "voice bearer". this would improve service continuity.
note?5: the arp may also be used to free up capacity in exceptional situations, e.g. a disaster situation. in such a case the enodeb may drop bearers with a lower arp priority level to free up capacity if the pre-emption vulnerability information allows this.
each gbr bearer is additionally associated with the following bearer level qos parameters:
- guaranteed bit rate (gbr);
- maximum bit rate (mbr).
the gbr denotes the bit rate that can be expected to be provided by a gbr bearer. the mbr limits the bit rate that can be expected to be provided by a gbr bearer (e.g. excess traffic may get discarded by a rate shaping function). see clause?4.7.4 for further details on gbr and mbr.
gbr bearers are not supported by nb-iot. the pdn gw uses the rat type to ensure that gbr bearers are not active when the ue is using nb-iot.
each apn access, by a ue, is associated with the following qos parameter:
- per apn aggregate maximum bit rate (apn-ambr).
the subscribed apn ambr is a subscription parameter stored per apn in the hss, which applies as apn-ambr unless the apn-ambr is modified by the mme (e.g in roaming scenarios and/or for usage of nb-iot) or the pdn gw, based on local policy (e.g. for rat type = nb-iot) or pcrf interactions. the apn-ambr limits the aggregate bit rate that can be expected to be provided across all non gbr bearers and across all pdn connections of the same apn (e.g. excess traffic may get discarded by a rate shaping function). each of those non gbr bearers could potentially utilize the entire apn ambr, e.g. when the other non gbr bearers do not carry any traffic. gbr bearers are outside the scope of apn ambr. the p gw enforces the apn ambr in downlink. enforcement of apn ambr in uplink is done in the ue and additionally in the p gw.
note?6: all simultaneous active pdn connections of a ue that are associated with the same apn shall be provided by the same pdn gw (see clauses?4.3.8.1 and 5.10.1).
apn-ambr applies to all pdn connections of an apn. for the case of multiple pdn connections of an apn, if a change of apn-ambr occurs due to local policy or the pdn gw is provided the updated apn-ambr for each pdn connection from the mme or pcrf, the pdn gw initiates explicit signaling for each pdn connection to update the apn-ambr value.
each ue in state emm-registered is associated with the following bearer aggregate level qos parameter:
- per ue aggregate maximum bit rate (ue-ambr).
the ue ambr is limited by a subscription parameter stored in the hss. the mme shall set the ue ambr to the sum of the apn ambr of all active apns up to the value of the subscribed ue ambr. the ue ambr limits the aggregate bit rate that can be expected to be provided across all non gbr bearers of a ue (e.g. excess traffic may get discarded by a rate shaping function). each of those non gbr bearers could potentially utilize the entire ue ambr, e.g. when the other non gbr bearers do not carry any traffic. gbr bearers are outside the scope of ue ambr. the e utran enforces the ue ambr in uplink and downlink except for pdn connections using the CP ciot eps optimisation.
the gbr and mbr denote bit rates of traffic per bearer while ue-ambr/apn-ambr denote bit rates of traffic per group of bearers. each of those qos parameters has an uplink and a downlink component. on s1_mme the values of the gbr, mbr, and ambr refer to the bit stream excluding the gtp-u/ip header overhead of the tunnel on s1_u.
the hss defines, for each pdn subscription context, the 'eps subscribed qos profile' which contains the bearer level qos parameter values for the default bearer (qci and arp) and the subscribed apn-ambr value. the subscribed arp shall be used to set the priority level of the eps bearer parameter arp for the default bearer while the pre-emption capability and the pre-emption vulnerability information for the default bearer are set based on mme operator policy. in addition, the subscribed arp shall be applied by the p-gw for setting the arp priority level of all dedicated eps bearers of the same pdn connection unless a different arp priority level setting is required (due to p-gw configuration or interaction with the pcrf).
note?7: the arp parameter of the eps bearer can be modified by the p gw (e.g. based on interaction with the pcrf due to e.g. mps user initiated session) to assign the appropriate pre-emption capability and the pre-emption vulnerability setting.
the arp pre-emption vulnerability of the default bearer should be set appropriately to minimize the risk of unnecessary release of the default bearer.
4.7.4 support for application / service layer rate adaptation
the e utran/utran and the ue support the rfc?3168?[55] explicit congestion notification (ecn), as described in ts?36.300?[5], ts?25.401?[16] and ts?26.114?[56]. the ip level ecn scheme enables the e utran/utran to trigger a rate adaptation scheme at the application / service / transport layer. to make sufficient time available for end-to-end codec rate adaptation the e-utran/utran should attempt to not drop any packets on a bearer for a default grace period of at least 500 ms after it has indicated congestion with ecn on the bearer for packets within the packet delay budget. during this ecn grace period the e-utran/utran should also attempt to meet the qci characteristics / qos class associated with the bearer.
note?1: note that the receiving end-point should interpret all ecn-ce signals received within one end-to-end round-trip time as one "congestion event" (see ietf?rfc?3168?[55] and ts?26.114?[56]).
the mbr of a particular gbr bearer may be set larger than the gbr.
note?2: enforcement of apn-ambr / ue-ambr is independent of whether the mbr of a particular gbr bearer has been set larger than the gbr (see clause?4.7.3).
the epc does not support e-utran/utran-initiated "qos re-negotiation". that is, the epc does not support an enodeb/rnc initiated bearer modification procedure. if an enodeb/rnc can no longer sustain the gbr of an active gbr bearer then the enodeb/rnc should simply trigger a deactivation of that bearer.
4.7.5 application of pcc in the evolved packet system
the evolved packet system applies the pcc framework as defined in ts?23.203?[6] for qos PCC. pcc functionality is present in the af, pcef and pcrf.
an eps needs to support both pcef and pcrf functionality to enable dynamic PCC by means of installation of pcc rules based on user and service dimensions. however, an eps may only support pcef functionality in which case it shall support static PCC.
note: the local configuration of pcef static PCC functionality is not subject to standardization. the pcef static policy and control functionality is not based on subscription information.
the following applies to the use of dynamic PCC in eps:
- the service level (per sdf) qos parameters are conveyed in pcc rules (one pcc rule per sdf) over the gx reference point. the service level qos parameters consist of a qos class identifier (qci) allocation and retention priority (arp) and authorised guaranteed and maximum bit rate values for uplink and downlink. the qci is a scalar that represents the qos characteristics that the eps is expected to provide for the sdf. arp is an indicator of the priority for the sdf that is used to decide about the assignment of resources due to resource limitations. the service level arp assigned by pcrf in a pcc rule may be different from the bearer level arp stored in subscription data;
- the set of standardized qcis and their characteristics that the pcrf in an eps can select from is provided in ts?23.203?[6]. it is expected that the pcrf selects a qci in such a way that the ip-can receiving it can support it;
- it is not required that an ip-can supports all standardized qcis;
- in the case of ip address configuration subsequent to initial attachment, i.e. through dhcp mechanism to complete the ip address configuration, the pdn gw/pcef shall notify the pcrf of the ue's ip address by means of an ip-can session modification procedure or ip-can session establishment procedure as defined in ts?23.203?[6] when it is assigned. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure;
- for local breakout, the visited network has the capability to reject the qos authorized by the home network based on operator policies.
the following applies regardless of whether dynamic or static PCC is used in eps:
- for e-utran the value of the arp of an eps bearer is identical to the value of the arp of the sdf(s) mapped to that eps bearer;
- for the same ue/pdn connection: sdfs associated with different qcis or with the same service-level qci but different arp shall not be mapped to the same eps bearer;
- the bearer level qci of an eps bearer is identical to the value of the qci of the sdf(s) mapped to that eps bearer.
4.7.6 bearer control mode in epc
the bearer control mode (bcm) for e-utran access is always ue/nw. hence, explicit signalling between the ue and the network to determine bcm for e-utran access does not occur.
geran/utran/e-utran capable ues negotiate the bcm of a pdn connection applicable for geran/utran access during e-utran initial attach and during ue requested pdn connectivity procedure. such ues provide the network request support ue (nrsu) parameter to the pdn gw in pco. the pdn gw derives the bcm applicable to geran/utran access based on the nrsu and operator policy. the selected bcm, valid for geran/utran, is provided back to the ue in pco ie in the e-utran attach accept or pdn connectivity accept message. the selected bcm is also stored in the pdn gw and the ue, and applied by ue upon moving to geran or utran access unless explicitly informed by pdn gw of a change in bcm (see ts?23.060?[7]) via pco ie.
note?1: in rel 8 it was not mandatory for geran/utran/e-utran capable ues to provide nrsu to the pdn?gw during e-utran initial attach and ue requested pdn connectivity procedure.
when a geran/utran/e-utran capable ue moves from utran or geran access to e-utran access, it stores the bcm used in utran or geran access to be used again when the ue moves back to utran or geran access unless explicitly informed by pdn gw of a change in bcm (see ts?23.060?[7]) via the pco ie.
if pcc is deployed, the pdn gw requests pcrf to perform bcm selection for the rat the ue is accessing at ip can session establishment and ip-can session modification. the pcrf, determines the applicable bcm, based on a number of factors (see ts?23.203?[6]), and informs the pdn?gw. if the bcm has changed, the pdn?gw informs the ue of the new bcm via the pco ie.
4.7.7 support of rate control of user data using ciot eps optimisation
4.7.7.1 general
the rate of user data sent to and from a ue (e.g. a ue using ciot eps optimisations) can be controlled in two different ways:
- serving plmn rate control
- apn rate control
serving plmn rate control is intended to allow the serving plmn to protect its mme and the signalling radio bearers in the e-utran from the load generated by nas data pdus.
apn rate control is intended to allow hplmn operators to offer customer services such as "maximum of y messages per day".
note: existing ambr mechanisms are not suitable for such a service since, for radio efficiency and ue battery life reasons, an ambr of e.g. > 100kbit/s is desirable and such an ambr translates to a potentially large daily data volume.
the pdn gw in the visited plmn may send the apn rate control parameter for an emergency pdn connection.
4.7.7.2 serving plmn rate control
the serving plmn rate control value is configured in the mme.
note?1: homogeneous support of serving plmn rate control in a network is assumed.
at pdn connection establishment, the mme may inform the ue and pdn gw/scef (as specified in ts?24.301?[46] and ts?29.274?[43]) of any per pdn connection local serving plmn rate control that the serving plmn intends to enforce for nas data pdus. the mme shall only indicate serving plmn rate control command to the pdn gw if the pdn connection is using s11-u and set to CP only. the mme shall only indicate serving plmn rate control command to the scef if that pdn connection is using scef.
this rate control is operator configurable and expressed as "x nas data pdus per deci hour" where x is an integer that shall not be less than 10. there are separate limits for uplink and downlink nas data pdus:
- the ue shall limit the rate at which it generates uplink nas data pdus to comply with the serving plmn policy. in the ue the indicated rate control applies only on the pdn connection where it was received, and therefore the ue shall limit the rate of its uplink nas data pdus to comply with the rate that is indicated for the pdn connection. the indicated rate is valid until the pdn connection is released.
- the pdn gw/scef shall limit the rate at which it generates downlink data pdus. in the pdn gw/scef the indicated rate control applies only on the pdn connection where it was received, and therefore the pdn?gw/scef shall limit the rate of its downlink data pdus to comply with the rate that is indicated for the pdn connection.
- the mme may enforce these limits per pdn connection by discarding or delaying packets that exceed this limitthese limits. the serving plmn rate does not include sms sent via nas transport pdus. the mme starts the serving plmn rate control when the first nas data pdu is received.
note?2: if the ue/pdn gw/scef starts the serving plmn rate control at a different time than the mme, pdus sent within the limit enforced at the ue/pdn gw/scef can still exceed the limit enforced by the mme.
note?3: it is assumed that the serving plmn rate is sufficiently high to not interfere with the apn rate control as the apn rate control, if used, is assumed to allow fewer messages. nas pdus related to exception reports are not subject to the serving plmn rate control.
4.7.7.3 apn rate control
the apn rate control is configured in the pdn gw or in the scef. the pdn gw or scef can send an apn uplink rate control command to the ue using the pco information element.
the apn uplink rate control applies to data pdus sent on that apn by either data radio bearers (s1-u) or signalling radio bearers (nas data pdus).
the rate control information is separate for uplink and downlink and in the form of:
- a positive integer 'number of packets per time unit', and
- an indication as to whether or not exception reports can still be sent if this rate control limit has been met, and
- if the ue indicated support for it, an integer 'number of additional allowed exception report packets per time unit' once the rate control limit has been reached.
ues supporting apn rate control shall support the 'number of additional allowed exception report packets per time unit' and shall provide an indication to the cn at pdn connection establishment.
note?1: pre-rel 14 ues do not support the 'number of additional allowed exception report packets per time unit' and do not send an indication to the cn at pdn connection establishment.
the ue shall comply with this uplink rate control instruction. if the ue exceeds the uplink 'number of packets per time unit', the ue may still send uplink exception reports if allowed and the 'number of additional allowed exception reports per time unit' has not been exceeded. the ue shall consider this rate control instruction as valid until it receives a new one from either pdn gw or from scef.
when the last pdn connection using a given apn is released, the apn rate control status (including the number of packets still allowed in the given time unit, the number of additional exception reports still allowed in the given time unit and the termination time of the current apn rate control validity period) may be stored in the mme so that it can be retrieved for a subsequent re-establishment of a new first pdn connection for that given apn.
at subsequent establishment of a new first pdn connection for that given apn, the pdn gw/scef may receive the previously stored apn rate control status and, if the first apn rate control validity period has not expired, it applies the received apn rate control status and provides the related parameters to the ue in the pco (instead of the configured apn rate control parameters). if the initially applied parameters differ from the configured apn rate control parameters, the pdn gw/scef uses the configured apn rate control parameters once the first apn rate control validity period expires, and sends an update to the ue with the configured apn rate control parameters.
note?2: the storage of the apn rate control status information for very long time intervals can be implementation specific.
the pdn gw or scef realises the apn rate control based on a 'maximum allowed rate' per direction. if pdn gw or scef provided the 'number of additional allowed exception report packets per time unit' to the ue, then the 'maximum allowed rate' is equal to the 'number of packets per time unit' plus the 'number of additional allowed exception report packets per time unit'. otherwise, the 'maximum allowed rate' is equal to the 'number of packets per time unit'.
note?3: pre-rel 14 ues understand only the 'number of packets per time unit', and, if an indication that exception reports are allowed has been sent to such ues, there is a risk that exception report packets are discarded by the pdn gw or scef. to overcome this problem, the pdn gw or scef can still apply a configured 'number of additional allowed exception report packets per time unit' even though not sent to pre-rel 14 ues.
the pdn gw or scef may enforce the uplink rate by discarding or delaying packets that exceed the 'maximum allowed rate'. the pdn gw or scef shall enforce the downlink rate by discarding or delaying packets that exceed the downlink part of the 'maximum allowed rate'.
note?4: it is assumed that the serving plmn rate is sufficiently high to not interfere with the apn rate control as the apn rate control, if used, is assumed to allow fewer messages. nas pdus related to exception reports are not subject to the serving plmn rate control.
4.7.8 inter-ue qos for nb-iot ues using CP ciot eps optimisation
to allow the e-utran to prioritise resource allocation between different nb-iot ues when some of the ues are using the CP ciot eps optimisation, the enb may request, based on configuration, the mme to supply the enb with the negotiated qos profile for any ue that is using the CP ciot eps optimisation.
the qos profile sent to the enb by the mme consists of the e-rab level qos parameter in the e-rab to be setup list ie (see ts?36.413?[36]).
in order to reduce signalling load on the mme, the enb may be configured to request the qos profile from the mme by using the ue's s-tmsi as identifier, e.g., when the enb's nb-iot load exceeds certain threshold(s) or when the enb needs to cache the qos profile.
if the ue has more than one eps bearer active, the mme sends qos profile for only one eps bearer to the enb. in this case the mme uses local configuration (e.g. considering table 6.1.7 in ts?23.203?[6], the mme chooses the non-gbr eps bearer with the qci corresponding to the highest priority level) to determine which eps bearer's qos to send to the enb. if the mme has no eps bearers active for the ue, then this fact is indicated to the enb.
the enb can use the qos profile to assist with resource prioritisation decisions between different nb-iot ues (irrespective of whether the ue/enb is using the CP ciot eps optimisation, or, the UP ciot eps optimisation).
4.8 compatibility issues
4.8.1 network configuration for interaction with utran/geran
gprs idle mode mobility within geran or utran and also between geran and utran specifies a set of sequence number handling functions, e.g. the exchange of sequence numbers during routing area update procedures. eps idle mode mobility procedures don't specify any such sequence number mappings for irat mobility scenarios. to avoid interoperation issues a network that deploys e-utran together with geran and/or utran shall not configure usage of the gprs feature "reordering required" for pdp contexts of pdp type ipv4, ipv6 or ipv4v6. also the network shall not configure usage of lossless pdcp of utran and the geran sgsn shall not configure usage of acknowledged mode llc/nsapi/sndcp.
4.9 paging policy differentiation
paging policy differentiation is an optional feature that allows the mme, based on operator configuration, to apply different paging strategies as defined in clause?5.3.4.3 for different traffic or service types provided within the same pdn connection.
when it supports paging policy differentiation feature, the serving gw provides a paging policy indication in the downlink data notification. the paging policy indication is based on information received with the downlink packet that triggers the downlink data notification. for example, as defined in ts?23.228?[52], the p-cscf may support paging policy differentiation by marking packet(s) to be sent towards the ue that relate to specific ims services (e.g. conversational voice as defined in ims multimedia telephony service).
the pdn gw shall not modify the received downlink ip packet e.g. the dscp (ipv4) / tc (ipv6). unconditionally, for each bearer and for each packet of pdn type ipv4, ipv6 or ipv4v6 that triggers a downlink data notification, the sgw shall send the dscp in tos (ipv4) / tc (ipv6) information received in the ip payload of the gtp-u packet from the pdn gw in the paging policy indication in the downlink data notification.
it shall be possible for the operator to configure the mme in such a way that the paging policy indicator only applies to certain hplmns and/or apns and/or qcis.
note?1: network configuration needs to ensure that the information used as a trigger for paging policy indication is not changed within the eps.
note?2: network configuration needs to ensure that the specific dscp in tos (ipv4) / tc (ipv6) value, used as a trigger for paging policy indication, is managed correctly in order to avoid the accidental use of certain paging policies.
4.10 introduction of ciot eps optimisations
ciot eps optimisations provide improved support of small data transfer. one optimisation is based on UP transport of user data and is referred to as UP ciot eps optimisation. another optimisation, known as CP ciot eps optimisation, transports user data or sms messages via mme by encapsulating them in nas, reducing the total number of CP messages when handling a short data transaction. for epc mobile originated location request (epc-mo-lr) and epc mobile terminated location request (epc-mt-lr) when the ue and network support CP ciot eps optimisation, CP service request is used. these optimisations can be used separately e.g. if the ue or the network supports one of them, or in parallel if the ue and the network supports both. if both the CP and UP ciot eps optimisations are supported for a ue, the pdn connections that only use the CP ciot eps optimisation, i.e. the mme has included CP only indicator in the esm request, will only be handled via the CP ciot eps optimisation. all other pdn connections are handled using CP or UP ciot eps optimisations. in addition, the CP ciot optimisation can be used to support pdn connections to an scef, while regular s1-u data transfer is used independently to support pdn connections to p-gw. the mme shall consistently include CP only indicator either in all sgi pdn connections of a ue or in none of them. all the sgi pdn connections of a ue shall either use s11-u or s1-u at any point in time.
the ciot data could include e.g. status information, measurement data from machine-to-machine applications.
several types of mme are envisaged, e.g.
- an mme that supports either UP or CP ciot eps optimisation;
- an mme that supports both UP and CP ciot eps optimisations;
- an mme that does not support any ciot eps optimisations.
the e-utran shall support the routeing of ues to an mme that can process the request from the ue.
the ciot eps optimisations are negotiated as described in clause?4.3.5.10 "preferred and supported network behaviour".
ciot eps optimisations may be supported also by ues that are not limited to low complexity and low throughput applications for machine type communications.
if CP ciot eps optimisation applies, separation of s11-u from s1-u may be required, and if required, the mme and the serving gw shall handle the ip address and teid for the s1-u and the address and teid for the s11-u separately.
note: homogeneous support of separation of s11-u from s1-u in the mmes and serving gws is assumed.
4.11 UP ciot eps optimisation
the UP ciot eps optimisation functionality enables support for transfer of UP data without the need for using the service request procedure to establish access stratum (as) context in the serving enodeb and ue.
if the following preconditions are met:
- ue and mme support UP ciot eps optimisation as defined in clause?4.3.5.10,
- mme indicates "ue UP ciot support indicator" ie to "supported" as defined in ts?36.413?[36],
- and the ue performs an initial connection establishment that establishes the as bearers and the as security context in the network and ue,
then the rrc connection can be suspended by means of a connection suspend procedure (see clause?5.3.4a).
based on trigger from the nas layer when ue is in ecm-idle including if it attempts to send data using CP ciot eps optimisation as defined in clause?5.3.4b, the ue shall attempt the connection resume procedure, see clause?5.3.5a and ts?24.301?[46]. if the connection resume procedure fails, the ue initiates the pending nas procedure, see ts?24.301?[46]. to maintain support for UP ciot eps optimisation at ue mobility between cells configured on different enodebs, the as context should be transferred between the enodebs, see ts?36.300?[5] and ts?36.423?[76].
by using the connection suspend procedure, see clause?5.3.5a and ts?36.300?[5]:
- the ue at transition into ecm-idle stores the as information;
- the enodeb stores the as information, the s1ap association and the bearer context for that ue;
- mme stores the s1ap association and the bearer context for that ue and enters ecm-idle.
in the context of this functionality, the ue and the enodeb store the relevant as information at transition into ecm-idle.
by using the connection resume procedure, see clause?5.3.5a and ts?36.300?[5]:
- the ue resumes the connection with the network using the as information stored during the connection suspend procedure;
- the, potentially new, enodeb notifies the mme that the connection with the ue has been securely resumed and the mme enters ecm-connected.
if a mme has a s1ap association stored for a ue and the mme receives for that ue a emm procedure over another ue-associated logical s1-connection or at tracking area update procedure with mme change, or sgsn context request, when the ue has re-attached, or when the ue has been detached, the mme and the previously involved enodeb shall delete that stored s1ap association using the s1 release procedure, see clause?5.3.5 and ts?36.413?[36].
4.12 supporting up to 15 eps bearers per ue
a ue attached to wb-e-utran access, including for dual connectivity using e-utran access as described in clause?4.3.2a, may support 8 or 15 eps bearers. to enable support of establishing 15 eps bearers, it requires the epc connected to the e-utran access to support 15 eps bearers for such ues.
if the ue supports 15 eps bearers, then the ue shall indicate this to the mme in nas signalling as defined in ts?24.301?[46].
the network shall support e-utran idle mode mobility and handover procedures in such plmns, where only part of the network nodes have been upgraded to support 15 eps bearers. in case of mobility procedures involving target nodes not supporting 15 eps bearers, additional bearers not supported by the non-upgraded nodes should be thus released.
the network shall homogeneously support 15 eps bearers per ue, at least per mme pool area/sgw serving area, in order to avoid eps bearer deactivations and attempts from services to re-activate the deactivated eps bearers caused by ue mobility within that area, by defining the tracking areas accordingly (see clause?4.3.5.3).
the mme shall provide the ue with a tai list such that it triggers the ue to perform the tau procedure, as defined in clause?5.3.3.0, when the ue enters and exits the area with support for 15 eps bearers per ue. the tau procedure execution enables the nodes in the supporting area to identify a supporting ue when it enters the area. when exiting the area, also enables the nodes to remove bearer resources for the ue towards nodes without support for 15 eps bearers per ue.
note?1: in order for the above tai list handling to be fully successful, the network requires the pgws the ue is connected to from these mme pool area/sgw serving area to be upgaded to support 15 eps bearers.
for a ue supporting 15 eps bearers, mobility to utran or geran may also lead to selective release of eps bearers, due to the lack of support of 15 pdp contexts in the gprs core network and radio access networks.
note?2: eps bearers need to be released either because the ue has more than 8 active eps bearers, or because they are identified by eps bearer identities not supported.
in order to minimize the impact from release of bearers not supported by the target nodes during mobility, the mme should be able to allocate the eps bearer ids in such way that the bearers with higher operator preference will be preserved in case of mobility involving legacy target nodes. this prioritised bearer allocation should be based on, at least, the allocation retention priority of the eps bearers and may take other bearer parameters (e.g. qci, apn) into consideration.
all pdn gws in a plmn shall support 15 eps bearers. mme may be configured to take into account additional pdn gw information such as whether the hplmn supports 15 eps bearers when selecting pdn gw (e.g. in case of roaming users home routed pdn gw selection) for ues supporting 15 eps bearers.
for inter-plmn handover, support of 15 eps bearers is based on mme configuration according to operator policy (e.g. bilateral agreements between operators).
5 functional description and information flows
5.1 control and UPs
5.1.0 general
note: 
- refer to ts?23.402?[2] for the corresponding protocol stack for pmip based s5/s8.
- refer to ts?23.203?[6] for the corresponding protocol stack for policy control and charging (pcc) function related reference points.
5.1.1 CP
5.1.1.1 general
the CP consists of protocols for control and support of the UP functions:
- controlling the e-utra network access connections, such as attaching to and detaching from e-utran;
- controlling the attributes of an established network access connection, such as activation of an ip address;
- controlling the routing path of an established network connection in order to support user mobility; and
- controlling the assignment of network resources to meet changing user demands.
the following CPs are used in e-utran mode.
5.1.1.2 enodeb - mme

legend:
- s1 application protocol (s1-ap): application layer protocol between the enodeb and the mme.
- stream control transmission protocol (sctp): this protocol guarantees delivery of signalling messages between mme and enodeb (s1). sctp is defined in rfc?4960?[35].

figure 5.1.1.2-1: CP for s1-mme interface
note: refer to ts?36.300?[5] for the corresponding CP for the henb subsystem - mme.
5.1.1.3 ue - mme

legend:
- nas: the nas protocol supports mobility management functionality and UP bearer activation, modification and deactivation. it is also responsible of ciphering and integrity protection of nas signalling.
- lte-uu: the radio protocol of e-utran between the ue and the enodeb is specified in ts?36.300?[5].

figure 5.1.1.3-1: CP ue - mme
5.1.1.4 sgsn - mme

legend:
- gprs tunnelling protocol for the CP (gtp c): this protocol tunnels signalling messages between sgsn and mme (s3).
- UDP (udp): this protocol transfers signalling messages. udp is defined in rfc?768?[26].

figure 5.1.1.4-1: CP for s3 interface
5.1.1.5 sgsn - s gw

legend:
- gprs tunnelling protocol for the CP (gtp c): this protocol tunnels signalling messages between sgsn and s gw (s4).
- UDP (udp): this protocol transfers signalling messages. udp is defined in rfc?768?[26].

figure 5.1.1.5-1: CP for s4 interface
5.1.1.6 s gw - p gw

legend:
- gprs tunnelling protocol for the CP (gtp c): this protocol tunnels signalling messages between s gw and p gw (s5 or s8).
- UDP (udp): this protocol transfers signalling messages between s gw and p gw. udp is defined in rfc?768?[26].

figure 5.1.1.6-1: CP for s5 and s8 interfaces
5.1.1.7 mme - mme

legend:
- gprs tunnelling protocol for the CP (gtp c): this protocol tunnels signalling messages between mmes (s10).
- UDP (udp): this protocol transfers signalling messages between mmes. udp is defined in rfc?768?[26].

figure 5.1.1.7-1: CP for s10 interface
5.1.1.8 mme - s gw

legend:
- gprs tunnelling protocol for the CP (gtp c): this protocol tunnels signalling messages between mme and s gw (s11).
- UDP (udp): this protocol transfers signalling messages. udp is defined in rfc?768?[26].

figure 5.1.1.8-1: CP for s11 interface
5.1.1.9 mme - hss

legend:
- diameter: this protocol supports transferring of subscription and authentication data for authenticating/authorizing user access to the evolved system between mme and hss (s6a). diameter is defined in rfc?3588?[31].
- stream control transmission protocol (sctp): this protocol transfers signalling messages. sctp is defined in rfc?4960?[35].

figure 5.1.1.9-1: CP for s6a interface
5.1.1.10 mme - eir

legend:
- diameter: this protocol supports ue identity check procedure between mme and eir (s13). diameter is defined in rfc?3588?[31].
- stream control transmission protocol (sctp): this protocol transfers signalling messages. sctp is defined in rfc?4960?[35].

figure 5.1.1.10-1: CP for s13 interface
5.1.1.11 void

5.1.1.12 mme - css

legend:
 diameter: this protocol supports transferring of csg subscription data for roaming subscribers only between mme and css (s7a). diameter is defined in rfc?3588?[31].
 stream control transmission protocol (sctp): this protocol transfers signalling messages. sctp is defined in rfc?4960?[35].

figure 5.1.1.12-1: CP for s7a interface
5.1.1.13 mme - rcaf

legend:
 nq-ap: this application layer protocol supports the imsi and apn retrieval procedure between the rcaf and the mme.
 stream control transmission protocol (sctp): this protocol transfers signalling messages. sctp is defined in rfc?4960?[35].

figure 5.1.1.13-1: CP for nq interface
5.1.2 UP
5.1.2.1 ue - p gw UP with e-utran

legend:
- gprs tunnelling protocol for the UP (gtp u): this protocol tunnels user data between enodeb and the s gw as well as between the s gw and the p gw in the backbone network. gtp shall encapsulate all end user ip packets.
- mme controls the UP tunnel establishment and establishes UP bearers between enodeb and s gw.
- udp/ip: these are the backbone network protocols used for routing user data and control signalling.
- lte-uu: the radio protocols of e-utran between the ue and the enodeb are specified in ts?36.300?[5].

figure 5.1.2.1-1: UP
5.1.2.2 enodeb - s gw

legend:
- gprs tunnelling protocol for the UP (gtp u): this protocol tunnels user data between enodeb and s gw.
- UDP (udp): this protocol transfers user data. udp is defined in rfc?768?[26].

figure 5.1.2.2-1: UP for enodeb ? s gw
note: refer to ts?36.300?[5] for the corresponding UP for the henb subsystem - s-gw.
5.1.2.3 ue - pdn gw UP with 2g access via the s4 interface

legend:
- gprs tunnelling protocol for the UP (gtp u): this protocol tunnels user data between sgsn and the s gw as well as between the s gw and the p gw in the backbone network. gtp shall encapsulate all end user ip packets.
- udp/ip: these are the backbone network protocols used for routing user data and control signalling.
- protocols on the um and the gb interfaces are described in ts?23.060?[7].

figure 5.1.2.3-1: UP for a/gb mode
5.1.2.4 ue - pdn gw UP with 3g access via the s12 interface

legend:
- gprs tunnelling protocol for the UP (gtp u): this protocol tunnels user data between utran and the s gw as well as between the s gw and the p gw in the backbone network. gtp shall encapsulate all end user ip packets.
- udp/ip: these are the backbone network protocols used for routing user data and control signalling.
- protocols on the uu interface are described in ts?23.060?[7].
- sgsn controls the UP tunnel establishment and establish a direct tunnel between utran and s gw as shown in figure?5.1.2.4-1.

figure 5.1.2.4-1: UP for utran mode and direct tunnel on s12
5.1.2.5 ue - pdn gw UP with 3g access via the s4 interface

note: please refer to ts?23.402?[2] for the corresponding stack for pmip based s5/s8.

legend:
- gprs tunnelling protocol for the UP (gtp u): this protocol tunnels user data between utran and the sgsn, between sgsn and s gw as well as between the s gw and the p gw in the backbone network. gtp shall encapsulate all end user ip packets.
- udp/ip: these are the backbone network protocols used for routing user data and control signalling.
- protocols on the uu and the iu interfaces are described in ts?23.060?[7].
- sgsn controls the UP tunnel establishment and establishes a tunnel between sgsn and s gw. if direct tunnel is established between utran and s gw, see figure 5.1.2.4-1.

figure 5.1.2.5-1: UP for iu mode
5.1.2.6 ue - p gw UP with CP ciot eps optimisations

legend:
- gtp-u (gprs tunnelling protocol UP): this protocol tunnels user data between mme and the s gw as well as between the s gw and the p gw in the backbone network. gtp shall encapsulate all end user ip packets.
- udp/ip: these are the backbone network protocols used for routing user data and control signalling.
- nas: this is the non access stratum layer used to carry data between ue and mme and may include header compression and security functions of UP ip data. whether a convergence protocol sublayer may be required for this purpose is a stage 3 matter.

figure 5.1.2.6-1: UP with CP ciot eps optimisations
5.2 identities
5.2.1 eps bearer identity
an eps bearer identity uniquely identifies an eps bearer for one ue accessing via e-utran. the eps bearer identity is allocated by the mme. when using an eps radio bearer, there is a one to one mapping between eps rb and eps bearer, and the mapping between eps rb identity and eps bearer identity is made by e-utran. the e-rab id value used at s1 and x2 interfaces to identify an e-rab is the same as the eps bearer id value used to identify the associated eps bearer. when using CP ciot eps optimisation for user data transport for the pdn connectivity service, the mme (for uplink) and ue (for downlink) uses the eps bearer identity contained within the nas pdus to identify the associated eps bearer.
when there is a mapping between an eps bearer and a pdp context, the same identity value is used for the eps bearer id and the nsapi/rab id.
in some sm signalling messages in geran/utran, transaction identifier (ti) represents nsapi. the ti is dynamically allocated by the ue for ue-requested pdp context activation, and by the network for network-requested pdp context activation. a corresponding allocation is also needed for eps bearers in order to successfully transfer bearers to geran/utran. the ti is deallocated when a pdp context/eps bearer has been deactivated. ti usage is defined in ts?23.060?[7].
5.2.2 globally unique temporary ue identity
the mme shall allocate a globally unique temporary identity (guti) to the ue. the guti is defined in ts?23.003?[9].
5.2.3 tracking area identity (tai)
this is the identity used to identify tracking areas. the tracking area identity is constructed from the mcc (mobile country code), mnc (mobile network code) and tac (tracking area code).
a tai should be associated with a single time zone. all tais served by one enodeb shall be in the same time zone.
note: changes in the tai of a cell can occur but are normally infrequent and linked with o+m activity.
5.2.4 enodeb s1-ap ue identity (enodeb s1-ap ue id)
this is the temporary identity used to identify a ue on the s1-mme reference point within the enodeb. it is unique within the enodeb.
5.2.5 mme s1-ap ue identity (mme s1-ap ue id)
this is the temporary identity used to identify a ue on the s1-mme reference point within the mme. it is unique within the mme.
5.2.6 closed subscriber group id
a csg id is a unique identifier within the scope of plmn defined in ts?23.003?[9] which identifies a closed subscriber group (csg) in the plmn associated with a csg cell or group of csg cells.
5.3 authentication, security and location management
5.3.1 ip address allocation
5.3.1.1 general
the procedures of clause?5.3.1 apply to ues activating a pdn connection of pdn type ipv4, ipv6 or ipv4v6. part of it also applies for pdn type non-ip when sgi ptp tunnelling based on udp/ip, see clause?4.3.17.8, is used.
a ue shall perform the address allocation procedures for at least one ip address (either ipv4 address or ipv6 prefix) after the default bearer activation if no ipv4 address is allocated during the default bearer activation.
one of the following ways shall be used to allocate ip addresses for the ue:
a) the hplmn allocates the ip address to the ue when the default bearer is activated (dynamic or static hplmn address);
b) the vplmn allocates the ip address to the ue when the default bearer is activated (dynamic vplmn address); or
c) the pdn operator or administrator allocates an (dynamic or static) ip address to the ue when the default bearer is activated (external pdn address allocation).
the ip address allocated for the default bearer shall also be used for the dedicated bearers within the same pdn connection. ip address allocation for pdn connections, which are activated by the ue requested pdn connectivity procedure, is handled with the same set of mechanisms as those used within the attach procedure.
pdn types ipv4, ipv6 and ipv4v6 are supported. an eps bearer of pdn type ipv4v6 may be associated with one ipv6 prefix only or with both one ipv4 address and one ipv6 prefix. pdn type ipv4 is associated with an ipv4 address. pdn type ipv6 is associated with an ipv6 prefix. pdn types ipv4 and ipv6 are utilised for the ue and/or the pdn gw support ipv4 addressing only or ipv6 prefix only; or operator preferences dictate the use of a single ip version only, or the subscription is limited to ipv4 only or ipv6 only for this apn. in addition, pdn type ipv4 and ipv6 are utilised for interworking with nodes of earlier releases.
the way that the ue sets the requested pdn type may be pre-configured in the device per apn. unless otherwise configured (including when the ue does not send any apn), the ue sets the pdn type during the attach or pdn connectivity procedures based on its ip stack configuration as follows:
- a ue which is ipv6 and ipv4 capable shall request for pdn type ipv4v6.
- a ue which is only ipv4 capable shall request for pdn type ipv4.
- a ue which is only ipv6 capable shall request for pdn type ipv6.
- when the ip version capability of the ue is unknown in the ue (as in the case when the mt and te are separated and the capability of the te is not known in the mt), the ue shall request for pdn type ipv4v6.
note?1: at intersystem changes between geran/utran and e-utran there is a 1-to-1 mapping between pdp type ipv4v6 and pdn type ipv4v6 without re-negotiation of the pdp/pdn type used for a pdn connection.
the hss stores one or more pdn types per apn in the subscription data. during the attach or ue requested pdn connectivity procedure the mme compares the requested pdn type to the pdn type in the subscription records for the given apn and sets the pdn type as follows:
- if the requested pdn type is allowed by subscription, the mme sets the pdn type as requested.
- if the requested pdn type is ipv4v6 and subscription data only allows pdn type ipv4 or only allows pdn type ipv6, the mme sets the pdn type according to the subscribed value. a reason cause shall be returned to the ue indicating that only the assigned pdn type is allowed. in this case the ue shall not request another pdn connection to the same apn for the other ip version during the existence of the pdn connection.
- if the requested pdn type is ipv4 or ipv6, and either the requested pdn type or pdn type ipv4v6 are subscribed, the mme sets the pdn type as requested. otherwis the pdn connection request is rejected.
- if the requested pdn type is ipv4v6, and both ipv4 and ipv6 pdn types are allowed by subscription but not ipv4v6, the mme shall set the pdn type to ipv4 or ipv6 where the selection between ipv4 and ipv6 is implementation specific. the ue should then initiate the ue requested pdn connectivity procedure to this apn in order to activate a second pdn connection with the other single address pdn type which was not allocated by the network.
note?2: if the mt and te are separated, the ue might not be able to use reason cause "single address bearers only" as a trigger for activating a second single-stack eps bearer.
the pdn gw may restrict the usage of a pdn type ipv4v6 as follows.
- if the pdn gw receives a request for pdn type ipv4v6, but the pdn gw operator preferences dictate the use of ipv4 addressing only or ipv6 prefix only for this apn, the pdn type shall be changed to a single address pdn type (ipv4 or ipv6) and a reason cause shall be returned to the ue indicating that only the assigned pdn type is allowed. in this case the ue shall not request another pdn connection to the same apn for the other ip version during the existence of the pdn connection.
- if the pdn gw receives a request for pdn type ipv4v6, but the mme does not set the dual address bearer flag due to the mme operator using single addressing per bearer to support interworking with nodes of earlier releases the pdn type shall be changed to a single ip version only and a reason cause shall be returned to the ue indicating that only single ip version per pdn connection is allowed. in this case the ue should request another pdn connection for the other ip version using the ue requested pdn connectivity procedure to the same apn with a single address pdn type (ipv4 or ipv6) other than the one already activated.
during inter-rat mobility between e utran and utran/geran, an eps bearer with pdn type ipv4v6 shall be mapped one-to-one to pdp type ipv4v6.
during inter-rat mobility between e-utran and utran/geran, an eps bearer with pdn type ipv4 shall be mapped one-to-one to a pdp context of pdp type ipv4. an eps bearer with pdn type ipv6 shall be mapped one-to-one to a pdp context of pdp type ipv6.
it is the hplmn operator that shall define in the subscription whether a dynamic hplmn or vplmn address may be used.
the eps ue may indicate to the network within the protocol configuration options element that the ue wants to obtain the ipv4 address with dhcpv4, which is a deferred ipv4 address allocation option, or during the default bearer activation procedure. this implies the following behaviour both for static and dynamic address allocation:
- the ue may indicate that it prefers to obtain an ipv4 address as part of the default bearer activation procedure. in such a case, the ue relies on the eps network to provide ipv4 address to the ue as part of the default bearer activation procedure.
- the ue may indicate that it prefers to obtain the ipv4 address after the default bearer setup by dhcpv4. that is, when the eps network supports dhcpv4 and allows that, it does not provide the ipv4 address for the ue as part of the default bearer activation procedures. the network may respond to the ue by setting the pdn address to 0.0.0.0. after the default bearer establishment procedure is completed, the ue uses the connectivity with the eps and initiates the ipv4 address allocation on its own using dhcpv4. however, if the eps network provides ipv4 address to the ue as part of the default bearer activation procedure, the ue should accept the ipv4 address indicated in the default bearer activation procedure.
- if the ue sends no address allocation preference, the pdn gw determines whether dhcpv4 is used between the ue and the pdn gw (for the deferred ipv4 address allocation) or not, based on per apn configuration
both eps network elements and ue shall support the following mechanisms:
a. ipv4 address allocation via default bearer activation, if ipv4 is supported.
b. /64 ipv6 prefix allocation via ipv6 stateless address autoconfiguration according to rfc?4862?[18], if ipv6 is supported;
furthermore, the protocol configuration options may be used during bearer activation to configure parameters which are needed for ip address allocation.
both eps network elements and ue may support the following mechanisms:
a. ipv4 address allocation and ipv4 parameter configuration after the attach procedure via dhcpv4 according to rfc?2131?[19] and rfc?4039?[25];
b. ipv6 parameter configuration via stateless dhcpv6 according to rfc?3736?[20].
c. allocation of ipv6 prefixes using dhcpv6 according to rfc?3633?[21].
eps network elements may support the following mechanism:
a. allocation of a static ipv4 address and/or a static ipv6 prefix based on subscription data in the hss.
if the static ip address/prefix is not stored in the hss subscription record, it may be configured on a per-user per-apn basis in the dhcp/radius/diameter server and the pdn gw retrieves the ip address/prefix for the ue from the dhcp/radius/diameter server. in this case, static ip address/prefix is allocated by the same procedures as the dynamic ip address/prefix allocation (i.e. in such cases it is transparent to the pdn gw if the ip address is static or dynamic).
if the static ip address/prefix is stored in the hss subscription record, during the default bearer establishment the pdn gw receives this static ip address/prefix from serving gw. in this case the pdn gw shall deliver the received address/prefix to the ue. the static ip address/prefix is delivered to the ue in the same way as a dynamic ip address/prefix. thus it is transparent to the ue whether the plmn or the external pdn allocates the ip address and whether the ip address is static or dynamic.
the following clauses describe how the above listed ip address allocation mechanisms work when gtp based s5/s8 is used. the way of working of the ip address allocation mechanisms for pmip based s5/s8 can be found in ts?23.402?[2].the procedures can be used both for plmn (vplmn/hplmn) or external pdn based ip address allocation.
in order to support dhcp based ip address configuration, the pdn gw shall act as the dhcp server towards the ue for both hplmn assigned dynamic and static ip addressing and for vplmn assigned dynamic ip addressing. when dhcp is used for external pdn assigned addressing and parameter configuration, the pdn gw shall act as the dhcp server towards the ue and it shall act as the dhcp client towards the external dhcp server. the serving gw does not have any dhcp functionality. it forwards packets, including dhcp packets, between the ue and the pdn gw.
ipv6 stateless address autoconfiguration specified in rfc?4862?[18] is the basic mechanism to allocate /64 ipv6 prefix to the ue.
during default bearer establishment, the pdn gw sends the ipv6 prefix and interface identifier to the s gw, and then the s gw forwards the ipv6 prefix and interface identifier to the mme or to the sgsn. the mme or the sgsn forwards the ipv6 interface identifier to the ue. the mme does not forward the ipv6 prefix to the ue. if the ue receives the ipv6 prefix from the sgsn during pdp context activation procedure, it shall ignore it.
5.3.1.2 ip address allocation, renewal and release mechanisms for gtp based s5/s8
5.3.1.2.1 ipv4 address allocation via default bearer activation and release via pdn connection release
an ipv4 address may be provided to the ue as part of the default bearer activation and the ipv4 address is released when pdn connection associated with the ipv4 address is released.
when the plmn allocates an ipv4 address, it is the pdn?gw responsibility to allocate and release the ipv4 address. the pdn gw may use an internal ipv4 address pool in this case. the pdn gw allocates an ipv4 address upon default bearer activation and it releases the ipv4 address upon pdn connection release associated with the ipv4 address for a given ue.
note: if the pdn type is ipv4v6, when the pdn connection is released, the ipv6 address is also released.
when an ipv4 address is allocated from an external pdn, it is the pdn gw responsibility to obtain the ipv4 address from the external pdn, and to allocate, renew and release the ipv4 address. the pdn gw may use dhcpv4 to obtain, renew and release the ipv4 address from the external pdn. if radius or diameter is used towards the external pdn, as described in ts?29.061?[38], the ip address can be obtained, renewed and released as part of these procedures. if dhcpv4 is used, the pdn gw functions as a dhcpv4 client. if radius is used, the pdn gw functions as a radius client. if diameter is used, the pdn gw functions as a diameter client.
after releasing the ipv4 address, the pdn gw should not assign that ipv4 address to other user immediately.
5.3.1.2.2 allocation, renewal and release of the ipv6 default prefix via ipv6 stateless address autoconfiguration
when the plmn allocates an ipv6 prefix, it is the pdn gw responsibility to allocate and release the ipv6 prefix. the pdn gw may use an internal ipv6 prefix pool in this case. the pdn gw allocates a globally unique /64 ipv6 prefix via router advertisement to a given ue.
when an ipv6 prefix is allocated from an external pdn, it is the pdn gw responsibility to obtain the ipv6 prefix from the external pdn and to allocate, renew and release the ipv6 prefix. the pdn gw may use dhcpv6 to obtain the ipv6 prefix from the external pdn. in this case, the pdn gw functions as a dhcpv6 client. if radius or diameter is used towards the external pdn as described in ts?29.061?[38], the ipv6 prefix can be obtained, renewed and released as part of these procedures. if radius is used, the pdn gw functions as the radius client. if diameter is used, the pdn gw functions as the diameter client.
the procedure of stateless ipv6 address autoconfiguration is the following: after default bearer establishment the ue may send a router solicitation message to the pdn gw to solicit a router advertisement message. the pdn?gw sends a router advertisement message (solicited or unsolicited) to the ue. the router advertisement messages shall contain the same ipv6 prefix as the one provided during default bearer establishment. if the ue receives an ipv6 prefix from a sgsn during the pdp context activation procedure, it shall ignore it.
after the ue has received the router advertisement message, it constructs a full ipv6 address via ipv6 stateless address autoconfiguration in accordance with rfc?4862?[18]. to ensure that the link-local address generated by the ue does not collide with the link-local address of the pdn gw, the pdn gw shall provide an interface identifier (see rfc?4862?[18]) to the ue and the ue shall use this interface identifier to configure its link-local address. for stateless address autoconfiguration however, the ue can choose any interface identifier to generate ipv6 addresses, other than link-local, without involving the network. however, the ue shall not use any identifiers defined in ts?23.003?[9] as the basis for generating the interface identifier. for privacy, the ue may change the interface identifier used to generate full ipv6 address, as defined in ts?23.221?[27] without involving the network.
any prefix that the pdn gw advertises to the ue is globally unique. the pdn gw shall also record the relationship between the ue's identity (imsi) and the allocated ipv6 prefix. because any prefix that the pdn gw advertises to the ue is globally unique, there is no need for the ue to perform duplicate address detection for any ipv6 address configured from the allocated ipv6 prefix. even if the ue does not need to use neighbor solicitation messages for duplicate address detection, the ue may, for example, use them to perform neighbor unreachability detection towards the pdn gw, as defined in rfc?4861?[32]. therefore, the pdn gw shall respond with a neighbor advertisement upon receiving a neighbor solicitation message from the ue.
in order to renew the allocated ipv6 prefix, the pdn gw sends a router advertisement (solicited or unsolicited) to the ue with the same prefix and new non-zero values in preferred and valid lifetime fields.
in order to release the allocated ipv6 prefix, the pdn gw shall initiate the pdn connection release procedure. upon release of the pdn connection, the ue shall implicitly release the prefix for the corresponding pdn connection.
note?2: if the pdn type is ipv4v6, when the pdn connection is released, the ipv4 address is also released.
after releasing the ipv6 prefix, the pdn gw should not assign that ipv6 prefix to other user immediately.
5.3.1.2.3 ipv6 parameter configuration via stateless dhcpv6
the ue may use stateless dhcpv6 for additional parameter configuration. the pdn gw acts as the dhcp server. when plmn based parameter configuration is used, the pdn gw provides the requested parameters from locally provisioned database. when external pdn based parameter configuration is used, the pdn gw obtains the requested configuration parameters from the external pdn as described in the previous clauses. when the pdn gw acts as a dhcpv6 server towards the ue, the pdn gw may act as dhcpv6 client towards the external pdn to request the configuration parameters for the ue. if radius or diameter is used towards the external pdn as described in ts?29.061?[38], the requested configuration parameters can be fetched as part of these procedures.
5.3.1.2.4 ipv4 address allocation, renewal and release and ipv4 parameter configuration via dhcpv4
when the plmn allocates an ipv4 address, it is the pdn gw responsibility to allocate, renew and release the ipv4 address.
when external pdn allocation is used, the pdn gw functions as a dhcpv4 server towards the ue. the pdn gw may act as a dhcp client when interacting with a dhcpv4 server in the external pdn in order to obtain, renew and release the ipv4 address and to obtain the configuration parameters. or, if radius or diameter is used towards the external pdn as described in ts?29.061?[38], the ipv4 address and the requested configuration parameters can be obtained, renewed and released as part of these procedures.
if dynamic policy provisioning is deployed, and the pcrf was not informed about the ipv4 address at ip-can session establishment, the pdn gw shall initiate an ip-can session modification procedure to inform the pcrf about an allocated ipv4 address. if the ipv4 address is released, the pdn gw shall inform the pcrf about the de-allocation of an ipv4 address.
if the ue sends dhcpv4 lease renewal message to renew the lease of the allocated ipv4 address, the pdn gw shall renew the lease of the allocated ipv4 address. if the ipv4 address was obtained from an external pdn, the pdn gw shall perform the dhcpv4 lease renewal procedure with the external pdn if dhcpv4 was used for obtaining ipv4 address from external pdn. if diameter or radius procedures where used to obtain the ipv4 address from external pdn, the pdn gw may perform corresponding update procedures as applicable. if the external pdn extends lease of the allocated ipv4 address, the pdn gw responds accordingly to the ue. otherwise, if the external pdn does not extend the lease of the allocated ipv4 address, the pdn gw responds with the remaining lease time of the ipv4 address. if there is no pdn address allocated to the ue for this pdn connection, the pdn gw shall perform pdn gw initiated bearer deactivation procedure as defined in clause?5.4.4.1.
if the ue sends dhcpv4 release message to release the allocated ipv4 address for the pdn connection, the pdn gw may anytime thereafter release the ipv4 address. if the pdn connection has no allocated pdn address, the pdn gw may at any time initiate pdn gw initiated bearer deactivation procedure as defined in clause?5.4.4.1.
note: if the pdn type is ipv4v6 the release of the allocated ipv4 address does not mean that there is no allocated pdn address for the pdn connection, as the ipv6 prefix still remains allocated to that pdn connection.
if the pdn connection is released without any dhcpv4 release signalling with the ue, the ue and the pdn gw shall release the ipv4 address implicitly, as soon as the pdn connection is released.
after releasing the ipv4 address, the pdn gw should not assign that ipv4 address to any other user immediately.
5.3.1.2.5 void

5.3.1.2.6 ipv6 prefix delegation via dhcpv6
optionally a single network prefix shorter than the default /64 prefix may be assigned to a pdn connection. in this case, the /64 default prefix used for ipv6 stateless autoconfiguration will be allocated from this network prefix; the remaining address space from the network prefix can be delegated to the pdn connection using prefix delegation after the default bearer establishment and ipv6 prefix allocation via ipv6 stateless address autoconfiguration as defined in clause?5.3.1.2.2. when plmn based parameter configuration is used, the pdn gw provides the requested ipv6 prefix from a locally provisioned pool. when external pdn based ipv6 prefix allocation is used, the pdn gw obtains the prefix from the external pdn.
note: allocation of ipv6 prefixes with flexible prefix length can leverage e.g. local configuration on the pdn?gw or interaction with the aaa server.
the address space provided is maintained as an ipv6 address space pool available to the pdn connection for dhcpv6 ipv6 prefix requests with the exclusion of the ipv6 prefix that is allocated to the pdn connection during default bearer establishment as defined in clause?5.3.1.2.2. the total ipv6 address space available for the pdn connection (ue default bearer prefix and ue pdn connection ipv6 address space pool) shall be possible to aggregate into one ipv6 prefix that will represent all ipv6 addresses that the ue may use. if the ue had indicated that it supports prefix exclusion and the prefix to be delegated to the ue includes the /64 prefix that was allocated to the pdn connection, the pdn gw shall utilise the prefix exclusion feature as specified for dhcpv6 prefix delegation in ietf?rfc?6603?[70].
the ue uses dhcpv6 to request additional ipv6 prefixes (i.e. prefixes in addition to the default prefix) from the pdn gw after completing stateless ipv6 address autoconfiguration procedures. the ue acts as a "requesting router" as described in rfc?3633?[21] and inserts one or more ia_pd option(s) into a dhcpv6 solicit message sent from the ue to the pdn gw. the pdn gw acts as the dhcp server and fulfils the role of a "delegating router" according to rfc?3633?[21]. the ue optionally includes the rapid_commit option in the dhcpv6 solicit message to trigger two-message dhcpv6 procedure instead of the four-message dhcpv6 procedure. the ue shall include option_pd_exclude option code in an option_oro option to indicate support for prefix exclusion. in response to the dhcpv6 solicit message, the ue receives a dhcpv6 reply message with one or more ia_pd prefix(es) for every ia_pd option that it sent in the dhcpv6 solicit message. the pdn gw delegates a prefix excluding the default prefix with help of option_pd_exclude. prefix exclusion procedures shall follow ietf?rfc?6603?[70].
5.3.2 attach procedure
5.3.2.1 e-utran initial attach
a ue/user needs to register with the network to receive services that require registration. this registration is described as network attachment. the always-on ip connectivity for ue/users of the eps may be enabled by establishing a default eps bearer during network attachment. the pcc rules applied to the default eps bearer may be predefined in the pdn gw and activated in the attachment by the pdn gw itself. the attach procedure may trigger one or multiple dedicated bearer establishment procedures to establish dedicated eps bearer(s) for that ue. during the attach procedure, the ue may request for an ip address allocation. terminals utilising only ietf based mechanisms for ip address allocation are also supported.
during the initial attach procedure the mobile equipment identity is obtained from the ue. the mme operator may check the me identity with an eir. the mme passes the me identity (imeisv) to the hss and to the pdn?gw.
during the initial attach procedure, if the mme supports srvcc and if any of the conditions described in step?8 in figure 5.3.2.1-1 are satisfied, the mme informs the hss with the ue srvcc capability e.g. for further ims registration.
the e-utran initial attach procedure is used for emergency attach by ues that need to perform emergency services but cannot gain normal services from the network. these ues are in limited service state as defined in ts?23.122?[10]. also ues that had attached for normal services and do not have emergency bearers established and are camped on a cell in limited service state (e.g. restricted tracking area or not allowed csg) shall initiate the attach procedures indicating that the attach is to receive emergency services. ues that camp normally on a cell, i.e. ues that are not in limited service state, should initiate normal initial attach when not already attached and shall initiate the ue requested pdn connectivity procedure to receive emergency eps bearer services.
note?1: a ue that is emergency attached performs initial attach procedure before being able to obtain normal services.
in order to limit load on the network, only when performing an e-utran attach with a new plmn (i.e. not the registered plmn or an equivalent plmn of the registered plmn), a ue configured to perform attach with imsi at plmn change (see ts?24.368?[69]) shall identify itself by its imsi instead of any stored temporary identifier.
this procedure is also used to establish the first pdn connection over e-utran when the ue already has active pdn connections over a non-3gpp access network and wants to establish simultaneous pdn connections to different apns over multiple accesses.

figure 5.3.2.1-1: attach procedure
note?2: for a pmip-based s5/s8, procedure steps (a), (b), and (c) are defined in ts?23.402?[2]. steps?7, 10, 13, 14, 15 and 23a/b concern gtp based s5/s8.
note?3: the serving gws and pdn gws involved in steps?7 and/or 10 may be different to those in steps?13 15.
note?4: the steps in (d) are executed only upon handover from non-3gpp access or if presence reporting area information is received from the mme.
note?5: more detail on procedure steps (e) is defined in the procedure steps (b) in clause?5.3.8.3.
note?6: more detail on procedure steps (f) is defined in the procedure steps (b) in clause?5.3.8.4.
1. a ue, camping on an e-utran cell reads the related system information broadcast.
 an e-utran cell for a plmn that supports ciot enhancements shall broadcast:
 for the nb-iot case:
- whether it can connect to an mme which supports eps attach without pdn connectivity.
 for the wb-e-utran case:
- whether it supports CP ciot eps optimisation and it can connect to an mme which supports CP ciot eps optimisation.
- whether it supports UP ciot eps optimisation and it can connect to an mme which supports UP ciot eps optimisation.
- whether it can connect to an mme which supports eps attach without pdn connectivity.
 if the plmn does not advertise support of eps attach without pdn connectivity and the ue can only attach without pdn connectivity, then the ue shall not attach to the plmn in this cell and shall proceed as specified in ts?23.122?[10].
 in the case of wb-e-utran, if the plmn does not support CP ciot eps optimisation, and the ue only supports CP ciot eps optimisation and cannot otherwise attach, then the ue shall not proceed with the attach to the plmn in this cell and shall proceed as specified in ts?23.122?[10].
 if a service gap timer is running in the ue (see clause?4.3.17.9) and the attach type is not emergency attach and it is not an attach without pdn connectivity, then the ue shall not send attach requests to this plmn or any other plmn as long as the timer is running.
 if the ue can proceed to attach, it initiates the attach procedure by the transmission, to the enodeb, of an attach request (imsi or old guti, old guti type, last visited tai (if available), ue core network capability, ue specific drx parameters, extended idle mode drx parameters, attach type, esm message container (request type, pdn type, protocol configuration options, ciphered options transfer flag, header compression configuration), ksiasme, nas sequence number, nas-mac, additional guti, p-tmsi signature, voice domain preference and ue's usage setting, preferred network behaviour, ms network capability, support for restriction of use of enhanced coverage) message together with rrc parameters indicating the selected network and the old gummei.
 in the rrc connection establishment signalling associated with the attach request, the ue indicates its support of the ciot eps optimisations, relevant for mme selection.
 if the ue identifies itself with the old guti, the ue shall set the old guti type to indicate whether the old guti is a native guti or is mapped from a p-tmsi and rai. the old guti may be derived from a p tmsi and rai. imsi shall be included if the ue does not have a valid guti or a valid p tmsi available, or if the ue is configured to perform attach with imsi at plmn change and is accessing a new plmn. the ue stores the tin in detached state. if the ue's tin indicates "guti" or "rat-related tmsi" and the ue holds a valid guti then the old guti indicates this valid guti. if the ue's tin indicates "p tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as the old guti. mapping a p tmsi and rai to a guti is specified in ts?23.003?[9]. if the ue holds a valid guti and the old guti indicates a guti mapped from a p-tmsi and rai, then the ue indicates the guti as additional guti. if the old guti indicates a guti mapped from a p-tmsi and rai and the ue has a valid p-tmsi signature associated to it, the p-tmsi signature shall be included. the ue sets the voice domain preference and ue's usage setting according to its configuration, as described in clause?4.3.5.9.
 alternatively, when a ue only supports e-utran, if the ue has a guti available and the ue is accessing the same plmn (or eplmn), then it identifies itself with the old guti and sets the old guti type to 'native', otherwise the ue configuration determines whether the ue identifies itself with its imsi or the old guti.
 the ue includes the extended idle mode drx parameters information element if the ue needs to enable extended idle mode drx.
 if available, the last visited tai shall be included in order to help the mme produce a good list of tais for any subsequent attach accept message. selected network indicates the plmn that is selected for network sharing purposes. the rrc parameter "old gummei" takes its value from the "old guti" contained in the attach request. ue network capability is described in ue capabilities, see clause?5.11.
 if the ue has valid security parameters, the attach request message shall be integrity protected by the nas-mac in order to allow validation of the ue by the mme. ksiasme, nas sequence number and nas-mac are included if the ue has valid eps security parameters. nas sequence number indicates the sequential number of the nas message. if the ue does not have a valid eps security association, then the attach request message is not integrity protected. in this case the security association is established in step?5a. the ue network capabilities indicate also the supported nas and as security algorithms.
 pdn type indicates the requested ip version (ipv4, ipv4/ipv6, ipv6). for a ue that support ciot eps optimisations, the pdn type may also be "non-ip " protocol configuration options (pco) are used to transfer parameters between the ue and the pdn gw, and are sent transparently through the mme and the serving gw. the protocol configuration options may include the address allocation preference indicating that the ue prefers to obtain an ipv4 address only after the default bearer activation by means of dhcpv4. if the ue intends to send pco which require ciphering (e.g., pap/chap usernames and passwords) or send an apn, or both, the ue shall set the ciphered options transfer flag and send pco or apn or both only after authentication and nas security setup have been completed (see below).
note?7: external network operators wanting to use pap for authentication are warned that pap is an obsolete protocol from a security point of view. chap provides stronger security than pap.
 if the ue supports 3gpp ps data off, it shall include in the pco the 3gpp ps data off ue status, which indicates whether the user has activated or deactivated 3gpp ps data off.
 if the ue has utran or geran capabilities, it shall send the nrsu in the pco to indicate the support of the network requested bearer control in utran/geran. the ue sends the etftu in the pco to indicate the support of the extended tft filter format. request type is included in the esm message container and indicates "handover" when the ue has already an activated pdn gw/ha due to mobility with non-3gpp accesses.
 if a ue indicates support of ciot eps optimisations in the rrc message, it may omit the esm message container. if the esm message container is omitted the mme shall not establish a pdn connection as part of the attach procedure. in this case steps 6, 12 to 16 and 23 to 26 are not executed. in addition, for the case of ues attaching with CP ciot eps optimisation with no UP establishment, steps 17 to 22 are replaced by s1 ap nas transport and rrc direct transfer messages that just transport the nas attach accept and nas attach complete messages.
 attach type indicates whether it is an eps attach or a combined eps/imsi attach or an emergency attach. emergency attach shall not be indicated when the ue is using nb-iot. when using ciot eps optimisations, the ue may indicate eps attach and request sms by setting the "sms transfer without combined attach" flag in the preferred network behaviour ie.
 if a ue includes a preferred network behaviour, this defines the network behaviour the ue is expecting to be available in the network as defined in clause?4.3.5.10.
 if a ue indicated CP ciot eps optimisation supported in preferred network behavior, and the ue included the esm message container, and the pdn type was ipv4 or ipv6 or ipv4v6, and the ue supports header compression, it shall include the header compression configuration. the header compression configuration includes the information necessary for the rohc channel setup. optionally, the header compression configuration may include additional header compression context setup parameters if the ue already has the application traffic information, e.g. the target server ip address.
 for an emergency attach the ue shall set both the attach type and the request type to "emergency" and the imsi shall be included if the ue does not have a valid guti or a valid p-tmsi available. the imei shall be included when the ue has no imsi, no valid guti and no valid p-tmsi.
2. the enodeb derives the mme address from the rrc parameters carrying the old gummei, the indicated selected network and the rat (nb-iot or wb-e-utran). if that mme is not associated with the enodeb or the old gummei is not available, the enodeb selects an mme as described in clause 4.3.8.3 on "mme selection function". the enodeb forwards the attach request message in a s1-mme control message (initial ue message) together with the selected network, csg access mode, csg id, l-gw address, tai+ecgi of the cell from where it received the message to the new mme. csg id is provided if the ue attaches via a csg cell or hybrid cell. csg access mode is provided if the ue attaches via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the mme shall consider the cell as a csg cell. if the enodeb has a collocated l-gw, it includes the l-gw address in the initial ue message to the mme.
 if the mme is not configured to support emergency attach the mme shall reject any attach request that indicates attach type "emergency".
 if the ue has included the preferred network behaviour, and what the ue indicated it supports in preferred network behaviour is incompatible with the network support e.g. the ue indicated support only for CP ciot eps optimisation and the mme only supports UP ciot eps optimisation, the mme shall reject the attach request with an appropriate cause value (e.g. one that avoids retries on this plmn).
 to assist location services, the enb indicates the ue's coverage level to the mme.
3. if the ue identifies itself with guti and the mme has changed since detach, the new mme determines the type of the old node, i.e. mme or sgsn, as specified in clause?4.3.19, uses the guti received from the ue to derive the old mme/sgsn address, and sends an identification request (old guti, complete attach request message) to the old mme/sgsn to request the imsi. if the request is sent to an old mme, the old mme first verifies the attach request message by nas mac and then responds with identification response (imsi, mm context). if the request is sent to an old sgsn, the old sgsn first verifies the attach request message by the p-tmsi signature and then responds with identification response (mm context). if the ue is not known in the old mme/sgsn or if the integrity check or p-tmsi signature check for the attach request message fails, the old mme/sgsn responds with an appropriate error cause. the mm context contains security related information as well as other parameters (including imsi) as described in clause?5.7.2 (information storage for mme).
 the additional guti in the attach request message allows the new mme to find any already existing ue context stored in the new mme when the old guti indicates a guti mapped from a p-tmsi and rai.
 for an emergency attach if the ue identifies itself with a temporary identity that is not known to the mme the mme immediately requests the imsi from the ue. if the ue identifies itself with imei, the imsi request shall be skipped.
note?8: a sgsn always responds with the umts security parameters and the mme may store it for later use.
4. if the ue is unknown in both the old mme/sgsn and new mme, the new mme sends an identity request to the ue to request the imsi. the ue responds with identity response (imsi).
5a if no ue context for the ue exists anywhere in the network, if the attach request (sent in step 1) was not integrity protected, or if the check of the integrity failed, then authentication and nas security setup to activate integrity protection and nas ciphering are mandatory. otherwise it is optional. if nas security algorithm is to be changed, the nas security setup is performed in this step. the authentication and nas security setup functions are defined in clause?5.3.10 on "security function".
 if the mme is configured to support emergency attach for unauthenticated imsis and the ue indicated attach type "emergency" the mme skips the authentication and security setup or the mme accepts that the authentication may fail and continues the attach procedure.
 after step?5a, all nas messages shall be protected by the nas security functions (integrity and ciphering) indicated by the mme unless the ue is emergency attached and not successfully authenticated.
5b. the me identity (imeisv) shall be retrieved from the ue. the me identity shall be transferred encrypted unless the ue performs emergency attach and cannot be authenticated.
 for an emergency attach, the ue may have included the imei in the emergency attach. if so, the me identity retrieval is skipped.
 in order to minimise signalling delays, the retrieval of the me identity may be combined with nas security setup in step?5a. the mme may send the me identity check request (me identity, imsi) to the eir. the eir shall respond with me identity check ack (result). dependent upon the result, the mme decides whether to continue with this attach procedure or to reject the ue.
 for an emergency attach, the imei check to the eir may be performed. if the imei is blocked, operator policies determine whether the emergency attach procedure continues or is stopped.
6. if the ue has set the ciphered options transfer flag in the attach request message, the ciphered options i.e. pco or apn or both, shall now be retrieved from the ue.
 in order to handle situations where the ue may have subscriptions to multiple pdns, if the protocol configuration options contains user credentials (e.g. user name/password within pap or chap parameters) then the ue should also send the apn to the mme.
7. if there are active bearer contexts in the new mme for this particular ue (i.e. the ue re-attaches to the same mme without having properly detached before), the new mme deletes these bearer contexts by sending delete session request (lbi) messages to the gws involved. the gws acknowledge with delete session response (cause) message. if a pcrf is deployed, the pdn gw employs an ip-can session termination procedure to indicate that resources have been released.
8. if the mme has changed since the last detach, or if there is no valid subscription context for the ue in the mme, or if the ue provides an imsi or the ue provides an old guti which doesn't refer to a valid context in the mme, or for some network sharing scenario (e.g. gwcn) if the plmn-id of the tai supplied by the enodeb is different from that of the guti in the ue's context, the mme sends an update location request (mme identity, imsi, me identity (imeisv), mme capabilities, ulr-flags, homogeneous support of ims voice over ps sessions, ue srvcc capability, equivalent plmn list) message to the hss. the mme capabilities indicate the mme's support for regional access restrictions functionality. ulr-flags indicates "initial-attach-indicator" as this is an attach procedure. the inclusion of the equivalent plmn list indicates that the mme supports the inter-plmn handover to a csg cell in an equivalent plmn using the subscription information of the target plmn. the "homogenous support of ims voice over ps sessions" indication (see clause?4.3.5.8a) shall not be included unless the mme has completed its evaluation of the support of "ims voice over ps session" as specified in clause?4.3.5.8.
note?9: at this step, the mme may not have all the information needed to determine the setting of the ims voice over ps session supported indication for this ue (see clause?4.3.5.8). hence the mme can send the "homogenous support of ims voice over ps sessions" later on in this procedure.
 if the ue performs initial or handover attach in a vplmn supporting autonomous csg roaming and the hplmn has enabled autonomous csg roaming in the vplmn (via service level agreement) and the mme needs to retrieve the csg subscription information of the ue from the css, the mme initiates the update csg location procedure with css as described in clause?5.3.12.
 if the mme determines that only the ue srvcc capability has changed, the mme sends a notify request to the hss to inform about the changed ue srvcc capability.
 if there is a valid subscription context for the ue in the mme with a service gap timer running and the attach type is not emergency attach and it is not an attach without pdn connectivity, the mme rejects the attach request from the ue with an appropriate cause value. in addition, mme may also provide a ue with a mobility management back-off timer set to the remaining value of the service gap timer.
 for an emergency attach in which the ue was not successfully authenticated, the mme shall not send an update location request to the hss.
9. the hss sends cancel location (imsi, cancellation type) to the old mme. the old mme acknowledges with cancel location ack (imsi) and removes the mm and bearer contexts. if the ulr-flags indicates "initial-attach-indicator" and the hss has the sgsn registration, then the hss sends cancel location (imsi, cancellation type) to the old sgsn. the cancellation type indicates the old mme/sgsn to release the old serving gw resource.
10. if there are active bearer contexts in the old mme/sgsn for this particular ue, the old mme/sgsn deletes these bearer contexts by sending delete session request (lbi) messages to the gws involved. the gws return delete session response (cause) message to the old mme/sgsn. if a pcrf is deployed, the pdn gw employs an ip can session termination procedure as defined in ts?23.203?[6] to indicate that resources have been released.
11. the hss acknowledges the update location message by sending an update location ack (imsi, subscription data) message to the new mme. the subscription data contain one or more pdn subscription contexts. each pdn subscription context contains an 'eps subscribed qos profile' and the subscribed apn-ambr (see clause?4.7.3) and the wlan offloadability indication (see clause?4.3.23). the new mme validates the ue's presence in the (new) ta.
 if due to regional subscription restrictions or access restrictions (e.g. csg restrictions) the ue is not allowed to attach in the ta or due to subscription checking fails for other reasons, the new mme rejects the attach request with an appropriate cause. if all checks are successful then the new mme constructs a context for the ue. if the apn provided by the ue is not allowed by subscription, based on operator policy, the mme may reject the attach request from the ue with an appropriate cause, or accept the attach request by replacing the ue requested apn with a network supported apn. the mme uses that network supported apn for the remainder of this procedure, except that the mme provides to the ue the same apn that the ue requested. if the update location is rejected by the hss, the new mme rejects the attach request from the ue with an appropriate cause.
 the subscription data may contain csg subscription information for the registered plmn and for the equivalent plmn list requested by mme in step?8.
 the subscription data may contain enhanced coverage restricted parameter. if received from the hss, mme stores this enhanced coverage restricted parameter in the mme mm context.
 the subscription data may contain service gap time parameter. if received from the hss, mme stores this service gap time in the mme mm context and passes it to the ue in the attach accept message.
 the subscription data may contain subscribed paging time window parameter that applies to the ues on a specific rat, e.g. nb-iot. if received from the hss, mme stores this subscribed paging time window parameter in the mme mm context.
 if the ue provided apn is authorized for lipa according to the user subscription, the mme shall use the csg subscription data to authorize the connection.
 for an emergency attach the mme shall not check for access restrictions, regional restrictions or subscription restrictions (e.g. csg restrictions). for an emergency attach, the mme shall ignore any unsuccessful update location response from hss and continue with the attach procedure.
12. if an esm container was not included in the attach request, steps 12, 13,14,15,16 are skipped. if the attach type is not set to "emergency", and the esm container was included in the attach request, and the ue has indicated support for attach without pdn connectivity, and the network supports attach without pdn connectivity, and the pdn connection restriction is set in the subscriber data, then the new mme shall not establish pdn connection, and steps 12, 13, 14, 15 and 16 are skipped.
 for an emergency attach the mme applies the parameters from mme emergency configuration data for the emergency bearer establishment performed in this step and any potentially stored imsi related subscription data are ignored by the mme.
 if the ue performs initial or handover attach via a csg cell and there is no subscription for that csg or the csg subscription is expired the mme shall reject the attach request with an appropriate cause. if the ue has this csg id and associated plmn on its allowed csg list the ue shall remove the csg id and associated plmn from the list when receiving this reject cause.
 if a subscribed pdn address is allocated for the ue for this apn, the pdn subscription context contains the ue's ipv4 address and/or the ipv6 prefix and optionally the pdn gw identity. if the pdn subscription context contains a subscribed ipv4 address and/or ipv6 prefix, the mme indicates it in the pdn address. for request type indicating "initial request", if the ue does not provide an apn, the mme shall use the pdn gw corresponding to the default apn for default bearer activation. if the ue provides an apn, this apn shall be employed for default bearer activation. for request type indicating "handover", if the ue provides an apn, the mme shall use the pdn gw corresponding to the provided apn for default bearer activation, if the ue does not provide an apn, and the subscription context from hss contains a pdn gw identity corresponding to the default apn, the mme shall use the pdn gw corresponding to the default apn for default bearer activation. the case where the request type indicates "handover" and the ue does not provide an apn, and the subscription context from hss does not contain a pdn gw identity corresponding to the default apn constitutes an error case. if the request type indicates "initial request" and the selected pdn subscription context contains no pdn gw identity the new mme selects a pdn gw as described in clause?4.3.8.1 on pdn gw selection function (3gpp accesses). if the pdn subscription context contains a dynamically allocated pdn gw identity and the request type does not indicate "handover" the mme may select a new pdn gw as described in clause pdn gw selection function, e.g. to allocate a pdn gw that allows for more efficient routing.
 for initial and handover emergency attach the mme uses the pdn gw selection function defined in clause?4.3.12.4 to select a pdn gw.
 if the subscription context does not indicate that the apn is for a pdn connection to an scef, the new mme selects a serving gw as described in clause 4.3.8.2 on serving gw selection function and allocates an eps bearer identity for the default bearer associated with the ue. then it sends a create session request (imsi, msisdn, mme teid for CP, pdn gw address, pdn address, apn, rat type, lte-m rat type reporting to pgw flag, default eps bearer qos, pdn type, apn-ambr, eps bearer identity, protocol configuration options, handover indication, me identity (imeisv), user location information (ecgi), ue time zone, user csg information, ms info change reporting support indication, selection mode, charging characteristics, trace reference, trace type, trigger id, omc identity, maximum apn restriction, dual address bearer flag, the protocol type over s5/s8, serving network, apn rate control status) message to the selected serving gw. if CP ciot eps optimisation applies, then the mme shall also indicate s11-u tunnelling of nas user data and send its own s11-u ip address and mme dl teid for dl data forwarding by the sgw. user csg information includes csg id, access mode and csg membership indication.
 for pdn type "non-ip" when CP ciot eps optimisations are enabled for the ue, if apn subscription data indicate a scef connection needs to be used, then the mme allocates an eps bearer identity for the default bearer associated with the ue and establishes a connection to the scef address indicated in subscription data as per ts?23.682?[74] and the steps 12,13,14,15,16 are not executed. the rest of the interactions with the ue apply as specified below.
 if the mme determines the pdn connection shall only use the CP ciot eps optimisation, the mme shall include a CP only pdn connection indicator in create session request.
 if the request type indicates "emergency", maximum apn restriction control shall not be performed.
 for emergency attached ues imsi is included if available and if the imsi cannot be authenticated then the imsi shall be marked as unauthenticated.
 the rat type is provided in this message for the later pcc decision. the rat type shall distinguish between nb-iot, lte-m and wb-e-utra types. the subscribed apn ambr for the apn is also provided in this message. the msisdn is included if provided in the subscription data from the hss. handover indication is included if the request type indicates handover. selection mode indicates whether a subscribed apn was selected, or a non-subscribed apn sent by the ue was selected. charging characteristics indicates which kind of charging the bearer context is liable for. the mme may change the requested pdn type according to the subscription data for this apn as described in clause?5.3.1.1. the mme shall set the dual address bearer flag when the pdn type is set to ipv4v6 and all sgsns which the ue may be handed over to are release?8 or above supporting dual addressing, which is determined based on node pre-configuration by the operator. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface.
 the charging characteristics for the ps subscription and individually subscribed apns as well as the way of handling charging characteristics and whether to send them or not to the p gw is defined in ts?32.251?[44]. the mme shall include trace reference, trace type, trigger id, and omc identity if s gw and/or p gw trace is activated. the mme shall copy trace reference, trace type, and omc identity from the trace information received from the hlr or omc.
 the maximum apn restriction denotes the most stringent restriction as required by any already active bearer context. if there are no already active bearer contexts, this value is set to the least restrictive type (see clause 15.4 of ts?23.060?[7]). if the p gw receives the maximum apn restriction, then the p gw shall check if the maximum apn restriction value does not conflict with the apn restriction value associated with this bearer context request. if there is no conflict the request shall be allowed, otherwise the request shall be rejected with sending an appropriate error cause to the ue.
 if the mme requires the enb to check whether the ue radio capabilities are compatible with the network configuration (e.g. whether the srvcc or frequency support by the ue matches that of the network) to be able to set the ims voice over ps session supported indication (see clause?4.3.5.8), then the mme may send a ue radio capability match request to the enb as defined in clause?5.3.14.
 the mme includes the latest apn rate control status if it has stored it.
13. the serving gw creates a new entry in its eps bearer table and sends a create session request (imsi, msisdn, apn, serving gw address for the UP, serving gw teid of the UP, serving gw teid of the CP, rat type, default eps bearer qos, pdn type, pdn address, subscribed apn-ambr, eps bearer identity, protocol configuration options, handover indication, me identity, user location information (ecgi), ue time zone, user csg information, ms info change reporting support indication, pdn charging pause support indication, selection mode, charging characteristics, trace reference, trace type, trigger id, omc identity, maximum apn restriction, dual address bearer flag, serving network, apn rate control status) message to the pdn gw indicated by the pdn gw address received in the previous step. after this step, the serving gw buffers any downlink packets it may receive from the pdn gw without sending a downlink data notification message to the mme until it receives the modify bearer request message in step 23 below. the msisdn is included if received from the mme.
 if the serving gw has received the CP only pdn connection indicator in step?12, the serving gw informs the pdn gw this information in create session request. the serving gw and pdn gw shall indicate the use of cp only on their cdrs.
 pdn?gws shall not perform any checks of maximum apn restriction if create default bearer request includes the emergency apn.
 for emergency attached ues imsi is included if available and if the imsi cannot be authenticated then the imsi shall be marked as unauthenticated.
 in the case of handover attach, and if the pdn gw detects that the 3gpp ps data off ue status is active, the pdn gw shall indicate this status to the charging system for offline and online charging.
14. if dynamic pcc is deployed and the handover indication is not present, the pdn gw performs an ip-can session establishment procedure as defined in ts?23.203?[6], and thereby obtains the default pcc rules for the ue. if the ue is accessing over wb-e-utra, this may lead to the establishment of a number of dedicated bearers following the procedures defined in clause 5.4.1 in association with the establishment of the default bearer, which is described in annex?f.
 the imsi, apn, ue ip address, user location information (ecgi), ue time zone, serving network, rat type, apn-ambr, default eps bearer qos, etftu (if etftu is not provided it means ue and/or the pdn?gw does not support the extended tft filter format) are provided to the pcrf by the pdn gw if received by the previous message. the user location information and ue time zone are used for location based charging. for emergency attached ues which are unauthenticated the pdn?gw provides the imei as the ue identity instead of imsi, to the pcrf. if the pcrf decides that the pdn connection may use the extended tft filter format, it shall return the etftn indicator to the pdn?gw for inclusion in the protocol configuration options returned to the ue.
 the pcrf may modify the apn-ambr and the qos parameters (qci and arp) associated with the default bearer in the response to the pdn gw as defined in ts?23.203?[6].
 if the pcc is configured to support emergency services and if dynamic pcc is deployed, the pcrf, based on the emergency apn, sets the arp of the pcc rules to a value that is reserved for emergency services and the authorization of dynamic pcc rules as described in of ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw uses the arp of the default emergency eps bearer for any potentially initiated dedicated emergency eps bearer. the p gw determines that emergency services are requested based on the emergency apn received in create session request message.
note?10: while the pdn gw/pcef may be configured to activate predefined pcc rules for the default bearer, the interaction with the pcrf is still required to provide e.g. the ue ip address information to the pcrf.
note?11: if the ip address is not available when the pdn gw performs the ip-can session establishment procedure with the pcrf, the pdn gw initiates an ip-can session modification procedure to inform the pcrf about an allocated ip address as soon as the address is available. in this version of the specification, this is applicable only to ipv4 address allocation.
 if dynamic pcc is deployed and the handover indication is present, the pdn gw executes a pcef initiated ip can session modification procedure with the pcrf as specified in ts?23.203?[6] to report the new ip can type. depending on the active pcc rules, the establishment of dedicated bearers for the ue may be required. the establishment of those bearers shall take place in combination with the default bearer activation as described in annex?f. this procedure can continue without waiting for a pcrf response. if changes to the active pcc rules are required, the pcrf may provide them after the handover procedure is finished.
 in both cases (handover indication is present or not), if dynamic pcc is not deployed, the pdn gw may apply local qos policy. if the ue is accessing over wb-e-utra, this may lead to the establishment of a number of dedicated bearers for the ue following the procedures defined in clause?5.4.1 in combination with the establishment of the default bearer, which is described in annex?f.
 if the csg information reporting triggers are received from the pcrf, the pdn?gw should set the csg information reporting action ie accordingly.
 if 3gpp ps data off status is received in the pco from the ue and pdn gw supports 3gpp ps data off, the pdn gw shall provide the 3gpp ps data off status to the pcrf. if the pcrf supports 3gpp ps data off, it shall return 3gpp ps data off support to the pdn gw for inclusion in the pco returned to the ue.
 the additional behaviour of the pdn gw for 3gpp ps data off is defined in ts?23.203?[6].
 if received, the pdn gw may take the apn rate control status into account when encoding the apn rate control parameters in protocol configuration options and when enforcing the apn rate control as described in clause?4.7.7.3.
15. the p gw creates a new entry in its eps bearer context table and generates a charging id for the default bearer. the new entry allows the p gw to route UP pdus between the s gw and the packet data network, and to start charging. the way the p gw handles charging characteristics that it may have received is defined in ts?32.251?[44].
 the pdn gw returns a create session response (pdn gw address for the UP, pdn gw teid of the UP, pdn gw teid of the CP, pdn type, pdn address, eps bearer identity, eps bearer qos, protocol configuration options, charging id, prohibit payload compression, apn restriction, cause, ms info change reporting action (start) (if the pdn gw decides to receive ue's location information during the session), csg information reporting action (start) (if the pdn gw decides to receive ue's user csg information during the session), presence reporting area action (if the pdn gw decides to receive notifications about a change of ue presence in presence reporting area), pdn charging pause enabled indication (if pdn gw has chosen to enable the function), apn-ambr, delay tolerant connection) message to the serving gw.
 the pdn gw takes into account the received pdn type, the dual address bearer flag and the policies of operator when the pdn gw selects the pdn type to be used as follows. if the received pdn type is ipv4v6 and both ipv4 and ipv6 addressing is possible in the pdn but the dual address bearer flag is not set, or only single ip version addressing for this apn is possible in the pdn, the pdn gw selects a single ip version (either ipv4 or ipv6). if the received pdn type is ipv4 or ipv6 or "non ip", the pdn gw uses the received pdn type if it is supported in the pdn, otherwise an appropriate error cause will be returned. for ipv4, ipv6 and ipv4v6, the pdn gw allocates a pdn address according to the selected pdn type. if the pdn gw has selected a pdn type different from the received pdn type, the pdn gw indicates together with the pdn type ie a reason cause to the ue why the pdn type has been modified, as described in clause?5.3.1.1. the pdn gw shall either accept or reject (but not modify) the pdn type if the pdn type is set to "non ip". pdn address may contain an ipv4 address for ipv4 and/or an ipv6 prefix and an interface identifier, or be omitted for pdn type "non ip". if the pdn has been configured by the operator so that the pdn addresses for the requested apn shall be allocated by usage of dhcpv4 only, or if the pdn gw allows the ue to use dhcpv4 for address allocation according to the address allocation preference received from the ue, the pdn address shall be set to 0.0.0.0, indicating that the ipv4 pdn address shall be negotiated by the ue with dhcpv4 after completion of the default bearer activation procedure. for external pdn addressing for ipv6, the pdn gw obtains the ipv6 prefix from the external pdn using either radius or diameter client function. in the pdn address field of the create session response, the pdn gw includes the interface identifier and ipv6 prefix. the pdn gw sends router advertisement to the ue after default bearer establishment with the ipv6 prefix information for all cases.
 if the pdn address is contained in the create session request, the pdn gw shall allocate the ipv4 address and/or ipv6 prefix contained in the pdn address to the ue. the ip address allocation details are described in clause 5.3.1 on "ip address allocation". the pdn gw derives the bcm based on the nrsu and operator policy. the pdn?gw derives whether the extended tft filter format is to be used based on the etftu, etftn received from the pcrf and operator policy. protocol configuration options contains the bcm, etftn as well as optional pdn parameters that the p gw may transfer to the ue. these optional pdn parameters may be requested by the ue, or may be sent unsolicited by the p gw. protocol configuration options are sent transparently through the mme.
 the pdn gw includes a delay tolerant connection indication if the pdn gw supports receiving a rejection cause from the sgw indicating that the ue is temporarily not reachable due to power saving and holding mobile terminated procedures, until the pdn gw receives a message indicating that the ue is available for end to end signalling.
 when the handover indication is present, the pdn gw does not yet send downlink packets to the s gw; the downlink path is to be switched at step?23a.
 if the pdn gw is an l-gw, it does not forward downlink packets to the s-gw. the packets will only be forwarded to the henb at step?20 via the direct UP path.
 if the 3gpp ps data off ue status was present in the create session request pco and the network supports 3gpp ps data off feature, the pdn gw shall include the 3gpp ps data off support indication in the create session response pco.
16. the serving gw returns a create session response (pdn type, pdn address, serving gw address for UP, serving gw teid UP, serving gw teid for CP, eps bearer identity, eps bearer qos, pdn gw addresses and teids (gtp-based s5/s8) or gre keys (pmip-based s5/s8) at the pdn gw(s) for uplink traffic, protocol configuration options, prohibit payload compression, apn restriction, cause, ms info change reporting action (start), presence reporting area action, csg information reporting action (start), apn-ambr, delay tolerant connection) message to the new mme.
 if CP ciot eps optimisation applies, and if the mme does not include CP only pdn connection indicator in the create session request:
- if separation of s11-u from s1-u is required, the serving gw shall include the serving gw ip address and teid for s11-u and additionally the serving gw ip address and teid for s1-u in create session response.
- otherwise, if separation of s11-u from s1-u is not required, the serving gw includes the serving gw ip address and teid for s11-u in create session response.
17. if an apn restriction is received, then the mme shall store this value for the bearer context and the mme shall check this received value with the stored value for the maximum apn restriction to ensure there are no conflicts between values. if the bearer context is accepted, the mme shall determine a (new) value for the maximum apn restriction. if there is no previously stored value for maximum apn restriction, then the maximum apn restriction shall be set to the value of the received apn restriction. mme shall not deactivate bearer(s) with emergency arp, if present, to maintain valid apn restriction combination.
 the p-gw shall ignore maximum apn restriction if the request includes the emergency apn.
 if the ms info change reporting action (start) and/or the csg information reporting action (start) are received for this bearer context, then the mme shall store this for the bearer context and the mme shall report to that p-gw via the s-gw whenever a ue's location and/or user csg information change occurs that meets the p-gw request, as described in clause?15.1.1a of ts?23.060?[7]. if presence reporting area action is received for this bearer context, the mme shall store this information for the bearer context and shall report to that p-gw via the s-gw whenever a change of ue presence in a presence reporting area is detected, as described in clause?5.9.2.2.
 the mme determines the ue ambr to be used by the enodeb based on the subscribed ue-ambr and the apn ambr for the default apn, see clause?4.7.3.
 for emergency attach the mme determines the ue-ambr to be used by the enodeb from the apn ambr received from the s-gw.
 if new mme hasn't received, from step 12, voice support match indicator for the ue from the enb then, based on implementation, the mme may set ims voice over ps session supported indication and update it at a later stage.
 the new mme sends an attach accept (guti, tai list, session management request (apn, pdn type, pdn address, eps bearer identity, protocol configuration options, header compression configuration, CP only indicator), nas sequence number, nas-mac, ims voice over ps session supported indication, emergency service support indicator, lcs support indication, supported network behaviour, service gap time, enhanced coverage restricted, indication for support of 15 eps bearers per ue) message to the enodeb. guti is included if the new mme allocates a new guti. pdn type and pdn address are omitted if the attach request (step?1) did not contain an esm message container. the mme indicates the ciot eps optimisations it accepts in the supported network behaviour information as defined in clause?4.3.5.10. service gap time is included if service gap time is present in the subscription information (step?11) and the ue has indicated ue service gap control capability. this message is contained in an s1_mme control message initial context setup request, unless the mme has selected to use the CP ciot eps optimisation, or, the ue did not include the esm message container in the attach request (step?1), in which case an s1-ap downlink nas transport message is used. the s1-ap initial context setup request message also includes the as security context information for the ue, the handover restriction list, the eps bearer qos, the ue-ambr, eps bearer identity, as well as the teid at the serving gw used for UP and the address of the serving gw for UP and whether UP ciot eps optimisation is allowed for the ue. if the pdn type is set to "non-ip" the mme includes it in the s1-ap initial context setup request so that the enodeb disables header compression. in addition, if the pdn connection is established for local ip access, the corresponding s1 initial context setup request message includes a correlation id for enabling the direct UP path between the henb and the l-gw. if the pdn connection is established for sipto at the local network with l-gw function collocated with the (h)enb, the corresponding s1-ap initial context setup request message includes a sipto correlation id for enabling the direct UP path between the (h)enb and the l-gw. lipa and sipto do not apply to CP ciot eps optimisation.
note?12: in this release of the 3gpp specification the correlation id and sipto correlation id is set equal to the UP pdn gw teid (gtp-based s5) or gre key (pmip-based s5) that the mme has received in step?16.
 if CP ciot eps optimisation applies for an ip pdn connection, and the ue has sent in the attach request the header compression configuration, and the mme supports the header compression parameters, the mme shall include the header compression configuration in the pdn connectivity accept message. the mme also binds the uplink and downlink rohc channels to support header compression feedback signalling. if the ue has included header compression context setup parameters in header compression configuration in the attach request, the mme may acknowledge the header compression context setup parameters. if the rohc context is not established during the attach procedure for the pdn connection, before using the compressed format for sending the data, the ue and the mme need to establish the rohc context with rohc ir packet based on header compression configuration.
 if the mme based on local policy determines the pdn connection shall only use the CP ciot eps optimisation, the mme shall include a CP only indicator in the session management request. for pdn connections with an scef, the mme shall always include the CP only indicator.a ue receiving the CP only indicator, for a pdn connection shall only use the CP ciot eps optimisation for this pdn connection.
 if the esm container was not included in the attach request in step?1, then the attach accept message shall not include pdn related parameters, and the downlink nas transfer s1-ap message shall not include access stratum context related information but may include csg related information.
 if the attach type is not set to "emergency", and the esm container was included in attach request in step?1, and the ue indicated support of attach without pdn connection in the attach request, and the mme supports attach without pdn connection, and pdn connection restriction is set in subscriber data, then the mme shall discard the esm container in the attach request message, and shall not include pdn related parameters in the attach accept, but may include csg related information.
 in the attach accept message, the mme does not include the ipv6 prefix within the pdn address. the mme includes the eps bearer qos parameter qci and apn-ambr into the session management request. furthermore, if the ue has utran or geran capabilities and the network supports mobility to utran or geran, the mme uses the eps bearer qos information to derive the corresponding pdp context parameters qos negotiated (r99 qos profile), radio priority, packet flow id and ti and includes them in the session management request. if the ue indicated in the ue network capability it does not support bss packet flow procedures, then the mme shall not include the packet flow id. handover restriction list is described in clause?4.3.5.7 "mobility restrictions". the mme sets the ims voice over ps session supported indication as described in clause?4.3.5.8. lcs support indication indicates whether the network supports the epc-mo-lr and/or cs-mo-lr as described in ts?23.271?[57]. the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan, as described in clause?4.3.23. indication for support of 15 eps bearers per ue indicates the network support for up to 15 eps bearers per ue as defined in clause?4.12.
 if the ue initiates the attach procedure at a hybrid cell, the mme shall check whether the csg id is contained in the csg subscription and is not expired. the mme shall send an indication whether the ue is a csg member to the ran along with the s1-mme control message. based on this information the ran may perform differentiated treatment for csg and non-csg members.
 if the mme or pdn gw has changed the pdn type, an appropriate reason cause shall be returned to the ue as described in clause?5.3.1.1. if the ue has indicated pdn type "non-ip", the mme and pdn gw shall not change pdn type.
 for an emergency attached ue, i.e. for ues that have only emergency eps bearers established, there is no as security context information included in the s1 control messages and there is no nas level security when the ue cannot be authenticated. the emergency service support indicator informs the ue that emergency bearer services are supported, i.e. the ue is allowed to request pdn connectivity for emergency services.
 if the ue included extended idle mode drx parameters information element, the mme includes extended idle mode drx parameters information element if it decides to enable extended idle mode drx with paging time window length assigned considering subscribed paging time window (if available) and the local policy.
 if the ue included support for restriction of use of enhanced coverage in step?1, the mme sends enhanced coverage restricted parameter to the enb in s1-ap initial context set-up request message. mme also sends enhanced coverage restricted parameter to the ue in the attach accept message.
 if the ue is not allowed to use nr as secondary rat, the mme indicates that to the ue in the attach accept message.
18. if the enodeb received an s1-ap initial context setup request the enodeb sends the rrc connection reconfiguration message including the eps radio bearer identity to the ue, and the attach accept message will be sent along to the ue.
 if the enodeb received an s1-ap downlink nas transport message (e.g. containing the attach accept message), the enode b sends a rrc direct transfer message to the ue.
 the ue shall store the qos negotiated, radio priority, packet flow id and ti, which it received in the session management request, for use when accessing via geran or utran. the apn is provided to the ue to notify it of the apn for which the activated default bearer is associated. for further details, see ts?36.331?[37]. the ue may provide eps bearer qos parameters to the application handling the traffic flow(s). the application usage of the eps bearer qos is implementation dependent. the ue shall not reject the rrc connection reconfiguration on the basis of the eps bearer qos parameters contained in the session management request.
 if the ue receives enhanced coverage restricted parameter in the attach accept message, ue shall store this information and shall use the value of enhanced coverage restricted parameter to determine if enhanced coverage feature should be used or not. if the ue receives a service gap time in the attach accept message, the ue shall store this parameter and apply service gap control (see clause?4.3.17.9).
 if the attach procedure is initiated by manual csg selection and occurs via a csg cell, the ue upon receiving the attach accept shall check if the csg id and associated plmn of the cell where the ue has sent the attach request message is contained in its allowed csg list. if the csg id and associated plmn is not in the ue's allowed csg list, the ue shall add the csg id and associated plmn to its allowed csg list. manual csg selection is not supported when an emergency service has been initiated.
note?13: if the ue receives an attach accept message via a hybrid cell, the ue does not add the corresponding csg id and associated plmn to its allowed csg list. adding a csg id and associated plmn to the ue's local allowed csg list for a hybrid cell is performed only by ota or oma dm procedures.
 when receiving the attach accept message the ue shall set its tin to "guti" as no isr activated is indicated.
 if the ue receives an ipv4 address set to 0.0.0.0, it may negotiate the ipv4 address with dhcpv4 as specified in ts?29.061?[38]. if the ue receives an ipv6 interface identifier, it may wait for the router advertisement from the network with the ipv6 prefix information or it may send a router solicitation if necessary.
note?14: the ip address allocation details are described in clause 5.3.1 on "ip address allocation".
 if CP ciot eps optimisation applies or the ue has not included the esm message container in the attach request in step?1, then the steps 19 and 20 are not executed.
19. the ue sends the rrc connection reconfiguration complete message to the enodeb. for further details, see ts?36.331?[37].
20. the enodeb sends the initial context response message to the new mme. this initial context response message includes the teid of the enodeb and the address of the enodeb used for downlink traffic on the s1_u reference point.
 the mme shall be prepared to receive this message either before or after the attach complete message (sent in step?22).
 if the correlation id or sipto correlation id was included in the initial context setup request message, the enodeb shall use the included information to establish direct UP path with the l-gw and forward uplink data for local ip access or sipto at the local network with l-gw function collocated with the (h)enb accordingly.
21. the ue sends a direct transfer message to the enodeb, which includes the attach complete (eps bearer identity, nas sequence number, nas-mac) message. if the ue omitted the esm message container from the attach request message in step?1, then the eps bearer identity is omitted from the attach complete message.
22. the enodeb forwards the attach complete message to the new mme in an uplink nas transport message.
 if the esm message container was included in step?1, after the attach accept message and once the ue has obtained (if applicable to the pdn type) a pdn address, the ue can then send uplink packets towards the enodeb which will then be tunnelled to the serving gw and pdn gw. if CP ciot eps optimisations apply, ul data is sent as specified in clause?5.3.4b. if the ue requested for a dual address pdn type (ipv4v6) to a given apn and was granted a single address pdn type (ipv4 or ipv6) by the network with a reason cause indicating that only single ip version per pdn connection is allowed sent together with the pdn type, the ue should request for the activation of a parallel pdn connection to the same apn with a single address pdn type (ipv4 or ipv6) other than the one already activated. if the ue receives no reason cause in step?18 in response to an ipv4v6 pdn type and it receives an ipv6 interface identifier apart from the ipv4 address or 0.0.0.0 in the pdn address field, it considers that the request for a dual address pdn was successful. it can wait for the router advertisement from the network with the ipv6 prefix information or it may send router solicitation if necessary.
23. upon reception of both, the initial context response message in step?20 and the attach complete message in step?22, the new mme sends a modify bearer request (eps bearer identity, enodeb address, enodeb teid, handover indication, presence reporting area information, rat type, lte-m rat type reporting to pgw) message to the serving gw. if the CP ciot eps optimisation applies and the pdn connection is not served by a scef and if the mme does not need to report a change of ue presence in presence reporting area, sending of modify bearer request and steps 23a, 23b and 24 are skipped; otherwise if the pdn connection is served by scef, steps 23,24, 25, and 26 are not executed. if the mme has been requested to report a change of ue presence in presence reporting area, the mme includes in this message the presence reporting area information comprising the pra identifier(s) and indication(s) on whether the ue is inside or outside the area(s). when receiving the request for reporting change of ue presence in presence reporting area, and the mme decides not to activate reporting ue presence in one or more of the received presence reporting area(s), the mme reports also the inactive presence reporting area(s) in this message. the rat type information element is included if the ue is using the lte-m rat type. if pdn gw expects the lte-m rat type reporting as specified in clause?5.11.5, the mme also includes the lte-m rat type reporting to pgw flag to indicate that the serving gw needs to forward the lte-m rat type to the pgw.
23a. if the handover indication is included in step 23, the serving gw sends a modify bearer request (handover indication) message to the pdn gw to prompt the pdn gw to tunnel packets from non 3gpp ip access to 3gpp access system and immediately start routing packets to the serving gw for the default and any dedicated eps bearers established. if presence reporting area information is included in step?23, the serving gw sends a modify bearer request (presence reporting area information) message to the pdn gw. if the lte-m rat type and the lte-m rat type reporting to pgw flag were received at step?23, the serving gw shall include the lte-m rat type in the modify bearer request message to the pgw. otherwise the serving gw includes rat type wb-e-utran.
note?15: the pdn gw is expected to handle the uplink packets sent by the ue via 3gpp access after step?22, even if they arrive before path switch in step?23.
note?16: the pdn gw forwards the presence reporting area information to the pcrf, to the ocs or to both as defined in ts?23.203?[6].
23b. the pdn gw acknowledges by sending modify bearer response to the serving gw.
24. the serving gw acknowledges by sending modify bearer response (eps bearer identity) message to the new mme. the serving gw can then send its buffered downlink packets.
 if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the emm context of the mme, the mme sends an event notification (see ts?23.682?[74] for further information).
25. after the mme receives modify bearer response (eps bearer identity) message, if request type does not indicate handover and an eps bearer was established and the subscription data indicates that the user is allowed to perform handover to non-3gpp accesses, and if the mme selected a pdn gw that is different from the pdn gw identity which was indicated by the hss in the pdn subscription context, the mme shall send a notify request including the apn and pdn gw identity to the hss for mobility with non-3gpp accesses. the message shall include information that identifies the plmn in which the pdn?gw is located.
 if the me identity of the ue has changed and step?8 has not been performed, the mme sends a notify request (me identity) message to inform the hss of the updated me identity.
 for an unauthenticated or roaming ue, if the request type of the ue requested connectivity procedure indicates "emergency", the mme shall not send any notify request to an hss. for a non-roaming authenticated ue, based on operator configuration (e.g. on whether voice over wlan is supported or not by the operator, on whether the operator uses a fixed pdn gw for emergency calls, etc.), if the request type indicates "emergency", the mme may send a notify request to the hss including the "pdn gw currently in use for emergency services", which comprises the pdn gw address and an indication that the pdn connection is for emergency services. the hss shall store it as part of the ue context for emergency services.
 after step?8, and in parallel to any of the preceding steps, the mme shall send a notify request (homogeneous support of ims voice over ps sessions) message to the hss:
- if the mme has evaluated the support of ims voice over ps sessions, see clause?4.3.5.8, and
- if the mme determines that it needs to update the homogeneous support of ims voice over ps sessions, see clause?4.3.5.8a.
26. in the case of non-emergency services, the hss stores the apn and pdn gw identity pair. in the case of emergency services, the hss stores the "pdn gw currently in use for emergency services". the hss then sends a notify response to the mme.
note?17: for handover from non-3gpp access, the pdn gw initiates resource allocation deactivation procedure in the trusted/untrusted non-3gpp ip access as specified in ts?23.402?[2].
5.3.2.2 utran/geran initial attach
when a ue attaches to utran/geran, it executes the normal attach procedure as defined in ts?23.060?[7]. when the ue needs an ip address, it initiates pdp context activation procedure as defined in ts?23.060?[7].
this procedure along with pdp context activation is also used to establish the first pdn connection over utran/geran when the ue already has active pdn connections over a non-3gpp access network and wants to establish simultaneous pdn connections to different apns over multiple accesses.
5.3.3 tracking area update procedures
5.3.3.0 triggers for tracking area update
a stand-alone tracking area update (with or without s gw change, described in clauses?5.3.3.1 and 5.3.3.2 respectively) occurs when a gprs-attached or e utran-attached ue experiences any of the following conditions:
- ue detects it has entered a new ta that is not in the list of tais that the ue registered with the network (except for the case of a ue configured to perform attach with imsi when entering a ta in a new non-equivalent plmn in rrc-idle mode);
- the periodic ta update timer has expired;
- ue was in utran pmm_connected state (e.g. ura_pch) when it reselects to e utran;
- ue was in gprs ready state when it reselects to e utran;
- the tin indicates "p-tmsi" when the ue reselects to e-utran (e.g. due to bearer configuration modifications performed on geran/utran);
- the rrc connection was released with release cause "load re-balancing tau required";
- the rrc layer in the ue informs the ue's nas layer that an rrc connection failure (in either e-utran or utran) has occurred;
- a change of the ue network capability and/or ms network capability and/or ue specific drx parameters and/or ts?24.008?[47] ms radio access capability (e.g. due to geran radio capability change, e-utran, ng-ran capability change or cdma2000 radio access technology capability change) information of the ue.
- a change in conditions in the ue require a change in the extended idle mode drx parameters previously provided by the mme.
- for a ue supporting cs fallback, or configured to support ims voice, or both, a change of the ue's usage setting or voice domain preference for e-utran.
- for a sr-vcc capable ue, a change of ms classmark 2 and/or ms classmark 3 and/or supported codecs.
- ue manually selects a csg cell whose csg id and associated plmn is absent from both the ue's allowed csg list and the ue's operator csg list.
- ue receives a paging request from the mme while the mobility management back off timer is running and the ue's tin indicates "p-tmsi".
- a change in any of the values of information included in preferred network behaviour as defined in clause?4.3.5.10 that would create incompatibility with the supported network behaviour provided by the serving mme.
note?1: the complete list of tau triggers is specified in ts?24.301?[46].
the procedure is initiated by an ue in either ecm-idle state or ecm-connected state. the decision to perform s gw change during the tracking area update procedure is made by the mme independently from the triggers above.
if sipto is allowed for the apn associated with a pdn connection, the mme should re-evaluate whether the pdn?gw location is still acceptable. if the mme determines that pdn gw re-location is needed, the mme may initiate pdn deactivation with reactivation requested according to clause?5.10.3 at the end of the tracking area/routing area update procedure.
note?2. it depends on the operator's configuration in the mme whether to use the deactivation with reactivation request or allow the continued usage of the already connected gw.
if sipto at the local network is allowed for the apn associated with a pdn connection the mme handles the sipto at the local network pdn connection as follows. 
 for a l gw collocated with (h)enb:
- for intra-mme mobility, upon completion of the tau procedure the mme shall deactivate the sipto at the local network pdn connection with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiates "explicit detach with reattach required" procedure according to clause?5.3.8.3.
- for inter-mme/sgsn mobility, as part of the tracking area update procedure, the source mme shall remove the bearer(s) corresponding to the sipto at local network pdn connection and shall release the core network resources associated to the sipto at the local network pdn connection by performing the mme-initiated pdn connection deactivation before sending the context response message.
 for a stand-alone gw:
- for intra-mme mobility, upon completion of the tau procedure the mme checks that the local home network id has changed and decides whether to deactivate the sipto at the local network pdn connection with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiates "explicit detach with reattach required" procedure according to clause?5.3.8.3.
- for inter-mme/sgsn mobility, upon completion of the tau/rau procedure the new mme/sgsn checks that the local home network id has changed and decides whether to deactivate the sipto at the local network pdn connection with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiates "explicit detach with reattach required" procedure according to clause?5.3.8.3.
if lipa is active for a pdn connection of the ue, the source mme (or s4-sgsn) shall not include lipa bearer(s) in the eps bearer context during tracking area update procedure and shall release the core network resources of this lipa pdn connection by peforming the mme requested pdn disconnection procedure according to steps?2 to 6 of clause?5.10.3 before it responds with the context response message in the case of inter-mme/sgsn mobility or after it receives tracking area update request in the case of intra-mme mobility.
note?3: the source mme may not be able to release the lipa pdn connection after the context response is sent as when there is no s-gw relocation, the s-gw will assign the s11 control tunnel of the ue to the new mme after the new mme updates the context information.
during the tracking area update procedure, if the mme supports srvcc and if the ue srvcc capability has changed, the mme informs the hss with the ue srvcc capability e.g. for further ims registration.
the cell selection for utran is described in ts?25.304?[12] and ts?25.331?[33].
if during the tracking area update procedure the mme detects that the serving gw or/and the mme needs be relocated, the old mme may reject any pdn gw initiated eps bearer(s) request received since the tracking area update procedure started and if rejected, the old mme shall include an indication that the request has been temporarily rejected due to mobility procedure in progress. the rejection is forwarded by the serving gw to the pdn gw, with the indication that the request has been temporarily rejected.
upon reception of a rejection for an eps bearer(s) pdn gw initiated procedure with an indication that the request has been temporarily rejected due to mobility procedure in progress, the pdn gw start a locally configured guard timer. the pdn gw shall re-attempt, up to a pre-configured number of times, when either it detects that the tracking area update procedure is completed or has failed using message reception or at expiry of the guard timer.
5.3.3.0a provision of ue's tai to mme in ecm-connected state
the enodeb shall include the tai+ecgi of the current cell in every s1-ap uplink nas transport message. if dual connectivity is activated for the ue, the enodeb shall also include the pscell id in every s1-ap uplink nas transport message.
note: an enodeb can contain cells from more than one tracking area and intra-enodeb cell changes are not normally notified to the mme. however, the mme needs to know the ue's current tai in order to correctly produce a tau accept message.
5.3.3.1 tracking area update procedure with serving gw change[blt[1]

figure 5.3.3.1-1: tracking area update procedure with serving gw change
note?1: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 9 and 10 concern gtp based s5/s8.
noe?2: in case of tracking area update without mme change the signalling in steps 4, 5, 7 and steps 12-17 are skipped.
1[blt[2]. one of the triggers described in clause?5.3.3.0 [blt[3]for starting the tau procedure[br[4] [blt[5]occurs[blt[6].
2[br[7][br[8][blt[9]. the ue[br[10] initiates the tau procedure by sending[br[11], to the enodeb[br[12], a tau request[br[13] (ue core network capability, ms network capability, preferred network behaviour, support for restriction of use of enhanced coverage, old guti, old guti type, last visited tai, active flag, signalling active flag, eps bearer status, p tmsi signature, additional guti, eksi, nas sequence number, nas-mac, ksi, voice domain preference and ue's usage setting[br[14]) message together with rrc parameters indicating the selected network[br[15] and the old gummei[br[16] an exception is that, if the tau was triggered for load re-balancing purposes[br[17] (see clause?4.3.7.3[br[18]), the old gummei[br[19] is not included[br[20] in the rrc parameters[br[21]. the ue[br[22] shall set[br[23][br[24] the old guti type to indicate whether the old guti is a native guti[br[25] or is mapped from a p-tmsi and rai[br[26].
 if the ue[br[27]'s tin indicates "guti"[br[28] or "rat related tmsi[br[29]" and the ue holds a valid guti[br[30] then the old guti indicates[br[31][br[32] this valid guti[br[33]. if the ue's tin indicates "p tmsi"[br[34] and the ue[br[35] holds a valid p tmsi and related rai[br[36] then these two elements are indicated[br[37] as the old guti[br[38]. mapping a p tmsi and rai to a guti is specified in annex?h[br[39]. when the ue is in connected mode (e.g. in ura_pch) when it reselects to e utran[br[40], the ue[br[41] shall set[br[42] its tin to "p tmsi"[br[43].
 if the ue holds a valid guti[br[44] and the old guti indicates a guti mapped from a p-tmsi and rai[br[45], then the ue[br[46] indicates[br[47] the guti as additional guti[br[48]. if the old guti indicates a guti mapped from a p-tmsi and rai, and the ue[br[49] has a valid p-tmsi signature[br[50], the p-tmsi signature shall be included[br[51][br[52].
 the additional guti in the tracking area update request message allows the new mme to find any already existing ue context stored in the new mme when the old guti indicates a value mapped from a p-tmsi and rai.[br[53]
 alternatively, when a ue[br[54] only supports e-utran[br[55], it identifies[br[56] itself with the old guti[br[57] and sets[br[58] the old guti type to 'native'[br[59].
 the rrc parameter "old gummei" takes[br[60] its value from the identifier that is signalled as the old guti[br[61] according to the rules above. for a combined mme/sgsn the enodeb is configured to route the mme code(s) of this combined node to the same combined node. this enodeb is also configured to route mme code(s) of gutis that are generated by the ue's mapping of the p tmsis allocated by the combined node. such an enodeb configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.[br[62]
 the last visited tai shall be include[br[63]d in order to help the mme produce a good list of tais for any subsequent tau accept message[br[64]. selected network indicate[br[65]s the network that is selected[br[66]. active flag is a request[br[67] by ue[br[68] to activate the radio and s1 bearers for all the active eps bearers[br[69] by the tau procedure when the ue is in ecm-idle state[br[70]. signalling active flag is a request[br[71] by ue[br[72] using CP ciot eps optimisation to maintain the nas signalling connection after tracking area update procedure is completed[br[73] in order to transmit pending data using the data transport in CP ciot eps optimisation or nas signalling.[br[74] the eps bearer status indicate[br[75]s each eps bearer that is active[br[76] in the ue[br[77]. the tau request message shall be integrity protect[br[78]ed by the nas-mac[br[79] as described in ts?33.401?[41].[br[80] eksi[br[81], nas sequence number and nas-mac[br[82] are included[br[83][br[84][br[85] if the ue[br[86] has valid eps security parameters[br[87]. nas sequence number indicates the sequential number of the nas message[br[88]. ksi is included[br[89][br[90] if the ue[br[91] indicates a guti mapped from a p tmsi in the information element "old guti"[br[92].
 in the rrc connection establishment signalling associated with the tau request, the ue[br[93] indicates[br[94] its support of the ciot eps optimisations relevant for mme selection[br[95].
 for ue[br[96] using ciot eps optimisation without any activated pdn connection[br[97], there is[br[98][br[99] no active flag[br[100] or eps bearer status[br[101] included in the tau request message. for a ue with a running service gap timer in the ue[br[102] the ue[br[103] shall not set[br[104][br[105] the active flag[br[106] and the signalling active flag[br[107] in the tau request message (see clause?4.3.17.9[br[108]).
 if the ue has pdn connection of pdn type "non-ip"[br[109], ue[br[110] shall indicate[br[111] eps bearer status included[br[112] in the tau request message.
 the ue[br[113] sets[br[114][br[115] the voice domain preference[br[116] and ue's usage setting according to its configuration[br[117], as described in clause?4.3.5.9[br[118].
 the ue[br[119] includes[br[120] extended idle mode drx parameters information element[br[121] if it needs to enable extended idle mode drx[br[122], even if extended idle mode drx parameters were already negotiated before[br[123].
 if a ue[br[124] includes a preferred network behaviour[br[125], this defines[br[126] the network behaviour the ue is expecting to be available in the network[br[127] as defined in clause?4.3.5.10[br[128].
3[br[129]. the enodeb[br[130] derives[br[131] the mme address from the rrc parameters carrying the old gummei, the indicated selected network and the rat (nb-iot or wb-e-utran)[br[132]. if that mme is not associated with that enodeb[br[133] or the gummei is not available [br[134]or the ue indicates that the tau procedure was triggered by load re-balancing[br[135], the enodeb[br[136] selects[br[137] an mme as described in clause 4.3.8.3 on "mme selection function"[br[138][br[139].
 the enodeb[br[140] forwards[br[141] the tau request[br[142] message together with the csg access mode, csg id, tai+ecgi of the cell from where it received the message and with the selected network[br[143] to the new mme[br[144]. csg id is provided[br[145] by ran[br[146] if the ue sends the tau request message via a csg cell or a hybrid cell[br[147]. csg access mode is provided[br[148] [br[149]if the ue sends the tau request message via a hybrid cell[br[150]. if the csg access mode is not provided [br[151]but the csg id is provided[br[152], the mme[br[153] shall consider[br[154] the cell as a csg cell[br[155]. for sipto at the local network with stand-alone gw architecture[br[156] the enodeb[br[157] includes[br[158][br[159] the local home network id in the initial ue message[br[160] and in uplink nas transport message[br[161] if the target cell is in a local home network[br[162].
 to assist location services, the enb[br[163] indicates[br[164] the ue's coverage level to the mme[br[165][br[166].
4[br[167]. the new mme[br[168] differentiates[br[169] the type of the old node, i.e. mme or sgsn, as specified in clause?4.3.19[br[170][br[171], uses[br[172] the guti received from the ue to derive the old mme/s4 sgsn address[br[173], and sends[br[174][br[175] a context request (old guti, complete tau request message, p tmsi signature, mme address, ue validated, ciot eps optimisation support inidication)[br[176] message to the old mme[br[177]/old s4 sgsn[br[178] to retrieve user information. ue validated indicates that the new mme[br[179] has validated[br[180] the integrity protection of the tau message[br[181][br[182], e.g. based on native eps security context for the ue[br[183]. to validate the context request[br[184] the old mme [br[185]uses[br[186] the complete tau request message [br[187]and the old s4 sgsn uses the p tmsi signature and responds[br[188] with an appropriate error[br[189] if integrity check fails[br[190] in old mme/s4 sgsn. this shall initiate[br[191] the security functions [br[192]in the new mme[br[193]. if the security functions authenticate the ue correctly[br[194], the new mme [br[195]shall send[br[196] a context request[br[197] (imsi, complete tau request message, mme address, ue validated[br[198]) message to the old mme[br[199]/s4 sgsn with the ue validated set. if the new mme [br[200]indicates that it has authenticated the ue[br[201] or if the old mme/old s4 sgsn correctly validates the ue[br[202], then the old mme[br[203]/old s4?sgsn start[br[204][br[205]s a timer[br[206].
 if the ue with emergency bearers is not authenticated in the old mme[br[207]/old s4 sgsn (in a network supporting unauthenticated ues) the old mme[br[208]/old s4 sgsn continues the procedure with sending[br[209] a context response [br[210]and start[br[211]ing the timer[br[212] also when it cannot validate the context request[br[213].
 if the new mme[br[214] supports ciot eps optimisation[br[215], ciot eps optimisation support indication is included[br[216] in the context request indicating support for various ciot eps optimisations (e.g. support for header compression for cp ciot eps optimisation, etc.)[br[217].
5[br[218][br[219][br[220][br[221]. if the context request is sent to an old mme[br[222] the old mme[br[223] responds[br[224][br[225] with a context response [br[226](imsi, me identity (imeisv), mm context, eps bearer context(s), serving gw signalling address and teid(s), isr supported, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, ue core network capability, ue specific drx parameters, remaining running service gap timer, lte-m ue indication) [br[227]message. if the new mme[br[228] supports ciot eps optimisation and the use of header compression has been negotiated between the ue and the old mme[br[229][br[230], the context response also includes[br[231] the header compression configuration[br[232] which includes the information necessary for the rohc channel setup but not the rohc context itself[br[233].
 if the context request is sent to an old s4?sgsn[br[234] the old s4?sgsn[br[235] responds[br[236][br[237][br[238] with a context response[br[239] (mm context, eps bearer context(s), serving gw signalling address and teid(s), isr supported, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, ue core network capability, ue specific drx parameters[br[240]). if the source mme[br[241] has not yet reported a non-zero mo exception data counter to the pdn gw[br[242], the context response also includes[br[243] the mo exception data counter as described in ts?29.274?[43][br[244][br[245].
 the mm context contains security related information as well as other parameters (including imsi and me identity (if available)) as described in clause?5.7.2 (information storage for mme)[br[246].[br[247] the unused authentication quintets in the mm context are also maintained in the sgsn. ts?33.401?[41] gives further details on the transfer of security related information.[br[248]
 if the mm context received with the context response message did not include imeisv[br[249] and the mme does not already store the imeisv of the ue[br[250], the mme[br[251] shall retrieve[br[252] the me identity (imeisv) from the ue.[br[253]
 the pdn gw address and teid(s) (for gtp-based s5/s8) or gre keys (pmip-based s5/s8 at the pdn gw(s) for uplink traffic) and the ti(s), is part of the eps bearer context.[br[254] if the ue is not known in the old mme[br[255]/old s4?sgsn[br[256] or if the integrity check for the tau request message fails[br[257], the old mme[br[258]/old s4?sgsn[br[259] responds[br[260][br[261] with agn appropriate error cause[br[262]. isr supported is indicated[br[263][br[264][br[265] if the old mme[br[266]/old s4 sgsn[br[267] and associated serving gw are capable to activate isr for the ue[br[268].
 if the ue receives emergency bearer services from the old mme[br[269][br[270]/old s4 sgsn[br[271][br[272] and the ue is uicc less[br[273], imsi can not be included[br[274][br[275] in the context response[br[276]. for emergency attached ues[br[277], if the imsi cannot be authenticated[br[278], then the imsi shall be marked[br[279][br[280] as unauthenticated[br[281]. also, in this case, security parameters are included[br[282][br[283][br[284] only if available[br[285].
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw[br[286], the old mme[br[287]/old s4 sgsn[br[288] shall include[br[289][br[290] the local home network id of the old cell in the eps bearer context corresponding to the sipto at the local network pdn connection[br[291].
 for ue using ciot eps optimisation without any activated pdn connection[br[292], there is no eps bearer context(s) included[br[293][br[294] in the context response message[br[295].
 based on the ciot eps optimisation support indication[br[296], old mme[br[297] only transfers[br[298] the eps bearer context(s) that the new mme supports[br[299]. if the new mme does not support ciot eps optimisation[br[300], eps bearer context(s) of non-ip pdn connection are not transferred[br[301][br[302] to the new mme. if the eps bearer context(s) of a pdn connection has not been transferred[br[303], the old mme[br[304] shall consider[br[305] all bearers of that pdn connection as failed [br[306]and release[br[307] that pdn connection by triggering the mme requested pdn disconnection procedure [br[308]specified in clause?5.10.3[br[309]. the buffered data in the old mme[br[310] is discarded[br[311] after receipt of context acknowledgement[br[312][br[313].
 if the eps bearer context(s) are to be transferred to the new mme[br[314], the old mme [br[315]also includes[br[316] the serving gw ip address and teid for both s1-u and s11-u[br[317], if available[br[318].
 if the old mme [br[319]is aware the ue is a lte-m ue[br[320], it provides[br[321] the lte-m ue indication to the new mme[br[322][br[323].
6[br[324]. if the integrity check of tau request message (sent in step?2[br[325]) failed[br[326], then authentication[br[327] is mandatory[br[328]. the authentication functions are defined in clause?5.3.10 on "security function"[br[329]. ciphering procedures are described in clause?5.3.10 on "security function"[br[330]. if guti allocation is going to be done[br[331] and the network supports ciphering[br[332], the nas messages shall be [br[333]ciphered[br[334].
 if this tau request is received for a ue which is already in ecm_connected state[br[335] and the plmn-id of the tai sent by the enodeb in step?3 is different from that of the guti, included in the tau request message[br[336], the mme[br[337] shall delay[br[338] authenticating the ue[br[339] until after step?21[br[340] (tau complete message)[br[341].
note?3: the mme delays the authentication such that the ue first updates its registered plmn-id to the new plmn-id selected by the ran during handover. the new plmn-id is provided by the mme to the ue as part of the guti in the tau accept message in step?20. doing this ensures that the same plmn-id is used in the derivation of the kasme key by both the network and the ue[br[342].
 if the new mme is configured to allow emergency bearer services for unauthenticated ue[br[343] the new mme[br[344] behave as follows:
- where a ue has only emergency bearer services[br[345], the mme either skip[br[346] the authentication and security procedure[br[347] or accepts[br[348] that the authentication may fail and continues the tracking area update procedure[br[349]; or
- where a ue has both emergency and non emergency bearer services[br[350] and authentication fails[br[351], the mme[br[352] continues[br[353] the tracking area update procedure[br[354] and deactivates[br[355] all the non-emergency pdn connections[br[356] as specified in clause?5.10.3[br[357].
7[br[358]. the mme[br[359] (if the mme has changed then it is the new mme[br[360][br[361]) determines to relocate[br[362][br[363] the serving gw[br[364]. the serving gw is relocated when the old serving gw cannot continue to serve the ue[br[365]. the mme[br[366] (if the mme has changed [br[367]then it is the new mme[br[368]) may also decide to relocate[br[369][br[370] the serving gw[br[371] if a new serving gw is expected to serve the ue longer[br[372] and/or with a more optimal ue to pdn gw path[br[373], or if a new serving gw can be co-located with the pdn gw[br[374]. selection of a new serving gw is performed according to clause?4.3.8.2 on "serving gw selection function[br[375]".
 if the mme has changed [br[376]the new mme [br[377]sends[br[378] a context acknowledge[br[379] (serving gw change indication) message to the old mme[br[380]/old s4 sgsn. serving gw change indication indicates a new serving gw has been selected[br[381]. the old mme[br[382]/old s4 sgsn marks[br[383] in its ue context that the information in the gws is invalid[br[384]. and, if the old node is an mme[br[385], the old mme[br[386] marks[br[387] in its ue context that the information in the hss is invalid.[br[388] this ensures that the old mme/old s4 sgsn updates the gws, and the old mme updates the hss, if the ue initiates a tau or rau procedure back to the old mme/old s4 sgsn before completing the ongoing tau procedure.[br[389]
note?4: updating the gws refers to deletion of session(s) on the serving gw followed by re-creation of session(s) on the serving gw. the re-creation of session(s) on the serving gw will result in successful re-establishment of the s5/s8 tunnel between the selected serving gw and the pdn gw.[br[390]
 if the security functions do not authenticate the ue correctly[br[391], then the tau shall be rejected[br[392][br[393], and the new mme[br[394] shall send[br[395] a reject indication[br[396] to the old mme[br[397]/old s4 sgsn. the old mme[br[398]/old s4 sgsn shall continue[br[399] as if the identification and context request was never received[br[400].
 isr[br[401] is not indicated[br[402][br[403] in the context acknowledge [br[404]as isr is not activated due to the s gw change.
 for ue using ciot eps optimisation without any activated pdn connection[br[405], the steps 8, 9, 10, 11, 18 and 19[br[406] are skipped[br[407].
8[br[408]. if the mme has changed[br[409] the new mme[br[410] verifies[br[411] the eps bearer status received from the ue with the bearer contexts received from the old mme[br[412]/old s4 sgsn. if the mme has not changed[br[413] the mme[br[414] verifies[br[415] eps bearer status from the ue with the bearer contexts available in the mm context[br[416]. the mme[br[417] releases[br[418] any network resources related to eps bearers that are not active in the ue[br[419][br[420]. if there is no bearer context at all[br[421], the mme[br[422] rejects[br[423] [br[424]the tau request[br[425][br[426].
 if the mme[br[427] selected a new serving gw[br[428] it sends[br[429] a create session request[br[430] (imsi, bearer contexts, mme address and teid, type, the protocol type over s5/s8, rat type, lte-m rat type reporting to pgw flag, serving network, ue time zone, mo exception data counter[br[431]) message per pdn connection[br[432] to the selected new serving gw[br[433]. the pdn gw address and tft (for pmip-based s5/s8) are indicated in the bearer contexts[br[434]. type indicates to the serving gw to send the modify bearer request to the pdn gw[br[435]. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface[br[436]. rat type indicates a change in radio access[br[437]. if it is a mobility from a sgsn to a mme[br[438] and if the mme supports location information change reporting[br[439], the mme[br[440] shall include[br[441] the user location information (according to the supported granularity)[br[442] in the create session request[br[443], regardless of whether location information change reporting had been requested in the previous rat by the pdn gw[br[444]. if it is an inter mme mobility[br[445] and if the pdn gw requested location information change reporting[br[446], the mme[br[447] includes[br[448] the user location information ie[br[449] in this message if it is different compared to the previously sent information[br[450][br[451]. if the pdn gw requested user csg information[br[452], the mme [br[453]also includes [br[454]the user csg information ie in this message[br[455][br[456]. if CP ciot eps optimisation applies[br[457], the mme[br[458] may also indicate [br[459]s11-u tunnelling of nas user data[br[460] and send its own s11-u ip address[br[461] and mme dl teid for dl data forwarding by the sgw[br[462][br[463]. the mme[br[464] shall include[br[465] the mo exception data counter[br[466][br[467] if it has received the counter for rrc cause "mo exception data" in the context response message[br[468].
 if only the CP ciot eps optimisation is used[br[469], the mme[br[470] shall include[br[471] a CP only pdn connection indicator[br[472][br[473] in create session request.
 if the new mme receives the eps bearer context with scef[br[474], then the new mme[br[475] updates[br[476] the scef[br[477][br[478] as defined in ts?23.682[br[479]?[74].
 if the ue is using the lte-m rat type[br[480] and the pdn gw expects the lte-m rat type reporting[br[481] as specified in clause?5.11.5[br[482], the mme[br[483] also includes[br[484] the lte-m rat type reporting to pgw flag to indicate to the serving gw to forward the lte-m rat type to the pdn gw[br[485].
9[br[486][br[487][br[488]. the serving gw [br[489]informs the pdn?gw(s)[br[490] about the change of for example the rat type that e.g. can be used for charging, by sending[br[491] the message modify bearer request[br[492] (serving gw address and teid, rat type, serving network, pdn charging pause support indication[br[493]) per pdn connection to the pdn?gw(s) concerned. user location information ie[br[494] and/or ue time zone ie[br[495] and/or user csg information ie[br[496] and/or mo exception data counter [br[497]are also included[br[498][br[499][br[500][br[501][br[502] if they are present in step?8[br[503]. the serving gw[br[504] and pdn gw[br[505] indicate[br[506][br[507] each use of the rrc establishment cause "mo exception data" by the related counter on its cdr[br[508].
 if the serving gw has received the CP only pdn connection indicator in step?8[br[509], the serving gw[br[510] indicates[br[511] the use of cp only on its cdr[br[512].
 if lte-m rat type[br[513] and the lte-m rat type reporting to pgw flag were received at step?8[br[514], the serving gw[br[515] shall include[br[516] the lte-m rat type[br[517] in the modify bearer request message to the pgw[br[518]. otherwise[br[519] the serving gw[br[520] includes[br[521] rat type wb-e-utran[br[522][br[523].
9a[br[524] if dynamic pcc is deployed[br[525], and rat type information needs to be conveyed from the pdn?gw to the pcrf[br[526], then the pdn?gw [br[527]shall send[br[528] rat type information[br[529] to the pcrf by means of an ip can session modification procedure[br[530] as defined in ts?23.203[br[531]?[6].
note?5: the pdn?gw[br[532] does not need to wait for the pcrf response[br[533], but continues[br[534] in the next step[br[535]. if the pcrf response leads to an eps bearer modification[br[536] the pdn?gw[br[537] should initiate[br[538] a bearer update procedure[br[539].
10[br[540]. the pdn gw[br[541] updates[br[542] its bearer contexts[br[543] and returns[br[544][br[545] a modify bearer response[br[546] (msisdn[br[547], charging id[br[548], pdn charging pause enabled indication[br[549] (if pdn gw has chosen to enable the function[br[550])) message. the msisdn is included[br[551][br[552] if the pdn gw[br[553] has it stored in its ue context[br[554]. if there has been a rat change towards e-utran[br[555] and location information change reporting is required and supported in the target mme[br[556], the pdn?gw[br[557] shall provide[br[558] ms info change reporting action[br[559] in the modify bearer response[br[560].
 if the serving gw [br[561]is relocated[br[562], the pdn gw [br[563]shall send[br[564] one or more "end marker[br[565]" packets on the old path[br[566] immediately after switching the path in order to assist the reordering function in the target enodeb[br[567]. if the serving gw has no downlink UP established[br[568], the serving gw[br[569] shall discard[br[570][br[571] the "end marker" received from the pdn gw[br[572] and shall not send downlink data notification[br[573]. otherwise the serving gw[br[574] shall forward[br[575] the "end marker" packets[br[576] to the source enodeb[br[577] or source s4 sgsn.
11[br[578]. the serving gw[br[579] updates[br[580] its bearer context[br[581]. this allows the serving gw to route bearer pdus to the pdn gw when received from enodeb.
 the serving gw[br[582] returns[br[583] a create session response[br[584][br[585] (serving gw address[br[586] and teid for UP[br[587] and CP[br[588] and pdn?gw teids[br[589] (for gtp-based s5/s8[br[590]) or gre keys (for pmip-based s5/s8[br[591]) for uplink traffic and CP[br[592], ms info change reporting action[br[593]) message to the new mme[br[594].
 if CP ciot eps optimisation applies[br[595] and if the mme does not include CP only pdn connection indicator in the create session request[br[596]:
- if separation of s11-u from s1-u is required[br[597], the serving gw[br[598] shall include[br[599] the serving gw ip address[br[600] and teid for s11-u[br[601] and additionally the serving gw ip address[br[602] and teid for s1-u[br[603] in the create session response[br[604].
- otherwise, if separation of s11-u from s1-u is not required[br[605], the serving gw[br[606] includes[br[607] the serving gw ip address[br[608] and teid for s11-u[br[609] in create session response.[br[610]
 when the mme[br[611] receives the create session response message, the mme checks if there is a "availability after ddn failure" monitoring event[br[612] or a "ue reachability" monitoring event configured for the ue[br[613] in the mme[br[614] and in such a case sends[br[615][br[616] an event notification[br[617] (see ts?23.682[br[618]?[74] for further information).
12[br[619][br[620][br[621]. the new mme[br[622] verifies[br[623][br[624][br[625] whether[br[626][br[627][br[628] it holds subscription data for the ue identified by the guti[br[629], the additional guti [br[630]or by the imsi received with the context data from the old cn node[br[631].
 if there are no subscription data in the new mme for this ue[br[632], or for some network sharing scenario (e.g. gwcn) if the plmn-id of the tai supplied by the enodeb is different from that of the guti in the ue's context[br[633], then the new mme[br[634] sends[br[635] an update location request[br[636] (mme identity, imsi, ulr-flags, mme capabilities, homogeneous support of ims voice over ps sessions, ue srvcc capability, equivalent plmn list, me identity (imeisv)[br[637]) message to the hss[br[638]. ulr-flags indicates[br[639] that update location is sent from an mme[br[640][br[641][br[642] and the mme registration shall be updated[br[643][br[644] in hss[br[645]. the hss[br[646] does not cancel[br[647] any sgsn registration[br[648]. the mme[br[649] capabilities indicate[br[650] the mme's support for regional access restrictions functionality[br[651]. the inclusion[br[652] of the equivalent plmn list indicates that the mme[br[653] supports the inter-plmn handover to a csg cell in an equivalent plmn using the subscription information of the target plmn[br[654]. the "homogenous support of ims voice over ps sessions" indication[br[655] (see clause?4.3.5.8a[br[656]) shall not be includ[br[657]ed[br[658] unless the mme[br[659] has completed its evaluation of the support of "ims voice over ps session"[br[660] as specified in clause?4.3.5.8[br[661]. the me identity is include[br[662][br[663]d if step?5 caused the mme[br[664] to retrieve the imeisv from the ue[br[665].
note?6: at this step, the mme may not have all the information needed to determine the setting of the ims voice over ps session supported indication for this ue[br[666] (see clause?4.3.5.8[br[667]). hence the mme[br[668] can send[br[669] the "homogenous support of ims voice over ps sessions[br[670]" later on in this procedure[br[671][br[672].
 if the ue initiates the tau procedure in a vplmn supporting autonomous csg roaming[br[673] and the hplmn has enabled autonomous csg roaming in the vplmn (via service level agreement)[br[674] and the mme needs to retrieve the csg subscription information of the ue from the css[br[675], the mme[br[676] initiates[br[677] the update csg location procedure with css[br[678] as described in clause?5.3.12[br[679].
 if the mme determines that only the ue srvcc capability has changed[br[680], the mme[br[681] sends[br[682] a notify request[br[683] to the hss[br[684] to inform about the changed ue srvcc capability[br[685].
 if all the eps bearers of the ue have emergency arp value[br[686], the new mme[br[687] may skip[br[688] the update location procedure[br[689] or proceed[br[690] even if the update location fails[br[691][br[692].
13[br[693]. the hss[br[694] sends[br[695] the message cancel location[br[696] (imsi[br[697], cancellation type[br[698]) to the old mme[br[699] with cancellation type set to update procedure[br[700].
14[br[701][br[702][br[703]. if the timer started in step 4 is not running[br[704], the old mme[br[705] removes[br[706] the mm context[br[707]. otherwise, the contexts are removed[br[708][br[709] when the timer expires[br[710]. it also ensures[br[711] that the mm context is kept in the old mme[br[712][br[713] for the case the ue initiates another tau procedure before completing the ongoing tau procedure to the new mme[br[714]. the old mme[br[715] acknowledges[br[716] with the message cancel location ack[br[717] (imsi[br[718]).
15[br[719]. when old s4 sgsn receives the context acknowledge message[br[720] and if the ue is in iu connected[br[721], the old s4?sgsn[br[722] sends[br[723] an iu release command[br[724] message to the rnc[br[725] after the timer started in step?4[br[726] has expired[br[727].
16[br[728]. the rnc[br[729] responds[br[730] with an iu release complete[br[731] message.
17[br[732][br[733][br[734]. the hss[br[735] acknowledges the update location request message by sending[br[736] an update location ack[br[737] (imsi[br[738], subscription data[br[739]) message to the new mme[br[740]. the subscription data may contain[br[741][br[742] the csg subscription data[br[743][br[744] for the registered plmn[br[745] and for the equivalent plmn list requested by mme in step?12[br[746].
 the subscription data may contain[br[747][br[748] enhanced coverage restricted parameter[br[749]. if received from the hss[br[750][br[751], mme[br[752] stores[br[753] this enhanced coverage restricted parameter in the mme mm context[br[754].
 the subscription data may contain[br[755] a service gap time[br[756][br[757]. if received from the hss[br[758], the mme[br[759] stores[br[760] this service gap time in the mme mm context for the ue[br[761] and passes[br[762] it to the ue[br[763] in the tracking area update accept[br[764] message.
 the subscription data may contain[br[765] subscribed paging time window [br[766]parameter that applies to the ues on a specific rat, e.g. nb-iot.[br[767] if received from the hss[br[768][br[769], mme[br[770] stores[br[771] this subscribed paging time window parameter in the mme mm context[br[772].
 if the update location[br[773] is rejected[br[774][br[775] by the hss[br[776][br[777], the new mme[br[778] rejects[br[779][br[780] the tau request[br[781] from the ue[br[782] with an appropriate cause[br[783]. in such cases, the new mme[br[784] releases[br[785] any local mme eps bearer contexts for this particular ue[br[786], and additionally deletes the eps bearer resources in the new serving gw by sending[br[787] the delete session request[br[788] (cause[br[789], operation indication[br[790]) messages to the new serving gw[br[791]. the operation indication flag shall not be set[br[792]. therefore, the new serving gw[br[793] receiving this request shall not initiate[br[794] a delete procedure towards the pdn gw[br[795].
 if the ue initiates the tau procedure at a csg cell[br[796], the new mme[br[797] shall check[br[798][br[799][br[800][br[801] whether the csg id[br[802] and associated plmn[br[803] is contained in the csg subscription [br[804][br[805]and is not expired[br[806][br[807]. if the csg id[br[808] and associated plmn[br[809] is not present[br[810] or expired[br[811], the mme[br[812] shall send[br[813][br[814][br[815][br[816] a tracking area update reject[br[817][br[818][br[819][br[820] message to the ue[br[821] with an appropriate cause value[br[822][br[823][br[824][br[825]. the ue[br[826] shall remove[br[827][br[828][br[829][br[830] the csg id and associated plmn from its allowed csg list[br[831] if present[br[832]. if the ue[br[833] has ongoing emergency bearer services[br[834] no csg access control shall be perform[br[835]ed[br[836].
 if all checks are successful[br[837] then the new mme[br[838] constructs[br[839] a context for the ue[br[840].
18[br[841]. if the mme has changed, when the timer started in step?4 expires[br[842] the old mme[br[843]/old s4 sgsn releases[br[844] any local mme or sgsn bearer resources[br[845] and additionally the old mme[br[846]/old s4 sgsn deletes the eps bearer resources by send[br[847]ing the delete session request[br[848] (cause, operation indication[br[849]) messagesto the old serving gw[br[850] if it received the serving gw change indication in the context acknowledge message in step?7[br[851]. when the operation indication flag is not set[br[852][br[853], that indicates to the old serving gw that the old serving gw[br[854] shall not initiate[br[855][br[856] a delete procedure[br[857] towards the pdn gw[br[858][br[859]. if isr is activated the cause indicates to the old s gw that the old s gw[br[860] shall delete the bearer resources on the other old cn node[br[861] by send[br[862]ing delete bearer request message[br[863](s) to that cn node[br[864].[br[865]
 if the mme[br[866] has not changed[br[867], step 11 triggers[br[868] the release[br[869] of the eps bearer resources[br[870] at the old serving gw[br[871].
19[br[872]. the serving gw[br[873] acknowledges[br[874] with delete session response[br[875] (cause[br[876]) messages. the serving gw[br[877] discards[br[878] any packets buffered for the ue[br[879].
20[br[880][br[881][br[882]. if due to regional subscription restrictions[br[883] or access restrictions (e.g. csg restrictions)[br[884] the ue is not allowed to access[br[885][br[886] the ta:
- the mme[br[887] rejects[br[888][br[889] the tracking area update request[br[890] with an appropriate cause[br[891] to the ue[br[892].
- for ues with emergency eps bearers, i.e. at least one eps bearer has an arp value reserved for emergency services[br[893], the new mme[br[894] accepts[br[895][br[896] the tracking area update request[br[897] and deactivates[br[898][br[899] all non-emergency pdn connections as specified in clause?5.10.3[br[900][br[901]. if the tracking area update procedure is initiated in ecm-idle state[br[902], all non-emergency eps bearers are deactivated[br[903][br[904] by the tracking area update procedure without bearer deactivation signalling between the ue and the mme[br[905].
 the mme[br[906] sends[br[907] a tau accept[br[908] (guti, tai list, eps bearer status, nas sequence number, nas-mac, ims voice over ps session supported, emergency service support indicator, lcs support indication, supported network behaviour, service gap time, enhanced coverage restricted, indication of support of 15 eps bearers per ue[br[909]) message to the ue[br[910]. if the active flag is set[br[911] the mme[br[912] may provide[br[913] the enodeb with handover restriction list[br[914]. guti is includ[br[915]ed[br[916] if the mme[br[917] allocates a new guti[br[918]. if the active flag is set[br[919] in the tau request message the UP setup procedure[br[920] can be activate[br[921]d in conjunction with the tau accept message[br[922]. if the dl data buffer expiration time for the ue in the mme has not expired[br[923], the UP setup procedure[br[924] is activate[br[925]d [br[926]even if the mme[br[927] did not receive the active flag in the tau request message[br[928]. if the new mme receives the downlink data notification message[br[929] or any downlink signalling message while the ue is still connected[br[930], the UP setup procedure[br[931] may be activate[br[932][br[933]d[br[934] even if the new mme[br[935] did not receive the active flag in the tau request message[br[936]. the procedure is described in detail in ts?36.300[br[937]?[5]. the message sequence should be the same as for the ue triggered service request procedure specified in clause 5.3.4.1 from the step when mme establishes the bearer(s)[br[938]. the mme[br[939] indicate[br[940]s the eps bearer status ie to the ue[br[941]. the ue[br[942] remove[br[943]s any internal resources related to bearers that are not marked active in the received eps bearer status[br[944]. if the eps bearer status information was in the tau request[br[945], the mme[br[946] shall indicate[br[947] the eps bearer status to the ue[br[948]. handover restriction list is described in clause?4.3.5.7 "mobility restrictions"[br[949]. the mme[br[950] sets[br[951] the ims voice over ps session supported[br[952] as described in clause?4.3.5.8[br[953].
 for ue using ciot eps optimisation without any activated pdn connection[br[954], there is no eps bearer status include[br[955]d in the tau accept message[br[956].
 the mme[br[957] indicates[br[958] the ciot eps optimisations it supports and prefers in the supported network behaviour information[br[959] as defined in clause?4.3.5.10[br[960].
 if there is a service gap timer running for the ue in the mme[br[961], and the active flag[br[962] or the signalling active flag is received in the tau request message[br[963], the mme[br[964] shall ignore[br[965][br[966] the active flag[br[967] and signalling active flag and not perform any of the actions related to these flags[br[968].
 the mme[br[969] shall include[br[970][br[971] the service gap time in the tau accept message[br[972] if the ue has indicated service gap control capability[br[973] and either if service gap time was received in step?17 from hss in the subscription information[br[974] or if the service gap time in the subscription information has been updated by hss user profile management[br[975] (i.e. the insert subscriber data procedure in clause?5.3.9.2[br[976]).
 if the ue included support for restriction of use of enhanced coverage in step?1[br[977], the mme[br[978] sends[br[979] enhanced coverage restricted parameter[br[980] to the enb[br[981] in the s1-ap message[br[982] as defined in clause?4.3.28[br[983]. the mme[br[984] also sends[br[985] the enhanced coverage restricted parameter[br[986] to the ue in the tau accept message[br[987]. ue[br[988] shall store[br[989] enhanced coverage restricted parameter[br[990][br[991] and shall use[br[992] the value of enhanced coverage restricted parameter[br[993] to determine if enhanced coverage feature should be used or not[br[994].
 if the mme[br[995] successfully obtained header compression configuration parameters in step?5[br[996] it indicates[br[997] the continued use of previous negotiated configuration to the ue in the header compression context status for each eps bearer of the ue[br[998]. when header compression context status indicates that the previous negotiated configuration can no longer be used for some eps bearers[br[999], the ue[br[1000] shall stop[br[1001] performing header compression and decompression, when sending or receiving data using CP ciot eps optimisation on these eps bearers[br[1002].
 if the mme did not receive the voice support match indicator in the mm context[br[1003], then the mme[br[1004] may send[br[1005] a ue radio capability match request[br[1006] to the enb[br[1007] as described in clause?5.3.14[br[1008]. if the mme hasn't received voice support match indicator from the enb then, based on implementation[br[1009], mme[br[1010] may set[br[1011] ims voice over ps session supported indication[br[1012] and update[br[1013] it at a later stage[br[1014]. after step?12, and in parallel to any of the preceding steps[br[1015], the mme[br[1016] shall send[br[1017][br[1018] a notify request[br[1019] (homogeneous support of ims voice over ps sessions[br[1020]) message to the hss[br[1021]:
- if the mme has evaluated the support of ims voice over ps sessions[br[1022], see clause?4.3.5.8[br[1023], and
- if the mme determines that it needs to update the homogeneous support of ims voice over ps sessions[br[1024], see clause?4.3.5.8a[br[1025].
 the emergency service support indicator informs the ue that emergency bearer services are supported[br[1026]. lcs support indication indicates whether the network supports the epc-mo-lr and/or cs-mo-lr as described in ts?23.271[br[1027]?[57][br[1028]. indication for support of 15 eps bearers per ue indicates the network support for up to 15 eps bearers per ue as defined in clause?4.12[br[1029].[br[1030]
 if the ue included extended idle mode drx parameters information element[br[1031], the mme[br[1032] include[br[1033]s extended idle mode drx parameters information element[br[1034] if it decides to enable extended idle mode drx with paging time window length assigned considering subscribed paging time window (if available) and the local policy[br[1035].
 when receiving the tau accept message and there is no isr activated indication[br[1036] the ue[br[1037] shall set[br[1038] its tin to "guti[br[1039]".
 for a s gw change[br[1040], isr activated is never indicated[br[1041] by the mme[br[1042] as it needs a rau with the same s gw first to activate isr[br[1043]. for an mme change[br[1044], isr is not activated[br[1045] by the new mme[br[1046] to avoid context transfer procedures with two old cn nodes[br[1047].
 if the tau procedure is initiated by manual csg selection and occurs via a csg cell, the ue[br[1048] upon receiving the tau accept message[br[1049] shall add[br[1050] the csg id and associated plmn to its allowed csg list[br[1051] if it is not already present[br[1052]. manual csg selection is not supported if the ue has emergency bearers established[br[1053].
 if the UP setup is performed in conjunction with the tau accept message and the tau is performed via a hybrid cell[br[1054], then the mme[br[1055] shall send[br[1056] an indication whether the ue is a csg member to the ran[br[1057][br[1058] along with the s1-mme control message[br[1059]. based on this information the ran may perform differentiated treatment for csg and non-csg members.[br[1060]
note?7: if the ue receives a tau accept message via a hybrid cell[br[1061], the ue[br[1062] does not add[br[1063] the corresponding csg id and associated plmn to its allowed csg list[br[1064]. adding a csg id and associated plmn to the ue's local allowed csg list for a hybrid cell is performed only by ota or oma dm procedures.[br[1065]
 if the ue receives a service gap time in the tau accept message[br[1066], the ue[br[1067] shall store[br[1068] this parameter and apply service gap control[br[1069] (see clause?4.3.17.9[br[1070]).
21[br[1071]. if guti was included in the tau accept[br[1072], the ue[br[1073] acknowledges the received message by returning[br[1074] a tau complete[br[1075] message to the mme[br[1076].
 when the "active flag" is not set in the tau request message and the tracking area update was not initiated in ecm-connected state[br[1077], the new mme[br[1078] releases[br[1079] the signalling connection with ue[br[1080], according to clause?5.3.5[br[1081]. for a ue using CP ciot eps optimisation, when the "signalling active flag" is set[br[1082], the new mme[br[1083] shall not release[br[1084] the nas signalling connection with the ue immediately after the tau procedure is completed[br[1085].
note?8: the new mme may initiate e rab establishment (see ts?36.413?[36]) after execution of the security functions, or wait until completion of the ta update procedure[br[1086]. for the ue, e rab establishment may occur anytime after the ta update request is sent[br[1087].
in the case of a rejected tracking area update operation, due to regional subscription, roaming restrictions or access restrictions (see ts?23.221?[27] and ts?23.008?[28]) the new mme should not construct an mm context for the ue. in the case of receiving the subscriber data from hss, the new mme may construct an mm context and store the subscriber data for the ue to optimise signalling between the mme and the hss. a reject shall be returned to the ue with an appropriate cause and the s1 connection shall be released. upon return to idle, the ue shall act according to ts?23.122?[10].
the new mme shall determine the maximum apn restriction based on the received apn restriction of each bearer context in the context response message and then store the new maximum apn restriction value.
the bearer contexts shall be prioritized by the new mme. if the new mme is unable to support the same number of active bearer contexts as received from old mme/sgsn, the prioritisation is used to decide which bearer contexts to maintain active and which ones to delete. in any case, the new mme shall first update all contexts in one or more p gws and then deactivate the bearer context(s) that it cannot maintain as described in the clause "mme initiated dedicated bearer deactivation procedure". this shall not cause the mme to reject the tracking area update.
the new mme shall not deactivate emergency service related eps bearers, i.e. eps bearers with arp value reserved for emergency services.
note?9: if ms (ue) was in pmm-connected state the bearer contexts are sent already in the forward relocation request message as described in the clause "serving rns relocation procedures" of ts?23.060?[7].
if the tracking area update procedure fails a maximum allowable number of times, or if the mme returns a tracking area update reject (cause) message, the ue shall enter emm deregistered state.
if the new mme identifies that the rat type has changed, the mme checks the subscription information to identify for each apn whether to maintain the pdn connection, disconnect the pdn connection with a reactivation request, or, disconnect the pdn connection without reactivation request. if the mme decides to deactivate a pdn connection it performs mme-initiated pdn connection deactivation procedure after[br[1088] the tracking area update procedure is completed but before the s1/rrc interface connection is released. existing esm cause values as specified in ts?24.301?[46] (e.g. #39, "reactivation requested"; #66 "requested apn not supported in current rat and plmn combination"; and for a dedicated bearer, possibly #37 "eps qos not accepted") are used to cause predictable ue behaviour. if all the pdn connections are disconnected and the ue does not support "attach without pdn connectivity", the mme shall request the ue to detach and reattach.
5.3.3.1a tracking area update procedure with serving gw change and data forwarding

figure 5.3.3.1a-1: tracking area update procedure with serving gw change and data forwarding
note?1: the procedure steps (a) and (b) are defined in clause?5.3.3.1. step 5 in the figure above has compared to clause?5.3.3.1 one additional parameter which is described below.
4. the timer setting by the old s4 sgsn or mme in step?4 (as in clause?5.3.3.1) shall ensure that the buffered data in the old serving gw can be forwarded before the old serving gw resource is released.
5. dl data is being buffered in the old serving gw and the dl data expiration time has not expired, therefore the old mme/old s4-sgsn indicates buffered dl data waiting in the context response. this triggers the new mme to setup the UP and invoke data forwarding. for CP ciot eps optimisation, if the dl data is buffered in the old serving gw, and when the buffered dl data waiting is indicated, the new mme shall setup the s11 UP with the new serving gw and invoke data forwarding. if the dl data is buffered in the old mme and the dl data expiration time has not expired, the old mme shall discard the buffered dl data.
11-12. the UP is setup. these procedure steps are defined in clause?5.3.4.1, steps 4-7 and steps 8-12 respectively in the ue triggered service request procedure.
note?2: it is assumed that pause of pgw charging is not invoked by sgw that is performing extended data buffering.
 for CP ciot eps optimisation, steps?11 and 12 are skipped.
13. since it was indicated in step?5 that buffered dl data is waiting, the new mme sets up forwarding parameters by sending create indirect data forwarding tunnel request (target enodeb addresses and teids for forwarding) to the serving gw. the serving gw sends a create indirect data forwarding tunnel response (target serving gw addresses and teids for forwarding) to the target mme. for CP ciot eps optimisation, the new mme sets up forwarding parameters by sending create indirect data forwarding tunnel request (target mme address and teid for forwarding) to the serving gw. upon receipt of the create indirect data forwarding tunnel response message the new mme starts a timer for release of resources if resources for indirect forwarding were allocated in the new s-gw.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
14. this procedure step?is defined in clause?5.3.3.1, step?7. in addition the new mme includes the f-teid where buffered dl data should be forwarded and a forwarding indication in the context acknowledge message. the f-teid is the f-teid for the indirect forwarding received from step?13 or it may be the f-teid of the enb (when enb supports forwarding).
15. a modify bearer request( f-teid ) is sent to the old serving gw. the f-teid is the forwarding f-teid where the buffered dl data shall be forwarded.
16. the old serving gw forwards its buffered data towards the received f-teid in step?15. the buffered dl data is sent to the ue over the radio bearers established in step?11. for CP ciot eps optimisation, the buffered dl data is sent to the new mme from the new serving gw and is sent to the ue as described in steps 12-14 of clause?5.3.4b.3.
17-18. as steps 15-16, 18-19 in clause?5.3.3.1.
19. if indirect forwarding was used, then the expiry of the timer at the new mme started at step?13 triggers the new mme to send a delete indirect data forwarding tunnel request message to the new s-gw to release temporary resources used for indirect forwarding that were allocated at step?13.
5.3.3.2 e-utran tracking area update without s gw change

figure 5.3.3.2-1: e-utran tracking area update without s gw change
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?12 and 14 concern gtp based s5/s8.
note?2: in case of tracking area update without mme change the signalling in steps 4, 5, 7 and steps 9-19 are skipped. a change of ue time zone, user csg information or serving network is signalled in the next service request. if tai change need to be reported to the pdn?gw, location information change reporting procedure described in clause?5.9.2 is performed.
note?3: deferred reporting of ue time zone, or serving network per note 2 may fail when inter-mme/sgsn mobility occurs before a ue sends service request and the target mme/sgsn (e.g. pre-release 10) does not support the "change to report" flag.
1. one of the triggers described in clause?5.3.3.0 for starting the tau procedure occurs.
2. the ue initiates a tau procedure by sending, to the enodeb, a tracking area update request (ue core network capability, ms network capability, preferred network behaviour, support for restriction of use of enhanced coverage, active flag, signalling active flag, eps bearer status, old guti, old guti type, last visited tai, p-tmsi signature, additional guti, ksisgsn, ksiasme, nas sequence number, nas-mac, voice domain preference and ue's usage setting) message together with rrc parameters indicating the selected network and the old gummei. an exception is that, if the tau was triggered for load re-balancing purposes (see clause?4.3.7.3), the old gummei is not included in the rrc parameters. the ue shall set the old guti type to indicate whether the old guti is a native guti or is mapped from a p-tmsi and rai.
 if the ue's tin indicates "guti" or "rat related tmsi" and the ue holds a valid guti then the old guti indicates this valid guti. if the ue's tin indicates "p tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as the old guti. mapping a p tmsi and rai to a guti is specified in annex?h. when the ue is in connected mode (e.g. in ura_pch) when it reselects to e-utran, the ue shall set its tin to "p tmsi".
 if the ue holds a valid guti and the old guti indicates a guti mapped from a p-tmsi and rai, then the ue indicates the guti as additional guti. if the old guti indicates a guti mapped from a p-tmsi and rai, and the ue has a valid p-tmsi signature, the p-tmsi signature shall be included.
 the additional guti in the tracking area update request message allows the new mme to find any already existing ue context stored in the new mme when the old guti indicates a value mapped from a p-tmsi and rai.
 alternatively, when a ue only supports e-utran, it identifies itself with the old guti and sets the old guti type to 'native'.
 the rrc parameter "old gummei" takes its value from the identifier that is signalled as the old guti according to the rules above. for a combined mme/sgsn the enodeb is configured to route the mme code(s) of this combined node to the same combined node. this enodeb is also configured to route mme code(s) of gutis that are generated the ue's mapping of the p tmsis allocated by the combined node. such an enodeb configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.
 the last visited tai shall be included in order to help the mme produce a good list of tais for any subsequent tau accept message. selected network indicates the network that is selected. active flag is a request by the ue to activate the radio and s1 bearers for all the active eps bearers by the tau procedure. signalling active flag is a request by ue using CP ciot eps optimisation to maintain the nas signalling connection after tracking area update procedure is completed in order to transmit pending data using the data transport in CP ciot eps optimisation or nas signalling. the ue's isr capability is included in the ue core network capability element. the eps bearer status indicates each eps bearer that is active in the ue. the tau request message shall be integrity protected by the nas-mac as described in ts?33.401?[41]. ksiasme is included if the ue has valid security parameters. nas sequence number indicates the sequential number of the nas message.
 in the rrc connection establishment signalling associated with the tau request, the ue indicates its support of the ciot eps optimisations relevant for mme selection.
 for ue using ciot eps optimisation without any activated pdn connection, there is no active flag or eps bearer status included in the tau request message. for a ue with a running service gap timer in the ue the ue shall not set the active flag or the signalling active flag in the tau request message (see clause?4.3.17.9).
 if the ue has pdn connection of pdn type "non-ip", ue shall indicate eps bearer status included in the tau request message.
 ksisgsn is included if the ue indicates a guti mapped from a p tmsi in the information element "old guti".
 the ue sets the voice domain preference and ue's usage setting according to its configuration, as described in clause?4.3.5.9.
 the ue includes extended idle mode drx parameters information element if it needs to enable extended idle mode drx, even if extended idle mode drx parameters were already negotiated before.
 if a ue includes a preferred network behaviour, this defines the network behaviour the ue is expecting to be available in the network as defined in clause?4.3.5.10.
3. the enodeb derives the mme address from the rrc parameters carrying the old gummei, the indicated selected network and the rat (nb-iot or wb-e-utran). if that gummei is not associated with the enodeb, or the gummei is not available or the ue indicates that the tau procedure was triggered by load re-balancing, the enodeb selects the mme as described in clause 4.3.8.3 on "mme selection function". the enodeb forwards the tau request message together with the csg access mode, csg id, tai+ecgi of the cell from where it received the message and with the selected network to the mme. csg id is provided by ran if the ue sends the tau request message via a csg cell or a hybrid cell. csg access mode is provided if the ue sends the tau request message via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the mme shall consider the cell as a csg cell. for sipto at the local network with stand-alone gw architecture the enodeb includes the local home network id in the initial ue message and in uplink nas transport message if the target cell is in a local home network.
 to assist location services, the enb indicates the ue's coverage level to the mme.
4. the new mme differentiates the type of the old node, i.e. mme or sgsn, as specified in clause?4.3.19, uses the guti received from the ue to derive the old mme/s4 sgsn address and sends a context request (old guti, mme address, ue validated, complete tau request message, p tmsi signature, ciot eps optimisation support inidication) message to the old mme/s4?sgsn to retrieve the user information. ue validated indicates that the new mme has validated the integrity protection of the tau message, e.g. based on native eps security context for the ue. to validate the context request the old mme uses the complete tau request message and the old s4 sgsn uses the p-tmsi signature and responds with an appropriate error if integrity check fails in old mme/s4 sgsn. this shall initiate the security functions in the new mme. if the security functions authenticate the ue correctly, the new mme shall send a context request (imsi, complete tau request message, mme address, ue validated) message to the old mme/s4 sgsn with the ue validated set. if the new mme indicates that it has authenticated the ue or if the old mme/old s4?sgsn authenticates the ue, the old mme/old s4?sgsn starts a timer.
 if the ue with emergency bearers is not authenticated in the old mme/old s4 sgsn (in a network supporting unauthenticated ues) the old mme/old s4 sgsn continues the procedure with sending a context response and starting the timer also when it cannot validate the context request.
 if the new mme supports ciot eps optimisation, ciot eps optimisation support indication is included in the context request indicating support for various ciot eps optimisations (e.g. support for header compression for cp ciot eps optimisation, etc.).
5. if the context request is sent to an old mme the old mme responds with a context response (imsi, me identity (imeisv), unused eps authentication vectors, ksiasme, kasme, eps bearer context(s), serving gw signalling address and teid(s), ms info change reporting action (if available), csg information reporting action (if available), ue time zone, ue core network capability, ue specific drx parameters, change to report (if present), remaining running service gap timer, lte-m ue indication) message. if the new mme supports ciot eps optimisation and the use of header compression has been negotiated between the ue and old mme, the context response also includes the header compression configuration which includes the information necessary for the rohc channel setup but not the rohc context itself.
 if the context request is sent to an old s4?sgsn the old s4 sgsn responds with a context response (imsi, me identity (if available), unused authentication quintets, ck, ik, ksisgsn, eps bearer context(s), serving gw signalling address and teid(s), isr supported, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, ue core network capability, ue specific drx parameters, change to report (if present)) message. the authentication quintets are maintained by the old s4 sgsn. ts?33.401?[41] gives further details on the transfer of security related information.
 change to report flag is included by the old mme or the old s4 sgsn if reporting of change of ue time zone, or serving network, or both towards serving gw / pdn gw was deferred by the old mme or old s4 sgsn.
 if the context response message did not include imeisv and the mme does not already store the imeisv of the ue, the mme shall retrieve the me identity (imeisv) from the ue.
 the pdn gw address and teid(s) (for gtp-based s5/s8) or gre keys (pmip-based s5/s8 at the pdn gw(s) for uplink traffic and the ti(s), is part of the eps bearer context. isr supported is indicated if the old sgsn and associated serving gw are capable to activate isr for the ue.
 the new mme shall ignore the ue core network capability contained in the context response only when it has previously received an ue core network capability in the tracking area update request. if the ue is not known in the old mme/old s4?sgsn or if the integrity check for the tau request message fails, the old mme/old s4?sgsn responds with an appropriate error cause.
 if the dl data buffer expiration time for the ue has not expired (see high latency communication in clause?4.3.17.7), the old mme/old s4-sgsn indicates buffered dl data waiting in the context response. when this is indicated, the new mme shall setup the UP in conjunction to the tau procedure for delivery of the buffered dl data.
 if the ue receives emergency bearer services from the old mme/old s4 sgsn and the ue is uiccless, imsi can not be included in the context response. for emergency attached ues, if the imsi cannot be authenticated, then the imsi shall be marked as unauthenticated. also, in this case, security parameters are included only if available.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw, the old mme/old s4 sgsn shall include the local home network id of the old cell in the eps bearer context corresponding to the sipto at the local network pdn connection.
 for ue using ciot eps optimisation without any activated pdn connection, there is no eps bearer context(s) included in the context response message.
 based on the ciot eps optimisation support indication, old mme only transfers the eps bearer context(s) that the new mme supports. if the new mme does not support ciot eps optimisation, eps bearer context(s) of non-ip pdn connection are not transferred to the new mme. if the eps bearer context(s) of a pdn connection has not been transferred, the old mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3. the buffered data in the old mme is discarded after receipt of context acknowledgement.
 if the eps bearer context(s) are to be transferred to the new mme, the old mme also includes the serving gw ip address and teid for both s1-u and s11-u, if available.
 if the old mme is aware the ue is a lte-m ue, it provides the lte-m ue indication to the new mme.
6. if the integrity check of tau request message (sent in step?2) failed, then authentication is mandatory. the authentication functions are defined in clause?5.3.10 on "security function". ciphering procedures are described in clause?5.3.10 on "security function". if guti allocation is going to be done and the network supports ciphering, the nas messages shall be ciphered.
 if this tau request is received for a ue which is already in ecm_connected state and the plmn-id of the tai sent by the enodeb in step?3 is different from that of the guti included in the tau request message, the mme shall delay authenticating the ue until after step?21 (tau complete message).
note?4: the mme delays the authentication such that the ue first updates its registered plmn-id to the new plmn-id selected by the ran during handover. the new plmn-id is provided by the mme to the ue as part of the guti in the tau accept message in step?20. doing this ensures that the same plmn-id is used in the derivation of the kasme key by both the network and the ue.
 if the new mme is configured to allow emergency bearer services for unauthenticated ue the new mme behave as follows:
- where a ue has only emergency bearer services, the mme either skip the authentication and security procedure or accepts that the authentication may fail and continues the tracking area update procedure; or
- where a ue has both emergency and non emergency bearer services and authentication fails, the mme continues the tracking area update procedure and deactivates all the non-emergency pdn connections as specified in clause?5.10.3.
7. if the old node is an old mme the new mme sends a context acknowledge message to the old mme. the old mme marks in its context that the information in the gw and the hss are invalid. this ensures that the mme updates the gws and the hss if the ue initiates a tau procedure back to the mme before completing the ongoing tau procedure.
note?5: updating the gws refers to modification of session(s) on the serving gw. this will result in successful re-establishment of the s11/s4 tunnel between the mme/sgsn and the serving gw.
 if the old node is an old s4?sgsn the mme sends a context acknowledge (isr activated) message to the old sgsn. unless isr activated is indicated by the mme, the old s4?sgsn marks in its context that the information in the gws is invalid. this ensures that the old s4?sgsn updates the gws if the ue initiates a rau procedure back to the old s4?sgsn before completing the ongoing tau procedure. if isr activated is indicated to the old s4?sgsn, this indicates that the old s4?sgsn shall maintain its ue context including authentication quintets and stop the timer started in step?4. in this case, if the implicit detach timer is running, the old s4 sgsn shall re-start it with a slightly larger value than the ue's geran/utran deactivate isr timer. also, in this case, if the old sgsn has maintained the serving gw address for UP and s4 gtp-u teid, the old sgsn shall remove serving gw address for UP and s4 gtp-u teid locally. when isr activated is not indicated and this timer expires the old sgsn deletes all bearer resources of that ue. as the context acknowledge from the mme does not include any s gw change the s4?sgsn does not send any delete session request message to the s gw. the mme shall not activate isr if the associated serving gw does not support isr.
 if the security functions do not authenticate the ue correctly, then the tau shall be rejected, and the mme shall send a reject indication to the old mme/old s4 sgsn. the old mme/old s4 sgsn shall continue as if the identification and context request was never received.
 for ue using ciot eps optimisation without any activated pdn connection, the steps 9, 10, 11, 12 and 13 are skipped.
8. void.
9. if the mme has changed the new mme adopts the bearer contexts received from the old mme/sgsn as the ue's eps bearer contexts to be maintained by the new mme. the mme establishes the eps bearer(s) in the indicated order. the mme deactivates the eps bearers which cannot be established.
 the mme verifies the eps bearer status received from the ue with the eps bearer contexts it maintains and releases any network resources related to eps bearers that are not active in the ue. if there is no bearer context at all, the mme rejects the tau request. if the mme has changed the new mme sends a modify bearer request (new mme address and teid, isr activated, rat type, lte-m rat type reporting to pgw flag) message per pdn connection to the serving gw. if there is no need for the sgw to send the signalling to the pdn gw, the mme may send modify access bearers request (new mme address and teid) per ue to the serving gw to optimise the signalling. the pdn gw address is indicated in the bearer contexts. if indicated, the information isr activated indicates that isr is activated. if it is a mobility from a sgsn to a mme and if the mme supports location information change reporting, the mme shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if it is an inter mme mobility and if the pdn gw requested location information change reporting, the mme includes the user location information ie in this message if it is different compared to the previously sent information. if the pdn gw requested user csg information, the mme also includes the user csg information ie in this message. if either the ue time zone has changed or context response message indicated pending ue time zone change reporting (via change to report flag), the mme includes the ue time zone ie in this message. if either the serving network has changed or context response message indicated pending serving network change reporting (via change to report flag) the mme includes the new serving network ie in this message. in network sharing scenarios serving network denotes the serving core network. if the old node is an old mme at a tracking area update with a mme change isr activated shall not be indicated.
note?6: the user csg information ie is only sent in step?9 if the "active flag" is set in the tau request message.
 when the modify access bearers request or modify bearer request does not indicate isr activated the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved.
 if the new mme receives the eps bearer context with scef, then the new mme updates the scef as defined in ts?23.682?[74].
 for CP ciot eps optimisation, if the dl data is buffered in the serving gw, and if this is a tracking area update without mme change and the dl data buffer expiration time in the mm context for the ue in the mme has not expired, or if this is a tracking area update with mme change and the old mme/old s4-sgsn indicated buffered dl data waiting in the context response in step?5, the mme shall also indicate s11-u tunnelling of nas user data and include it's own s11-u ip address and mme dl teid for dl data forwarding by the sgw in the modify bearer request. the mme may also do so without dl data buffered in the sgw.
 if the ue is using the lte-m rat type and the pdn gw expects the lte-m rat type reporting as specified in clause?5.11.5, the mme also includes the lte-m rat type reporting to pgw flag to indicate to the serving gw to forward the lte-m rat type to the pdn gw.
10. if the rat type has changed, or the serving gw has received the user location information ie or the ue time zone ie or user csg information ie and/or the serving network ie from the mme in step?9, the serving gw informs the pdn gw(s) about this information that e.g. can be used for charging, by sending the message modify bearer request (rat type) per pdn connection to the pdn gw(s) concerned. user location information ie and/or ue time zone ie and/or user csg information ie and/or serving network ie are also included if they are present in step?9.
 if the modify bearer request message is not sent because of above reasons and the pdn gw charging is paused, then the sgw shall send modify bearer request message with pdn charging pause stop indication to inform the pdn gw that the charging is no longer paused. other ies are not included in this message.
 if lte-m rat type and the lte-m rat type reporting to pgw flag were received at step?9, the serving gw shall include the lte-m rat type in the modify bearer request message to the pgw. otherwise the serving gw includes rat type wb-e-utran.
11. if dynamic pcc is deployed, and rat type information or ue location information needs to be conveyed from the pdn gw to the pcrf, then the pdn gw shall send this information to the pcrf by means of an ip can session modification procedure as defined in ts?23.203?[6].
note?7: the pdn gw does not need to wait for the pcrf response, but continues in the next step. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure.
12. the pdn gw updates its context field to allow dl pdus to be routed to the correct serving gw. pdn gw returns a modify bearer response (msisdn) to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. if there has been a rat change towards e-utran and location information change reporting is required and supported in the target mme, the pdn gw shall provide ms info change reporting action in the modify bearer response.
13. the serving gw updates its bearer context. if isr activated is indicated in step?9 and rat type received in step?9 indicates e utran, then the serving gw only updates the mme CP address stored locally and keep the sgsn related information unchanged. also, in this case, if the serving gw has maintained the sgsn address for UP and s4 gtp-u teid, the serving gw removes the sgsn address for UP and s4 gtp-u teid locally. otherwise the serving gw shall update all of the information stored locally for this ue with the related information received from the mme. this allows the serving gw to route bearer pdus to the pdn gw when received from enodeb. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic, ms info change reporting action) message to the new mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling other than to unpause charging in the pdn gw or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using modify bearer request message per pdn connection.
 when the mme receives the modify bearer response or the modify access bearers response message, the mme checks if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the mme and in such a case sends an event notification (see ts?23.682?[74] for further information).
 for CP ciot eps optimisation, if the mme address and mme dl teid are provided in step?9, the serving gw includes serving gw address and serving gw ul teid in the modify bearer response message. the dl data is sent to the mme from the serving gw.
 the buffered dl data is sent to the ue as described in steps 12-14 of clause?5.3.4b.3.
14. the new mme verifies whether it holds subscription data for the ue identified by the guti, the additional guti or by the imsi received with the context data from the old cn node.
 if there are no subscription data in the new mme for this ue, or for some network sharing scenario (e.g. gwcn) if the plmn-id of the tai supplied by the enodeb is different from that of the guti in the ue's context, then the new mme informs the hss of the change of mme by sending an update location request (mme id, imsi, ulr-flags, mme capabilities, homogenous support of ims voice over ps sessions, ue srvcc capability, equivalent plmn list, me identity (imeisv)) message to the hss. ulr-flags indicates that update location is sent from an mme and the mme registration shall be updated in hss. the hss does not cancel any sgsn registration. the mme capabilities indicate the mme's support for regional access restrictions functionality. the inclusion of the equivalent plmn list indicates that the mme supports the inter-plmn handover to a csg cell in an equivalent plmn using the subscription information of the target plmn. the "homogenous support of ims voice over ps sessions" indication (see clause?4.3.5.8a) shall not be included unless the mme has completed its evaluation of the support of "ims voice over ps session" as specified in clause?4.3.5.8. the me identity is included if step?5 caused the mme to retrieve the imeisv from the ue.
note?8: at this step, the mme may not have all the information needed to determine the setting of the ims voice over ps session supported indication for this ue (see clause?4.3.5.8). hence the mme can send the "homogenous support of ims voice over ps sessions" later on in this procedure.
 if the ue initiates the tau procedure in a vplmn supporting autonomous csg roaming and the hplmn has enabled autonomous csg roaming in the vplmn (via service level agreement) and the mme needs to retrieve the csg subscription information of the ue from the css, the mme initiates the update csg location procedure with css as described in clause?5.3.12.
 if the mme determines that only the ue srvcc capability has changed, the mme sends a notify request to the hss to inform about the changed ue srvcc capability.
 if all the eps bearers of the ue have emergency arp value, the new mme may skip the update location procedure or proceed even if the update location fails.
15. the hss sends a cancel location (imsi, cancellation type) message to the old mme with a cancellation type set to update procedure.
16. when receiving a cancel location message and the timer started in step 4 is not running, the old mme removes the mm and bearer contexts. otherwise, the contexts are removed when the timer expires. it also ensures that the mm context is kept in the old mme for the case the ue initiates another tau procedure before completing the ongoing tau procedure to the new mme. the old mme acknowledges with a cancel location ack (imsi) message.
note?9: isr activated is never indicated from new to old mme.
 so an old mme deletes all the bearer resources of the ue in any case when the timer started in step?4 expires, which is independent on receiving a cancel location message.
17. when receiving the context acknowledge message and if the ue is iu connected, the old sgsn sends an iu release command message to the rnc after the timer started in step?4 has expired.
18. the rnc responds with an iu release complete message.
19. the hss acknowledges the update location request by returning an update location ack (imsi, subscription data) message to the new mme after the cancelling of the old mme context is finished. if all checks are successful, the mme constructs an mm context for the ue. the subscription data may contain the csg subscription data for the registered plmn and for the equivalent plmn list requested by mme in step?14.
 the subscription data may contain enhanced coverage restricted parameter. if received from the hss, mme stores this enhanced coverage restricted parameter in the mme mm context.
 the subscription data may contain service gap time. if received from the hss, the mme stores this service gap time in the mme mm context for the ue and passes it to the ue in the tracking area update accept message if the ue has indicated service gap control capability.
 the subscription data may contain subscribed paging time window parameter that applies to the ues on a specific rat, e.g. nb-iot. if received from the hss, mme stores this subscribed paging time window parameter in the mme mm context.
 if the ue initiates the tau procedure at a csg cell, the new mme shall check whether the csg id and associated plmn is contained in the csg subscription and is not expired. if the csg id and associated plmn is not present or expired, the mme shall send a tracking area update reject message to the ue with an appropriate cause value. the ue shall remove the csg id and associated plmn from its allowed csg list if present.
 if the update location is rejected by the hss, the new mme rejects the tau request from the ue with an appropriate cause sent in the tau reject message to the ue. in such cases, the new mme releases any local mme eps bearer contexts for this particular ue.
20. if due to regional subscription restrictions or access restrictions (e.g. csg restrictions) the ue is not allowed to access the ta:
- the mme rejects the tracking area update request with an appropriate cause to the ue.
- for ues with emergency eps bearers, i.e. at least one eps bearer has an arp value reserved for emergency services, the new mme accepts the tracking area update request and deactivates all non-emergency pdn connections as specified in clause?5.10.3. if the tracking area update procedure is initiated in ecm-idle state, all non-emergency eps bearers are deactivated by the tracking area update procedure without bearer deactivation signalling between the ue and the mme.
 the mme responds to the ue with a tracking area update accept (guti, tai-list, eps bearer status, nas sequence number, nas-mac, isr activated, ims voice over ps session supported, emergency service support indicator, lcs support indication, supported network behaviour, service gap time, enhanced coverage restricted, indication of support of 15 eps bearers per ue) message. if the active flag is set the handover restriction list may be sent to enodeb as enodeb handles the roaming restrictions and access restrictions in the intra e-utran case. if the active flag is set in the tau request message the UP setup procedure is activated in conjunction with the tau accept message. if this is a tracking area update without mme change and the dl data buffer expiration time in the mm context for the ue in the mme has not expired, or if this is a tracking area update with mme change and the old mme/old s4-sgsn indicated buffered dl data waiting in the context response in step?5, the UP setup procedure is activated even if the mme did not receive the active flag in the tau request message. if the new mme receives the downlink data notification message or any downlink signalling message while the ue is still connected, the UP setup procedure may be activated even if the new mme did not receive the active flag in the tau request message. the procedure is described in detail in ts?36.300?[5]. the message sequence should be the same as for the ue triggered service request procedure specified in clause 5.3.4.1 from the step when mme establish the bearers(s). the eps bearer status indicates the active bearers in the network. the ue removes any internal resources related to bearers not marked active in the received eps bearer status. if the eps bearer status information was in the tau request, the mme shall indicate the eps bearer status to the ue. if isr activated is indicated to the ue, this indicates that its p-tmsi and rai shall remain registered with the network and shall remain valid in the ue. at a tracking area update with an mme change isr activated shall not be indicated. at a tracking area update without an mme change, if isr is activated for the ue when the mme receives the tracking area update request, the mme should maintain isr by indicating isr activated in the tracking area update accept message. handover restriction list is described in clause 4.3.5.7 "mobility restrictions". the mme sets the ims voice over ps session supported as described in clause?4.3.5.8.
 for ue using ciot eps optimisation without any activated pdn connection, there is no eps bearer status included in the tau accept message.
 the mme indicates the ciot eps optimisations it supports and prefers in the supported network behaviour information as defined in clause?4.3.5.10.
 if there is a service gap timer running for the ue in the mme, the mme shall ignore the active flag and signalling active flag and not perform any of the actions related to these flags.
 the mme shall include the service gap time in the tau accept message if the ue has indicated service gap control capability and either if service gap time was received in step?19 from hss in the subscription information or if the service gap time in the subscription information has been updated by hss user profile management (i.e. the insert subscriber data procedure in clause?5.3.9.2).
 if the ue included support for restriction of use of enhanced coverage in step?1, the mme sends enhanced coverage restricted parameter to the enb in the s1-ap message as defined in clause?4.3.28. the mme also sends the enhanced coverage restricted parameter to the ue in the tau accept message. ue shall store enhanced coverage restricted parameter and shall use the value of enhanced coverage restricted parameter to determine if enhanced coverage feature should be used or not.
 if the mme successfully obtained header compression configuration parameters in step?5 it indicates he continued use of previous negotiated configuration to the ue in the header compression context status for each eps bearer of the ue. when header compression context status indicates that the previous negotiated configuration can no longer be used for some eps bearers, the ue shall stop performing header compression and decompression when sending or receiving data using CP ciot eps optimisation on these eps bearers.
 the mme checks if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the mme for which an event notification has not yet been sent. in such a case an event notification is sent (see ts?23.682?[74] for further information).
 if the mme did not receive the voice support match indicator in the mm context, then the mme may send a ue radio capability match request to the enb as described in clause?5.3.14. if the mme hasn't received voice support match indicator from the enb then based on implementation mme may set ims voice over ps session supported indication and update it at a later stage. after step?14, and in parallel to any of the preceding steps, the mme shall send a notify request (homogeneous support of ims voice over ps sessions) message to the hss:
- if the mme has evaluated the support of ims voice over ps sessions, see clause?4.3.5.8, and
- if the mme determines that it needs to update the homogeneous support of ims voice over ps sessions, see clause?4.3.5.8a.
 the emergency service support indicator informs the ue that emergency bearer services are supported. lcs support indication indicates whether the network supports the epc-mo-lr and/or cs-mo-lr as described in ts?23.271?[57]. indication for support of 15 eps bearers per ue indicates the network supports 15 eps bearers as defined in clause?4.12.
 when receiving the tau accept message and there is no isr activated indication the ue shall set its tin to "guti". when isr activated is indicated and the ue's tin indicates "guti" the ue's tin shall not be changed. when isr activated is indicated and the tin is "p tmsi" or "rat related tmsi" the ue shall set its tin to "rat related tmsi".
 for an mme change isr is not activated by the new mme to avoid context transfer procedures with two old cn nodes.
 for an emergency attached ue, emergency isr is not activated.
 if the tau procedure is initiated by manual csg selection and occurs via a csg cell, the ue upon receiving tau accept message shall add the csg id and associated plmn to its allowed csg list if it is not already present. manual csg selection is not supported if the ue has emergency bearers established.
 if the ue included extended idle mode drx parameters information element, the mme includes extended idle mode drx parameters information element in the tau accept if it decides to enable extended idle mode drx with paging time window length assigned considering subscribed paging time window (if available) and the local policy.
 if the UP setup is performed in conjunction with the tau accept message and the tau is performed via a hybrid cell, then the mme shall send an indication whether the ue is a csg member to the ran along with the s1-mme control message. based on this information the ran may perform differentiated treatment for csg and non-csg members.
note?10: if the ue receives a tau accept message via a hybrid cell, the ue does not add the corresponding csg id and associated plmn to its allowed csg list. adding a csg id and associated plmn to the ue's local allowed csg list for a hybrid cell is performed only by ota or oma dm procedures.
 if the ue receives a service gap time in the tau accept message, the ue shall store this parameter and apply service gap control (see clause?4.3.17.9).
21. if the guti was changed the ue acknowledges the new guti by returning a tracking area update complete message to the mme.
 when the "active flag" is not set in the tau request message and the tracking area update was not initiated in ecm-connected state, the mme releases the signalling connection with ue, according to clause?5.3.5. for a ue using CP ciot eps optimisation, when the "signalling active flag" is set, the new mme shall not release the nas signalling connection with the ue immediately after the tau procedure is completed.
note?11: the new mme may initiate e rab establishment (see ts?36.413?[36]) after execution of the security functions, or wait until completion of the ta update procedure. for the ue, e rab establishment may occur anytime after the ta update request is sent.
in the case of a rejected tracking area update operation, due to regional subscription, roaming restrictions, or access restrictions (see ts?23.221?[27] and ts?23.008?[28]) the new mme should not construct an mm context for the ue. in the case of receiving the subscriber data from hss, the new mme may construct an mm context and store the subscriber data for the ue to optimise signalling between the mme and the hss. a reject shall be returned to the ue with an appropriate cause and the s1 connection shall be released. upon return to idle, the ue shall act according to ts?23.122?[10].
if the new mme is unable to update the bearer context in one or more p gws, the new mme shall deactivate the corresponding bearer contexts as described in clause "mme initiated dedicated bearer deactivation procedure". this shall not cause the mme to reject the tracking area update.
the new mme shall determine the maximum apn restriction based on the received apn restriction of each bearer context in the context response message and then store the new maximum apn restriction value.
the bearer contexts shall be prioritized by the new mme. if the new mme is unable to support the same number of active bearer contexts as received from old mme/sgsn, the prioritisation is used to decide which bearer contexts to maintain active and which ones to delete. in any case, the new mme shall first update all contexts in one or more p gws and then deactivate the context(s) that it cannot maintain as described in clause "mme initiated dedicated bearer deactivation procedure". this shall not cause the mme to reject the tracking area update.
the new mme shall not deactivate emergency service related eps bearers, i.e. eps bearers with arp value reserved for emergency services.
note?12: if ms (ue) was in pmm-connected state the bearer contexts are sent already in the forward relocation request message as described in clause "serving rns relocation procedures" of ts?23.060?[7].
if the tracking area update procedure fails a maximum allowable number of times, or if the mme returns a tracking area update reject (cause) message, the ue shall enter emm deregistered state.
if the new mme identifies that the rat type has changed, the mme checks the subscription information to identify for each apn whether to maintain the pdn connection, disconnect the pdn connection with a reactivation request, or, disconnect the pdn connection without reactivation request. if the mme decides to deactivate a pdn connection it performs mme-initiated pdn connection deactivation procedure after the tracking area update procedure is completed but before the s1/rrc interface connection is released. existing esm cause values as specified in ts?24.301?[46] (e.g. #39, "reactivation requested"; #66 "requested apn not supported in current rat and plmn combination"; and for a dedicated bearer, possibly #37 "eps qos not accepted") are used to cause predictable ue behaviour. if all the pdn connections are disconnected and the ue does not support "attach without pdn connectivity", the mme shall request the ue to detach and reattach.
5.3.3.3 routing area update with mme interaction and without s gw change
the routing area update without s gw change procedure takes place when a ue that is registered with an mme selects a utran or geran cell and the s gw is not changed by the procedure. in this case, the ue changes to a routing area that the ue has not yet registered with the network. this procedure is initiated by an ecm-idle state ue and may also be initiated if the ue is in ecm-connected state. the ra update case is illustrated in figure 5.3.3.3-1.
note?1: this procedure covers the mme to 2g or 3g sgsn rau.

figure 5.3.3.3-1: routing area update with mme interaction and without s gw change
note?2: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 8 and 10 concern gtp based s5/s8.
1. the ue selects a utran or geran cell. this cell is in a routing area that the ue not yet registered with the network, or the ue reselects a utran or geran cell and the tin indicates "guti". the ue in ecm connected state may change to the geran cell through network assisted cell change (nacc).
2a. the ue sends a routing area update request (old p-tmsi, p-tmsi type, old rai, ue core network capability, ms network capability, p tmsi signature, additional p tmsi/rai, ksi, voice domain preference and ue's usage setting) message to the new sgsn. the ue shall set the p-tmsi type to indicate whether the p-tmsi is a native p-tmsi or is mapped from a guti.
 if the ue's internal tin indicates "guti" and the ue holds a valid guti then the ue indicates the guti as the old p tmsi and old rai. if the ue's tin indicates "p tmsi" or "rat related tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as old p tmsi and old rai. mapping a guti to a p tmsi and an rai is specified in ts?23.003?[9].
 if the ue holds a valid p tmsi and related rai and the old p-tmsi and old rai indicate a p-tmsi/rai mapped from a guti, then the ue indicates these parameters as additional p tmsi/rai.
 the old p tmsi is indicated in the rau request message for iu mode only. for gb mode the tlli is derived from the value that is determined as the old p tmsi according to the rules above. the routing parameter that is signalled in the rrc signalling to the rnc for routing to the sgsn is derived from the identifier that is signalled as the old p tmsi according to the rules above. for a combined mme/sgsn the ran is configured to route the nri(s) of this combined node to the same combined node. the ran is also configured to route nri(s) of p tmsis that are generated by the ue's mapping of the gutis allocated by the combined node. such a ran configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.
 if the ue has a follow-on request, i.e. if there is pending uplink traffic (signalling or data), the 3g?sgsn may use, as an implementation option, the follow-on request indication to release or keep the iu connection after the completion of the ra update procedure.
 ksi is mapped from an eksi identifying a kasme if the ue indicates a p tmsi mapped from guti in the information element "old p tmsi". ksi identifies a (ck, ik) pair if the ue indicates a p tmsi in the information element "old p tmsi".
 the ue sets the voice domain preference and ue's usage setting according to its configuration, as described in clause?4.3.5.9.
2b. the rnc shall add the routing area identity, csg access mode, csg id before forwarding the message to the sgsn. this ra identity corresponds to the rai in the mm system information sent by the rnc to the ue. the bss shall add the cell global identity (cgi) of the cell where the ue is located before passing the message to the new sgsn. csg id is provided by ran if the ue sends the rau request message via a csg cell or a hybrid cell. csg access mode is provided if the ue sends the rau request message via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the sgsn shall consider the cell as a csg cell. for sipto at the local network the with stand-alone gw architecture the rnc includes the local home network id in the initial ue message and in direct transfer message if the target cell is in a local home network.
3. the new s4?sgsn determines the type of the old node, i.e. mme or sgsn, as specified in clause?4.3.19, uses the old rai received from the ue to derive the old mme address, and sends a context request (p tmsi, old rai, new sgsn address, p tmsi signature) message to the old mme to get the context for the ue. to validate the context request the old mme uses a nas token mapped from the p tmsi signature. if the ue is not known in the old mme, the old mme responds with an appropriate error cause. if integrity check fails in the old mme, the old mme responds with an appropriate error cause which shall initiate the security functions in the new s4 sgsn. if the security functions authenticate the ue correctly, the new s4 sgsn shall send a context request (imsi, old rai, new sgsn address, ue validated) message to the old mme.ue validated indicates that the new s4 sgsn has authenticated the ue. if the new s4 sgsn indicates that it has authenticated the ue or if the old mme authenticates the ue, the old mme starts a timer.
 if the ue with emergency bearers is not authenticated in the old mme (in a network supporting unauthenticated ues) the old mme continues the procedure with sending a context response and starting the timer also when it cannot validate the context request.
4. the old mme responds with one context response (imsi, me identity (if available), ksi, ck, ik, unused authentication quintets, eps bearer contexts, serving gw signalling address and teid(s), isr supported, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, ue core network capability, ue specific drx parameters, change to report (if present)) message. the pdn?gw address and teid(s) (for gtp-based s5/s8) or gre keys (pmip-based s5/s8) for uplink traffic and CP, and the ti(s) is part of the eps bearer context(s). the unused authentication quintets in the mm context may be sent if stored by the mme and the mme received the unused authentication quintets from the same sgsn previously. isr supported is indicated if the old mme and associated serving gw are capable to activate isr for the ue.
 if the ue receives emergency bearer services from the old mme and the ue is uiccless, imsi can not be included in the context response. for emergency attached ues, if the imsi cannot be authenticated, then the imsi shall be marked as unauthenticated. also, in this case, security parameters are included only if available.
 the new s4?sgsn shall ignore the ue core network capability contained in the context response only when it has previously received an ue core network capability in the routing area update request. if ue is not known in the old mme, the old mme responds with an appropriate error cause.
 change to report flag is included by the old mme if reporting of change of ue time zone, or serving network, or both towards serving gw / pdn gw was deferred by the old mme.
 the new sgsn maps the eps bearers to pdp contexts 1-to-1 and maps the eps bearer qos parameter values of an eps bearer to the release?99 qos parameter values of a pdp context as defined in annex e. the pdp context(s) are established in the indicated order. the sgsn deactivates the pdp contexts which cannot be established.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw, the old mme shall include the local home network id of the old cell in the eps bearer context corresponding to the sipto at the local network pdn connection.
 for ue using ciot eps optimisation without any activated pdn connection, there is no eps bearer context(s) included in the context response message.
 the old mme only transfers the eps bearer context(s) that the new sgsn supports. if not supported, eps bearer context(s) of non-ip pdn connection are not transferred to the new sgsn. if the eps bearer context(s) of a pdn connection has not been transferred, the old mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
5. security functions may be executed. procedures are defined in clause?5.3.10 on "security function".
 if the new sgsn is configured to allow emergency bearer services for unauthenticated ue the new sgsn behave as follows:
- where a ue has only emergency bearer services, the sgsn either skip the authentication and security procedure or accepts that the authentication may fail and continues the routing area update procedure; or
- where a ue has both emergency and non emergency bearer services and authentication fails, the sgsn continues the routing area update procedure and deactivates all the non-emergency pdp contexts as specified in ts?23.060?[7].
6. the new s4?sgsn sends a context acknowledge (isr activated) message to the old mme. unless isr is indicated by the new s4?sgsn, the old mme marks in its context that the information in the gws is invalid. this ensures that the old mme updates the gw if the ue initiates a tau procedure back to the old mme before completing the ongoing rau procedure.
note?3: updating the gws refers to modification of session(s) on the serving gw. this will result in successful re-establishment of the s11/s4 tunnel between the mme/sgsn and the serving gw.
 isr activated indicates to the old mme that it shall maintain the ue's contexts and the mme stops the timer started in step 3. in this case, if the implicit detach timer is running, the old mme shall re-start it with a slightly larger value than the ue's e-utran deactivate isr timer. when isr activated is not indicated and this timer expires the old mme deletes all bearer resources of that ue. as the context acknowledge from the new s4?sgsn does not include any s gw change the old mme does not send any delete session request message to the s gw. the sgsn shall not activate isr if the associated serving gw does not support isr.
 if the security functions do not authenticate the ue correctly, then the rau is rejected, and the new s4?sgsn sends a reject indication to the old mme. the old mme shall continue as if the identification and context request was never received.
 for ue using ciot eps optimisation without any activated pdn connection, the steps 7, 8, 9, 10, and 11 are skipped.
 if the new sgsn identifies that the rat type has changed, the sgsn checks the subscription information to identify for each apn whether to maintain the pdn connection, disconnect the pdn connection with a reactivation request or disconnect pdn connection without reactivation request. if the sgsn decides to deactive a pdn connection it performs sgsn-initiated pdn connection deactivation procedure after tracking area procedure is completed. existing sm cause values as specified in ts?24.008?[47] (e.g. #39, "reactivation requested"; #66 "requested apn not supported in current rat and plmn combination"; and for a dedicated bearer, possibly #37 "qos not accepted") are used to cause predictable ue behaviour.
7. in this procedure flow the serving gw is not relocated. the sgsn sends a modify bearer request (new sgsn address and teid, rat type, isr activated) message per pdn connection to the serving gw. if indicated, the information isr activated indicates that isr is activated. as it is a mobility from e-utran, if the target sgsn supports location information change reporting, the target sgsn shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information, the sgsn also includes the user csg information ie in this message. if either the ue time zone has changed , or context response message from old mme indicated pending ue time zone change reporting (via change to report flag), the sgsn includes the ue time zone ie in this message. if either the serving network has changed, or context response message from old mme indicated pending serving network change reporting (via change to report flag) the sgsn includes the new serving network ie in this message. in network sharing scenarios serving network denotes the serving core network.
 when the modify bearer request does not indicate isr activated the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved. rat type indicates a change in radio access.
 if isr activated is indicated or sgsn and sgw are configured to release s4 u-plane when eps bearer contexts associated with the released rabs are to be preserved, the sgsn does not send sgsn address and teid for u-plane in modify bearer request.
note?4: the user csg information ie is not sent in step?7 if the "follow-on request indication" indicates releasing the iu connection after the completion of the ra update procedure.
8. if the rat type has changed or the serving gw has received the user location information ie and/or the ue time zone ie and/or user csg information ie and/or the serving network ie from the mme in step?7 the serving gw informs the pdn gw(s) about the change of this information that e.g. can be used for charging, by sending the message modify bearer request (rat type) per pdn connection to the pdn gw(s) concerned. user location information ie and/or ue time zone ie and/or user csg information ie and/or serving network ie are also included if they are present in step?7.
9. if dynamic pcc is deployed, and rat type information or ue location information needs to be conveyed from the pdn gw to the pcrf, then the pdn gw shall send this information to the pcrf by means of an ip can session modification procedure as defined in ts?23.203?[6].
note?5: the pdn gw does not need to wait for the pcrf response, but continues in the next step. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure.
10. the pdn gw updates its context field and returns a modify bearer response (msisdn) message to the serving gw. msisdn is included if the pdn gw has it stored in its ue context. if location information change reporting is required and supported in the target sgsn, the pdn gw shall provide ms info change reporting action in the modify bearer response.
11. the serving gw updates its context fields. if isr activated is indicated in step 7 and rat type received in step 7 indicates utran or geran, then the serving gw only updates the sgsn CP address and keeps the mme related information unchanged. otherwise the serving gw shall update all of the information stored locally for this ue with the related information received from the sgsn. then the serving gw returns a modify bearer response (serving gw address and teid for uplink traffic, ms info change reporting action) message.
 when the sgsn receives the modify bearer response message, the sgsn checks if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the sgsn and in such a case sends an event notification (see ts?23.682?[74] for further information).
12. the new sgsn verifies whether it holds subscription data for the ue identified by the p tmsi, the additional ptmsi/rai or by the imsi received with the context data from the old cn node.
 the additional p-tmsi/rai allows the new sgsn to find any already existing ue context stored in the new sgsn. if there are no subscription data in the new sgsn for this ue, or for some network sharing scenario (e.g. gwcn) if the plmn-id of the rai supplied by the rnc is different from that of the rai in the ue's context, then the new sgsn informs the hss of the change of the sgsn by sending an update location (sgsn number, sgsn address, imsi, homogenous support of ims voice over ps sessions, ue srvcc capability, equivalent plmn list) message to the hss. for "homogenous support of ims voice over ps sessions", see clause?5.3.8a of ts?23.060?[7]. the inclusion of the equivalent plmn list indicates that the sgsn supports the inter-plmn handover to a csg cell in an equivalent plmn using the subscription information of the target plmn.
 if the ue initiates the rau procedure in a vplmn supporting autonomous csg roaming and the hplmn has enabled autonomous csg roaming in the vplmn (via service level agreement) and the sgsn needs to retrieve the csg subscription information of the ue from the css, the sgsn initiates the update csg location procedure with css as described in clause?5.3.12.
13. the hss sends a cancel location (imsi, cancellation type) message to the old sgsn with the cancellation type set to update procedure.
 when receiving the cancel location message the old sgsn removes all the ue contexts. the old sgsn acknowledges with a cancel location ack (imsi) message.
14. when receiving the context acknowledge message from the new sgsn and if the old mme has an s1-mme association for the ue, the source mme sends a s1-u release command to the source enodeb after the timer started in step?3 has expired. the rrc connection is released by the source enodeb. the source enodeb confirms the release of the rrc connection and of the s1-u connection by sending a s1-u release complete message to the source mme.
15. the hss acknowledges the update location message by sending an update location ack (imsi, subscription data) to the new sgsn. the subscription data may contain the csg subscription data for the registered plmn and for the equivalent plmn list requested by sgsn in step?12.
 if the ue initiates the rau procedure at a csg cell, the new s4 sgsn shall check whether the csg id and associated plmn is contained in the csg subscription and is not expired. if the csg id and associated plmn is not present or expired, the s4 sgsn shall send a rau reject message to the ue with an appropriate cause value. the ue shall remove the csg id and associated plmn from its allowed csg list if present.
 if the update location is rejected by the hss, the new sgsn rejects the rau request from the ue with an appropriate cause sent in the rau reject message to the ue. in such cases, the new sgsn releases any local sgsn eps bearer contexts for this particular ue.
16. void.
17. void.
18. if due to regional subscription restrictions or access restrictions (e.g. csg restrictions) the ue is not allowed to access the ra:
- for ues with ongoing emergency bearer services, the new sgsn accept the routing area update request and deactivates the non-emergency pdp contexts as specified in clause?9.2.4.2 in ts?23.060?[7]. .if the routing area update procedure is initiated in pmm-idle/standby state, all non-emergency pdp contexts are deactivated by the routing area without pdp context deactivation signalling between the ue and the sgsn
- for all other cases, the new sgsn rejects routing area update request with an appropriate cause to the ue and notifies the hss of rejection (details of this notification is covered in stage 3).
 the new sgsn responds to the ue with a routing area update accept (p-tmsi, p-tmsi signature, isr activated, emergency service support indicator, pdp context status) message to the ue. p-tmsi is included if the sgsn allocates a new p-tmsi. the emergency service support indicator informs the ue that emergency bearer services are supported over utran.
 if isr activated is indicated to the ue, its guti and list of tas shall remain registered with the network and shall remain valid in the ue.
 when receiving the rau accept message and there is no isr activated indication the ue shall set its tin to "p tmsi". when isr activated is indicated and the ue's tin indicates "p tmsi" the tin shall not be changed. when isr activated is indicated and the ue's tin indicates "guti" or "rat related tmsi" the ue shall set its tin to "rat related tmsi".
 if an sgsn change isr is not activated by the new sgsn to avoid context transfer procedures with two old cn nodes.
 if the rau procedure is initiated by manual csg selection and occurs via a csg cell, the ue upon receiving the rau accept shall add the csg id and associated plmn to its allowed csg list if it is not already present. manual csg selection is not supported if the ue has emergency bearers established.
 in iu mode, if after step?7 the new sgsn receives a downlink data notification message or any other downlink signalling message while the ue is still connected, the new sgsn may prolong the ps signalling connection with the ue.
 if there is dl data buffered for a ue using power saving functions (i.e. the dl data buffer expiration time in the mm context for the ue in the sgsn has not expired), the UP setup is performed in conjunction with the rau accept message.
 with the pdp context status information, the ue shall deactivate all those bearers contexts locally which are active in the ue, but are indicated by the sgsn as being inactive.
 if the UP setup is performed in conjunction with the rau accept message and the rau is performed via a hybrid cell, then the sgsn shall send an indication whether the ue is a csg member to the ran along with the ranap message. based on this information the ran may perform differentiated treatment for csg and non-csg members.
note?6: if the ue receives a rau accept message via a hybrid cell, the ue does not add the corresponding csg id and associated plmn to its allowed csg list. adding a csg id and associated plmn to the ue's local allowed csg list for a hybrid cell is performed only by ota or oma dm procedures.
19. if p-tmsi was included in the routing area update accept message, the ue acknowledges the new p-tmsi by returning a routing area update complete message to the sgsn.
20. for iu-mode, if the ue has uplink data or signalling pending it shall send a service request (p-tmsi, cksn, service type) message to the new sgsn. if a p-tmsi was allocated in step 18, that p-tmsi is the one included in this message. service type specifies the requested service. service type shall indicate one of the following: data or signalling.
21. if the ue has sent the service request, the new 3g sgsn requests the rnc to establish a radio access bearer by sending a rab assignment request (rab id(s), qos profile(s), gtp snds, gtp snus, pdcp snus) message to the rnc. if direct tunnel is established the sgsn provides to the rnc the serving gw's address for UP and teid for uplink data.
22. if the sgsn established direct tunnel in step 21) it shall send modify bearer request per pdn connection to the serving gw and include the rnc's address for UP and downlink teid for data. the serving gw updates the address for UP and teid for downlink data and return a modify bearer response.
note?7: eps does not support any camel procedures.
note?8: the new sgsn may initiate rab establishment after execution of the security functions (step?5), or wait until completion of the ra update procedure. for the ms, rab establishment may occur anytime after the ra update request is sent (step?2).
in the case of a rejected routing area update operation, due to regional subscription, roaming restrictions or access restrictions (see ts?23.221?[27] and ts?23.008?[28]) the new sgsn should not construct an mm context. in the case of receiving the subscriber data from hss, the new sgsn may construct an mm context and store the subscriber data for the ue to optimise signalling between the sgsn and the hss. a reject shall be returned to the ue with an appropriate cause and the ps signalling connection shall be released. upon return to idle, the ue shall act according to ts?23.122?[10].
if the network supports the mocn configuration for network sharing, the sgsn may, if the ue is not a 'network sharing supporting ms', in this case decide to initiate redirection by sending a reroute command to the rns, as described in ts?23.251?[24] instead of rejecting the routing area update.
if the new sgsn is unable to update the bearer context in one or more p gws, the new sgsn shall deactivate the corresponding bearer contexts as described in clause "sgsn-initiated pdp context deactivation procedure" of ts?23.060?[7]. this shall not cause the sgsn to reject the routing area update.
the new sgsn shall determine the maximum apn restriction based on the received apn restriction of each bearer context in the context response message and then store the new maximum apn restriction value.
the pdp contexts shall be prioritized by the new sgsn. if the new sgsn is unable to support the same number of active pdp contexts as received from the old mme, the prioritisation is used to decide which pdp contexts to maintain active and which ones to delete. in any case, the new sgsn shall first update all pdp contexts in one or more p gws and then deactivate the pdp context(s) that it cannot maintain as described in clause "sgsn-initiated pdp context deactivation procedure" of ts?23.060?[7]. this shall not cause the sgsn to reject the routing area update.
note?9: if the ue was in pmm-connected state the bearer contexts are sent already in the forward relocation request message as described in clause "serving rns relocation procedures" of ts?23.060?[7].
if the routing area update procedure fails a maximum allowable number of times, or if the sgsn returns a routing area update reject (cause) message, the ue shall enter pmm detached state.
5.3.3.4 void

5.3.3.5 void

5.3.3.6 routing area update with mme interaction and with s gw change
the routing area update with s gw change procedure takes place when a ue that is registered with an mme selects a utran or geran cell and the s gw is changed by the procedure. in this case, the ue changes to a routing area that the ue has not yet registered with the network. this procedure is initiated by an ecm-idle state ue and may also be initiated if the ue is in ecm-connected state. this ra update case is illustrated in figure 5.3.3.6-1.
note?1: this procedure covers the mme to 2g or 3g sgsn rau.

figure 5.3.3.6-1: routing area update with mme interaction and with s gw change
note?2: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 8 and 10 concern gtp based s5/s8
1. the ue selects a utran or geran cell. this cell is in a routing area that the ue not yet registered with the network or the ue reselects a utran or geran cell and the tin indicates "guti". the ue in ecm connected state may change to the geran cell through network assisted cell change (nacc).
2a. the ue sends a routing area update request (old rai, old p-tmsi, p-tmsi type, ue core network capability, ms network capability, p tmsi signature, additional p tmsi/rai, ksi, voice domain preference and ue's usage setting) message to the new sgsn. the ue shall set the p-tmsi type to indicate whether the p-tmsi is a native p-tmsi or is mapped from a guti.
 if the ue's tin indicates "guti" and the ue holds a valid guti then the ue indicates the guti as the old p tmsi and old rai. if the ue's tin indicates "p tmsi" or "rat related tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as old p tmsi and old rai. mapping a guti to a p tmsi and an rai is specified in ts?23.003?[9].
 if the ue holds a valid p tmsi and related rai and the old p-tmsi and old rai indicate a p-tmsi/rai mapped from a guti, then the ue indicates these parameters as additional p tmsi/rai.
 the old p tmsi is indicated in the rau request message for iu mode only. for gb mode the tlli is derived from the value that is determined as the old p tmsi according to the rules above. the routing parameter that is signalled in the rrc signalling to the rnc for routing to the sgsn is derived from the identifier that is signalled as the old p tmsi according to the rules above. for a combined mme/sgsn the ran is configured to route the nri(s) of this combined node to the same combined node. the ran is also configured to route nri(s) of p tmsis that are generated by the ue's mapping of the gutis allocated by the combined node. such a ran configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.
 if the ue has a follow-on request, i.e. if there is pending uplink traffic (signalling or data), the 3g-sgsn may use, as an implementation option, the follow-on request indication to release or keep the iu connection after the completion of the ra update procedure.
 ksi is mapped from an eksi identifying a kasme if the ue indicates a p tmsi mapped from guti in the information element "old p tmsi". ksi identifies a (ck, ik) pair if the ue indicates a p tmsi in the information element "old p tmsi".
 the ue sets the voice domain preference and ue's usage setting according to its configuration, as described in clause?4.3.5.9.
2b. the rnc shall add the routing area identity, csg access mode, csg id before forwarding the message to the sgsn. this ra identity corresponds to the rai in the mm system information sent by the rnc to the ue. the bss shall add the cell global identity (cgi) of the cell where the ue is located before passing the message to the new sgsn. csg id is provided by ran if the ue sends the rau request message via a csg cell or a hybrid cell. csg access mode is provided if the ue sends the rau request message via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the sgsn shall consider the cell as a csg cell. for sipto at the local network the with stand-alone gw architecture the rnc includes the local home network id in the initial ue message and in direct transfer message if the target cell is in a local home network.
3. the new s4?sgsn determines the type of the old node, i.e. mme or sgsn, as specified in clause?4.3.19, uses the old rai received from the ue to derive the old mme address, and the new s4 sgsn sends a context request (p tmsi, old rai, new sgsn address, p tmsi signature) message to the old mme to get the context for the ue. to validate the context request the old mme uses a nas token mapped from the p-tmsi signature. if the ue is not known in the old mme, the old mme responds with an appropriate error cause. if integrity check fails in the old mme, the old mme responds with an appropriate error cause which should initiate the security functions in the new s4 sgsn. if the security functions authenticate the ue correctly, the new s4 sgsn shall send a context request (imsi, old rai, new sgsn address, ue validated) message to the old mme. ue validated indicates that the new s4 sgsn has authenticated the ue. if the new s4?sgsn indicates that it has authenticated the ue or if the old mme authenticates the ue, the old mme starts a timer.
 if the ue with emergency bearers is not authenticated in the old mme (in a network supporting unauthenticated ues) the old mme continues the procedure with sending a context response and starting the timer also when it cannot validate the context request.
4. the old mme responds with a context response (mm context, eps bearer contexts, serving gw signalling address and teid(s), ms info change reporting action (if available), csg information reporting action (if available), ue time zone and isr supported) message. the mm context contains security related information as well as other parameters (including imsi) as described in clause?5.7.2 (information storage for mme). the pdn gw address and teid(s) (for gtp-based s5/s8) or gre keys (pmip-based s5/s8) for uplink traffic and CP, and the ti(s) is part of the eps bearer context(s). the unused authentication quintets in the mm context may be sent if stored by the mme and if the mme received the unused authentication quintets from the same sgsn previously.
 if the ue receives only emergency bearer services from the old mme and the ue is uiccless, imsi can not be included in the context response. for emergency attached ues, if the imsi cannot be authenticated, then the imsi shall be marked as unauthenticated. also, in this case, security parameters are included only if available. isr supported is indicated if the old mme and associated serving gw are capable to activate isr for the ue.
 the new sgsn shall ignore the ue core network capability in the mm context of the context response only when it has previously received an ue core network capability in the routing area request. if ue is not known in the old mme, the old mme responds with a appropriate error cause.
 the new sgsn maps the eps bearers to pdp contexts 1-to-1 and maps the eps bearer qos parameter values of an eps bearer to the release?99 qos parameter values of a bearer context as defined in annex e. the pdp context(s) are established in the indicated order. the sgsn deactivates the pdp contexts which cannot be established.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw, the old mme shall include the local home network id of the old cell in the eps bearer context corresponding to the sipto at the local network pdn connection.
 if the ue uses power saving functions and the dl data buffer expiration time for the ue has not expired (see high latency communication in clause?4.3.17.7), the old mme indicates buffered dl data waiting in the context response. when this is indicated, the new sgsn shall invoke data forwarding (corresponding to clause?5.3.3.1a) and setup the UP in conjunction to the rau procedure for delivery of the buffered dl data to the ue.
 for ue using ciot eps optimisation without any activated pdn connection, there is no eps bearer context(s) included in the context response message.
 the old mme only transfers the eps bearer context(s) that the new sgsn supports. if not supported, eps bearer context(s) of non-ip pdn connection are not transferred to the new sgsn. if the eps bearer context(s) of a pdn connection has not been transferred, the old mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
5. security functions may be executed. procedures are defined in clause?5.3.10 on "security function".
 for ongoing emergency services only, if the new sgsn is configured to support emergency bearer services in limited service state, it may skip the authentication procedure or proceed even if authentication fails. if the new sgsn does not support emergency bearer services in limited service state, then it rejects the rau request with an appropriate reject cause.
6. if the new sgsn identifies that the rat type has changed, the sgsn checks the subscription information to identify for each apn whether to maintain the pdn connection, disconnect the pdn connection with a reactivation request or disconnect pdn connection without reactivation request. if the sgsn decides to deactive a pdn connection it performs sgsn-initiated pdn connection deactivation procedure after tracking area procedure is completed. existing sm cause values as specified in ts?24.008?[47] (e.g. #39, "reactivation requested"; #66 "requested apn not supported in current rat and plmn combination"; and for a dedicated bearer, possibly #37 "qos not accepted") are used to cause predictable ue behaviour.
 the new sgsn determines to relocate the serving gw. the serving gw is relocated when the old serving gw cannot continue to serve the ue. the new sgsn may also decide to relocate the serving gw if a new serving gw is expected to serve the ue longer and/or with a more optimal ue to pdn gw path, or if a new serving gw can be co-located with the pdn gw. selection of a new serving gw is performed according to clause?4.3.8.2 on "serving gw selection function".
 the new sgsn sends a context acknowledge (serving gw change indication) message to the old mme. serving gw change indication indicates a new serving gw has been selected. the old mme marks in its context that the information in the gws is invalid. this ensures that the old mme updates the gws if the ue initiates a tau procedure back to the old mme before completing the ongoing rau procedure.
note?3: updating the gws refers to deletion of session(s) on the serving gw followed by re-creation of session(s) on the serving gw. the re-creation of session(s) on the serving gw will result in successful re-establishment of the s5/s8 tunnel between the selected serving gw and the pdn gw.
 the old mme deletes all bearer resources of the ue when the timer started in step?3 expires.
 if the security functions do not authenticate the ue correctly, then the rau is rejected, and the new s4?sgsn sends a reject indication to the old mme. the mme shall continue as if the identification and context request was never received.
 for ue using ciot eps optimisation without any activated pdn connection, the steps 7, 8, 9, 10, 11, 16 and 17 are skipped.
7. in this procedure flow the serving gw is relocated. the sgsn sends a create session request (imsi, bearer contexts, sgsn address and teid for the CP, rat type, type, the protocol type over s5/s8, serving network, ue time zone, etc) message per pdn connection to the selected new serving gw. the pdn gw address is indicated in the bearer contexts. type indicates to the serving gw to send the modify bearer request to the pdn gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface. rat type indicates a change in radio access. as it is a mobility from e-utran, if the target sgsn supports location information change reporting, the target sgsn shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information, the sgsn also includes the user csg information ie in this message.
8. the new serving gw sends the message modify bearer request (serving gw address, serving gw teid, rat type, serving network) per pdn connection to the pdn gw concerned. user location information ie and/or ue time zone ie and/or user csg information ie are also included if they are present in step?7.
9. if dynamic pcc is deployed, and rat type information or ue location information or ue time zone needs to be conveyed from the pdn gw to the pcrf, then the pdn gw shall send this information to the pcrf by means of an ip-can session modification procedure as defined in ts?23.203?[6].
note?4: the pdn gw does not need to wait for the pcrf response, but continues in the next step. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure.
10. the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. if location information change reporting is required and supported in the target sgsn, the pdn gw shall provide ms info change reporting action in the modify bearer response.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path. if the source serving gw has no downlink UP established, the serving gw shall discard the "end marker" received from the pdn gw and shall not send downlink data notification. otherwise the serving gw shall forward the "end marker" packets to the source enodeb.
11. the new serving gw updates its bearer context. this allows the serving gw to route bearer pdus to the pdn gw when received from rnc. the new serving gw returns a create session response (serving gw address and teid, pdn gw address and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8, ms info change reporting action) at the pdn gw(s) for uplink traffic) message to the sgsn.
 when the sgsn receives the create session response message, the sgsn checks if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the sgsn and in such a case sends an event notification (see ts?23.682?[74] for further information).
12. the new sgsn verifies whether it holds subscription data for the ue identified by the p tmsi, the additional p tmsi/rai or by the imsi received with the context data from the old cn node.
 the additional p-tmsi/rai allows the new sgsn to find any already existing ue context stored in the new sgsn. if there are no subscription data in the new sgsn for this ue, or for some network sharing scenario (e.g. gwcn) if the plmn-id of the rai supplied by the rnc is different from that of the rai in the ue's context, then the new sgsn informs the hss of the change of sgsn by sending an update location (sgsn number, sgsn address, imsi, homogenous support of ims voice over ps session, ue srvcc capability, equivalent plmn list) message to the hss. for "homogenous support of ims voice over ps sessions", see clause?5.3.8a of ts?23.060?[7]. the inclusion of the equivalent plmn list indicates that the sgsn supports the inter-plmn handover to a csg cell in an equivalent plmn using the subscription information of the target plmn.
 if the ue initiates the rau procedure in a vplmn supporting autonomous csg roaming and the hplmn has enabled autonomous csg roaming in the vplmn (via service level agreement) and the sgsn needs to retrieve the csg subscription information of the ue from the css, the sgsn initiates the update csg location procedure with css as described in clause?5.3.12.
13. the hss sends a cancel location (imsi, cancellation type) message to the old sgsn with the cancellation type set to update procedure.
 when receiving the cancel location message the old sgsn removes all the ue contexts. the old sgsn acknowledges with a cancel location ack (imsi) message.
14. when receiving the context acknowledge message from the new s4 sgsn and if the old mme has an s1-mme association for the ue, the source mme sends a s1-u release command to the source enodeb after the timer started in step3 has expired. the rrc connection is released by the source enodeb. the source enodeb confirms the release of the rrc connection and of the s1-u connection by sending a s1-u release complete message to the source mme.
15. the hss acknowledges the update location message by sending an update location ack (imsi, subscription data) to the new sgsn. if the update location is rejected by the hss, the new sgsn rejects the rau request from the ue with an appropriate cause. in such cases, the sgsn releases any local sgsn eps bearer contexts for this particular ue, and additionally deletes the eps bearer resources in the new serving gw by sending the delete session request (cause, operation indication) messages to the new serving gw. the operation indication flag shall not be set. therefore, the new serving gw receiving this request shall not initiate a delete procedure towards the pdn gw.
 the new sgsn validates the ue's presence in the (new) ra. if due to regional subscription restrictions or access restrictions (e.g. csg restrictions) the ue is not allowed to be attached in the ra, the sgsn rejects the routing area update request with an appropriate cause to the ue and notifies the hss of the rejection. the subscription data may contain the csg subscription data for the registered plmn and for the equivalent plmn list requested by sgsn in step?12.
 if the ue initiates the rau procedure at a csg cell, the new s4 sgsn shall check whether the csg id and associated plmn is contained in the csg subscription and is not expired. if the csg id and associated plmn is not present or expired, the s4 sgsn shall send a rau reject message to the ue with an appropriate cause value. the ue shall remove the csg id and associated plmn from its allowed csg list if present.
16. when the timer started in step?3 expires and the old mme received the serving gw change indication in the context acknowledge message, the old mme deletes the eps bearer resources by sending delete session request (cause, operation indication) messages to the old serving gw. the operation indication flag is not set, that indicates to the old serving gw that the old serving gw shall not initiate a delete procedure towards the pdn gw. if isr is activated the cause indicates to the old s gw that the old s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
17. the old serving gw acknowledges with delete session response (cause) messages. the old serving gw discards any packets buffered for the ue.
18. if due to regional subscription restrictions or access restrictions the ue is not allowed to access the ra:
- for ues with ongoing emergency bearer services, the new sgsn accept the routing area update request and deactivates the non-emergency pdp contexts as specified in clause?9.2.4.2 of ts?23.060?[7]. if the routing area update procedure is initiated in pmm-idle/standby state, all non-emergency pdp contexts are deactivated by the routing area update procedure without pdp context deactivation signalling between the ue and the sgsn.
- for all other cases, the new sgsn rejects routing area update request with an appropriate cause to the ue and notifies the hss of rejection (details of this notification is specified in stage?3).
 the new sgsn responds to the ue with a routing area update accept (p-tmsi, p-tmsi signature, emergency service support indicator, pdp context status) message. the emergency service support indicator informs the ue that emergency bearer services are supported over utran.
 for an s gw change isr activated is never indicated by the sgsn to the ue as it needs a tau with the same s gw first to activate isr. for an sgsn change isr is not activated by the new sgsn to avoid context transfer procedures with two old cn nodes.
 when receiving the rau accept message, as there is no isr activated indication, the ue shall set its tin to "p tmsi".
 in iu mode, if after step?7 the new sgsn receives a downlink data notification message or any other downlink signalling message while the ue is still connected, the new sgsn may prolong the ps signalling connection with the ue.
 if there is dl data buffered for a ue using power saving functions (i.e. the dl data buffer expiration time in the mm context for the ue in the sgsn has not expired), the UP setup is performed in conjunction with the rau accept message.
 if the rau procedure is initiated by manual csg selection and occurs via a csg cell, the ue upon receiving the rau accept message shall add the csg id and associated plmn to its allowed csg list if it is not already present. manual csg selection is not supported if the ue has emergency bearers established.
 with the pdp context status information, the ue shall deactivate all those bearers contexts locally which are active in the ue, but are indicated by the sgsn as being inactive.
 if the UP setup is performed in conjunction with the rau accept message and the rau is performed via a hybrid cell, then the sgsn shall send an indication whether the ue is a csg member to the ran along with the ranap message. based on this information the ran may perform differentiated treatment for csg and non-csg members.
note?5: if the ue receives a rau accept message via a hybrid cell, the ue does not add the corresponding csg id and associated plmn to its allowed csg list. adding a csg id and associated plmn to the ue's local allowed csg list for a hybrid cell is performed only by ota or oma dm procedures.
note?6: when isr activated is indicated and the ue's tin indicates "p tmsi" the tin is not changed. when isr activated is indicated and the ue's tin indicates "guti" or "rat related tmsi" the ue shall set its tin to "rat related tmsi".
19. if the p-tmsi was included in the rau accept message, the ue acknowledges the new p-tmsi by returning a routing area update complete message to the sgsn.
20. for iu-mode, if the ue has uplink data or signalling pending it shall send a service request (p-tmsi, cksn, service type) message to the new sgsn. if a p-tmsi was allocated in step 18, that p-tmsi is the one included in this message. service type specifies the requested service. service type shall indicate one of the following: data or signalling.
21. if the ue has sent the service request, the new 3g sgsn requests the rnc to establish a radio access bearer by sending a rab assignment request (rab id(s), qos profile(s), gtp snds, gtp snus, pdcp snus) message to the rnc. if direct tunnel is established the sgsn provides to the rnc the serving gw's address for UP and teid for uplink data.
22. if the sgsn established direct tunnel in step 21) it shall send modify bearer request to the serving gw and include the rnc's address for UP and downlink teid for data. the serving gw updates the address for UP and teid for downlink data and return a modify bearer response.
note?7: eps does not support any camel procedures.
in the case of a rejected routing area update operation, due to regional subscription, roaming restrictions, access restrictions (see ts?23.221?[27] and ts?23.008?[28]) or because the sgsn cannot determine the hlr address to establish the locating updating dialogue, the new sgsn should not construct an mm context. in the case of receiving the subscriber data from hlr, the new sgsn may construct an mm context and store the subscriber data for the ue to optimise signalling between the sgsn and the hss. a reject shall be returned to the ue with an appropriate cause and the ps signalling connection shall be released. upon return to idle, the ue shall act according to ts?23.122?[10].
if the new sgsn is unable to update the bearer context in one or more p gws, the new sgsn shall deactivate the corresponding bearer contexts as described in clause "sgsn-initiated pdp context deactivation procedure" of ts?23.060?[7]. this shall not cause the sgsn to reject the routing area update.
the new sgsn shall determine the maximum apn restriction based on the received apn restriction of each bearer context in the context response message and then store the new maximum apn restriction value.
the pdp contexts shall be prioritized by the new sgsn. if the new sgsn is unable to support the same number of active pdp contexts as received from old mme, the prioritisation is used to decide which pdp contexts to maintain active and which ones to delete. in any case, the new sgsn shall first update all pdp contexts in one or more p gws and then deactivate the pdp context(s) that it cannot maintain as described in clause "sgsn-initiated pdp context deactivation procedure" of ts?23.060?[7]. this shall not cause the sgsn to reject the routing area update.
if the routing area update procedure fails a maximum allowable number of times, or if the sgsn returns a routing area update reject (cause) message, the ms shall enter idle state.
5.3.4 service request procedures
5.3.4.1 ue triggered service request

figure 5.3.4.1-1: ue triggered service request procedure
the service request procedure in this clause?is triggered by the ue in ecm-idle status to establish UP radio bearers for the ue.
the ue in ecm-idle state can also use this procedure to establish UP radio bearers even if the ue applies CP ciot eps optimisation, when the ue and mme supports s1-u data transfer or UP eps optimisation in addition to CP ciot eps optimisation.
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?9 and 11 concern gtp-based s5/s8.
1. the ue sends nas message service request towards the mme encapsulated in an rrc message to the enodeb. the rrc message(s) that can be used to carry the s-tmsi and this nas message are described in ts?36.300?[5].
2. the enodeb forwards nas message to mme. nas message is encapsulated in an s1-ap: initial ue message (nas message, tai+ecgi of the serving cell, s-tmsi, csg id, csg access mode, rrc establishment cause). details of this step are described in ts?36.300?[5]. if the mme can't handle the service request it will reject it. csg id is provided if the ue sends the service request message via a csg cell or a hybrid cell. csg access mode is provided if the ue sends the service request message via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the mme shall consider the cell as a csg cell.
 if a csg id is indicated and csg access mode is not provided, and there is no subscription data for this csg id and associated plmn or the csg subscription is expired, the mme rejects the service request with an appropriate cause. the ue shall remove the csg id and associated plmn of the cell where the ue has initiated the service request procedure from the allowed csg list, if present.
 for ues with emergency eps bearers, i.e. at least one eps bearer has an arp value reserved for emergency services, if csg access restrictions do not allow the ue to get normal services the mme shall deactivate all non-emergency bearers and accept the service request.
 if lipa is active for a pdn connection and if the cell accessed by the ue does not link to the l-gw where the ue inititiated the lipa pdn connection, the mme shall not request the establishment of the bearers of the lipa pdn connection from the enodeb in step?4 and shall request disconnection of the lipa pdn connection according to clause?5.10.3. if the ue has no other pdn connection then the mme shall reject the service request with an appropriate cause value resulting in the ue detaching, skip the following steps of the procedure and initiate the release of the core network resources with the implicit mme-initiated detach procedure according to clause?5.3.8.3.
 if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the mme, the mme sends an event notification (see ts?23.682?[74] for further information).
 to assist location services, the enb indicates the ue's coverage level to the mme.
3. nas authentication/security procedures as defined in clause?5.3.10 on "security function" may be performed.
4. if there is a service gap timer running in the mme mm context for the ue and the mme is not waiting for a mt paging response from the ue, the mme rejects the service request with an appropriate cause. in addition, mme may also provide a ue with a mobility management back-off timer set to the remaining value of the service gap timer.
 the mme deletes s11-u related information in ue context if there is any, including teid(dl) for the s11-u for CP ciot eps optimisation if data buffering is in the mme, rohc context for CP ciot eps optimisation, etc, but not the header compression configuration. the mme sends s1-ap initial context setup request (serving gw address, s1-teid(s) (ul), eps bearer qos(s), security context, mme signalling connection id, handover restriction list, csg membership indication) message to the enodeb. if there is a pdn connection established for local ip access, this message includes a correlation id for enabling the direct UP path between the henb and the l-gw. if there is a pdn connection established for sipto at the local network with l-gw function collocated with the (h)enb, this message includes a sipto correlation id for enabling the direct UP path between the (h)enb and the l gw. this step activates the radio and s1 bearers for all the active eps bearers. the enodeb stores the security context, mme signalling connection id, eps bearer qos(s) and s1-teid(s) in the ue ran context. the step is described in detail in ts?36.300?[5]. handover restriction list is described in clause 4.3.5.7 "mobility restrictions".
note?2: in this release of the 3gpp specification the correlation id and sipto correlation id is set equal to the UP pdn gw teid (gtp-based s5) or gre key (pmip-based s5) which is specified in clause?5.3.2.1 and clause?5.10.2.
 if the ue included support for restriction of use of enhanced coverage, the mme sends enhanced coverage restricted parameter to the enb in the s1-ap message.
 the mme shall only request to establish emergency eps bearer if the ue is not allowed to access the cell where the ue initiated the service request procedure due to csg access restriction.
 if the service request is performed via a hybrid cell, csg membership indication indicating whether the ue is a csg member shall be included in the s1-ap message from the mme to the ran. based on this information the ran can perform differentiated treatment for csg and non-csg members.
5. the enodeb performs the radio bearer establishment procedure. the UP security is established at this step, which is described in detail in ts?36.300?[5]. when the UP radio bearers are setup. eps bearer state synchronization is performed between the ue and the network, i.e. the ue shall locally remove any eps bearer for which no radio bearers are setup and, if the radio bearer for a default eps bearer is not established, the ue shall locally deactivate all eps bearers associated to that default eps bearer.
6. the uplink data from the ue can now be forwarded by enodeb to the serving gw. the enodeb sends the uplink data to the serving gw address and teid provided in the step 4. the serving gw forwards the uplink data to the pdn?gw.
7. the enodeb sends an s1-ap message initial context setup complete (enodeb address, list of accepted eps bearers, list of rejected eps bearers, s1 teid(s) (dl)) to the mme. this step is described in detail in ts?36.300?[5]. if the correlation id or sipto correlation id is included in step?4, the enodeb shall use the included information to establish a direct UP path to the l-gw and forward uplink data for local ip access or sipto at the local network with l-gw function collocated with the (h)enb accordingly.
8. the mme sends a modify bearer request message (enodeb address, s1 teid(s) (dl) for the accepted eps bearers, delay downlink packet notification request, rat type, mo exception data counter) per pdn connection to the serving gw. if the serving gw supports modify access bearers request procedure and if there is no need for the serving gw to send the signalling to the pdn gw, the mme may send modify access bearers request (enodeb address(es) and teids for downlink UP for the accepted eps bearers, delay downlink packet notification request) per ue to the serving gw to optimise the signalling. the serving gw is now able to transmit downlink data towards the ue. the usage of the delay downlink packet notification request information element is specified in clause 5.3.4.2 below. if the pdn gw requested ue's location and/or user csg information and the ue's location and/or user csg information has changed, the mme also includes the user location information ie and/or user csg information ie in this message. if isr is activated or if the serving network ie has changed compared to the last reported serving network ie then the mme also includes the serving network ie in this message. if the ue time zone has changed compared to the last reported ue time zone then the mme shall include the ue time zone ie in this message. if the internal flag pending network initiated pdn connection signalling is set, the mme indicates ue available for end to end signalling in the modify bearer request message and reset the flag.
 the mme only includes the mo exception data counter if the rrc establishment cause is set to "mo exception data" and the ue is accessing via the nb-iot rat. the mme maintains the mo exception data counter for serving plmn rate control purposes (see clause?4.7.7.2). the mme may immediately send the mo exception data counter to the serving gw. alternatively, in order to reduce signalling, the mme may send the mo exception data counter to the serving gw as described in ts?29.274?[43].
 the mme and the serving gw clears the dl data buffer expiration time in their ue contexts if it was set, to remember that any dl data buffered for a ue using power saving functions has been delivered and to avoid any unnecessary UP setup in conjunction with a later tau.
 if a default eps bearer is not accepted by the enodeb, all the eps bearers associated to that default bearer shall be treated as non-accepted bearers. the mme releases the non-accepted bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
9. if the rat type has changed compared to the last reported rat type or if the ue's location and/or info ies and/or ue time zone and/or if isr is not activated and serving network id and/or the indication ue available for end to end signalling are present in step?8, the serving gw shall send the modify bearer request message (rat type, mo exception data counter) per pdn connection to the pdn gw. user location information ie and/or user csg information ie and/or serving network ie and/or ue time zone and/or the indication ue available for end to end signalling are also included if they are present in step?8.
 if the modify bearer request message is not sent because of above reasons and the pdn gw charging is paused, then the sgw shall send a modify bearer request message with pdn charging pause stop indication to inform the pdn gw that the charging is no longer paused. other ies are not included in this message.
 if the modify bearer request message is not sent because of above reasons but the mme indicated the mo exception data counter, then the SGW should notify the pdn gw that this rrc establishment cause has been used by the mo exception data counter (see ts?29.274?[43]). the serving gw indicates each use of this rrc establishment cause by the related counter on its cdr.
10. if dynamic pcc is deployed, the pdn gw interacts with the pcrf to get the pcc rule(s) according to the rat type by means of a pcef initiated ip can session modification procedure as defined in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw may apply local qos policy.
 the pdn gw indicates each use of the rrc establishment cause "mo exception data" by the related counter on its cdr.
11. the pdn gw sends the modify bearer response to the serving gw.
12. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling other than to unpause charging in the pdn gw or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using a modify bearer request message per pdn connection.
 if sipto at the local network is active for a pdn connection with stand-alone gw deployment and the local home network id for stand-alone accessed by the ue differs from the local home network id where the ue initiated the sipto@ln pdn connection, the mme shall request disconnection of the sipto at the local network pdn connection(s) with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiated "explicit detach with reattach required" procedure according to clause?5.3.8.3.
 if sipto at the local network is active for a pdn connection with collocated lgw deployement and the l-gw cn address of the cell accessed by the ue differs from the l-gw cn address of the cell where the ue initiated the sipto at the local network pdn connection, the mme shall request disconnection of the sipto at the local network pdn connection(s) with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiated "explicit detach with reattach required" procedure according to clause?5.3.8.3.
5.3.4.2 handling of abnormal conditions in ue triggered service request
under certain conditions, the current ue triggered service request procedure can cause unnecessary downlink packet notification messages which increase the load of the mme.
this can occur when uplink data sent in step 6 causes a response on the downlink which arrives at the serving gw before the modify bearer request message, step 8. this data cannot be forwarded from the serving gw to the enodeb and hence it triggers a downlink data notification message.
if the mme receives a downlink data notification after step 2 and before step 9, the mme shall not send s1 interface paging messages. however, across all the ues on that mme, the mme shall monitor the rate at which these events occur. if the rate becomes significant (as configured by the operator) and the mme's load exceeds an operator configured value, the mme shall indicate "delay downlink packet notification request" with parameter d to the SGW, where d is the requested delay given as an integer multiple of 50?ms, or zero. the serving gw then uses this delay in between receiving downlink data and sending the downlink data notification message.
note?1: a low rate of reception of downlink data notifications between steps 2 and 9 should be considered a normal circumstance, e.g. due to the chance that a ue terminating call/session is initiated at roughly the same time as the ue triggered service request procedure.
note?2: it is recommended that this rate is determined over 60?second periods.
the mme shall use the step 8 modify access bearers request or modify bearer request of the ue initiated service request procedure to indicate "delay downlink packet notification request" to the serving gw.
to determine the amount of delay requested by a given mme, the serving gw either uses the last modify access bearers request or modify bearer request message which is part of a service request procedure, or, just uses one of the service request procedure's modify access bearers request or modify bearer request messages received within the preceding 30?seconds. the latter mode of operation shall be taken into account when implementing the mme.
the mme is responsible for setting the value of d. the exact algorithm for setting the value is implementation dependent, two examples are given below to serve as a guideline:
example 1: the mme adaptively increases the value of d when the rate of unnecessary downlink data notifications is too high; and correspondingly it decreases the value when the rate is not too high.
example 2: when unnecessary downlink data notifications arrive, the mme measures the average time from the reception of the unnecessary downlink data notification to the reception of the modify access bearers request or modify bearer response from the serving gw in the same ue triggered service request procedure. the value of d is calculated from this average, by adding a safety margin.
normally, upon receipt of a downlink data packet for which there is no dl-teid of the s1 UP tunnel, the s gw shall send the downlink data notification message to the mme without delay.
if the s gw determines from the last modify access bearers request or modify bearer request message which is part of a service request procedure that a given mme request delaying of the downlink packet notification by a delay of d, it shall (only for ues of that mme) buffer the downlink data for a period d. if the dl-teid and enodeb address for the ue is received before the expiry of the timer, the timer shall be cancelled and the network triggered service request procedure is finished without sending the downlink data notification message to the mme, i.e. dl data are sent to the ue. otherwise the downlink data notification message is sent to the mme when the timer expires.
note?3: the above procedure and indicated time values are intended to ensure that the procedure is "stable"; avoids ran impacts; and, that the negative impacts of shortening the drx interval on ue battery life are avoided.
5.3.4.3 network triggered service request

figure 5.3.4.3-1: network triggered service request procedure
if the mme needs to signal with the ue that is in ecm-idle state, e.g. to perform the mme/hss-initiated detach procedure for the ecm-idle mode ue or the s gw receives control signalling (e.g. create bearer request or update bearer request), the mme starts network triggered service request procedure from step 3a in the network triggered service request procedure.
if the mme wishes to use the CP ciot eps optimisation for mobile terminating services, then the procedure of clause?5.3.4b.3 is used to replace the procedure of this clause.
if isr is activated, when the serving gw receives a create bearer request or update bearer request for a ue, and the s gw does not have a downlink s1-u and the sgsn has notified the serving gw that the ue has moved to pmm-idle or standby state, the serving gw buffers signalling messages and sends a downlink data notification to trigger the mme and sgsn to page the ue. if the serving gw, while waiting for the UP to be established, is triggered to send a second downlink data notification with higher priority (i.e. arp priority level) than the first downlink data notification was sent with, the serving gw sends a new downlink data notification message indicating the higher priority to the mme. if the serving gw receives additional downlink signalling messages for a bearer with same or lower priority than the first downlink data notification was sent for or if the serving gw has sent the second downlink data notification message indicating the higher priority and receives additional downlink signalling messages for this ue, the serving gw buffers these downlink signalling messages and does not send a new downlink data notification. the s gw will be notified about the current rat type based on the ue triggered service request procedure. the s gw will go on executing the dedicated bearer activation or dedicated bearer modification procedure, i.e. send the corresponding buffered signalling to mme or sgsn which ue resides in now and inform the current rat type to the pdn gw if the rat type has been changed compared to the last reported rat type. if dynamic pcc is deployed, the current rat type information shall also be conveyed from the pdn gw to the pcrf. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure as specified in clause?5.4.2.1 below.
when the serving gw sends a downlink data notification, it shall include both eps bearer id and arp. if the downlink data notification is triggered by the arrival of downlink data packets at the serving gw, the serving gw shall include the eps bearer id and arp associated with the bearer on which the downlink data packet was received. if the downlink data notification is triggered by the arrival of control signalling, the serving gw shall include the eps bearer id and arp if present in the control signalling. if the arp is not present in the control signalling, the serving gw shall include the arp in the stored eps bearer context.
if a lipa pdn connection exists, when the l-gw receives the downlink data for a ue that is in ecm-idle state, the l-gw sends the first downlink user packet to serving gw and buffers all other downlink user packets. the serving gw will trigger the mme to page the ue.
1. when the serving gw receives a downlink data packet/control signalling for a ue known as not UP connected (i.e. the s gw context data indicates no downlink UP teid), it buffers the downlink data packet and identifies which mme or sgsn is serving that ue.
 if that mme has requested the serving gw to throttle downlink low priority traffic and if the downlink data packet is received on a low priority bearer to be throttled (see clause?4.3.7.4.1a), the sgw drops the downlink data. the steps below are not executed.
 if that mme has requested the s gw to delay sending the downlink data notification (see clause 5.3.4.2 on "handling of abnormal conditions in ue triggered service request"), the serving gw buffers the downlink data and waits until the timer expires before continuing with step 2. if the dl-teid and enodeb address for that ue is received before the expiry of the timer, the timer shall be cancelled and the network triggered service request procedure is finished without executing the steps below, i.e. dl data are sent to the ue.
 if the serving gw receives additional downlink data packets/control signalling for this ue before the expiry of the timer, the serving gw does not restart this timer.
2. the serving gw sends a downlink data notification message (arp, eps bearer id, paging policy indication) to the mme and sgsn nodes for which it has CP connectivity for the given ue. the arp and eps bearer id are always set in downlink data notification. the mme and sgsn respond to the s gw with a downlink data notification ack message. when supporting paging policy differentiation, the serving gw indicates in the message the paging policy indication related to the downlink data that triggered the downlink data notification message, as described in clause?4.9.
note?1: the arp, the eps bearer id and optionally the paging policy indication are sent to the sgsn as well as mme, but the usage of these parameters at sgsn is not specified in this release of the specification.
 an mme and an sgsn that detects that the ue is in a power saving state (e.g. power saving mode or extended idle mode drx) and cannot be reached by paging at the moment, shall invoke extended buffering depending on operator configuration, except for cases described in next paragraphs. mme/sgsn derives the expected time before radio bearers can be established to the ue. the mme/sgsn then indicates dl buffering requested to the serving gw in the downlink data notification ack message and includes a dl buffering duration time and optionally a dl buffering suggested packet count. the mme/sgsn stores a new value for the dl data buffer expiration time in the mm context for the ue based on the dl buffering duration time and skips the remaining steps of this procedure. the dl data buffer expiration time is used for ues using power saving state and indicates that there are buffered data in the serving gw and that the UP setup procedure is needed when the ue makes signalling with the network. when the dl data buffer expiration time has expired, the mme/sgsn considers no dl data to be buffered and no indications of buffered dl data waiting are sent during context transfers at tau procedures.
 if there is a "availability after ddn failure" monitoring event configured for the ue in the mme/sgsn, the mme/sgsn does not invoke extended buffering. instead, the mme/sgsn sets the notify-on-available-after-ddn-failure flag to remember to send an "availability after ddn failure" notification when the ue becomes available. if there is a "ue reachability" monitoring event configured for the ue in the mme/sgsn, the mme/sgsn should not need to invoke extended buffering.
note?2: when "availability after ddn failure" and "ue reachability" monitoring events are used for a ue, the application server is assumed to send data when the ue is reachable or about to become reachable, hence no extended buffering is needed. if there are multiple application servers, the event notifications and extended buffering may be needed simultaneously. it is assumed this is handled through additional information based on sla as described in the next paragraph.
 the mme/sgsn may use additional information based on a sla with the mtc user for when to invoke extended buffering, e.g. only invoke it for a certain apn, do not invoke it for certain subscribers, invoke extended buffering in conjunction with "availability after ddn failure" and "ue reachability" monitoring events, etc.
 a serving gw that receives a dl buffering requested indication in a downlink data notification ack message stores a new value for the dl data buffer expiration time based on the dl buffering duration time and does not send any additional downlink data notification if subsequent downlink data packets are received in the serving gw before the buffer time dl data buffer expiration time has expired for the ue.
 if the serving gw, while waiting for the UP to be established, is triggered to send a second downlink data notification for a bearer with higher priority (i.e. arp priority level) than the first downlink data notification was sent for, the sgw sends a new downlink data notification message indicating the higher priority to the mme. if the serving gw receives additional downlink data packets for a bearer with same or lower priority than the first downlink data notification was sent for or if the serving gw has sent the second downlink data notification message indicating the higher priority and receives additional downlink data packets for this ue, the serving gw buffers these downlink data packets and does not send a new downlink data notification.
 if the serving gw, while waiting for the UP to be established, receives a modify bearer request message from mme or sgsn other than the one it sent a downlink data notification message to, the serving gw re-sends the downlink data notification message only to the new mme or sgsn from which it received the modify bearer request message even if isr is active.
 if the tracking area update procedure with mme change or the routing area update procedure is in progress when the old mme receives a downlink data notification message, the old mme may reject a downlink data notification message with an indication that the downlink data notification message has been temporarily rejected.
 similarly, if the routing area update procedure with sgsn change or the tracking area update procedure is in progress when the old sgsn receives a downlink data notification message, the old sgsn may reject a downlink data notification message with an indication that the downlink data notification message has been temporarily rejected.
 upon reception of a downlink data notification ack message with an indication that the downlink data notification message has been temporarily rejected and if the downlink data notification is triggered by the arrival of downlink data packets at the serving gw, the serving gw may start a locally configured guard timer and buffers all downlink user packets received to the given ue and waits for a modify bearer request message to come. upon reception of a modify bearer request message, the serving gw re-sends the downlink data notification message only to the new mme or sgsn from which it received the modify bearer request message even if isr is active. otherwise the serving gw releases buffered downlink user packets at expiry of the guard timer or receiving the delete session request message from mme/sgsn.
 upon reception of a downlink data notification ack message with an indication that the downlink data notification message has been temporarily rejected and if the downlink data notification is triggered by the arrival of signalling messages at the serving gw, the serving gw may reject the pdn gw initiated eps bearer(s) request with the same indication that the request has been temporarily rejected. upon reception of a rejection for an eps bearer(s) pdn gw initiated procedure with an indication that the request has been temporarily rejected, the pdn gw may start a locally configured guard timer. the pdn gw may re-attempt, up to a pre-configured number of times, when either it detects the ue accesses via a new sgw or at expiry of the guard timer.
3a. if the ue is registered in the mme and considered reachable for paging, the mme sends a paging message (nas id for paging, tai(s), ue identity based drx index, paging drx length, list of csg ids for paging, paging priority indication, enhanced coverage restricted, ce mode b restricted) to each enodeb belonging to the tracking area(s) in which the ue is registered. the step is described in detail in ts?36.300?[5] and ts?36.413?[36]. steps 3-4 are omitted if the mme already has a signalling connection over s1-mme towards the ue but the s1-u tunnel has not yet been established.
 if extended idle mode drx is enabled for the ue, the mme pages the ue just before the occurrence of the ue's next paging occasion, which is determined as described in ts?23.682?[74].
note?3: steps 3a and 4a are performed also when the ue and the network support UP ciot eps optimisation and the previous rrc connection has been suspended.
 paging priority indication is included only:
- if the mme receives a downlink data notification or create bearer request with an arp priority level associated with mps or other priority services, as configured by the operator.
- one paging priority level can be used for multiple arp priority level values. the mapping of arp priority level values to paging priority level (or levels) is configured by operator policy.
 during a congestion situation the enodeb may prioritise the paging of ues according to the paging priority indications.
 if the mme, while waiting for a ue response to the paging request message sent without paging priority indication, receives an update bearer request, create bearer request or downlink data notification, any of which indicates an arp priority level associated with mps or other priority services, as configured by the operator, the mme shall send another paging message with the suitable paging priority.
 when the mme is configured to support csg paging optimisation in the cn, the mme should avoid sending paging messages to those enodeb(s) with csg cells for which the ue does not have a csg subscription. when the mme is configured to support csg paging optimisation in the henb subsystem, the list of csg ids for paging is included in the paging message. for csg paging optimisation, the csg ids of expired csg subscriptions and valid csg subscriptions are both included in the list. if the ue has emergency bearer service the mme shall not perform the csg paging optimisation.
note?4: an expired csg subscription indicates that the ue is not allowed service in the csg. however, since the removal of the csg from the ue is pending, it is possible the ue will camp on that csg and therefore the ue is still paged for the csg.
note?5: the enodeb reports to the mme the csg id supported. for more detail of this procedure refer to ts?36.413?[36].
 when the mme supports sipto at local network and lipa paging for traffic arriving on the pdn connection with l-gw function collocated with the (h)enb the mme should only page this (h)enb to avoid sending paging messages to enodeb(s) that are not handling this specific pdn connection.
 paging strategies may be configured in the mme for different combinations of apn, paging policy indication from sgw when available (see clause?4.9) and other eps bearer context information e.g. qci. apn and any eps bearer context information are identified by eps bearer id received in downlink data notification. paging strategies may include:
- paging retransmission scheme (e.g. how frequently the paging is repeated or with what time interval);
- determining whether to send the paging message to the enodebs during certain mme high load conditions;
- whether to apply sub-area based paging (e.g. first page in the last known ecgi or ta and retransmission in all registered tas).
 if extended idle mode drx was enabled in the ue, the mme may additionally take into account the paging time window length for paging retransmission schemes.
note?6: the paging priority in the paging message is set based on priority level of the arp ie received in downlink data notification or create/update bearer request message and is independent from any paging strategy.
 the mme and the e-utran may support further paging optimisations in order to reduce the signalling load and the network resources used to successfully page a ue by one or several following means:
- by the mme implementating specific paging strategies (e.g. the s1 paging message is sent to the enb that served the ue last);
- by the mme considering information on recommended cells and enbs provided by the e-utran at transition to ecm idle. the mme takes the enb related part of this information into account to determine the enbs to be paged, and provides the information on recommended cells within the s1 paging message to each of these enbs;
- by the e-utran considering the paging attempt count information provided by the mme at paging.
 when implementing such optimisations/strategies, the mme shall take into account any psm active timer and the drx interval for the ue.
 if the ue radio capability for paging information is available in the mme, the mme adds the ue radio capability for paging information in the s1 paging message to the enb.
 if the information on recommended cells and enbs for paging is available in the mme, the mme shall take that information into account to determine the enbs for paging and, when paging an enb, the mme may transparently convey the information on recommended cells to the enb.
 the mme may include in the s1ap paging message(s) the paging attempt count information. the paging attempt count information shall be the same for all enbs selected by the mme for paging.
 if the mme has information for enhanced coverage stored and enhanced coverage is not restricted then the mme shall include information for enhanced coverage in the paging message for all enbs selected by the mme for paging. for including the enhanced coverage restricted parameter in the paging message, see clause?4.3.28.
 for including the ce mode b restricted parameter in the paging message, see clause?4.3.27a.
3b. if the ue is registered in the sgsn, the sgsn sends paging messages to rnc/bss, which is described in detail in ts?23.060?[7].
4a. if enodebs receive paging messages from the mme, the ue is paged by the enodebs. the step is described in detail in ts?36.300?[5] and ts?36.304?[34].
4b. if rnc/bss nodes receive paging messages from the sgsn the ue is paged by the rnsc/bss, which is described in detail in ts?23.060?[7].
5. when ue is in the ecm-idle state, upon reception of paging indication in e-utran access, the ue initiates the ue triggered service request procedure (clause?5.3.4.1) or, if the ue is enabled to use UP ciot eps optimisation and there is suspended access stratum context stored in the ue, the ue initiates the connection resume procedure (clause?5.3.5a). if the mme already has a signalling connection over s1-mme towards the ue but the s1-u tunnel has not yet been established, then the messages sequence performed start from the step when mme establishes the bearer(s).
 upon reception of paging indication in utran or geran access, the ms shall respond in respective access as specified ts?24.008?[47] and the sgsn shall notify the s gw.
 the mme and/or sgsn supervises the paging procedure with a timer. if the mme and/or sgsn receives no response from the ue to the paging request message, it may repeat the paging according to any applicable paging strategy described in step?2.
 if the mme and/or sgsn receives no response from the ue after this paging repetition procedure, it shall use the downlink data notification reject message to notify the serving gw about the paging failure, if paging was triggered by a downlink data notification message, unless the mme or sgsn is aware of an ongoing mm procedure that prevents the ue from responding, i.e. the mme or sgsn received a context request message indicating that the ue performs tau or rau procedure with another mme or sgsn. if paging was triggered by control signalling from the serving gw and if the mme or sgsn receives no response from the ue after this paging repetition procedure, the mme or sgsn shall reject that control signalling. when a downlink data notification reject message is received, if isr is not activated, the serving gw deletes the buffered packet(s). if isr is activated and the serving gw receives downlink data notification reject message from both sgsn and mme, the serving gw deletes the buffered packet(s) or rejects the control signalling which triggers the service request procedure. the serving gw may invoke the procedure pdn gw pause of charging (clause?5.3.6a) if ue is in ecm idle and the pdn gw has enabled "pdn charging pause" feature.
note?7: the serving gw may initiate the procedure pdn gw pause of charging at any time before step?5 if the ue is in ecm idle and the pdn gw has indicated that the feature is enabled for this pdn. see clause?5.3.6a.
6a. if isr is activated and paging response is received in e utran access the serving gw sends a "stop paging" message to the sgsn.
6b. if isr is activated and paging response is received in utran or geran access the serving gw sends a "stop paging" message to the mme.
the serving gw transmits downlink data towards the ue via the rat which performed the service request procedure.
for a lipa pdn connection, after the ue enters connected mode, the packets buffered in the l-gw are forwarded to the henb on the direct path. if the ue enters connected mode at a different cell than the one where the l-gw is colocated, the mme shall deactivate the lipa pdn connection as defined in clause?5.3.4.1 step?2.
if the network triggered service request fails due to no response from the ue, then mme and/or sgsn may based on operator policy initiate the dedicated bearer deactivation procedure for preserved gbr bearers. for details, see clause?5.4.4.2 for mme and ts?23.060?[7] for sgsn.
5.3.4a connection suspend procedure
this procedure is used by the network to suspend the connection if the ue and the network support UP ciot eps optimisation (see ts?36.300?[5]).

figure 5.3.4a-1: enodeb initiated connection suspend procedure
1. the enodeb initiates the connection suspend procedure to the mme, see ts?36.413?[36]. the enodeb indicates to the mme that the ue's rrc connection is to be suspended upon which mme enters ecm-idle. data related to the s1ap association, ue context and bearer context, necessary to resume the connection is kept in the enb, ue and the mme.
 the enodeb may include the information on recommended cells and enbs for paging in the s1 ue context suspend request message. if available, the mme shall store this information to be used when paging the ue.
 the enb includes information for enhanced coverage, if available, in the s1 ue context suspend request message.
 if the plmn has configured secondary rat reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included.
 if dual connectivity was activated by that enodeb at the time of the connection suspend or earlier by that enodeb, the enodeb shall include the last known pscell id and the time elapsed since the dual connectivity was released.
 if service gap control is being applied to the ue (see clause?4.3.17.9) and the service gap timer is not already running, the service gap timer shall be started in the mme when entering ecm-idle, unless the connection was initiated after a paging of an mt event, or after a tau procedure without any active flag or signalling active flag set.
1a-d. if the enodeb provided secondary rat usage data in step?1 and if pgw secondary rat usage data reporting is active, the mme initiates the secondary rat usage data reporting procedure in clause?5.7a.3 as illustrated in figure 5.7a.3-2.
2. the mme sends a release access bearers request (secondary rat usage data) message to the serving gw that requests the release of all s1-u bearers for the ue. if secondary rat usage data was received in step?1, secondary rat usage data is included in this message. the message indicates that the sgw is the target for the reporting.
3. the serving gw releases all enodeb related information (address and downlink teids) for the ue and responds with a release access bearers response message to the mme. other elements of the ue's serving gw context are not affected. if downlink packets arrive for the ue, the serving gw starts buffering downlink packets received for the ue and initiating the "network triggered service request" procedure, described in clause?5.3.4.3.
note: based on operator policy any received indication of "abnormal release of radio link" may be used by serving gw in subsequent decisions to trigger pdn charging pause if the feature has been enabled on that pdn.
 the serving gw informs the mme in the release access bearer response message about release of s1-u bearers.
4. the mme sends an s1ap: ue context suspend response message to the enb to successfully terminate the connection suspend procedure initiated by the enb, see ts?36.413?[36].
5. the enodeb sends rrc message to suspend the rrc connection towards the ue, see ts?36.300?[5]).
 if service gap control is being applied for the ue (see clause?4.3.17.9) and the service gap timer is not already running, the service gap timer shall be started in the ue when entering ecm-idle, unless the connection was initiated as a response to paging of an mt event, or after a tau procedure without any active flag or signalling active flag set.
5.3.4b data transport in CP ciot eps optimisation
5.3.4b.1 general
if the ue and mme use the CP ciot eps optimisation, they can transfer data in nas pdus including the eps bearer identity of the pdn connection they relate to, for which there is no s1-u bearers established (i.e. when an s1-u bearer is established the ue shall use s1-u to transfer data pdus). both the ip and non ip data types are supported. if the ue and the mme support CP ciot eps optimisation, then for sms transfer and epc mobile originated location request (epc-mo-lr) or epc mobile terminated location request (epc-mt-lr) the service request procedures defined in clause?5.3.4 are not used for mo and mt sms or for epc-mo-lr and epc-mt-lr, but instead ue and mme shall be using the data transport in CP ciot eps optimisation.
this is accomplished by using the nas transport capabilities of rrc and s1-ap protocols and the data transport of gtp-u tunnels between mme and s-gw and between s-gw and p-gw, or if a non-ip connection is provided by via the mme with the scef, then data transfer occurs as indicated in ts?23.682?[74].
for ip data, the ue and mme may perform header compression based on rohc framework ietf?rfc?5795?[77]. for uplink ip data, ue implements rohc compressor, and mme implements the decompressor. for downlink ip data, mme implements the rohc compressor, and ue implements the decompressor. the uplink and downlink rohc channels are bound by ue and mme to support feedback. the configurations for the header compression are established during the pdn connection establishment procedure.
to minimise potential conflicts between nas signalling pdus and nas data pdus, the mme should complete any security related procedures (e.g. authetication, security mode command, guti reallocation) before alerting the hss, msc or sgw of the ue's entry into ecm-connected state, and before commencing downlink transfer of nas data pdus. the priority handling between the emm/esm nas signalling pdus and nas data pdus is specified in ts?24.301?[46].
5.3.4b.2 mobile originated data transport in CP ciot eps optimisation with p-gw connectivity

figure 5.3.4b.2-1: mo data transport in nas pdu
0. the ue is ecm-idle.
1. the ue establishes a rrc connection or sends the rrcearlydatarequest message as defined in ts?36.300?[5] and sends as part of it an integrity protected nas pdu. the nas pdu carries the eps bearer id and encrypted uplink data. for ip pdn type pdn connections configured to support header compression, the ue shall apply header compression before encapsulating data into the nas message. the ue may also indicate in a nas release assistance information in the nas pdu whether no further uplink or downlink data transmissions are expected, or only a single downlink data transmission (e.g. acknowledgement or response to uplink data) subsequent to this uplink data transmission is expected.
1b. in the nb-iot case, the enb, based on configuration, may retrieve the eps negotiated qos profile from the mme, if not previously retrieved. the mme code within the s-tmsi in the rrcconnectionrequest message is used to identify the mme. in the case of network sharing, the mme codes shall be unique within the area of overlapping mme pools of the participating operators. the enb may apply prioritisation between requests from different ues before triggering step?2 and throughout the rrc connection. the enb may retrieve additional parameters (e.g., ue radio capabilities - see ts?36.413?[36]).
2. the nas pdu sent in step?1 is relayed to the mme by the enodeb using a s1-ap initial ue message. if the rrcearlydatarequest message was received in step?1, the enb includes the "edt session" indication in the s1-ap initial ue message.
 to assist location services, the enb indicates the ue's coverage level to the mme.
 if the nas release assistance information is received from the ue it overrides the traffic profile (see ts?23.682?[74]) and the mme does not send the traffic profile to the enb.
3. if there is a service gap timer running in the mme mm context for the ue and the mme is not waiting for a mt paging response from the ue, the mme rejects the request by discarding the nas data pdu and sending a service reject message to the ue with an appropriate cause. the mme may also provide ue with a mobility management back-off timer set to the remaining value of service gap timer, followed by executing step?15.
 the mme checks the integrity of the incoming nas pdu and decrypts the data it contains. when the rohc is configured to be used, the mme shall decompress the ip header if header compression applies to the pdn connection.
 the mme performs (and the ue responds to) any emm or esm procedures if necessary, e.g. the security related procedures. steps 4 to 9 can continue in parallel to this, however, steps 10 and 11 shall await completion of all the emm and esm procedures.
4a. if the s11-u connection is not established, the mme sends a modify bearer request message (mme address, mme teid dl, delay downlink packet notification request, rat type, lte-m rat type reporting to pgw flag, mo exception data counter) for each pdn connection to the serving gw. the serving gw is now able to transmit downlink data towards the ue. the usage of the delay downlink packet notification request information element is specified in clause?5.3.4.2 with reference to the ue initiated service request procedure, but it equally applies in this case. the mme shall indicate s11-u tunnelling of nas user data and send its own s11-u ip address and mme dl teid for dl data forwarding by the sgw. also, regardless of whether the s11-u was already established:
- if the pdn gw requested ue's location and/or user csg information and the ue's location and/or user csg information has changed, the mme shall send the modify bearer request message and also includes the user location information ie and/or user csg information ie in this message.
- if the serving network ie has changed compared to the last reported serving network ie then the mme shall send the modify bearer request message and also includes the serving network ie in this message.
- if the ue time zone has changed compared to the last reported ue time zone then the mme shall send the modify bearer request message and include the ue time zone ie in this message.
 if the rat type currently used is nb-iot this shall be reported as different from other e-utra flavours.
 if the ue is using the lte-m rat type and the pdn gw expects the lte-m rat type reporting as specified in clause?5.11.5, the mme also includes the lte-m rat type reporting to pgw flag to indicate to the serving gw to forward the lte-m rat type to the pdn gw.
 the mme only includes mo exception data counter if the rrc establishment cause is set to "mo exception data" and the ue is accessing via the nb-iot rat. the serving gw indicates each use of this rrc establishment cause by the related counter on its cdr. the mme maintains the mo exception data counter for serving plmn rate control purposes (see clause?4.7.7.2). the mme may immediately send the mo exception data counter to the serving gw. alternatively, in order to reduce signalling, the mme may send the mo exception data counter to the serving gw as indicated in ts?29.274?[43].
4b if the s11-u connection is established and the ue is accessing via the nb-iot rat with the rrc establishment cause set to "mo exception data", the mme should notify the SGW. the mme maintains the mo exception data counter for serving plmn rate control purposes (see clause?4.7.7.2). the mme may immediately send the mo exception data counter to the serving gw. alternatively, in order to reduce signalling, the mme may send the mo exception data counter to the serving gw as indicated in ts?29.274?[43].
5. if the rat type has changed compared to the last reported rat type or if the ue's location and/or info ies and/or ue time zone and serving network id are present in step?4, the serving gw shall send the modify bearer request message (rat type, mo exception data counter) to the pdn gw. user location information ie and/or user csg information ie and/or serving network ie and/or ue time zone are also included if they are present in step?4.
 if lte-m rat type and the lte-m rat type reporting to pgw flag were received at step?4a, the serving gw shall include the lte-m rat type in the modify bearer request message to the pgw. otherwise the serving gw includes rat type wb-e-utran.
 if the modify bearer request message is not sent because of above reasons and the pdn gw charging is paused, then the sgws-gw shall send a modify bearer request message with pdn charging pause stop indication to inform the pdn gw that the charging is no longer paused. other ies are not included in this message.
 if the modify bearer request message is not sent because of above reasons but the mme indicated mo exception data counter, then the SGW should notify the pdn gw that this rrc establishment cause has been used by the indication of the mo exception data counter (see ts?29.274?[43]). the serving gw indicates each use of this rrc establishment cause by the related counter on its cdr.
6. the pdn gw sends the modify bearer response to the serving gw.
 the pdn gw indicates each use of the rrc establishment cause "mo exception data" by the related counter on its cdr.
7. if a modify bearer request message was sent at step?4 the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) to the mme as a response to a modify bearer request message. the serving gw address for s11-u UP and serving gw teid are used by the mme to forward ul data to the sgw.
8. the mme sends uplink data to the p-gw via the s-gw.
9. if no downlink data are expected based on the nas release assistance information from the ue in step?1, this means that all application layer data exchanges have completed with the ul data transfer, and if the mme is not aware of pending mt traffic and s1-u bearers are not established, step?10 is skipped and step?11 applies.
 otherwise, downlink data may arrive at the p-gw and the p-gw sends them to the mme via the s-gw. if no data is received steps10-12 are skipped and the enb may trigger step?14 after step?13 detects no activity. while the rrc connection is active, the ue may still send uplink data and may receive downlink data in nas pdus that are carried in a s1ap uplink or (respectively) downlink messages (not shown in the figure). at any time the ue has no UP bearers established it may provide nas release assistance information with the uplink data. in this case, to assist location services, the enb may indicate, if needed, the ue's coverage level to the mme.
10. if downlink data are received in step?9, the mme encrypts and integrity protects the downlink data.
11. if step?10 is executed then downlink data are encapsulated in a nas pdu and sent to the enb in a s1-ap downlink nas message. if the configuration in the mme indicates that the enodeb supports acknowledgements of downlink nas data pdus and if acknowledgements of downlink nas data pdus are enabled in the subscription information for the ue, the mme indicates in the s1-ap downlink nas message that acknowledgment is requested from the enodeb. for ip pdn type pdn connections configured to support header compression, the mme shall apply header compression before encapsulating data into the nas message. if step?10 is not executed, or nas service accept message is not to be sent, the mme sends connection establishment indication message to the enb to complete the establishment of the ue-associated logical s1-connection. the ue radio capability may be provided from the mme to the enb in the dl nas transport message or connection establishment indication message, and the enb shall store the received ue radio capability information as specified in ts?36.300?[5].
 if the nas release assistance information was received with uplink data and it indicated that downlink data was expected, it means that the next downlink packet following the sending of the nas release assistance information is the last packet of the application layer data exchange, then for this case, unless the mme is aware of additional pending mt traffic and unless s1-u bearers are established, the mme sends a s1 ue context release command immediately after the s1-ap message including the downlink data encapsulated in nas pdu as an indication that the enodeb shall release the rrc connection promptly after successfully sending data to the ue. alternatively, if "edt session" indication was received in step?2, the mme may include end indication for no further data in the s1-ap message including the downlink data encapsulated in nas pdu. if the mme includes the end indication indicating no further data and if the enb does not proceed with rrc connection establishment, then the enb skips step?12a and initiates step?12b.
 if the nas release assistance information was received indicating no downlink data expected, it means that all application layer data exchanges have completed with the ul data transfer, then for this case, unless the mme is aware of additional pending mt traffic and unless s1-u bearers are established:
- the mme sends s1ap ue context release command either:
- immediately after the s1ap dl nas transport (nas service accept), in which case steps 12b and 14 are skipped, or
- immediately after s1ap connection establishment indication, in which case steps 12a, 12b, 13, and 14 are skipped.
- alternatively, if the mme received "edt session" indication from the enb in step?2, the mme should include end indication with no further data in s1ap dl nas transport (nas service accept) or s1ap connection establishment indication. if the enb does not proceed with rrc connection establishment, the enb skips step?12a and initiates stop?12b.
 if the ue is accessing via an nb-iot cell, or if it is accessing via an wb-e-utran cell and is capable of ce mode b, to determine the nas pdu retransmission strategy the mme should take into account the transmission delay of the nas pdu and the ce mode b restricted parameter stored in the mme's mm context and, if applicable, the ce mode, i.e. set the nas timers long enough according to the worst transmission delay (see ts?24.301?[46]).
12a. the enb sends a rrc downlink data message including the downlink data encapsulated in nas pdu. if in step?11 the s1-ap message with the nas data pdu was followed by an s1 ue context release command, step?15 is completed promptly after the downlink data transmission of the nas pdu to the ue and the acknowledgement to mme in step?13 have been completed at the enb, and the enb does not need to enter step?14. if header compression was applied to the pdn, the ue would perform header decompression to rebuild the ip header.
12b. if end indication with no further data is received in s1ap message from the mme, the enb may send the rrcearlydatacomplete message with any nas payload received from step?11 (either nas data pdu or nas service accept) as defined in ts?36.300?[5]. step?14 is skipped in this case.
13. the enodeb sends a nas delivery indication to the mme if requested. if the enodeb reports an unsuccessful delivery with an s1-ap nas non delivery indication, the mme should wait for some time until the ue has potentially changed cell and re-established contact with the mme, by which mme should resend the downlink s1-ap message to the enodeb, otherwise the mme reports an unsuccessful delivery to the scef in case of t6a procedure (see ts?23.682?[74], clause?5.13.3). if the enodeb reports a successful delivery with an s1-ap nas delivery indication and if the downlink data was received over the t6a interface, the mme should respond to the scef (see ts?23.682?[74], clause?5.13.3). if the enodeb does not support s1-ap nas delivery indications, the mme indicates a cause code 'success unacknowledged delivery' to the scef otherwise 'success acknowledged delivery', for the scef to know if reliable delivery was possible or not.
14. if no nas pdu activity exists for a while, the enb starts an s1 release in step?15.
15. an s1 release procedure according to clause?5.3.5 triggered by the enodeb or mme. alternatively, if the mme in step?11 sent s1 ue context release command then the procedure starts with step?5 in clause?5.3.5, or connection suspend procedure defined in clause?5.3.4a. the ue and the mme shall store the rohc configuration and context for the uplink/downlink data transmission when entering ecm_connected state next time.
5.3.4b.3 mobile terminated data transport in CP ciot eps optimisation with p-gw connectivity

figure 5.3.4b.3-1: mt data transport in nas pdus
0. the ue is eps attached and in ecm-idle mode.
1. when the s-gw receives a downlink data packet/control signalling for a ue, if the s- gw context data indicates no downlink UP teid towards the mme), it buffers the downlink data packet and identifies which mme is serving that ue.
 if that mme has requested the serving gw to throttle downlink low priority traffic and if the downlink data packet is received on a low priority bearer to be throttled (see clause?4.3.7.4.1a), the s-gw drops the downlink data. the steps below are not executed.
 if that mme has requested the s gw to delay sending the downlink data notification (see clause?5.3.4.2 on "handling of abnormal conditions in ue triggered service request"), the serving gw buffers the downlink data and waits until the timer expires before continuing with step?2. if the dl-teid and mme address for that ue is received before the expiry of the timer, the timer shall be cancelled and the mobile terminated data transport procedure is progressed from step?11 as downlink data are sent to the ue.
 if the serving gw receives additional downlink data packets/control signalling for this ue before the expiry of the timer, the serving gw does not restart this timer.
2. if the serving gw is buffering data in step?1, the serving gw sends a downlink data notification message (arp, eps bearer id) to the mme for which it has CP connectivity for the given ue. the arp and eps bearer id are always set in downlink data notification. the mme responds to the s gw with a downlink data notification ack message.
 an mme detects that the ue is in a power saving state (e.g. power saving mode) and cannot be reached by paging at the time of receiving downlink data notification, shall invoke extended buffering depending on operator configuration, except for cases described in next paragraphs. the mme derives the expected time before radio bearers can be established to the ue. the mme then indicates downlink buffering requested to the serving gw in the downlink data notification ack message and includes a downlink buffering duration time and optionally a downlink buffering suggested packet count. the mme stores a new value for the downlink data buffer expiration time in the mm context for the ue based on the downlink buffering duration time and skips the remaining steps of this procedure. the downlink data buffer expiration time is used for ues using power saving state and indicates that there are buffered data in the serving gw and that the UP setup procedure is needed when the ue makes signalling with the network. when the downlink data buffer expiration time has expired, the mme considers no downlink data to be buffered and no indications of buffered downlink data waiting are sent during context transfers at tau procedures.
 if there is an "availability after ddn failure" monitoring event configured for the ue in the mme, the mme does not invoke extended buffering. instead, the mme sets the notify-on-available-after-ddn-failure flag to remember to send an "availability after ddn failure" notification when the ue becomes available. if there is a "ue reachability" monitoring event configured for the ue in the mme, the mme does not invoke extended buffering.
note?1: when "availability after ddn failure" and "ue reachability" monitoring events are used for a ue, the application server is assumed to send data only when the ue is reachable, hence no extended buffering is needed. if there are multiple application servers, the event notifications and extended buffering may be needed simultaneously. it is assumed this is handled through additional information based on sla as described in the next paragraph.
 the mme may use additional information based on a sla with the mtc user for when to invoke extended buffering, e.g. only invoke it for a certain apn, do not invoke it for certain subscribers, invoke extended buffering in conjunction with "availability after ddn failure" and "ue reachability" monitoring events, etc.
 a serving gw that receives a downlink buffering requested indication in a downlink data notification ack message stores a new value for the downlink data buffer expiration time based on the downlink buffering duration time and does not send any additional downlink data notification if subsequent downlink data packets are received in the serving gw before the buffer time downlink data buffer expiration time has expired for the ue.
 if the serving gw, while waiting for the UP to be established, is triggered to send a second downlink data notification for a bearer with higher priority (i.e. arp priority level) than that of the bearer for which the first downlink data notification was sent, the s-gw sends a new downlink data notification message indicating the higher priority to the mme. if the serving gw receives additional downlink data packets for a bearer with same or lower priority than the first downlink data notification was sent for or if the serving gw has sent the second downlink data notification message indicating the higher priority and receives additional downlink data packets for this ue, the serving gw buffers these downlink data packets and does not send a new downlink data notification.
 if the serving gw, while waiting for the UP to be established, receives a modify bearer request message from an mme other than the one it sent a downlink data notification message to, the serving gw re-sends the downlink data notification message but only to the new mme from which it received the modify bearer request message.
 upon reception of a downlink data notification ack message with an indication that the downlink data notification message has been temporarily rejected and if the downlink data notification is triggered by the arrival of downlink data packets at the serving gw, the serving gw may start a locally configured guard timer and buffers all downlink user packets received to the given ue and waits for a modify bearer request message to come. upon reception of a modify bearer request message, the serving gw re-sends the downlink data notification message but only to the new mme from which it received the modify bearer request message. otherwise the serving gw releases buffered downlink user packets upon expiry of the guard timer or upon receiving the delete session request message from mme.
 if the s11-u is already established (buffering is in the mme), step?2 is not executed and step?11 is immediately executed. steps 7,8,9,10 are executed only if conditions are met when the nas CP service request is received at step?6, as outlined below in the respective clauses.
 an mme detecting that the ue is in a power saving state (e.g. power saving mode) and cannot be reached by paging at the time of receiving downlink data, shall start extended buffering depending on operator configuration, except for cases described in next paragraphs. the mme derives the expected time before radio bearers can be established to the ue, stores a new value for the downlink data buffer expiration time in the mm context for the ue and skips the remaining steps of this procedure. when the downlink data buffer expiration time has expired, the mme considers no downlink data to be buffered.
 also for the case of buffering in the mme the "availability after ddn failure" monitoring event can be configured for the ue, even though the actual ddn is not received and the downlink data is received. the "ue reachability" monitoring event can be configured.also. the extended buffering can also be configured as per what is described above in this step?of the procedure for the case of buffering in s-gw.
3. if the ue is registered in the mme and considered reachable, the mme sends a paging message (nas id for paging, tai(s), ue identity based drx index, paging drx length, list of csg ids for paging, paging priority indication, enhanced coverage restricted, ce mode b restricted) to each enodeb belonging to the tracking area(s) in which the ue is registered.
 paging priority indication is included only:
- if the mme receives a downlink data notification (or a downlink packet for a eps bearer, for the case of buffering in mme) with an arp priority level associated with priority services, as configured by the operator.
- one paging priority level can be used for multiple arp priority level values. the mapping of arp priority level values to paging priority level (or levels) is configured by operator policy.
 during a congestion situation the enodeb may prioritise the paging of ues according to the paging priority indications.
 if the mme, while waiting for a ue response to the paging request message sent without paging priority indication, receives a downlink data notification (or a downlink packet for a eps bearer, for the case of buffering in mme) which indicates an arp priority level associated with priority services, as configured by the operator, the mme shall send another paging message with the suitable paging priority.
 when the mme is configured to support csg paging optimisation in the cn, the mme should avoid sending paging messages to those enodeb(s) with csg cells for which the ue does not have a csg subscription. when the mme is configured to support csg paging optimisation in the henb subsystem, the list of csg ids for paging is included in the paging message. for csg paging optimisation, the csg ids of expired csg subscriptions and valid csg subscriptions are both included in the list. if the ue has emergency bearer service the mme shall not perform the csg paging optimisation.
note?2: an expired csg subscription indicates that the ue is not allowed service in the csg. however, since the removal of the csg from the ue is pending, it is possible the ue will camp on that csg and therefore the ue is still paged for the csg.
note?3: the enodeb reports to the mme the csg id supported. for more detail of this procedure refer to ts?36.413?[36].
 paging strategies may be configured in the mme. paging strategies may include:
- paging retransmission scheme (e.g. how frequently the paging is repeated or with what time interval);
- determining whether to send the paging message to the enodebs during certain mme high load conditions;
- whether to apply sub-area based paging (e.g. first page in the last known ecgi or ta and retransmission in all registered tas).
note?4: the paging priority in the paging message is set based on priority level of the arp ie received in downlink data notification or create/update bearer request message and is independent from any paging strategy.
 the mme and the e-utran may support further paging optimisations in order to reduce the signalling load and the network resources used to successfully page a ue by one or several following means:
- by the mme implementating specific paging strategies (e.g. the s1 paging message is sent to the enb that served the ue last);
- by the mme considering information on recommended cells and enodebs provided by the e-utran at transition to ecm idle. the mme takes the enb related part of this information into account to determine the enbs to be paged, and provides the information on recommended cells within the s1 paging message to each of these enbs;
- by the e-utran considering the paging attempt count information provided by the mme at paging.
 when implementing such optimisations/strategies, the mme shall take into account any psm active timer and the drx interval for the ue.
 if the ue radio capability for paging information is available in the mme, the mme adds the ue radio capability for paging information in the s1 paging message to the enb.
 if the information on recommended cells and enbs for paging is available in the mme, the mme shall take that information into account to determine the enbs for paging and, when paging an enb, the mme may transparently convey the information on recommended cells to the enb.
 the mme may include in the s1ap paging message(s) the paging attempt count information. the paging attempt count information shall be the same for all enbs selected by the mme for paging.
 if the mme has information for enhanced coverage stored and enhanced coverage is not restricted then the mme shall include information for enhanced coverage in the paging message for all enbs selected by the mme for paging. for including the enhanced coverage restricted parameter in the paging message, see clause?4.3.28.
 for including the ce mode b restricted parameter in the paging message, see clause?4.3.27a.
4. if enodebs receive paging messages from the mme, the ue is paged by the enodebs.
5. as the ue is in the ecm-idle state, upon reception of paging indication, the ue sends CP service request nas message (as defined in ts?24.301?[46]) over rrc connection request and s1-ap initial message. the CP service request nas message, when CP ciot eps optimisation applies, does not trigger data radio bearer establishment by the mme and the mme can immediately send downlink data it receives using a nas pdu to the enodeb. the mme supervises the paging procedure with a timer. if the mme receives no response from the ue to the paging request message, it may repeat the paging according to any applicable paging strategy described in step?3.
5b. in the nb-iot case, the enb, based on configuration, may retrieve the eps negotiated qos profile from the mme, if not previously retrieved. the mme code within the s-tmsi in the rrcconnectionrequest message is used to identify the mme. in the case of network sharing, the mme codes shall be unique within the area of overlapping mme pools of the participating operators. the enb may apply prioritisation between requests from different ues before triggering step?6 and throughout the rrc connection. the enb may retrieve additional parameters (e.g., ue radio capabilities - see ts?36.413?[36]).
6. if the mme receives no response from the ue after this paging repetition procedure, it shall use the downlink data notification reject message to notify the serving gw about the paging failure (or, equivalently, if the buffering is in the mme, the mme simply discards data for the ue locally), unless the mme is aware of an ongoing mm procedure that prevents the ue from responding, i.e. the mme received a context request message indicating that the ue performs tau with another mme. when a downlink data notification reject message is received, the serving gw deletes the buffered packet(s). the serving gw may invoke the procedure pdn gw pause of charging (clause?5.3.6a) if ue is in ecm idle and the pdn gw has enabled "pdn charging pause" feature. if buffering is in the mme, pause charging is triggered by the mme via a release access bearer request to the s-gw(not shown in figure 5.3.4b.3-1) including a "abnormal release of radio link" cause , which releases the s11-u.
note?5: the serving gw (or mme, in the case of buffering in the mme) may initiate the procedure p-gw pause of charging at any time before step?5 if the ue is in ecm idle and the p-gw has indicated that the feature is enabled for this pdn. see clause?5.3.6a.0.
 to assist location services, the enb indicates the ue's coverage level to the mme.
 the mme performs (and the ue responds to) any emm or esm procedures if necessary, e.g. the security related procedures. steps 7 to 11 can continue in parallel to this, however, steps 12 and 13 shall await completion of all the emm and esm procedures.
7. if the s11-u is not established, the mme sends a modify bearer request message (mme address, mme teid dl, delay downlink packet notification request, rat type, lte-m rat type reporting to pgw flag) for each pdn connection to the serving gw. the serving gw is now able to transmit downlink data towards the ue. the usage of the delay downlink packet notification request information element is specified in clause?5.3.4.2 with reference to the ue initiated service request procedure, but it equally applies in this case. the mme shall indicate s11-u tunnelling of nas user data and send its own s11-u ip address and mme dl teid for dl data forwarding by the sgw. also, regardless of whether the s11-u was already established:
- if the p-gw requested ue's location and/or user csg information and the ue's location and/or user csg information has changed, the mme shall send the modify bearer request message and also includes the user location information ie and/or user csg information ie in this message.
- if the serving network ie has changed compared to the last reported serving network ie then the mme shall send the modify bearer request message and also includes the serving network ie in this message.
- if the ue time zone has changed compared to the last reported ue time zone then the mme shall send the modify bearer request message and include the ue time zone ie in this message.
 if the rat type currently used is nb-iot this shall be reported as different from other -e-utra flavours.
 if the ue is using the lte-m rat type and the pdn gw expects the lte-m rat type reporting as specified in clause?5.11.5, the mme also includes the lte-m rat type reporting to pgw flag to indicate to the serving gw to forward the lte-m rat type to the pdn gw.
8. if the rat type has changed compared to the last reported rat type or if the ue's location and/or info ies and/or ue time zone and serving network id are present in step?7, the serving gw shall send the modify bearer request message (rat type) to the p-gw. user location information ie and/or user csg information ie and/or serving network ie and/or ue time zone are also included if they are present in step?7.
 if lte-m rat type and the lte-m rat type reporting to pgw flag were received at step?7, the serving gw shall include the lte-m rat type in the modify bearer request message to the pgw. otherwise the serving gw includes rat type wb-e-utran.
 if the modify bearer request message is not sent because of above reasons and the pdn gw charging is paused, then the s-gw shall send a modify bearer request message with pdn charging pause stop indication to inform the pdn gw that the charging is no longer paused. other ies are not included in this message.
9. the pdn gw sends the modify bearer response to the serving gw.
10. if a modify bearer request message was sent at step?7, the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) to the mme as a response to a modify bearer request message. the serving gw address for s11-u UP and serving gw teid are used by the mme to forward ul data to the sgw.
11. buffered (if s11-u was not established) downlink data is sent by the s-gw to the mme.
12-13. the mme encrypts and integrity protects downlink data and sends it to the enodeb using a nas pdu carried by a downlink s1-ap message. if the configuration in the mme indicates that the enodeb supports acknowledgements of downlink nas data pdus and if acknowledgements of downlink nas data pdus are enabled in the subscription information for the ue, the mme indicates in the downlink s1-ap message that acknowledgment is requested from the enodeb. for ip pdn type pdn connections configured to support header compression, the mme shall apply header compression before encapsulating data into the nas message. alternatively and if the mme decides that s1-u bearers need to be established in case the ue and mme accept UP eps optimisation or s1-u data transfer, steps 4-12 from clause?5.3.4.1 are followed.
 if the ue is accessing via an nb-iot cell, or if it is accessing via an wb-e-utran cell and is capable of ce mode b, to determine the nas pdu retransmission strategy the mme should take into account the transmission delay of the nas pdu and the ce mode b restricted parameter stored in the mme's mm context and, if applicable, the ce mode, i.e. set the nas timers long enough according to the worst transmission delay (see ts?24.301?[46]).
14. the nas pdu with data is delivered to the ue via a downlink rrc message. this is taken by the ue as implicit acknowledgment of the service request message sent in step?5. if header compression was applied, to the pdn, the ue shall perform header decompression to rebuild the ip header.
15. the enodeb sends a nas delivery indication to the mme if requested. if the enodeb reports an unsuccessful delivery with an s1-ap nas non delivery indication, the mme should wait for some time until the ue has potentially changed cell and re-established contact with the mme, by which mme should resend the downlink s1-ap message to the enodeb, otherwise the mme reports an unsuccessful delivery to the scef in case of t6a procedure (see ts?23.682?[74], clause?5.13.3). if the enodeb reports a successful delivery with an s1-ap nas delivery indication and if the downlink data was received over the t6a interface, the mme should respond to the scef (see ts?23.682?[74], clause?5.13.3). if the enodeb does not support s1-ap nas delivery indications, the mme indicates a cause code 'success unacknowledged delivery' to the scef otherwise 'success acknowledged delivery', for the scef to know if reliable delivery was possible or not.
16. while the rrc connection is still up, further uplink and downlink data can be transferred using nas pdus. in step?17 an uplink data transfer is shown using an uplink rrc message encapsulating a nas pdu with data. at any time the ue has no UP bearers established, the ue may provide a release assistance information with uplink data in the nas pdu.
 for ip pdn type pdn connections configured to support header compression, the ue shall apply header compression before encapsulating it into the nas message.
17. the nas pdu with data is send to the mme in a uplink s1-ap message.
 to assist location services, the enb may indicate, if changed, the ue's coverage level to the mme.
 if the release assistance information is received from the ue it overrides the traffic profile (see ts?23.682?[74]) and the mme does not send the traffic profile to the enb.
18. the data is checked for integrity and decrypted. if header compression was applied to the pdn, the mme shall perform header decompression to rebuild the ip header.
19. the mme sends uplink data to the pdn gw via the s-gw and executes any action related to the presence of release assistance information as follows:
- for the case where the release assistance information indicates there is no downlink data to follow the uplink data then unless the mme is aware of pending mt traffic, and unless s1-u bearers exist, the mme immediately releases the connection and therefore step?21 is executed.
- for the case where the release assistance information indicates that downlink data will follow the uplink transmission then unless the mme is aware of additional pending mt traffic and unless s1-u bearers exist, the mme sends a s1 ue context release command to the enodeb immediately after the s1-ap message including the downlink data encapsulated in nas pdu.
20. if no nas activity exists for a while the enb detects inactivity and executes step?21.
21. the enb starts an enodeb initiated s1 release procedure according to clause?5.3.5 or connection suspend procedure defined in clause?5.3.4a. the ue and the mme shall store the rohc configuration and context for the uplink/downlink data transmission when entering ecm_connected state next time.
5.3.4b.4 establishment of s1-u bearer during data transport in CP ciot eps optimisation

figure 5.3.4b.4-1: establishment of s1-u bearer during data transport in CP ciot eps optimisation
ue or mme can use this procedure if the ue and mme successfully negotiate s1-u data transfer or UP ciot eps optimisation in addition to CP ciot eps optimisation based on the preferred and supported network behaviour as defined in clause?4.3.5.10. the mme either because it has received the nas message as defined in steps 2-3 or the mme decides that s1-u based data transfer is now preferred e.g. determined by the size of data transferred in ul and dl using CP ciot eps optimisation triggers the establishment of s1-u bearer(s). the mme checks if the ue can support the establishment of required number of additional UP radio bearers based on the maximum number of UP radio bearers indicated by ue in the ue network capability ie as defined in clause?5.11.3. if the mme takes the decision that s1-u data transfer is now preferred steps 2-3 are not needed.
1. ue is sending and receiving data in nas pdus using the CP ciot eps optimisation.
2. the ue may be triggered to establish UP bearers and sends a CP service request with an active flag towards the mme encapsulated in an rrc message to the enodeb. the rrc message and this nas message are described in ts?36.300?[5] and ts?24.301?[46] respectively.
3. the enodeb forwards the CP service request with active flag to mme. nas message is encapsulated in an s1-ap ul nas transport message (nas message, tai+ecgi of the serving cell, s-tmsi, csg id, csg access mode). details of this step?are described in ts?36.300?[5]. if the mme receives the CP service request with active flag defined in steps 2-3 it shall establish s1-u bearer(s) and execute the transfer. if the mme cannot handle the procedure associated to the CP service request with active flag, it shall reject it. csg id is provided if the ue sends the nas message via a csg cell or a hybrid cell. csg access mode is provided if the ue sends the nas message via a hybrid cell. if the csg access mode is not provided but the csg id is provided, the mme shall consider the cell as a csg cell.if a csg id is indicated and csg access mode is not provided, and there is no subscription data for this csg id and associated plmn or the csg subscription is expired, the mme rejects the CP service request with an appropriate cause. the ue shall remove the csg id and associated plmn of the cell where the ue has initiated the service request procedure from the allowed csg list, if present.
4. the mme shall send any remaining ul data over s11-u and in order to minimize the possible occurrence of out of order dl data e.g. caused by earlier dl data which were sent on the CP may send a release access bearers request message to the serving gw that requests the release of all s11-u bearers for the ue. the mme locally deletes any existing rohc context used for CP ciot eps optimisation, and other s11-u related information in ue context, including teid (dl) for the s11-u, etc, but not the header compression configuration.
note: the mme may use the "delay downlink packet notification request" causing the serving gw to not send downlink data notifications as described in clause?5.3.4.2 to minimize the impact of possible downlink data notifications this step?may cause.
5. if the serving gw receives the release access bearers request message it releases all mme related information (address and downlink teids) for the ue and responds with a release access bearers response message to the mme. other elements of the ue's serving gw context are not affected. if downlink packets arrive for the ue, the serving gw starts buffering downlink packets received for the ue and initiating the "network triggered service request" procedure, described in clause?5.3.4.3.
6. the mme sends s1-ap initial context setup request (serving gw address, s1-teid(s) (ul), eps bearer qos(s), security context, mme signalling connection id, handover restriction list, csg membership indication, service accept) message to the enodeb for all pdn connections that mme has not included CP only indicator in esm request. the mme responds to the ue with a service accept message. the enodeb stores the security context, mme signalling connection id, eps bearer qos(s) and s1-teid(s) in the ue ran context. the step?is described in detail in ts?36.300?[5]. handover restriction list is described in clause?4.3.5.7 "mobility restrictions".
7. if the CP service request is performed via a hybrid cell, csg membership indication indicating whether the ue is a csg member shall be included in the s1-ap message from the mme to the ran. based on this information the ran can perform differentiated treatment for csg and non-csg members. the enodeb performs the radio bearer establishment procedure. the UP security is established at this step, which is described in detail in ts?36.300?[5]. the ue needs to locally delete any existing rohc context used for CP ciot eps optimisation. when the UP radio bearers are setup, eps bearer state synchronization is performed between the ue and the network, i.e. the ue shall locally remove any eps bearer for which the mme has not included CP only indicator in esm request and for which no radio bearers are setup. if the radio bearer for a default eps bearer is not established, the ue shall locally deactivate all eps bearers associated to that default eps bearer.
8. as the UP radio bearers are setup the ue shall use UP bearers to transfer data pdus, except for eps bearers the mme has included CP only indicator in esm request and for which CP ciot eps optimisation is still be used. the uplink data from the ue can now be forwarded by enodeb to the serving gw. the enodeb sends the uplink data to the serving gw address and teid provided in the step?6. the serving gw forwards the uplink data to the pdn gw.
9. the enodeb sends an s1-ap message initial context setup complete (enodeb address, list of accepted eps bearers, list of rejected eps bearers, s1 teid(s) (dl)) to the mme. this step?is described in detail in ts?36.300?[5].
10. the mme sends a modify bearer request message (enodeb address, s1 teid(s) (dl) for the accepted eps bearers, delay downlink packet notification request, rat type) per pdn connection to the serving gw. if the serving gw supports modify access bearers request procedure and if there is no need for the serving gw to send the signalling to the pdn gw, the mme may send modify access bearer request (enodeb address(es) and teids for downlink UP for the accepted eps bearers, delay downlink packet notification request) per ue to the serving gw to optimise the signalling. the serving gw is now able to transmit downlink data towards the ue.
11. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling other than to unpause charging in the pdn gw or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using a modify bearer request message per pdn connection.
5.3.4b.5 enb CP relocation indication procedure
for intra-nb-iot mobility for ue and mme using CP ciot eps optimisation the enb cp relocation indication procedures may be used. the purpose of the enb cp relocation indication procedure is to request the mme to authenticate the ue's re-establishment request as described in ts?33.401?[41], and initiate the establishment of the ue's s1 connection and, if necessary, the s11-u connection after the ue has initiated a rrc re-establishment procedure in a new enb.
more details are defined in ts?36.300?[5].
5.3.5 s1 release procedure
this procedure is used to release the logical s1-ap signalling connection (over s1-mme) and all s1 bearers (in s1-u) for a ue. this procedure releases the s11-u bearer in CP ciot eps optimisation (except in case of buffering in mme), instead of the s1-u bearer. the procedure will move the ue from ecm-connected to ecm-idle in both the ue and mme, and all ue related context information is deleted in the enodeb. when the s1-ap signalling connection is lost, e.g. due to loss of the signalling transport or because of an enodeb or mme failure, the s1 release procedure is performed locally by the enodeb and by the mme. when the s1 release procedure is performed locally by the enodeb or by the mme each node performs locally its actions as described in the procedure flow below without using or relying on any of the signalling shown directly between enodeb and mme.
if service gap control shall be applied for the ue (see clause?4.3.17.9) and the service gap timer is not already running, the service gap timer shall be started in mme and ue when entering ecm-idle, unless the connection was initiated after a paging of an mt event, or after a tau procedure without any active flag set or signalling active flag set.
the initiation of s1 release procedure is either:
- enodeb-initiated with cause e.g. o&m intervention, unspecified failure, user inactivity, repeated rrc signalling integrity check failure, release due to ue generated signalling connection release, cs fallback triggered, inter-rat redirection, etc. as defined in ts?36.413?[36]; or
- mme-initiated with cause e.g. authentication failure, detach, not allowed csg cell (e.g. the csg id of the currently used csg cell expires or is removed from the csg subscription data), etc.
both enodeb-initiated and mme-initiated s1 release procedures are shown in figure 5.3.5-1.

figure 5.3.5-1: s1 release procedure
1a. in certain cases the enodeb may release the ue's signalling connection before or in parallel to requesting the mme to release the s1 context, e.g. the enodeb initiates an rrc connection release for cs fallback by redirection. if the reason for the release is that the enodeb received release assistance indicator in access stratum as defined in ts?36.321?[87], the enodeb should not immediately release the rrc connection, instead send s1 ue context release request with appropriate cause value e.g. user inactivity.
1b. if the enodeb detects a need to release the ue's signalling connection and all radio bearers for the ue, the enodeb sends an s1 ue context release request (cause) message to the mme. cause indicates the reason for the release (e.g. o&m intervention, unspecified failure, user inactivity, repeated integrity checking failure, or release due to ue generated signalling connection release).
 if the plmn has configured secondary rat reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included in s1 ue context release request.
note?1: step 1 is only performed when the enodeb-initiated s1 release procedure is considered. step 1 is not performed and the procedure starts with step 2 when the mme-initiated s1 release procedure is considered.
 the mme upon receiving s1 ue context release request with cause=user inactivity continues with the s1 release procedure unless the mme is aware of pending mt traffic or signalling and/or nas release assistance information that may have been received in nas pdu when CP ciot eps optimisation is used, which indicates that downlink data is expected.
 for CP ciot eps optimisation with data buffering in the mme, step?2 and step?3 are skipped.
2. the mme sends a release access bearers request (abnormal release of radio link indication, secondary rat usage data) message to the s gw that requests the release of all s1-u bearers for the ue, or the s11-u in CP ciot eps optimisation if buffering is in the s-gw. this message is triggered either by an s1 release request message from the enodeb, or by another mme event. the abnormal release of radio link indication is included if the s1 release procedure is due to an abnormal release of the radio link. if secondary rat usage data was received in step 1b, the mme includes secondary rat usage data in this message.
3. if the s-gw has received a release access bearers request, the s gw releases all enodeb related information (address and teids), or the mme teids related information in CP ciot eps optimisation (address and teids), for the ue and responds with a release access bearers response message to the mme. other elements of the ue's s gw context are not affected. the s gw retains the s1-u configuration that the s gw allocated for the ue's bearers. the s gw starts buffering downlink packets received for the ue and initiating the "network triggered service request" procedure, described in clause 5.3.4.3, if downlink packets arrive for the ue. in CP ciot eps optimisation downlink data triggers mobile terminated data transport in nas signalling defined in clause?5.3.4b.3.
note?2: based on operator policy any received indication of "abnormal release of radio link" may be used by serving gw in subsequent decisions to trigger pdn charging pause if the feature has been enabled on that pdn.
4. the mme releases s1 by sending the s1 ue context release command (cause) message to the enodeb.
5. if the rrc connection is not already released, the enodeb sends a rrc connection release message to the ue in acknowledged mode. once the message is acknowledged by the ue, the enodeb deletes the ue's context.
6. the enodeb confirms the s1 release by returning an s1 ue context release complete (ecgi, tai, secondary rat usage data) message to the mme. with this, the signalling connection between the mme and the enodeb for that ue is released. this step shall be performed promptly after step?4, e.g. it shall not be delayed in situations where the ue does not acknowledge the rrc connection release.
 if dual connectivity was activated by that enodeb at the time of the release or earlier by that enodeb, the enodeb shall include the last known pscell id and the time elapsed since the dual connectivity was released.
 the enodeb may include the information on recommended cells and enodebs for paging in the s1 ue context release complete message. if available, the mme shall store this information to be used when paging the ue.
 the enb includes information for enhanced coverage, if available, in the s1 ue context release complete message.
 if the plmn has configured secondary rat usage data reporting, the enodeb has not included secondary rat usage data at step?1b, and the enodeb has secondary rat usage data to report, the secondary rat usage data is included in this message. if secondary rat usage data was included at step?1b then mme ignores secondary rat usage data at step?6.
 the mme deletes any enodeb related information ("enodeb address in use for s1-mme", "mme ue s1 ap id" and "enb ue s1ap id") from the ue's mme context, but, retains the rest of the ue's mme context including the s gw's s1-u configuration information (address and teids). all non-gbr eps bearers established for the ue are preserved in the mme and in the serving gw.
 if the cause of s1 release is because of user i inactivity, inter-rat redirection, the mme shall preserve the gbr bearers. if the cause of s1 release is because of cs fallback triggered, further details about bearer handling are described in ts?23.272?[58]. otherwise, e.g. radio connection with ue lost, s1 signalling connection lost, enodeb failure the mme shall trigger the mme initiated dedicated bearer deactivation procedure (clause?5.4.4.2) for the gbr bearer(s) of the ue after the s1 release procedure is completed.
note?3: epc does not support the gprs preservation feature with setting the mbr for gbr bearers to zero.
note?4: the mme can defer the deactivation of gbr bearers for a short period (in the order of seconds) upon receipt of an s1ap ue context release request due to radio reasons, so as to allow the ue to re-establish the corresponding radio and s1-u bearers and thus avoid deactivation of the gbr bearers.
 if lipa is active for a pdn connection, the henb informs the collocated l-gw by internal signalling to releases the direct UP path to the henb. after the direct UP path is released, if downlink packets arrive for the ue, the l-gw forwards the first packet on the s5 tunnel to the s gw to initiate the "network triggered service request" procedure, as described in clause?5.3.4.3.
7. if the enodeb provided and mme accepted secondary rat usage data in step?6 (i.e. mme initiated s1 release), the mme initiates the secondary rat usage data reporting procedure in clause?5.7a.3 as illustrated in figure 5.7a.3-2 (steps 7a - 7d). if pgw secondary rat usage reporting is active, steps 7b and 7c are performed, otherwise only steps 7a and 7d are performed.
 if the enodeb provided secondary rat usage data in step?1b (i.e. enb initiated s1 release) and pgw secondary rat usage data reporting is active, the mme initiates the secondary rat usage data reporting procedure in clause?5.7a.3 as illustrated in figure 5.7a.3-2.
5.3.5a connection resume procedure
this procedure is used by the ue to resume the ecm-connection if the ue and the network support UP ciot eps optimisation and the ue has stored the necessary information to conduct the connection resume procedure (see ts?36.300?[5]) otherwise the service request procedures are used, see clause?5.3.4.

figure 5.3.5a-1: ue initiated connection resume procedure
1. the ue triggers the random access procedure to the enodeb, see ts?36.300?[5].
2. the ue triggers the rrc connection resume procedure including information needed by the enodeb to access the ue's stored as context, see ts?36.300?[5]. the e-utran performs security checks. eps bearer state synchronization is performed between the ue and the network, i.e. the ue shall locally remove any eps bearer for which no radio bearer is setup and which is not a CP ciot eps bearer. if the radio bearer for a default eps bearer is not established, the ue shall locally deactivate all eps bearers associated to that default eps bearer.
3. the enodeb notifies the mme that the ue's rrc connection is resumed in the s1-ap ue context resume request message which includes an rrc resume cause. if the enodeb is not able to admit all suspended bearers, the enodeb shall indicate this in the list of rejected eps bearers, see ts?36.413?[36].
 if there is a service gap timer running in the mme for the ue and the mme is not waiting for a mt paging response from the ue and the rrc connection establishment cause for the connection resume request is not 'mo-signalling', the mme rejects the resume request by sending a s1-ap ue context resume reject message to enodeb.
note: if the ue then sends a subsequent service request while the service gap timer is running, the mme will send a service reject nas message to the ue with a mobility management back-off timer corresponding to the remaining time of the current service gap timer (see procedure in clause?5.3.4).
 the mme enters the ecm-connected state. the mme identifies that the ue returns at the enodeb for which mme has stored data related to the s1ap association, ue context and bearer context including the dl teid(s), necessary to resume the connection, see connection suspend procedure in clause?5.3.4a.
 if a default eps bearer is not accepted by the enodeb, all the eps bearers associated to that default bearer shall be treated as non-accepted bearers. the mme releases the non-accepted and non-established bearers by triggering the bearer release procedure as specified in clause?5.4.4.2.
 to assist location services, the enb indicates the ue's coverage level to the mme.
3a. if the s1-u connection is resumed and the ue is accessing via the nb-iot rat with the rrc resume cause set to "mo exception data", the mme should notify the SGW of each use of this establishment cause by the mo exception data counter. the mme maintains the mo exception data counter and sends it to the serving gw as indicated in ts?29.274?[43].
3b. the SGW should notify the pdn gw if the rrc establishment cause "mo exception data" has been used by the mo exception data counter (see ts?29.274?[43]). the serving gw indicates each use of this rrc establishment cause by the related counter on its cdr.
3c. the pdn gw indicates each use of the rrc establishment cause "mo exception data" by the related counter on its cdr.
4. mme acknowledges the connection resumption in s1-ap ue context resume response message. if the mme is not able to admit all suspended e-rabs the mme shall indicate this in the e-rabs failed to resume list ie.
5. if the mme included in step?4 a list of e-rabs failed to resume, the enodeb reconfigures the radio bearers.
6. the uplink data from the ue can now be forwarded by enodeb to the serving gw. the enodeb sends the uplink data to the serving gw address and teid stored during the connection suspend procedure, see clause?5.3.4a. the serving gw forwards the uplink data to the pdn gw.
7. the mme sends a modify bearer request message (enodeb address, s1 teid(s) (dl) for the accepted eps bearers, delay downlink packet notification request, rat type) per pdn connection to the serving gw. if the serving gw supports modify access bearers request procedure and if there is no need for the serving gw to send the signalling to the pdn gw, the mme may send modify access bearers request (enodeb address(es) and teids for downlink UP for the accepted eps bearers, delay downlink packet notification request) per ue to the serving gw to optimise the signalling. the serving gw is now able to transmit downlink data towards the ue.
 the mme and the serving gw clears the dl data buffer expiration time in their ue contexts if it was set, to remember that any dl data buffered for a ue using power saving functions has been delivered and to avoid any unnecessary UP setup in conjunction with a later tau.
8. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling other than to unpause charging in the pdn gw or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using a modify bearer request message per pdn connection.
 if sipto at the local network is active for a pdn connection with stand-alone gw deployment and the local home network id for stand-alone accessed by the ue differs from the local home network id where the ue initiated the sipto@ln pdn connection, the mme shall request disconnection of the sipto at the local network pdn connection(s) with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiated "explicit detach with reattach required" procedure according to clause?5.3.8.3.
 if sipto at the local network is active for a pdn connection with collocated lgw deployement and the l-gw cn address of the cell accessed by the ue differs from the l-gw cn address of the cell where the ue initiated the sipto at the local network pdn connection, the mme shall request disconnection of the sipto at the local network pdn connection(s) with the "reactivation requested" cause value according to clause?5.10.3. if the ue has no other pdn connection, the mme initiated "explicit detach with reattach required" procedure according to clause?5.3.8.3.
5.3.6 void

5.3.6a pdn gw pause of charging procedure
the pdn gw pause of charging procedure is optionally supported by the serving gw and pdn gw and has the purpose to limit a mismatch between pdn gw and serving gw charging volume and packet counts. generally, it aims for the pdn gw charging and usage monitoring data to more accurately reflect the downlink traffic actually sent to the e-utran.
note?1: a consequence of using this procedure is that pdn gw charging data does not correspond to the volume that traversed the pdn gw, and it is therefore not possible to count the downlink packets dropped between the pdn gw and the e-utran.
the serving gw may indicate support of this function to the pdn gw when the pdn connection is activated or when a new/target serving gw is used for a pdn connection. this is indicated to the pdn gw by a "pdn charging pause support indication" in the create session request during pdn activation/attach and in the modify bearer request in procedures with a change of serving gw.
note?2: it is assumed that pause of pgw charging is not invoked by sgw that is performing extended data buffering.
the pdn gw may indicate if the feature is to be enabled on a per pdn connection basis, if the current serving gw supports the feature and the operator's policy is to enable the feature. this is indicated to the serving gw by a "pdn charging pause enabled" indication in the create session response during pdn activation/attach and in the modify bearer response in procedures with a change of serving gw. this is an indication to the serving gw that when the criteria for pause of pdn gw charging are met (as described further down in this clause) the pdn gw charging can be paused.
note?3: pdns where this function applies are based on an operator policy in the pdn gw. what enters into that policy is operator specific but may be based on for example if the pdn uses sdf based charging, ue is in home or visited network, apn employed, ue is configured for nas signalling low priority, charging characteristics value etc.
the pdn gw shall stop any charging and usage monitoring actions for the pdn connection upon receiving a "pdn charging pause start" indication in a modify bearer request. when the pdn gw receives a modify bearer request for a pdn connection for which charging has been stopped previously and, if the modify bearer request contains a "pdn charging pause stop" indication or does not contain a "pdn charging pause start" indication, then the pdn gw shall continue charging for the pdn connection.
note?4: in addition to the service request procedure, the pdn gw charging is also unpaused during mobility procedures involving the serving gw based on modify bearer request messages without "pdn charging pause start" indication or during mobility procedures involving the gn/gp sgsn based on update pdp context request messages.
note?5: a delete bearer command or delete bearer request or delete bearer response for a dedicated bearer does not unpause a previously paused pdn charging.
when bearers become suspended for a ue (see ts?23.272?[58]), the pdn gw charging is no longer paused and the pdn gw continues charging for the pdn connection after suspended bearers are resumed.
note?6: the pdn gw discards packets received for a suspended ue as described in ts?23.272?[58].
while the pdn gw charging is currently paused and the ue is in ecm-idle (for isr case the device is at same time in pmm-idle or standby in utran/geran accesses) the following applies:
- the pdn gw shall not perform charging and usage monitoring actions for downlink traffic on this pdn.
note?7: the serving gw charges anyway only for the amount of transmitted downlink traffic as described in clause?5.7a.
- based on operator policy/configuration in the pdn gw, the pdn gw may limit the rate of downlink traffic sent to the serving gw.
based on operator policy/configuration in the serving gw, the serving gw may discard rather than buffer the downlink UP packets for this pdn connection while the pdn gw charging is paused. this is to avoid delivery of UP packets to the ue that were not counted in the pdn gw for charging and usage monitoring purposes. regardless of operator policy/configuration, the downlink UP packets received from pdn gw at the serving gw shall trigger downlink data notifications as described in clause?5.3.4.3.
when the serving gw receives a modify bearer request or modify access bearers request for a pdn connection triggering a modify bearer request towards the pdn gw, the serving gw shall consider the pdn charging as being unpaused if it has been paused previously.

figure 5.3.6a: pdn gw pause of charging procedure
1. the serving gw receives downlink data packets for a ue known as not UP connected (i.e. the serving gw context data indicates no downlink UP teid for the enodeb) as described in clause?5.3.4.3 step?1, i.e. the packets are buffered or discarded in serving gw based on operator policy.
2. based on operator policy/configuration the serving gw triggers the procedure to pause pdn charging. triggering criteria are based on serving gw operator policy/configuration. example of such policy may be:
a. operator specified criteria/threshold (e.g. number/fraction of packets/bytes dropped at serving gw in downlink since last time the ue was in ecm-connected state (or for isr case pmm-connected state)).
b. recent indication of "abnormal release of radio link" (see clause?5.3.5) or a recent downlink data notification reject (clause?5.3.4.3) without ue shortly re-entering ecm-connected state (or for isr case without also re-entering pmm-connected state).
3. serving gw sends a modify bearer request (pdn charging pause start) message to the pdn gw. pdn charging pause start indicates that pdn gw charging shall be paused.
4. pdn gw confirms with a modify bearer response message.
5.3.7 guti reallocation procedure
the mme may initiate the guti reallocation procedure to reallocate the guti and/or tai list at any time when a signalling association is established between ue and mme. the guti reallocation procedure allocates a new guti and/or a new tai list to the ue. the guti and/or the tai list may also be reallocated by the attach or the tracking area update procedures.
the guti reallocation procedure is illustrated in figure 5.3.7-1.

figure 5.3.7-1: guti reallocation procedure
1. the mme sends guti reallocation command (guti, tai list) to the ue.
2. the ue returns guti reallocation complete message to the mme.
5.3.8 detach procedure
5.3.8.1 general
the detach procedure allows:
- the ue to inform the network that it does not want to access the eps any longer, and
- the network to inform the ue that it does not have access to the eps any longer.
the ue is detached either explicitly or implicitly:
- explicit detach: the network or the ue explicitly requests detach and signal with each other.
- implicit detach: the network detaches the ue, without notifying the ue. this is typically the case when the network presumes that it is not able to communicate with the ue, e.g. due to radio conditions.
four detach procedures are provided when the ue accesses the eps through e-utran. the first detach procedure is ue-initiated detach procedure and other detach procedures are network-initiated detach procedure:
- ue-initiated detach procedure. in the isr activated case the ue initiated detach is split into two sub procedures, one for ue camping on e-utran and one for ue camping on geran/utran;
- mme-initiated detach procedure;
- sgsn-initiated detach procedure with isr activated;
- hss-initiated detach procedure.
note?1: the mme and the ue may enter emm-deregistered state without the above procedures.
5.3.8.2 ue-initiated detach procedure
the detach procedure when initiated by the ue is described in clauses?5.3.8.2.1 and 5.3.8.2.2.
5.3.8.2.1 ue-initiated detach procedure for e-utran
figure?5.3.8.2-1 shows the case when ue camps on e-utran and detach request is sent to mme.

figure 5.3.8.2-1: ue-initiated detach procedure - ue camping on e-utran
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?6, 7 and 8 concern gtp based s5/s8
1. the ue sends nas message detach request (guti, switch off) to the mme. this nas message is used to trigger the establishment of the s1 connection if the ue was in ecm-idle mode. switch off indicates whether detach is due to a switch off situation or not. the enodeb forwards this nas message to the mme along with the tai+ecgi of the cell which the ue is using.
 if the mme receives a detach request via a csg cell with switch off parameter indicating that detach is not due to a switch off situation, and the csg subscription for this csg id and associated plmn is absent or expired, the mme shall trigger a mme-initiated detach procedure as specified in clause?5.3.8.3.
 if dual connectivity is active for the ue, the pscell id shall be included in the uplink nas transport that carries the detach request message.
note?2: security procedures may be invoked if the nas message is used to establish the s1 connection.
note?3: for emergency attached ues that were not successfully authenticated, security procedures are not performed.
2. if the ue has no activated pdn connection, then steps 2 to 10 are not executed. if the plmn has configured secondary rat usage data reporting, the mme shall wait for step?11, if applicable, and shall perform step?12 before step?2 onwards. for any pdn connection to the scef, the mme indicates to the scef that the pdn connection for the ue is no longer available according to ts?23.682?[74] and steps 2 to 10 are not executed. for pdn connections to the p-gw, the active eps bearers in the serving gw regarding this particular ue are deactivated by the mme sending delete session request (lbi, user location information (ecgi), secondary rat usage data) per pdn connection to the serving gw. if isr is activated, then the serving gw shall not release the CP teid allocated for mme/sgsn until it receives the delete session request message in step?5. if the ue time zone has changed, the mme includes the ue time zone ie in this message. if secondary rat usage data report was received from ran, the mme includes this in the delete session request message.
3. when the s gw receives the first delete session request message from the mme or sgsn in isr activated state, the serving gw deactivates isr, releases the related eps bearer context information and responds with delete session response (cause).
 when the s gw receives the delete session request message from the mme or sgsn in isr deactivated state, the serving gw releases the related eps bearer context information and jumps to step?6 by sending a delete session request (lbi) message per pdn connection to the pdn gw. after step?7 the serving gw responds back to the mme/sgsn with the delete session response (cause and, optionally, apn rate control status according to clause?4.7.7.3) message.
4. if isr is activated, mme sends detach indication (cause) message to the associated sgsn. the cause indicates complete detach.
5. the active pdp contexts in the serving gw regarding this particular ue are deactivated by the sgsn sending delete session request (lbi, cgi/sai) per pdn connection to the serving gw. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message.
6. if isr is activated, serving gw deactivates isr. if isr is not activated in the serving gw, the serving gw sends delete session request (lbi, user location information (ecgi or cgi/sai), secondary rat usage data) per pdn connection to the pdn gw. if isr is not activated, this step shall be triggered by step?2. this message indicates that all bearers belonging to that pdn connection shall be released. if the mme and/or sgsn sends ue's location information, and/or ue time zone information, and/or secondary rat usage data in step?2 and/or step?5, the s gw includes the user location information, and/or ue time zone, and/or user csg information with the least age in this message and/or secondary rat usage data information.
7. the pdn gw acknowledges with delete session response (cause and, optionally, apn rate control status according to clause?4.7.7.3).
8. the pdn gw employs a pcef initiated ip can session termination procedure as defined in ts?23.203?[6] with the pcrf to indicate to the pcrf that eps bearer is released if pcrf is applied in the network. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
9. the serving gw acknowledges with delete session response (cause and, optionally, apn rate control status).
10. the sgsn sends detach acknowledge message to the mme (optionally apn rate control status). if received, the mme stores the apn rate control status in the mm context.
11. if switch off indicates that detach is not due to a switch off situation, the mme sends a detach accept to the ue.
12. the mme releases the s1-mme signalling connection for the ue by sending s1 release command to the enodeb with cause set to detach. the details of this step are covered in the "s1 release procedure", as described in clause 5.3.5.
note?4: in the "s1 release procedure", if dual connectivity was active at the time of the release, the enodeb includes the pscell id.
5.3.8.2.2 ue-initiated detach procedure for geran/utran with isr activated
figure?5.3.8.2-2 shows the case when ue with isr activated camps on geran/utran and detach request is sent to sgsn. refer to clause?6.6.1 of ts?23.060?[7] for the ue-initiated detach procedure when isr is not activated.

figure 5.3.8.2-2: ue-initiated detach procedure - ue camping on geran/utran, isr activated
1. the ue sends nas message detach request (detach type, p tmsi, p tmsi signature, switch off) to the sgsn. detach type indicates which type of detach is to be performed, i.e. gprs detach only, imsi detach only or combined gprs and imsi detach. switch off indicates whether detach is due to a switch off situation or not. the detach request message includes p tmsi and p tmsi signature. p tmsi signature is used to check the validity of the detach request message. if p tmsi signature is not valid or is not included, the authentication procedure should be performed.
 if the sgsn receives a detach request via a csg cell with switch off parameter indicating that detach is not due to a switch off situation, and the csg subscription for this csg id and associated plmn is absent or expired, the sgsn shall trigger a sgsn-initiated detach procedure as specified in clause?5.3.8.3a.
2. the active eps bearers in the serving gw regarding this particular ue are deactivated by the sgsn sending delete session request (lbi, user location information (cgi/sai)) per pdn connection to the serving gw. because isr is activated, then the serving gw shall not release the control plan teid allocated for mme/sgsn until it receives the delete session request message in step?5. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message.
3. because the serving gw receives this message in isr activated state, the serving gw deactivates isr and acknowledges with delete session response (cause).
4. because isr is activated, the sgsn sends detach notification (cause) message to the associated mme. cause indicates complete detach.
5. the active pdp contexts in the serving gw regarding this particular ue are deactivated by the mme sending delete session request (lbi, ecgi) per pdn connection to the serving gw. if the ue time zone has changed, the mme includes the ue time zone ie in this message.
6. serving gw deactivates isr and sends delete session request (lbi, user location information (ecgi or cgi/sai)) per pdn connection to the pdn gw. if isr is not activated, this step shall be triggered by step?2. this message indicates that all bearers belonging to that pdn connection shall be released. if the mme and/or sgsn sends ue's location information and/or ue time zone information in step?2 and/or step?5, the s gw includes the user location information and/or ue time zone with the least age in this message.
7. the pdn gw acknowledges with delete session response (cause).
8. the pdn gw employs a pcef initiated ip can session termination procedure as defined in ts?23.203?[6] with the pcrf to indicate to the pcrf that eps bearer is released if pcrf is applied in the network. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
9. the serving gw acknowledges with delete session response (cause).
10. the mme sends detach acknowledge message to the sgsn.
11. if switch off indicates that detach is not due to a switch off situation, the sgsn sends a detach accept to the ue.
12. if the ms was gprs detached, then the 3g sgsn releases the ps signalling connection.
5.3.8.3 mme-initiated detach procedure
the mme-initiated detach procedure when initiated by the mme is illustrated in figure 5.3.8.3-1.
this procedure may be also used as part of the sipto function when the mme determines that gw relocation is desirable for all pdn connection(s) serving sipto-allowed apns. the mme initiates the "explicit detach with reattach required" procedure and the ue should then re-establish those pdn connections for the same apn(s).

figure 5.3.8.3-1: mme-initiated detach procedure
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps 3, 4 and 5 concern gtp based s5/s8.
note?2: procedure steps (b) are used by the procedure steps (e) in clause?5.3.2.1.
1. the mme initiated detach procedure is either explicit (e.g. by o&m intervention) or implicit. the mme may implicitly detach a ue, if it has not had communication with ue for a long period of time. the mme does not send the detach request (detach type) message to the ue for implicit detach. the implicit detach is local to the mme, i.e. an sgsn registration will not be detached. if the ue is in ecm-connnected state the mme may explicitly detach the ue by sending a detach request message to the ue. the detach type may be set to re-attach in which case the ue should re-attach at the end of the detach process. if the ue is in ecm-idle state the mme pages the ue.
 for emergency attached ues, mme initiated implicit detach procedures are based on an inactivity timeout specific to emergency.
 if this detach procedure is due to the ue's detach request via a csg cell which the ue is not allowed to access, i.e. the csg subscription for this csg id and associated plmn is absent or expired, the mme shall send a detach request to ue with an appropriate cause indicating the ue is not allowed to access this csg.
2. if the ue has no activated pdn connection, then steps 2 to 10 are not executed. if the plmn has configured secondary rat usage reporting, the mme shall wait for step?11, if applicable, and perform step?12 before step?2 onwards. for any pdn connections to the scef, the mme indicates to the scef that the pdn connection for the ue is no longer available according to ts?23.682?[74] and steps 2 to 10 are not executed. for pdn connections to the p-gw, any eps bearer context information in the serving gw regarding this particular ue and related to the mme are deactivated by the mme sending delete session request (lbi, user location information (ecgi), nas release cause if available, secondary rat usage data) message per pdn connection to the serving gw. if the ue time zone has changed, the mme includes the ue time zone ie in this message. nas release cause is only sent by the mme to the pdn gw if this is permitted according to mme operator's policy. if secondary rat usage data report was received from the ran, the mme includes this in the delete session request message.
3. when the s gw receives the first delete session request message from the mme or sgsn in isr activated state, the serving gw deactivates isr, releases the related eps bearer context information and responds with delete session response (cause).
 when the s gw receives the delete session request message from the mme or sgsn in isr deactivated state, the serving gw releases the related eps bearer context information and jumps to step?6 by sending a delete session request (lbi) message to the pdn gw. after step?7 the serving gw responds back to the mme/sgsn with the delete session response (cause and, optionally, apn rate control status according to clause?4.7.7.3) message.
4. if isr is activated, mme sends detach notification (cause) message to the associated sgsn. the cause indicates whether it is a local or complete detach.
5. if cause indicates complete detach then the sgsn sends a delete session request (lbi, cgi/sai) message per pdn connection to the serving gw. if cause indicates local detach then sgsn deactivates isr and steps?5 to 9 shall be skipped. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message.
6. if isr is activated, serving gw deactivates isr.
 if isr is not activated and the serving gw received one or several delete bearer request message(s) from sgsn in step?2, the serving gw sends a delete session request (lbi, user location information (ecgi or cgi/sai), nas release cause if available, secondary rat usage data) message for each associated pdn connection to the pdn gw. nas release cause is the one received in the delete session request from the mme. this message indicates that all bearers belonging to that pdn connection shall be released.
 if the mme and/or sgsn send(s) ue's location information, and/or ue time zone and/or secondary rat usage data in step?2 and/or step?5, the s gw includes the user location information, and/or ue time zone information with the least age in this message and/or secondary rat usage data.
7. the pdn gw acknowledges with delete session response (cause and, optionally, apn rate control status according to clause?4.7.7.3) message.
8. the pdn gw employs an ip can session termination procedure as defined in ts?23.203?[6] with the pcrf to indicate to the pcrf that the eps bearer(s) are released if a pcrf is configured. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information and nas release cause (if available) to the pcrf as defined in ts?23.203?[6].
9. the serving gw acknowledges with delete session response (cause, apn rate control status) message.
10. the sgsn sends detach acknowledge message to the mme (apn rate control status). the mme stores the apn rate control status in the mm context.
11. if the ue receives the detach request message from the mme in the step 1, the ue sends a detach accept message to the mme any time after step 1. the enodeb forwards this nas message to the mme along with the tai+ecgi of the cell which the ue is using.
 if dual connectivity is active for the ue, the pscell id shall be included in the uplink nas transport that carries the detach accept message.
 if the ue receives detach request from the mme via a csg cell with the cause indicating the ue is not allowed to access this csg, the ue shall remove this csg id and associated plmn from its allowed csg list, if present.
12. after receiving the detach accept message, delete session response and, if appropriate, detach acknowledge message, the mme releases the s1-mme signalling connection for the ue by sending an s1 release command (cause) message to the enodeb. the details of this step are covered in the "s1 release procedure", as described in clause?5.3.5 by step?4 to step?6. if the detach type requests the ue to make a new attach, the ue reattaches after the rrc connection release is completed.
note?3: in the "s1 release procedure", if dual connectivity was active at the time of the release, the enodeb includes the pscell id.
5.3.8.3a sgsn-initiated detach procedure with isr activated
the sgsn-initiated detach procedure with isr activated is illustrated in figure?5.3.8.3a-1. refer to clause?6.6.2.1 of ts?23.060?[7] for the sgsn-initiated detach procedure when isr is not activated.

figure 5.3.8.3a-1: sgsn-initiated detach procedure with isr activated
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?3, 4 and 5 concern gtp based s5/s8.
1. the sgsn initiated detach procedure is either explicit (e.g. by o&m intervention) or implicit. the sgsn may implicitly detach a ue, if it has not had communication with ue for a long period of time. the sgsn does not send the detach request (detach type) message to the ue for implicit detach. the implicit detach is local to the sgsn, i.e. an mme registration will not be detached. if the ue is in pmm-connnected state the sgsn may explicitly detach the ue by sending a detach request message to the ue. the detach type may be set to re-attach in which case the ue should re-attach at the end of the detach process. if the ue is in pmm-idle state the sgsn pages the ue.
 if this detach procedure is due to the ue's detach request via a csg cell which the ue is not allowed to access, i.e. the csg subscription for this csg id and associated plmn is absent or expired, the sgsn shall send a detach request to ue with an appropriate cause indicating the ue is not allowed to access this csg.
2. any eps bearer context information in the serving gw regarding this particular ue and related to the sgsn is deactivated by the sgsn sending delete session request (lbi, user location information (ecgi)) message per pdn connection to the serving gw. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message.
3. because the serving gw receives this message in isr activated state, the serving gw deactivates isr, releases the sgsn related eps bearer context information and acknowledges with delete session response (cause).
4. because isr is activated, the sgsn sends detach notification (cause) message to the associated mme. the cause indicates whether it is a local or complete detach.
5. if cause indicates complete detach then the mme sends a delete session request (lbi, user location information (ecgi)) message per pdn connection to the serving gw. if cause indicates local detach then mme deactivates isr and steps?5 to 9 shall be skipped. if the ue time zone has changed, the mme includes the ue time zone ie in this message.
6. the serving gw sends a delete session request (lbi, user location information (ecgi or cgi/sai)) message per pdn connection to the pdn gw. this message indicates that all bearers belonging to that pdn connection shall be released. if the mme and/or sgsn sends ue's location information and/or ue time zone in step?2 and/or step?5, the s gw includes the user location information and/or ue time zone information with the least age in this message.
7. the pdn gw acknowledges with delete session response (cause) message.
8. the pdn gw employs an ip can session termination procedure as defined in ts?23.203?[6] with the pcrf to indicate to the pcrf that the eps bearer(s) are released if a pcrf is configured. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
9. the serving gw acknowledges with delete session response (cause) message.
10. the mme sends detach acknowledge message to the sgsn.
11. if the ue receives the detach request message from the sgsn in the step?1, the ue sends a detach accept message to the sgsn any time after step?1.
 if the ue receives detach request from the sgsn via a csg cell with the cause indicating the ue is not allowed to access this csg, the ue shall remove this csg id and associated plmn from its allowed csg list, if present.
12. after receiving the detach accept message, if detach type did not request the ue to make a new attach, then the 3g sgsn releases the ps signalling connection.
5.3.8.4 hss-initiated detach procedure
the hss-initiated detach procedure is initiated by the hss. the hss uses this procedure for operator-determined purposes to request the removal of a subscriber's mm and eps bearer at the mme and also at the sgsn if both an mme and an sgsn are registered in the hss.
for ues with emergency eps bearers, the mme/sgsn shall not initiate detach procedure. instead the mme/sgsn shall deactivate all the non emergency pdn connection.
for subscription change, e.g. rat restrictions to disallow one of the rats, the insert subscription data procedure shall be used towards the mme, and also towards the sgsn if both an mme and an sgsn are registered in the hss.
this procedure is not applied if a cancel location is sent to the mme or the sgsn with a cause other than subscription withdrawn.
the hss-initiated detach procedure is illustrated in figure 5.3.8.4-1.

figure 5.3.8.4-1: hss-initiated detach procedure
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps 4, 5 and 6 concern gtp based s5/s8.
note?2: procedure steps (b) are used by the procedure steps (f) in clause?5.3.2.1.
note?3: the steps below apply for an s4-sgsn. for gn/gp sgsn, the procedure specified in clause?6.6.2.2. of ts?23.060?[7] applies for the sgsn.
1. if the hss wants to request the immediate deletion of a subscriber's mm contexts and eps bearers, the hss shall send a cancel location (imsi, cancellation type) message with cancellation type set to subscription withdrawn to the registered mme and also to the sgsn if an sgsn is also registered. when receiving the cancel location message the mme/sgsn acknowledges with a cancel location ack (imsi) message to the hss.
2. if cancellation type is subscription withdrawn, the mme/sgsn which has an active ue context informs the ue which is in ecm-connected state, that it has been detached, by sending detach request (detach type) message to the ue. if the cancel location message includes a flag to indicate re-attach is required, the mme/sgsn shall set the detach type to indicate that re-attach is required. if the ue is in ecm-idle state the mme pages the ue.
note?4: the ue will receive only one detach request message in the rat where it currently camps on.
3a. if the ue has no activated pdn connection, then steps 3 to 7 are not executed. if the plmn has configured secondary rat usage data reporting, the mme shall wait for step 8a, if applicable, and perform step?10a before step?3a. if the mme has an active ue context, for any pdn connection to the scef, the mme indicates to the scef that the pdn connection for the ue is no longer available according to ts?23.682?[74] and steps 3 to 7 are not executed. for pdn connections to the p-gw, the mme sends a delete session request (lbi, user location information (ecgi), nas release cause if available, secondary rat usage data if available) message per pdn connection to the serving gw to deactivate the eps bearer context information in the serving gw. nas release cause is only sent by the mme to the pdn gw if this is permitted according to mme operator's policy.
3b. if the sgsn has an active ue context, the sgsn sends a delete session request (lbi, user location information (cgi/sai)) per pdn connection to the serving gw to deactivate the eps bearer context information in the serving gw.
4. when the s gw receives the first delete session request message from the mme or sgsn in isr activated state, the serving gw deactivates isr, releases the related eps bearer context information and responds with delete session response in step?7.
 when the s gw receives one or several delete session request message(s) from the mme or sgsn in isr deactivated state, the serving gw releases the related eps bearer context information and sends a delete session request (lbi, user location information (ecgi or cgi/sai), nas release cause if available, secondary rat usage data if pgw secondary rat usage data reporting is active) message for each associated pdn connection to the pdn gw. nas release cause is the one received in the delete session request from the mme or sgsn. this message indicates that all bearers belonging to that pdn connection shall be released. if the ue time zone has changed, the mme includes the ue time zone ie in this message. if the mme and/or sgsn sends ue's location information and/or ue time zone information in step?3a and/or step?3b, the s gw includes the user location information and/or ue time zone with the least age in this message.
5. the pdn gw acknowledges with delete session response (cause and, optionally, apn rate control status according to clause?4.7.7.3) message.
6. the pdn gw employs a pcef initiated ip can session termination procedure as defined in ts?23.203?[6] with the pcrf to indicate to the pcrf that the eps bearer is released if a pcrf is configured. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information and nas release cause (if available) to the pcrf as defined in ts?23.203?[6].
7. the serving gw acknowledges with delete session response (teid and, optionally, apn rate control status) message.
 if received, the mme stores the apn rate control status in the mm context.
8. if the ue receives the detach request message from the mme/sgsn, the ue sends a detach accept message to the mme/sgsn any time after step 2. the message is sent either in e-utran or geran/utran access depending on which access the ue received the detach request. for the detach accept message from ue to mme the enodeb forwards this nas message to the mme along with the tai+ecgi of the cell which the ue is using.
 if dual connectivity is active for the ue, the pscell id shall be included in the uplink nas transport that carries the detach accept message.
9. void.
10a. after receiving the detach accept message, the mme releases the s1-mme signalling connection for the ue by sending s1 release command (cause) message to the enodeb with cause set to detach. the details of this step are covered in the "s1 release procedure", as described in clause 5.3.5.
10b. after receiving the detach accept message, if detach type did not request the ue to make a new attach, then the 3g sgsn releases the ps signalling connection.
note?5: in the "s1 release procedure", if dual connectivity was active at the time of the release, the enodeb includes the pscell id.
5.3.9 hss user profile management function procedure
5.3.9.1 general
the hss user profile management function allows the hss to update the hss user profile stored in the mme. whenever the hss user profile is changed for a user in the hss, and the changes affect the hss user profile stored in the mme, the mme shall be informed about these changes by the means of the following procedure:
- insert subscriber data procedure, used to add or modify the hss user profile in the mme.
5.3.9.2 insert subscriber data procedure
the insert subscriber data procedure is illustrated in figure?5.3.9.2-1.

figure 5.3.9.2-1: insert subscriber data procedure
1. the hss sends an insert subscriber data (imsi, subscription data) message to the mme.
2. the mme updates the stored subscription data and acknowledges the insert subscriber data message by returning an insert subscriber data ack (imsi) message to the hss. the update result should be contained in the ack message.
 the mme initiates appropriate action according to the changed subscriber data (e.g. mme initiates detach if the ue is not allowed to roam in this network). for received pdn subscription contexts that have no related active pdn connection in the mme, no further action is required except storage in the mme. otherwise if the subscribed qos profile has been modified and the ue is in ecm connected state or in ecm-idle state when isr is not activated but the ue is reachable by the mme, the hss initiated subscribed qos modification procedure, as described in figure?5.4.2.2-1, is invoked from step?2a. when isr is not activated and the ue is in ecm idle state and is not reachable by the mme, e.g. when the ue is suspended, when the ue has entered into power saving mode or when the ppf is cleared in the mme, the hss initiated subscribed qos modification procedure, as described in figure 5.4.2.2-1, is invoked from step?2a at the next ecm idle to ecm connected transition. if the ue is in ecm idle state and the isr is activated, this procedure is invoked at the next ecm idle to ecm connected transition. if the ue is in ecm idle state and the isr is not activated and if the subscription change no longer allows the pdn connection, the mme initiated pdn disconnection procedure in clause 5.10.3 is used to delete the concerned pdn connection. if the mme receives rat specific subscribed paging time window that is different from the one stored in the mme mm context, the mme updates rat specific subscribed paging time window parameter in the mme mm context to the value received from the hss.
 if the ue is in ecm-connected state and connected via a csg or hybrid cell, the mme shall check the received csg subscription data. if the mme detects that the csg membership to that cell has changed or expired, the mme initiates the procedure in clause?5.16.
 if the mme received a changed service gap time parameter in the updated subscription data, the mme shall provide the new service gap time value to the ue in the next tracking area update accept message, or, if the ue does not send any tracking area update request within a certain time period that shall be longer than any psm or edrx interval used by the ue, the mme may initiate a detach with reattach required of the ue or an rrc connection release with release cause load balancing tau required of the ue.
5.3.9.3 purge function
the purge function allows an mme to inform the hss that it has deleted the subscription data and mm context of a detached ue. the mme may, as an implementation option, delete the subscription data and mm context of an ue immediately after the implicit or explicit detach of the ue. alternatively the mme may keep for some time the subscription data and the mm context of the detached ue, so that the data can be reused at a later attach without accessing the hss.

figure 5.3.9.3-1: purge procedure
1. after deleting the subscription data and mm contexts of a detached ue, the mme sends purge ue (imsi) message to the hss.
2. the hss sets the ue purged for e-utran flag and acknowledges with a purge ue ack message.
5.3.10 security function
5.3.10.1 general
the security functions include:
- guards against unauthorised eps service usage (authentication of the ue by the network and service request validation).
- provision of user identity confidentiality (temporary identification and ciphering).
- provision of user data and signalling confidentiality (ciphering).
- provision of origin authentication of signalling data (integrity protection).
- authentication of the network by the ue.
security-related network functions for eps are described in ts?33.401?[41].
5.3.10.2 authentication and key agreement
eps aka is the authentication and key agreement procedure that shall be used over e-utran, between the ue and mme. eps aka is specified in ts?33.401?[41].
5.3.10.3 user identity confidentiality
an m-tmsi identifies a user between the ue and the mme. the relationship between m-tmsi and imsi is known only in the ue and in the mme.
5.3.10.4 user data and signalling confidentiality
there are two different levels of the security associations between the ue and the network.
i) rrc and up security association is between the ue and e utran. the rrc security associations protect the rrc signalling between the ue and e utran (integrity protection and ciphering). the up security association is also between the ue and e utran and provide UP encryption function.
ii) nas security association is between the ue and the mme. it provides integrity protection and encryption of nas signalling and, when the CP ciot eps optimisation is used, user data.
5.3.10.4.1 as security mode command procedure
the mme triggers the rrc level as security mode command procedure by sending the needed security parameters to the enodeb. this enables ciphering of the up traffic and ciphering and integrity protection of the rrc signalling as described in ts?33.401?[41].
5.3.10.4.2 nas security mode command procedure
the mme uses the nas security mode command (smc) procedure to establish a nas security association between the ue and mme, in order to protect the further nas signalling messages. this procedure is also used to make changes in the security association, e.g. to change the security algorithm.

figure 5.3.10.4.2-1: nas security mode command procedure
1. the mme sends nas security mode command (selected nas algorithms, eksi, me identity request, ue security capability) message to the ue. me identity request may be included when nas smc is combined with me identity retrieval (see clause?5.3.10.5).
2. the ue responds nas with security mode complete (nas-mac, me identity) message. the ue includes the me identity if it was requested in step?1.
note: the nas security mode command procedure is typically executed as part of the attach procedure (see clause?5.3.2.1) in advance of, or in combination with, executing the me identity check procedure (see clause?5.3.10.5) and in the tau procedure (see clauses?5.3.3.1 and 5.3.3.2).
more details of the procedure are described in ts?33.401?[41].
5.3.10.5 me identity check procedure
the mobile equipment identity check procedure permits the operator(s) of the mme and/or the hss and/or the pdn?gw to check the mobile equipment's identity (e.g. to check that it has not been stolen, or, to verify that it does not have faults).
the me identity can be checked by the mme passing it to an equipment identity register (eir) and then the mme analysing the response from the eir in order to determine its subsequent actions (e.g. sending an attach reject if the eir indicates that the mobile equipment is blacklisted).
the me identity check procedure is illustrated in figure 5.3.10.5-1.

figure 5.3.10.5-1: identity check procedure
1. the mme sends identity request (identity type) to the ue. the ue responds with identity response (mobile identity).
2. if the mme is configured to check the imei against the eir, it sends me identity check (me identity, imsi) to eir. the eir responds with me identity check ack (result).
note: the identity check procedure is typically executed as part of the attach procedure (see clause?5.3.2.1).
5.3.11 ue reachability procedures
5.3.11.1 general
there are two procedures necessary for any service related entity that would need to be notified by the reachability of the ue at epc nas level:
- ue reachability notification request procedure; and
- ue activity notification procedure.
5.3.11.2 ue reachability notification request procedure
the ue reachability notification request procedure is illustrated in figure?5.3.11.2-1.

figure 5.3.11.2-1: ue reachability notification request procedure
1) if a service-related entity requests the hss to provide an indication regarding ue reachability on eps, the hss stores the service-related entity and sets the urrp-mme parameter to indicate that such request is received. if the value of urrp-mme parameter has changed from "not set" to "set", the hss sends a ue-reachability-notification-request (urrp-mme) to the mme. if the mme has an mm context for that user, the mme sets urrp-mme to indicate the need to report to the hss information regarding changes in ue reachability, e.g. when the next nas activity with that ue is detected.
5.3.11.3 ue activity notification procedure
the ue activity notification procedure is illustrated in figure?5.3.11.3-1.

figure 5.3.11.3-1: ue activity procedure
1) the mme receives an indication regarding ue reachability, e.g. an attach request message from the ue or mme receive an indication from s gw that ue has handed over to non-3gpp coverage.
2) if the mme contains an mm context of the ue and if urrp-mme for that ue is configured to report once that the ue is reachable, the mme shall send a ue-activity-notification (imsi, ue-reachable) message to the hss and clears the corresponding urrp-mme for that ue.
3) when the hss receives the ue-activity-notification (imsi, ue-reachable) message or the update location message for an ue that has urrp-mme set, it triggers appropriate notifications to the entities that have subscribed to the hss for this notification and clears the urrp-mme for that ue.
5.3.12 update csg location procedure
the update csg location procedure takes place when the sgsn/mme needs to retrieve the csg subscription information of the ue from the css.

figure 5.3.12-1: update csg location procedure
1. the sgsn/mme sends update csg location request (mme identity, imsi, msisdn) to the css. the msidsn is included if available.
2. the css acknowledges the update csg location message by sending an update csg location ack (imsi, csg subscription data) message to the sgsn/mme.
5.3.13 css subscription data management function procedure
5.3.13.1 general
the css subscription data management function allows the css to update the css subscription data stored in the mme.
the css subscription data is stored and managed in the mme independently from the subscription data received from the hss.
whenever the css subscription data is changed for a user in the css, and the changes affect the csg subscription information stored in the mme, the mme shall be informed about these changes by the means of the following procedure:
- insert csg subscriber data procedure, used to add or modify the css subscription data in the mme.
5.3.13.2 insert csg subscriber data procedure
the insert csg subscriber data procedure is illustrated in figure 5.3.13.2-1.

figure 5.3.13.2-1: insert csg subscriber data procedure
1. the css sends an insert csg subscriber data (imsi, csg subscription data) message to the mme.
2. the mme updates the stored csg subscription data and acknowledges the insert csg subscriber data message by returning an insert csg subscriber data ack (imsi) message to the css. the update result should be contained in the ack message.
 the mme initiates appropriate action according to the changed csg subscriber data. if the ue is in ecm-connected state and connected via a csg or hybrid cell, the mme shall check the received csg subscriber data. if the mme detects that the csg membership to that cell has changed or expired, the mme initiates the procedure in clause?5.16.
5.3.14 ue radio capability match request
if the mme, e.g. based on srvcc capability in nas, ue usage type or local policy, requires more information on the ue radio capabilities support to be able to set the ims voice over ps session supported indication (see clause?4.3.5.8), then the mme may send a ue radio capability match request message to the enb. this procedure is typically used during the initial attach procedure, during tracking area update procedure for the "first tau following geran/utran attach" or for "ue radio capability update" or when mme has not received the voice support match indicator (as part of the mm context).

figure 5.3.14-1: ue radio capability match request
1 the mme indicates whether the mme wants to receive voice support match indicator. the mme may include the ue radio capability information that it has previously received from the enb via a s1-ap ue capability info indication as described in clause?5.11.2.
2. upon receiving a ue radio capability match request from the mme, if the enb has not already received the ue radio capabilities from the ue or from mme in step?1, the enb requests the ue to upload the ue radio capability information by sending the rrc ue capability enquiry.
3. the ue provides the enb with its ue radio capabilities sending the rrc ue capability information.
4. the enb checks whether the ue radio capabilities are compatible with the network configuration for ensuring voice service continuity of voice calls initiated in ims.
 for determining the appropriate ue radio capability match response, the enb is configured by the operator to check whether the ue supports certain capabilities required for voice continuity of voice calls using ims ps. in a shared network, the enb keeps a configuration separately per plmn.
note?1: what checks to perform depends on network configuration, i.e. following are some examples of ue capabilities to be taken into account:
- the srvcc, and utran/e-utran voice over ps capabilities;
- the radio capabilities for utran/e-utran fdd and/or tdd; and/or
- the support of utran/e-utran frequency bands.
note?2: the network configuration considered in the decision for the voice support match indicator is homogenous within a certain area (e.g. mme pool area) in order to guarantee that the voice support match indicator from the enb is valid within such area.
 the enb provides a voice support match indicator to the mme to indicate whether the ue capabilities and networks configuration are compatible for ensuring voice service continuity of voice calls initiated in ims.
 the mme stores the received voice support match indicator in the mm context and uses it as an input for setting the ims voice over ps session supported indication.
5. if enb requested radio capabilities from ue in step?2 and 3, enb also sends the ue radio capabilities to the mme using the s1-ap ue capability info indication. the mme stores the ue radio capabilities without interpreting them for further provision to the enb in cases described in clause?5.11.2.
note?3: steps 4 and 5 may be received by the mme in any order.
5.4 session management, qos and interaction with pcc functionality
5.4.1 dedicated bearer activation
the dedicated bearer activation procedure for a gtp based s5/s8 is depicted in figure 5.4.1-1. this procedure shall not be used when the ue is accessing over nb-iot (i.e. rat type = nb-iot).

figure 5.4.1-1: dedicated bearer activation procedure
note?1: steps 3-10 are common for architecture variants with gtp based s5/s8 and pmip-based s5/s8. for an pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 1, 2, 11 and 12 concern gtp based s5/s8.
1. if dynamic pcc is deployed, the pcrf sends a pcc decision provision (qos policy) message to the pdn gw. this corresponds to the initial steps of the pcrf-initiated ip can session modification procedure or to the pcrf response in the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], up to the point that the pdn gw requests ip can bearer signalling. the pcc decision provision message may indicate that user location information and/or ue time zone information is to be provided to the pcrf as defined in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw may apply local qos policy.
2. the pdn gw uses this qos policy to assign the eps bearer qos, i.e., it assigns the values to the bearer level qos parameters qci, arp, gbr and mbr; see clause 4.7.3. if this dedicated bearer is created as part of the handover procedure from non-3gpp access with gtp-based s2a/s2b, then the pdn gw applies the charging id already in use for the corresponding dedicated bearer while the ue was in non-3gpp access (i.e bearer with the same qci and arp as in non-3gpp access). otherwise, the pdn gw generates a charging id for the dedicated bearer. the pdn gw sends a create bearer request message (imsi, pti, eps bearer qos, maximum packet loss rate (ul, dl), tft, s5/s8 teid, charging id, lbi, protocol configuration options) to the serving gw, the linked eps bearer identity (lbi) is the eps bearer identity of the default bearer. the procedure transaction id (pti) parameter is only used when the procedure was initiated by a ue requested bearer resource modification procedure - see clause 5.4.5. protocol configuration options may be used to transfer application level parameters between the ue and the pdn gw (see ts?23.228?[52]), and are sent transparently through the mme and the serving gw.
note?2: the pco is sent in the dedicated bearer activation procedure either in response to a pco received from the ue, or without the need to send a response to a ue provided pco e.g. when the network wants the bearer to be dedicated for ims signalling.
 for a qci=1 bearer, the maximum packet loss rate (ul, dl) may be provided by the pdn gw as described in ts?23.203?[6].
3. the serving gw sends the create bearer request (imsi, pti, eps bearer qos, maximum packet loss rate (ul, dl), tft, s1-teid, pdn gw teid (gtp-based s5/s8), lbi, protocol configuration options) message to the mme. if the ue is in ecm-idle state the mme will trigger the network triggered service request from step 3 (which is specified in clause 5.3.4.3). in that case the following steps 4-7 may be combined into network triggered service request procedure or be performed stand-alone. the mme checks if the ue can support the establishment of additional UP radio bearer based on the maximum number of UP radio bearers indicated by nb-iot ue in the ue network capability ie as defined in clause?5.11.3 and for wb-e-utran in clause?4.12.
 if the ue is in ecm-idle state and extended idle mode drx is enabled for the ue, the mme will trigger network triggered service request from step?3 (which is specified in clause?5.3.4.3), and start a timer which is configured to a value smaller than the gtp re-transmission timer. if the mme receives no response from the ue before the timer expires, the mme sends a create bearer response with a rejection cause indicating that the ue is temporarily not reachable due to power saving and, if a delay tolerant connection indication was set for the pdn connection, the mme sets the internal flag pending network initiated pdn connection signalling. the rejection is forwarded by the serving gw to the pdn gw. in this case, the steps 4-11 are skipped.
note?3: if isr is activated and the serving gw does not have a downlink s1-u and the sgsn has notified the serving gw that the ue has moved to pmm-idle or standby state, the serving gw sends downlink data notification to trigger mme and sgsn to page the ue (as specified in clause?5.3.4.3) before sending the create bearer request message.
4. the mme selects an eps bearer identity, which has not yet been assigned to the ue. the mme then builds a session management request including the pti, tft, eps bearer qos parameters (excluding arp), protocol configuration options, the eps bearer identity, the linked eps bearer identity (lbi) and a wlan offloadability indication. if the ue has utran or geran capabilities and the network supports mobility to utran or geran, the mme uses the eps bearer qos parameters to derive the corresponding pdp context parameters qos negotiated (r99 qos profile), radio priority, packet flow id and ti and includes them in the session management request. if the ue indicated in the ue network capability it does not support bss packet flow procedures, then the mme shall not include the packet flow id. the mme then signals the bearer setup request (eps bearer identity, eps bearer qos, maximum packet loss rate (ul, dl), session management request, s1-teid) message to the enodeb.
 the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan as described in clause?4.3.23.
5. the enodeb maps the eps bearer qos to the radio bearer qos. it then signals a rrc connection reconfiguration (radio bearer qos, session management request, eps rb identity) message to the ue. the ue shall store the qos negotiated, radio priority, packet flow id and ti, which it received in the session management request, for use when accessing via geran or utran. the ue nas stores the eps bearer identity and links the dedicated bearer to the default bearer indicated by the linked eps bearer identity (lbi). the ue uses the uplink packet filter (ul tft) to determine the mapping of traffic flows to the radio bearer. the ue may provide the eps bearer qos parameters to the application handling the traffic flow. the application usage of the eps bearer qos is implementation dependent. the ue shall not reject the rrc connection reconfiguration on the basis of the eps bearer qos parameters contained in the session management request.
note?4: how the enb uses the maximum packet loss rate (ul, dl) for handover threshold decision, if provided, is out of scope of 3gpp specifications.
note?5: the details of the radio bearer qos are specified in ts?36.300?[5].
6. the ue acknowledges the radio bearer activation to the enodeb with a rrc connection reconfiguration complete message.
7. the enodeb acknowledges the bearer activation to the mme with a bearer setup response (eps bearer identity, s1-teid) message. the enodeb indicates whether the requested eps bearer qos could be allocated or not.
 the mme shall be prepared to receive this message either before or after the session management response message (sent in step?9).
8. the ue nas layer builds a session management response including eps bearer identity. the ue then sends a direct transfer (session management response) message to the enodeb.
9. the enodeb sends an uplink nas transport (session management response) message to the mme.
10. upon reception of the bearer setup response message in step 7 and the session management response message in step 9, the mme acknowledges the bearer activation to the serving gw by sending a create bearer response (eps bearer identity, s1-teid, user location information (ecgi)) message.
11. the serving gw acknowledges the bearer activation to the pdn gw by sending a create bearer response (eps bearer identity, s5/s8-teid, user location information (ecgi)) message.
12. if the dedicated bearer activation procedure was triggered by a pcc decision provision message from the pcrf, the pdn gw indicates to the pcrf whether the requested pcc decision (qos policy) could be enforced or not, allowing the completion of the pcrf-initiated ip can session modification procedure or the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], after the completion of ip can bearer signalling. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
 if the dedicated bearer activation is rejected with a cause indicating that the ue is temporarily not reachable due to power saving, then the pdn gw re-attempts the same procedure after it receives the indication that the is ue available for end to end signalling in the subsequent modify bearer request message.
note?6: the exact signalling of step 1 and 12 (e.g. for local break-out) is outside the scope of this specification. this signalling and its interaction with the dedicated bearer activation procedure are to be specified in ts?23.203?[6]. steps 1 and 12 are included here only for completeness.
5.4.2 bearer modification with bearer qos update
5.4.2.1 pdn gw initiated bearer modification with bearer qos update
the pdn?gw initiated bearer modification procedure (including eps bearer qos update) for a gtp based s5/s8 is depicted in figure 5.4.2.1-1. this procedure is used in cases when one or several of the eps bearer qos parameters qci, gbr, mbr or arp are modified (including the qci or the arp of the default eps bearer e.g. due to the hss initiated subscribed qos modification procedure, as described in clause?5.4.2.2) or to modify the apn-ambr. modification from a qci of resource type non-gbr to a qci of resource type gbr and vice versa is not supported by this procedure.
note?1: the qci of an existing dedicated bearer should only be modified if no additional bearer can be established with the desired qci.

figure 5.4.2.1-1: bearer modification procedure with bearer qos update
note?2: steps 3-10 are common for architecture variants with gtp based s5/s8 and pmip-based s5/s8. for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 1, 2, 11 and 12 concern gtp based s5/s8.
1. if dynamic pcc is deployed, the pcrf sends a pcc decision provision (qos policy) message to the pdn gw. this corresponds to the initial steps of the pcrf-initiated ip can session modification procedure or to the pcrf response in the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], up to the point that the pdn gw requests ip can bearer signalling. the pcc decision provision message may indicate that user location information and/or ue time zone information is to be provided to the pcrf as defined in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw may apply local qos policy.
2. the pdn gw uses this qos policy to determine that the authorized qos of a SDF has changed or that a SDF shall be aggregated to or removed from an active bearer. the pdn gw generates the tft and updates the eps bearer qos to match the traffic flow aggregate. the pdn gw then sends the update bearer request (pti, eps bearer identity, eps bearer qos, apn-ambr, tft, maximum packet loss rate (ul, dl)) message to the serving gw. the procedure transaction id (pti) parameter is used when the procedure was initiated by a ue requested bearer resource modification procedure - see clause?5.4.5. for apn-ambr, the eps bearer identity must refer to a non-gbr bearer.
 for a qci=1 bearer, the maximum packet loss rate (ul, dl) may be provided by the pdn gw as described in ts?23.203?[6].
3. the serving gw sends the update bearer request (pti, eps bearer identity, eps bearer qos, tft, apn ambr, maximum packet loss rate (ul, dl)) message to the mme. if the ue is in ecm idle state the mme will trigger the network triggered service request from step?3 (which is specified in clause?5.3.4.3). in that case the following steps?4 7 may be combined into network triggered service request procedure or be performed stand-alone. if only the qos parameter arp is modified and if the ue is in ecm idle state the mme shall skip the network triggered service request. in that case the following steps 4-9 are also skipped and the mme sends an update bearer response to the serving gw.
 if extended idle mode drx is enabled for the ue, the mme will trigger network triggered service request from step?3 (which is specified in clause?5.3.4.3), and start a timer which is configured to a value smaller than the gtp re-transmission timer. if the mme receives no response from the ue before the timer expires, the mme sends an update bearer response with a rejection cause indicating that the ue is temporarily not reachable due to power saving and, if a delay tolerant connection indication was set for the pdn connection, the mme sets the internal flag pending network initiated pdn connection signalling. the rejection is forwarded by the serving gw to the pdn gw. in this case, the steps 4-11 are skipped.
note?3: if isr is activated and the serving gw does not have a downlink s1-u and the sgsn has notified the serving gw that the ue has moved to pmm-idle or standby state, the serving gw sends downlink data notification to trigger mme and sgsn to page the ue (as specified in clause?5.3.4.3) before sending the update bearer request message.
4. the mme builds a session management request including the pti, eps bearer qos parameters (excluding arp), tft, apn ambr, eps bearer identity and a wlan offloadability indication. if the ue has utran or geran capabilities and the network supports mobility to utran or geran, the mme uses the eps bearer qos parameters to derive the corresponding pdp context parameters qos negotiated (r99 qos profile), radio priority and packet flow id and includes them in the session management request. if the ue indicated in the ue network capability it does not support bss packet flow procedures, then the mme shall not include the packet flow id. if the apn ambr has changed the mme may update the ue ambr if appropriate. the mme then sends the bearer modify request (eps bearer identity, eps bearer qos, session management request, ue ambr, maximum packet loss rate (ul, dl)) message to the enodeb.
 the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan as described in clause?4.3.23.
5. the enodeb maps the modified eps bearer qos to the radio bearer qos. it then signals a rrc connection reconfiguration (radio bearer qos, session management request, eps rb identity) message to the ue. the ue shall store the qos negotiated, radio priority, packet flow id, which it received in the session management request, for use when accessing via geran or utran. if the apn-ambr has changed, the ue stores the modified apn-ambr value and sets the mbr parameter of the corresponding non-gbr pdp contexts (of this pdn connection) to the new value. the ue uses the uplink packet filter (ul tft) to determine the mapping of traffic flows to the radio bearer. the ue may provide eps bearer qos parameters to the application handling the traffic flow(s). the application usage of the eps bearer qos is implementation dependent. the ue shall not reject the radio bearer modify request on the basis of the eps bearer qos parameters contained in the session management request. the ue shall set its tin to "guti" if the modified eps bearer was established before isr activation.
note?4: the details of the radio bearer qos are specified in ts?36.300?[5].
6. the ue acknowledges the radio bearer modification to the enodeb with a rrc connection reconfiguration complete message.
7. the enodeb acknowledges the bearer modification to the mme with a bearer modify response (eps bearer identity) message. with this message, the enodeb indicates whether the requested eps bearer qos could be allocated or not.
 the mme shall be prepared to receive this message either before or after the session management response message (sent in step?9).
8. the ue nas layer builds a session management response including eps bearer identity. the ue then sends a direct transfer (session management response) message to the enodeb.
9. the enodeb sends an uplink nas transport (session management response) message to the mme.
10. upon reception of the bearer modify response message in step 7 and the session management response message in step 9, the mme acknowledges the bearer modification to the serving gw by sending an update bearer response (eps bearer identity, user location information (ecgi)) message.
11. the serving gw acknowledges the bearer modification to the pdn gw by sending an update bearer response (eps bearer identity, user location information (ecgi)) message.
12. if the bearer modification procedure was triggered by a pcc decision provision message from the pcrf, the pdn gw indicates to the pcrf whether the requested pcc decision (qos policy) could be enforced or not by sending a provision ack message allowing the completion of the pcrf-initiated ip can session modification procedure or the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], after the completion of ip can bearer signalling. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
 if the bearer modification is rejected with a cause indicating that the ue is temporarily not reachable due to power saving, then the pdn gw re-attempts the same procedure after it receives the indication that the is ue available for end to end signalling in the subsequent modify bearer request message.
note?5: the exact signalling of step 1 and 12 (e.g. for local break-out) is outside the scope of this specification. this signalling and its interaction with the bearer activation procedure are to be specified in ts?23.203?[6]. steps 1 and 12 are included here only for completeness.
5.4.2.2 hss initiated subscribed qos modification
the hss initiated subscribed qos modification for a gtp-based s5/s8 is depicted in figure 5.4.2.2-1.

figure 5.4.2.2-1: hss initiated subscribed qos modification
note?1: for a pmip-based s5/s8, procedure steps (a) and steps (b) are defined in ts?23.402?[2]. steps?3, 4, 5, 7 and 8 concern gtp based s5/s8.
1. the hss sends an insert subscriber data (imsi, subscription data) message to the mme. the subscription data includes eps subscribed qos (qci, arp) and the subscribed ue-ambr and apn ambr.
1a. the mme updates the stored subscription data and acknowledges the insert subscriber data message by returning an insert subscriber data ack (imsi) message to the hss (see clause?5.3.9.2).
2a if only the subscribed ue-ambr has been modified, the mme calculates a new ue-ambr value as described in clause?4.7.3 and may then signal a modified ue-ambr value to the enodeb by using s1-ap ue context modification procedure. the hss initiated subscribed qos modification procedure ends after completion of the ue context modification procedure.
2b. if the qci and/or arp and/or subscribed apn-ambr has been modified and there is related active pdn connection with the modified qos profile the mme sends the modify bearer command (eps bearer identity, eps bearer qos, apn ambr) message to the serving gw. the eps bearer identity identifies the default bearer of the affected pdn connection. the eps bearer qos contains the eps subscribed qos profile to be updated.
3. the serving gw sends the modify bearer command (eps bearer identity, eps bearer qos, apn ambr) message to the pdn gw.
4. if pcc infrastructure is deployed, the pdn gw informs the pcrf about the updated eps bearer qos and apn-ambr. the pcrf sends new updated pcc decision to the pdn gw. this corresponds to the pcef-initiated ip can session modification procedure as defined in ts?23.203?[6].
 the pcrf may modify the apn-ambr and the qos parameters (qci and arp) associated with the default bearer in the response to the pdn gw as defined in ts?23.203?[6].
5. the pdn gw modifies the default bearer of each pdn connection corresponding to the apn for which subscribed qos has been modified. if the subscribed arp parameter has been changed, the pdn?gw shall also modify all dedicated eps bearers having the previously subscribed arp value unless superseded by pcrf decision. the pdn gw then sends the update bearer request (eps bearer identity, eps bearer qos, tft, apn ambr) message to the serving gw.
note?2: as no pti is included the mme use protocol specific details, as described in ts?29.274?[43], to determine if the update bearer request was triggered by this procedure or not.
6. if the qci and/or arp parameter(s) have been modified, steps 3 to 10, as described in clause?5.4.2.1, figure 5.4.2.1-1, are invoked. if neither the qci nor the arp have been modified, but instead only the apn-ambr was updated, steps 3 to 8, as described in clause?5.4.3, figure 5.4.3-1, are invoked.
7. the serving gw acknowledges the bearer modification to the pdn gw by sending an update bearer response (eps bearer identity, user location information (ecgi)) message. if the bearer modification fails the pdn gw deletes the concerned eps bearer.
8. the pdn gw indicates to the pcrf whether the requested pcc decision was enforced or not by sending a provision ack message.
5.4.3 pdn gw initiated bearer modification without bearer qos update
the bearer modification procedure without bearer qos update is used to update the tft for an active default or dedicated bearer, to modify the apn-ambr, to retrieve user location from the mme, to inform pco to ue or to instruct the mme (e.g. to activate/deactivate the location reporting).
the procedure for a gtp based s5/s8 is depicted in figure 5.4.3 1. in this procedure there is no need to update the underlying radio bearer(s). this procedure may be triggered if the apn ambr is changed by the pcrf/pdn gw.

figure 5.4.3-1: bearer modification procedure without bearer qos update
note?1: steps 3-8 are common for architecture variants with gtp based s5/s8 and pmip-based s5/s8. for an pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 1, 2, 9 and 10 concern gtp based s5/s8. steps?3-8 may also be used within the hss initiated subscribed qos modification.
1. if dynamic pcc is deployed, the pcrf sends a pcc decision provision (qos policy) message to the pdn gw. this corresponds to the beginning of the pcrf-initiated ip-can session modification procedure or to the pcrf response in the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], up to the point that the pdn gw requests ip-can bearer signalling. the pcc decision provision message may indicate that user location information and/or ue time zone information is to be provided to the pcrf as defined in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw may apply local qos policy.
2. the pdn gw uses this qos policy to determine that a SDF shall be aggregated to or removed from an active bearer. the pdn gw generates the tft and determines that no update of the eps bearer qos is needed. the pdn gw then sends the update bearer request (pti, eps bearer identity, apn-ambr, tft, retrieve location) message to the serving gw. the procedure transaction id (pti) parameter is used when the procedure was initiated by a ue requested bearer resource modification procedure - see clause?5.4.5. "retrieve location" is indicated if requested by the pcrf. if the pdn gw initiated bearer modification procedure was triggered by a ue requested bearer resource modification procedure and if 3gpp ps data off ue status was present in the bearer resource command pco, the pdn gw shall include the 3gpp ps data off support indication in the update bearer request pco.
3. the serving gw sends the update bearer request (pti, eps bearer identity, apn-ambr, tft, retrieve location) message to the mme. if the ue is in ecm-idle state (and extended idle mode drx is not enabled) the mme will trigger the network triggered service request from step 3 (which is specified in clause 5.3.4.3). in that case the following steps 4-7 may be combined into network triggered service request procedure or be performed stand-alone. if both the pco and the tft are absent and the apn-ambr has not been modified, the mme shall skip the following steps 4-7.
 if the ue is in ecm-idle state and extended idle mode drx is enabled for the ue, the mme will trigger network triggered service request from step?3 (which is specified in clause?5.3.4.3), , and start a timer which is configured to a value smaller than the gtp re-transmission timer . if the mme receives no response from the ue before the timer expires, the mme sends an update bearer response with a rejection cause indicating that ue is temporarily not reachable due to power saving and then sets the internal flag pending network initiated pdn connection signalling. the rejection is forwarded by the serving gw to the pdn gw. in this case, the steps 4-9 are skipped.
note?2: if isr is activated and the serving gw does not have a downlink s1-u and the sgsn has notified the serving gw that the ue has moved to pmm-idle or standby state, the serving gw sends downlink data notification to trigger mme and sgsn to page the ue (as specified in clause?5.3.4.3) before sending the update bearer request message.
note?3: the pco can be set by the pdn gw in accordance with the ts?23.380?[75].
4. the mme builds a session management request message including the tft, apn-ambr, eps bearer identity and a wlan offloadability indication. the mme then sends a downlink nas transport (session management configuration) message to the enodeb. if the apn ambr has changed, the mme may also update the ue ambr. and if the ue-ambr is updated, the mme signal a modified ue-ambr value to the enodeb by using s1-ap ue context modification procedure.
 the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan as described in clause?4.3.23.
5. the enodeb sends the direct transfer (session management request) message to the ue. the ue uses the uplink packet filter (ul tft) to determine the mapping of traffic flows to the radio bearer. the ue stores the modified apn-ambr value and sets the mbr parameter of the corresponding non-gbr pdp contexts (of this pdn connection) to the new value. the ue shall set its tin to "guti" if the modified eps bearer was established before isr activation.
6. the ue nas layer builds a session management response including eps bearer identity. the ue then sends a direct transfer (session management response) message to the enodeb.
7. the enodeb sends an uplink nas transport (session management response) message to the mme.
8. if the procedure is performed without steps 4-7 and location retrieval is requested and the ue is ecm_connected and unless the mme is configured not to retrieve ecgi from the enodeb under this condition, the mme uses the location reporting procedure described in clause?5.9.1 to retrieve the ecgi from the enodeb. the mme acknowledges the bearer modification to the serving gw by sending an update bearer response (eps bearer identity, user location information (ecgi)) message. the mme includes the last known user location information.
note?4: based on operator policy and local regulation the mme may, instead of using the location reporting procedure described in clause?5.9.1 to retrieve the ecgi from the enodeb, use the last known user location information obtained from e.g. attach procedure, tracking area update procedure, etc.
9. the serving gw acknowledges the bearer modification to the pdn gw by sending an update bearer response (eps bearer identity, user location information (ecgi)) message.
10. if the bearer modification procedure was triggered by a pcc decision provision message from the pcrf, the pdn gw indicates to the pcrf whether the requested pcc decision (qos policy) could be enforced or not by sending a provision ack message. this then allows the pcrf-initiated ip can session modification procedure or the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6] to continue and eventually conclude, proceeding after the completion of ip can bearer signalling. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
 if the bearer modification is rejected with a cause indicating that the ue is temporarily not reachable due to power saving, then the pdn gw re-attempts the same procedure after it receives the indication that the is ue available for end to end signalling in the subsequent modify bearer request message.
note?5: the exact signalling of step 1 and 10 (e.g. for local break-out) is outside the scope of this specification. this signalling and its interaction with the bearer activation procedure are to be specified in ts?23.203?[6]. steps 1 and 10 are included here only for completeness.
5.4.4 bearer deactivation
5.4.4.1 pdn gw initiated bearer deactivation
the bearer deactivation procedure for a gtp based s5/s8 is depicted in figure 5.4.4.1-1. this procedure can be used to deactivate a dedicated bearer or deactivate all bearers belonging to a pdn address. if the default bearer belonging to a pdn connection is deactivated, the pdn gw deactivates all bearers belonging to the pdn connection.
when the last bearer belonging to the last pdn connection of a given apn is released, the pgw may forward to the mme the apn rate control status for storing it in the mm context according to clause?4.7.7.3.

figure 5.4.4.1-1: pdn gw initiated bearer deactivation
note?1: steps 3-8 are common for architecture variants with gtp based s5/s8 and pmip-based s5/s8. for an pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 1, 2, 9 and 10 concern gtp-based s5/s8.
1. if dynamic pcc is not deployed, the pdn gw is triggered to initiate the bearer deactivation procedure due either a qos policy or on request from the mme (as outlined in clause 5.4.4.2) or on intra-node signalling request from the henb to release the lipa pdn connection. optionally, the pcrf sends qos policy to the pdn gw. this corresponds to the initial steps of the pcrf-initiated ip can session modification procedure or the response to the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], up to the point that the pdn gw requests ip can bearer signalling. the pcc decision provision message may indicate that user location information and/or ue time zone information is to be provided to the pcrf as defined in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw may apply local qos policy. the pdn gw initiated bearer deactivation is also performed when handovers occur from 3gpp to non-3gpp, in which case, the default bearer and all the dedicated bearers associated with the pdn address are released, but the pdn address is kept in the pdn gw.
 for an emergency pdn connection the pdn gw initiates the deactivation of all bearers of that emergency pdn connection when the pdn connection is inactive (i.e. not transferring any packets) for a configured period of time or when triggered by dynamic pcc.
2. the pdn gw sends a delete bearer request (pti, eps bearer identity, causes and, optionally, apn rate control status according to clause?4.7.7.3) message to the serving gw. the procedure transaction id (pti) parameter in this step and in the following steps is only used when the procedure was initiated by a ue requested bearer resource modification procedure - see clause?5.4.5. this message can include an indication that all bearers belonging to that pdn connection shall be released. the pdn gw includes 'cause' ie in the delete bearer request message and sets the ie to 'rat changed from 3gpp to non-3gpp' if the delete bearer request message is caused by a handover from 3gpp to non-3gpp.
3a. the serving gw sends the delete bearer request (pti, eps bearer identity, cause and, optionally, apn rate control status) message to the mme. this message can include an indication that all bearers belonging to that pdn connection shall be released.
3b. if isr is activated, the serving gw sends the delete bearer request (pti, eps bearer identity, cause) message to the sgsn. this message can include an indication that all bearers belonging to that pdn connection shall be released, and the sgsn releases all bearer resources of the pdn connection.
note?2: if all the bearers belonging to a ue are released due to a handover from 3gpp to non-3gpp, the sgsn changes the mm state of the ue to idle (geran network) or pmm-detached (utran network).
 if isr is activated, upon receiving delete bearer request from sgw for the last pdn connection for a given ue, mme shall locally de-activate isr.
note?3: in this case, sgsn locally de-activates isr as well (see ts?23.060?[7]).
 if received, the mme stores the apn rate control status in the mm context.
steps 4 to 7 are not performed if at least one of the following three conditions is fulfilled:
(i) the ue is in ecm-idle and the last pdn connection of the ue is not being deleted and the delete bearer request received from the serving gw does not contain the cause "reactivation requested", which has been sent from the pdn gw;
(ii) ue is in ecm-idle and the last pdn connection is deleted due to isr deactivation;
(iii) ue is in ecm-idle and the last pdn connection is deleted in 3gpp due to handover to non-3gpp access.
when steps 4 to 7 are not performed, the eps bearer state is synchronized between the ue and the network at the next ecm-idle to ecm-connected transition (e.g. service request or tau procedure).
4a. if the last pdn connection of a ue that does not support "attach without pdn connectivity" is being released and the bearer deletion is neither due to isr deactivation nor due to handover to non-3gpp accesses, the mme explicitly detaches the ue by sending a detach request message to the ue. if the ue is in ecm-idle state the mme initiates paging via network triggered service request procedure in clause?5.3.4.3 from step?3a onwards in order to inform ue of the request. steps?4b to 7b are skipped in this case, and the procedure continues from step?7c.
4b. if the ue is in ecm-idle state and the reason for releasing pdn connection is "reactivation requested", the mme initiates paging via network triggered service request procedure in clause?5.3.4.3 from step?3a onwards in order to inform ue of the request and step?4c is performed after completion of the paging.
4c. if the release of the bearer in e utran has already been signalled to the mme, steps?4c to 7 are omitted. otherwise, if this is not the last pdn connection for the ue which is being released, the mme sends the s1-ap deactivate bearer request (eps bearer identity) message to the enodeb. the mme builds a nas deactivate eps bearer context request message including the eps bearer identity and a wlan offloadability indication, and includes it in the s1-ap deactivate bearer request message. when the bearer deactivation procedure was originally triggered by a ue request, the nas deactivate eps bearer context request message includes the pti.
 the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan as described in clause?4.3.23 if the pdn connection is not released.
5. the enodeb sends the rrc connection reconfiguration message including the eps radio bearer identity to release and the nas deactivate eps bearer context request message to the ue.
6a. the ue rrc releases the radio bearers indicated in the rrc message in step 5, and indicates the radio bearer status to the ue nas. then the ue nas removes the ul tfts and eps bearer identity according to the radio bearer status indication from the ue rrc. the ue responds to the rrc connection reconfiguration complete message to the enodeb.
6b. the enodeb acknowledges the bearer deactivation to the mme with a deactivate bearer response (eps bearer identity, ecgi, tai, pscell id, secondary rat usage data) message. if the plmn has configured secondary rat usage reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included.
 the pscell id is included if dual connectivity is active for the ue in the ran.
 the mme shall be prepared to receive this message either before or after the session management response message sent in step?7b, and before or after, any detach request message sent in step?7c.
7a the ue nas layer builds a deactivate eps bearer context accept message including eps bearer identity. the ue then sends a direct transfer (deactivate eps bearer context accept) message to the enodeb.
7b. the enodeb sends an uplink nas transport (deactivate eps bearer context accept) message to the mme.
7c. if the ue receives the detach request message from the mme in the step 4a, the ue sends a detach accept message to the mme any time after step 4a. the enodeb forwards this nas message to the mme along with the tai+ecgi of the cell which the ue is using.
note?4: the ue may not be able to send this message, e.g. when the ue is out of coverage of e-utran due to mobility to non-3gpp access.
7a,b,c if dual connectivity is active for the ue, the pscell id shall be included in the uplink nas transport sent by the enodeb.
8a. after reception of both the deactivate bearer response message in step?6b and the deactivate eps bearer context accept message in step?7b, the mme deletes the bearer context related to the deactivated eps bearer and acknowledges the bearer deactivation to the serving gw by sending a delete bearer response (eps bearer identity, user location information (ecgi), ran/nas release cause, secondary rat usage data) message. if the mme received secondary rat usage data in step?6b, the mme shall include it in this message. if extended idle mode drx is enabled, then the mme acknowledges the bearer deactivation to the serving gw and at the same time the mme initiates the deactivation towards the ue. if the s1 connection had already been released by the enb due to radio link failure and the mme receives a delete bearer request while it is still deferring the sending of the s1 release (see clause?5.3.5), the mme shall include in the delete bearer response the ran/nas cause received in the s1 release due to radio link failure procedure.
8b the sgsn deletes pdp context related to the deactivated eps bearer and acknowledges the bearer deactivation to the serving gw by sending a delete bearer response (eps bearer identity, user location information (cgi/sai)) message. if extended idle mode drx is enabled, then the sgsn acknowledges the bearer deactivation to the serving gw and at the same time the sgsn initiates the deactivation towards the ue.
9. if isr is activated, after receiving the two delete bearer response messages from the mme and the sgsn, or if isr is not activated, after receiving the delete bearer response messages from the mme, the serving gw deletes the bearer context related to the deactivated eps bearer acknowledges the bearer deactivation to the pdn gw by sending a delete bearer response (eps bearer identity, user location information (ecgi or cgi/sai), secondary rat usage data) message. if the mme and/or sgsn sent ue's location information and/or ue time zone in step?8a and/or step?8b, the serving gw includes the user location information and/or ue time zone information with the least age in this message. the serving gw includes the secondary rat usage data if it was received in step?8a and if pgw secondary rat usage data reporting is active.
10. the pdn gw deletes the bearer context related to the deactivated eps bearer. if the dedicated bearer deactivation procedure was triggered by receiving a pcc decision message from the pcrf, the pdn gw indicates to the pcrf whether the requested pcc decision was successfully enforced by completing the pcrf-initiated ip can session modification procedure or the pcef initiated ip-can session modification procedure as defined in ts?23.203?[6], proceeding after the completion of ip can bearer signalling. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6]. if available, the pdn gw shall send ran/nas release cause to the pcrf as defined in ts?23.203?[6].
11. if the ue is being explicitly detached, the mme releases the s1-mme signalling connection for the ue by sending an s1 release command (cause) message to the enodeb. the details of this step are covered in the "s1 release procedure", as described in clause?5.3.5 by step 4 to step?6.
note?5: in the "s1 release procedure", if dual connectivity was active at the time of the release, the enodeb includes the pscell id.
note?6: the exact signalling of step 1 and 10 (e.g. for local break-out) is outside the scope of this specification. this signalling and its interaction with the dedicated bearer activation procedure are to be specified in ts?23.203?[6]. steps 1 and 10 are included here only for completeness.
if all the bearers belonging to a ue that does not support "attach without pdn connectivity" are released, the mme shall change the mm state of the ue to emm-deregistered and the mme sends the s1 release command to the enodeb, which initiates the release of the rrc connection for the given ue if it is not released yet, and returns an s1 release complete message to the mme.
if all bearers of an emergency attached ue are deactivated the mme may initiate the explicit mme-initiated detach procedure. regardless of the outcome of any explicit detach procedure the mme changes the emm state of the ue to emm-deregistered and the mme sends the s1 release command to the enodeb if it is not yet released.
if the default bearer belonging to a pdn connection is deactivated, the mme determines the maximum apn restriction for the remaining pdn connections and stores this new value for the maximum apn restriction. in addition if isr is activated the sgsn determines the maximum apn restriction for the remaining bearer contexts and stores this new value for the maximum apn restriction.
5.4.4.2 mme initiated dedicated bearer deactivation
mme initiated dedicated bearer deactivation is depicted in figure 5.4.4.2-1 below. this procedure deactivates dedicated bearers. default bearers are not affected. to initiate the release of the full pdn connection including the default bearer, the mme uses the ue or mme requested pdn disconnection procedure defined in clause?5.10.3.

figure 5.4.4.2-1: mme initiated dedicated bearer deactivation
note?1: for a pmip-based s5/s8, procedure steps (a) and steps (b) are defined in ts?23.402?[2]. steps 3, 4, 5 and?9 concern gtp based s5/s8
0. radio bearers for the ue in the ecm-connected state may be released due to local reasons (e.g. abnormal resource limitation or radio conditions do not allow the enodeb to maintain all the allocated gbr bearers: it is not expected that non-gbr bearers are released by the enodeb unless caused by error situations). the ue deletes the bearer contexts related to the released radio bearers.
1. when the enodeb releases radio bearers in step 0, it sends an indication of bearer release to the mme. this indication may be e.g. the bearer release request (eps bearer identity) message to the mme, or alternatively initial context setup complete, handover request ack and ue context response, path switch request may also indicate the release of a bearer.
 the enodeb includes the ecgi and tai in the indication sent to the mme. the enodeb also includes the pscell id if dual connectivity is active for the ue in the ran.
 if the plmn has configured secondary rat reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included.
2. the mme sends the delete bearer command (eps bearer identity, user location information, ue time zone, ran/nas release cause if available, secondary rat usage data) message per pdn connection to the serving gw to deactivate the selected dedicated bearer. ran/nas release cause indicates the ran release cause and/or the nas release cause. ran/nas release cause is only sent by the mme to the pdn gw if this is permitted according to mme operator's policy. if the mme received secondary rat usage data in step?1, the mme shall include it in this message.
3. the serving gw sends the delete bearer command (eps bearer identity, user location information, ue time zone, ran/nas release cause, secondary rat usage data) message per pdn connection to the pdn?gw. the serving gw includes the secondary rat usage data it in this message if it was received in the previous message and if pgw secondary rat usage data reporting is active.
4. if pcc infrastructure is deployed, the pdn gw informs the pcrf about the loss of resources by means of a pcef-initiated ip can session modification procedure as defined in ts?23.203?[6] and provides the user location information, ue time zone and ran/nas release cause (if available) received in the delete bearer command from the s-gw if requested by the pcrf as defined in ts?23.203?[6]. the pcrf sends an updated pcc decision to the pdn gw.
note?2: user location information and ue time zone might not be available if the mme or the serving gw are of a previous release and did not provide this information.
5. the pdn gw sends a delete bearer request (eps bearer identity) message to the serving gw.
6. the serving gw sends the delete bearer request (eps bearer identity) message to the mme.
7. steps between steps?4 and 7, as described in clause?5.4.4.1, are invoked. this is omitted if the bearer deactivation was triggered by the enodeb in step?0 and step?1.
 this is also omitted if the mme initiated bearer release due to failed bearer set up during handover, the ue and the mme deactivate the failed contexts locally without peer-to peer esm signalling.
8. the mme deletes the bearer contexts related to the deactivated eps bearer and acknowledges the bearer deactivation to the serving gw by sending a delete bearer response (eps bearer identity, user location information (ecgi), secondary rat usage data) message. the mme includes the secondary rat usage data if it received this in step?7 from the enodeb.
9. the serving gw deletes the bearer context related to the deactivated eps bearer and acknowledges the bearer deactivation to the pdn gw by sending a delete bearer response (eps bearer identity, secondary rat usage data) message. the serving gw includes the secondary rat usage data if it was received in step?8 and if pgw secondary rat usage data reporting is active.
5.4.5 ue requested bearer resource modification
the ue requested bearer resource modification procedure for an e-utran is depicted in figure 5.4.5-1. the procedure allows the ue to request for a modification of bearer resources (e.g. allocation or release of resources) for one traffic flow aggregate with a specific qos demand. alternatively, the procedure allows the ue to request for the modification of the packet filters used for an active traffic flow aggregate, without changing qos. if accepted by the network, the request invokes either the dedicated bearer activation procedure, the bearer modification procedure or a dedicated bearer is deactivated using the pdn gw initiated bearer deactivation procedure. the procedure is used by the ue when the ue already has a pdn connection with the pdn gw. a ue can send a subsequent request bearer resource modification message before the previous procedure is completed. the ue requested bearer resource modification procedure is used to indicate the change of 3gpp ps data off ue status to the pdn gw via the pco, only if the ue has been previously informed that the pdn gw supports the 3gpp ps data off feature. when a ue supports only CP ciot eps optimisation as defined in clause?5.3.4b the ue need not support the ue requested bearer resource modification procedure in order to modify the traffic flow aggregate, as the ue does not support any drbs. the ue may need to support ue requested bearer resource modification procedure for other purposes, e.g. header compression negotiation, see ts?24.301?[46].
the ue supporting 15 eps bearers as defined in clause?4.12 shall not initiate a ue requested bearer resource modification procedure that would trigger the establishment of a new eps bearer, if it has already 8 eps bearers established and the ue has not received an indication for support of 15 eps bearers per ue or has received cause #65 "maximum number of eps bearers reached".
in this procedure the ue signals a traffic aggregate description (tad) which is a partial tft, together with a procedure transaction identifier (pti), and an eps bearer identity (when the tad operation is modify, delete or add to an existing packet filter). when the tad operation is modify or delete, the packet filter identifiers of the tad are the same as the tft packet filter identifiers of the referenced eps bearer (as the concatenation of the tft packet filter identifier and the eps bearer identifier represents a unique packet filter identifier within the pdn connection), for which resources are being modified. the tad is released by the ue after it has received a tft related to the current pti from the network.

figure 5.4.5-1: ue requested bearer resource modification
note?1: steps 1, 2, and 5 are common for architecture variants with gtp-based s5/s8 and pmip-based s5/s8. the procedure steps marked (a) differ in the case that pmip-based s5/s8 is employed and is defined in ts?23.402?[2].
if the bearer resource modification procedure is initiated for re-negotiation of header compression configuration for CP ciot eps optimisation, the mme shall not send bearer resource command message to the serving gw. in this case, the bearer modification procedures (according to clause?5.4.3) is invoked and only the steps from 4 to 7 are performed.
1. the ue sends a request bearer resource modification (lbi, pti, eps bearer identity, qos, tad, protocol configuration options) message to the mme. if the ue was in ecm-idle mode, this nas message is preceded by the service request procedure.
 the tad indicates one requested operation (add, modify, or delete packet filters). if traffic flows are added, the tad includes the packet filter(s) (consisting of the packet filter information including packet filter precedence, but without a packet filter identifier) to be added. the ue also sends the qci requested and gbr, if applicable, for the added traffic flows. if the ue wants to link the new packet filter(s) to an existing packet filter to enable the usage of existing bearer resources for the new packet filter(s), the ue shall provide an existing packet filter identifier together with the new packet filter(s). if the new packet filter(s) are not linked to an existing packet filter the ue shall provide at least one ul packet filter in the tad. in case a downlink only traffic flow(s) is to be added the ue shall provide an ul packet filter that effectively disallows any useful packet flows (see clause?15.3.3.4 of ts?23.060?[7] for an example of such packet filter).
note?2: receiving at least one ul packet filter from the ue ensures that a valid state for the tft settings of the pdn connection as defined in clause?15.3.0 of ts?23.060?[7] is maintained in case the tad add operation results in the establishment of a new dedicated eps bearer.
 if the ue wants to change the gbr in addition, the ue includes the gbr requirement of the eps bearer. the tad is released when the procedure is completed.
 when only requesting for a modification of gbr (i.e. decrease or increase), the tad shall include the existing packet filter identifier(s) for which the gbr change request applies to. the ue includes the gbr requirement of the eps bearer. the tad is released when the procedure is completed.
 when requesting for a modification of packet filter(s) (e.g. change of port number), the tad shall include packet filter identifier(s) for which the change request applies to together with the changed packet filter information.
 if the ue requests for deletion of traffic flows, the tad includes the packet filter identifier(s) to be deleted. if the packet filters to be deleted were mapped to a gbr bearer, the ue includes the new gbr requirement of the eps bearer.
 the ue sends the linked bearer id (lbi) only when the requested operation is add, to indicate to which pdn connection the additional bearer resource is linked to. the eps bearer identity is only sent when the requested operation is modify or delete. the procedure transaction id is dynamically allocated by the ue for this procedure. the ue should ensure as far as possible that previously used pti values are not immediately reused. the pti is released when the procedure is completed. protocol configuration options may be used to transfer application level parameters between the ue and the pdn gw (see ts?23.228?[52]), and are sent transparently through the mme and the serving gw.
 if the pdn gw indicated support for the 3gpp ps data off feature during pdn connection setup, the ue shall include in the pco the 3gpp ps data off support indication, which indicates whether the user has activated or deactivated 3gpp ps data off.
2. the mme sends the bearer resource command (imsi, lbi, pti, eps bearer identity, qos, tad, protocol configuration options) message to the selected serving gw. the mme validates the request using the linked bearer id. the same serving gw address is used by the mme as for the eps bearer identified by the linked bearer id received in the request bearer resource modification message.
3. the serving gw sends the bearer resource command (imsi, lbi, pti, eps bearer identity, qos, tad, protocol configuration options) message to the pdn gw. the serving gw sends the message to the same pdn gw as for the eps bearer identified by the linked bearer id.
4. the pdn gw may either apply a locally configured qos policy, or it may interact with the pcrf to trigger the appropriate pcc decision, which may take into account subscription information. this corresponds to the beginning of a pcef-initiated ip can session modification procedure as defined in ts?23.203?[6], up to the point that the pdn gw requests ip can bearer signalling. when interacting with pcrf, the pdn gw provides to the pcrf the content of the tad and, if applicable, the gbr change (increase or decrease) associated with the packet filter information contained in the tad. the gbr change is either calculated from the current bearer qos and the requested bearer qos from the ue, or set to the requested gbr if the tad indicates an add operation and no eps bearer identity was received. if the tad indicates an add operation, the requested qci is also provided to the pcrf unless an existing packet filter identifier is provided together with the new packet filter.
 the pcc decision provision message may indicate that user location information and/or ue time zone information is to be provided to the pcrf as defined in ts?23.203?[6].
 if the tad operation is modify, delete, a request for changing the gbr, or add with a link to existing packet filter(s), then the pdn gw provides to the pcrf the sdf filter identifier(s), previously assigned on gx, that correspond to the received packet filter identifiers of the eps bearer indicated by the received eps bearer identity.
note?3: the ability of the pcrf to handle multiple pcc rules in the same request depends on operator policy. it is therefore recommended that the ue avoids providing references to multiple packet filters for different applications and services.
 if the pdn gw detects that the 3gpp ps data off ue status has changed, the pdn gw shall indicate this event to the charging system for offline and online charging.
 if the 3gpp ps data off ue status indicates that 3gpp ps data off is activated for the ue, the pdn gw shall enforce the pcc rules for downlink traffic to be applied when 3gpp ps data off is activated, as described in ts?23.203?[6].
5. if the request is accepted, either the dedicated bearer activation procedure (according to clause?5.4.1), the pdn gw initiated bearer deactivation procedure (according to clause?5.4.4.1) or one of the bearer modification procedures (according to clause?5.4.2.1 or 5.4.3) is invoked. the pti allocated by the ue is used as a parameter in the invoked dedicated bearer activation procedure, the pdn gw initiated bearer deactivation procedure or the bearer modification procedure to correlate it to the ue requested bearer resource modification procedure. this provides the ue with the necessary linkage to what eps bearer to be used for the new traffic flow aggregate. the pdn gw shall not modify the qos parameters requested by the ue.
 the pdn gw inserts, modifies or removes packet filter(s) corresponding to the tad into the tft for the eps bearer. if pcc is in use, the pdn gw uses the SDF filters as specified in the resulting pcc rule(s). the pdn gw validates the state of the tft settings of the pdn connection as defined in clause?15.3.0 of ts?23.060?[7]. if after the execution of all tad operations the tft of the dedicated eps bearer contains only packet filters for the downlink direction, the pdn gw shall add a packet filter which effectively disallows any useful packet flows in uplink direction (see clause?15.3.3.4 in ts?23.060?[7] for an example of such a packet filter) to the tft.
note?4: the pdn gw addition of an uplink packet filter allows the handling of pre-release 11 ues which may have provided only downlink packet filters in a tad add operation without linking to an existing packet filter.
 when a new packet filter is inserted into a tft, the pdn gw assigns a new packet filter identifier which is unique within the tft. the pdn gw maintains the relation between the sdf filter identifier in the pcc rule received from the pcrf and the packet filter identifier of the tft of this eps bearer. if all of the packet filter(s) for a dedicated eps bearer have been removed from the tft, the pdn gw performs the pdn gw initiated bearer deactivation procedure.
 if the requested qos is not granted (i.e. the requested qos cannot be accepted or resources could not be allocated), or the resulting tft settings of the pdn connection does not pass the validation, then the pdn gw sends a bearer resource failure indication (with a cause indicating the reason why the request failed or was rejected) message, which shall be delivered to the ue.
6. if the pdn gw interacted with the pcrf in step?4, the pdn gw indicates to the pcrf whether the pcc decision could be enforced or not. this corresponds to the completion of the pcef-initiated ip can session modification procedure as defined in ts?23.203?[6], proceeding after the completion of ip can bearer signalling. if requested by the pcrf the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
5.4.6 void

5.4.7 e-utran initiated e-rab modification procedure
when scg bearer option is applied to support dual connectivity operation, this procedure is used to transfer bearer contexts to and from secondary enodeb (see ts?36.300?[5]) or secondary gnodeb (see ts?37.340?[85]). during this procedure, both the mme and serving gw are never relocated. the presence of ip connectivity between the serving gw and the master enodeb (see ts?36.300?[5] or ts?37.340?[85] for master enodeb definition), as well as between the serving gw and the secondary ran node is assumed.
note: in e-utran, enodeb is not allowed to negotiate bearer-level qos parameters as defined in clause?4.7.2.1.

figure 5.4.7-1: e-utran initiated e-rab modification procedure
1. the master enodeb sends a e-rab modification indication message (enodeb address(es) and teids for downlink UP for all the eps bearers, csg membership information, secondary rat usage data) to the mme. the master enb indicates for each bearer whether it is modified or not. if the plmn has configured secondary rat usage reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included.
 if the secondary enb is a hybrid access enb, the master enb includes the csg membership information for the scg bearer(s) in the e-rab modification indication message. the mme determines the csg membership based on the csg membership information as specified in ts?36.300?[5], but does not update the user csg information in the core network. a failure of the csg membership information verification does not impact the e-utran initiated e-rab modification procedure.
2. the mme sends a modify bearer request (enodeb address(es) and teids for downlink UP for all the eps bearers, isr activated, secondary rat usage data and indication to send it to pdn?gw) message per pdn connection to the serving gw, only for the affected pdn connections. if isr was activated before this procedure, mme should maintain isr. the ue is informed about the isr status in the tracking area update procedure. if the serving gw supports modify access bearers request procedure and if there is no need for the sgw to send the signalling to the pdn gw, the mme may send a modify access bearers request (enodeb address(es) and teids for downlink UP for all the eps bearers, isr activated) to the serving gw to optimise the signalling. if the mme received secondary rat usage data in step?1, the mme shall include it in this message.
 if secondary rat usage data was included and if pgw secondary rat usage data reporting is active, the serving gw shall send modify bearer request (secondary rat usage data) message to the pdn gw for each pdn connection. the pdn gw responds with modify bearer response message to the serving gw.
3. the serving gw returns a modify bearer response (serving gw address and teid for uplink traffic) message to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. 
 the serving gw starts sending downlink packets to the enodeb using the newly received address and teid.
4. in order to assist the reordering function in the master enodeb and/or secondary ran nodes, for the bearers that are switched between master enodeb and secondary ran nodes, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path as defined in ts?36.300?[5], clause?10.1.2.2.
5. the mme confirms the e-rab modification with the e-rab modification confirm (csg membership status) message. the mme indicates for each bearer whether it was successfully modified, kept unmodified or already released by the epc as defined in ts?36.413?[36]. for the eps bearers that have not been switched successfully in the core network, it is the mme decision whether to maintain or release the corresponding eps bearers. the enb uses the csg membership status to decide on further actions, as specified in ts?36.300?[5].
5.4.8 e-utran initiated ue context modification procedure
when split bearer option is applied to support dual connectivity operation, this procedure is used is by the enb to request the modifications on the established ue context. in the current version of the specification, this procedure is only used for membership verification, as described in ts?36.300?[5].

figure 5.4.7-1: e-utran initiated ue context modification procedure
1. the addition of an hybrid henb as the senb is triggered, providing the csg-id and the csg membership information to the menb.
2. the master enodeb sends ue context modification indication message to the mme, which includes the csg membership information of the senb.
3. the mme verifies the csg membership based on the provided csg membership information as specified in ts?36.300?[5], but does not update the user csg information in the core network. a failure of the csg membership information verification does not impact the e-utran ue context modification procedure.
4. the mme confirms the ue context modification indication with the ue context modification confirm (csg membership status) message. if csg membership information was not present in the ue context modification indication message, the mme can not perform csg membership information verification and does not provide csg membership status in the ue context modification confirm message.
5. in case the csg membership status returned by the mme is different from what was reported by the ue, the enb may decide on further actions.
5.5 handover

5.5.1 intra-e-utran handover
5.5.1.1 x2-based handover
5.5.1.1.1 general
these procedures are used to hand over a ue from a source enodeb to a target enodeb using the x2 reference point. in these procedures the mme is unchanged. two procedures are defined depending on whether the serving gw is unchanged or is relocated. in addition to the x2 reference point between the source and target enodeb, the procedures rely on the presence of s1-mme reference point between the mme and the source enodeb as well as between the mme and the target enodeb.
the handover preparation and execution phases are performed as specified in ts?36.300?[5]. if emergency bearer services are ongoing for the ue handover to the target enodeb is performed independent of the handover restriction list. the mme checks, as part of the tracking area update in the execution phase, if the handover is to a restricted area and if so mme releases the non-emergency bearers as specified in clause?5.10.3.
if the serving plmn changes during x2-based handover, the source enodeb shall indicate to the target enodeb (in the handover restriction list) the plmn selected to be the new serving plmn.
when the ue receives the handover command it will remove any eps bearers for which it did not receive the corresponding eps radio bearers in the target cell. as part of handover execution, downlink and optionally also uplink packets are forwarded from the source enodeb to the target enodeb. when the ue has arrived to the target enodeb, downlink data forwarded from the source enodeb can be sent to it. uplink data from the ue can be delivered via the (source) serving gw to the pdn gw or optionally forwarded from the source enodeb to the target enodeb. only the handover completion phase is affected by a potential change of the serving gw, the handover preparation and execution phases are identical.
if the mme receives a rejection to a nas procedure (e.g. dedicated bearer establishment/modification/release; location reporting control; nas message transfer; etc.) from the enodeb with an indication that an x2 handover is in progress (see ts?36.300?[5]), the mme shall reattempt the same nas procedure either when the handover is complete or the handover is deemed to have failed, except in case of serving gw relocation. the failure is known by expiry of the timer guarding the nas procedure.
if the x2 handover includes the serving gw relocation, and if the mme receives a rejection to a nas message transfer for a downlink nas transport or downlink generic nas transport message from the enodeb with an indication that an x2 handover is in progress, the mme should resend the corresponding message to the target enodeb when either the handover is complete or to the source enodeb when the handover is deemed to have failed if the mme is still the serving mme.
if the mme receives a rejection to a nas message transfer for a cs service notification or to a ue context modification request message with a cs fallback indicator from the enodeb with an indication that an x2 handover is in progress, the mme shall resend the corresponding message to the target enodeb when the handover is complete or to the source enodeb when the handover is deemed to have failed.
if during the handover procedure the mme detects that the serving gw needs be relocated, the mme shall reject any pdn gw initiated eps bearer(s) request received since handover procedure started and shall include an indication that the request has been temporarily rejected due to handover procedure in progress. the rejection is forwarded by the serving gw to the pdn gw, with the indication that the request has been temporarily rejected.
upon reception of a rejection for an eps bearer(s) pdn gw initiated procedure with an indication that the request has been temporarily rejected due to handover procedure in progress, the pdn gw start a locally configured guard timer. the pdn gw shall re-attempt, up to a pre-configured number of times, when either it detects that the handover is completed or has failed using message reception or at expiry of the guard timer.
5.5.1.1.2 x2-based handover without serving gw relocation
this procedure is used to hand over a ue from a source enodeb to a target enodeb using x2 when the mme is unchanged and decides that the serving gw is also unchanged. the presence of ip connectivity between the serving gw and the source enodeb, as well as between the serving gw and the target enodeb is assumed.

figure 5.5.1.1.2-1: x2-based handover without serving gw relocation
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2].
1a. if the plmn has configured secondary rat usage reporting, the source enodeb during the handover execution phase may provide ran usage data report (secondary rat usage data, handover flag) to the mme. the source enb shall provide this only when the target enb has confirmed handover over x2 interface (see ts?36.300?[5] and the source enb has sent a ho command to the ue). the handover flag indicates to the mme that it should buffer the usage data report before forwarding it to the serving gw.
1b. the target enodeb sends a path switch request message to mme to inform that the ue has changed cell, including the tai+ecgi of the target cell and the list of eps bearers to be switched.
 if dual connectivity is activated for the ue, the pscell id shall be included in the path switch request message.
 if the target cell is a csg cell , the target enodeb includes the csg id of the target cell in path switch request message. if the target cell is in hybrid mode, it includes the csg id of the target cell and csg access mode set to "hybrid" in the path switch request message. moreover, the path switch request message contains the csg membership status ie if the hybrid cell accessed by the ue has a different csg from the source cell or the source cell does not have a csg id. the mme determines the csg membership based on the csg id and the target plmn id received from the target enodeb.the mme updates the user csg information based on the csg id and csg access mode received from the target enodeb and csg membership if one of the parameters has changed.
 for sipto at the local network with stand-alone gw architecture, the target enodeb shall include the local home network id of the target cell in the path switch request message.
 the mme determines that the serving gw can continue to serve the ue.
2. the mme sends a modify bearer request (enodeb address(es) and teids for downlink UP for the accepted eps bearers, isr activated, secondary rat usage data) message per pdn connection to the serving gw for each pdn connection where the default bearer has been accepted by the target enodeb. if the pdn gw requested location information change reporting, the mme also includes the user location information ie in this message if it is different compared to the previously sent information. if the ue time zone has changed, the mme includes the ue time zone ie in this message. if the serving network has changed, the mme includes the new serving network ie in this message. if isr was activated before this procedure, mme should maintain isr. the ue is informed about the isr status in the tracking area update procedure. if the serving gw supports modify access bearers request procedure and if there is no need for the sgw to send the signalling to the pdn gw, the mme may send modify access bearers request (enodeb address(es) and teids for downlink UP for the accepted eps bearers, isr activated) per ue to the serving gw to optimise the signalling. the mme includes the secondary rat usage data if the mme received it from the source enodeb in step?1a.
 if the pdn gw requested ue's user csg information (determined from the ue context), the mme includes the user csg information ie in this message if the user csg information has changed.
 the mme uses the list of eps bearers to be switched, received in step?1, to determine whether any dedicated eps bearers in the ue context have not been accepted by the target enodeb. the mme releases the non-accepted dedicated bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
 if the default bearer of a pdn connection has not been accepted by the target enodeb and there are multiple pdn connections active, the mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
 if none of the default eps bearers have been accepted by the target enodeb or there is a lipa pdn connection that has not been released, the mme shall act as specified in step?6.
3. if the serving gw has received the user location information ie and/or the ue time zone ie and/or the serving network ie and/or user csg information ie from the mme in step?2 the serving gw informs the pdn gw(s) about this information that e.g. can be used for charging, by sending the message modify bearer request (serving gw address and teid, user location information ie and/or ue time zone ie and/or serving network ie and/or user csg information ie, secondary rat usage data) per pdn connection to the pdn gw(s) concerned. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) message to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using modify bearer request message per pdn connection. the serving gw forwards the secondary rat usage data to the pdn gw, if the serving gw received it in step?2 and if pgw secondary rat usage data reporting is active.
4. the serving gw starts sending downlink packets to the target enodeb using the newly received address and teids. a modify bearer response message is sent back to the mme.
5. in order to assist the reordering function in the target enodeb, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path as defined in ts?36.300?[5], clause?10.1.2.2.
6. the mme confirms the path switch request message with the path switch request ack message. if the ue ambr is changed, e.g. all the eps bearers which are associated to the same apn are rejected in the target enodeb, the mme shall provide the updated value of ue ambr to the target enodeb in the path switch request ack message.
 if the csg membership status was included in the path switch request message, the mme shall include its verified csg membership status in the path switch request ack message.
 if some eps bearers have not been switched successfully in the core network, the mme shall indicate in the path switch request ack message which bearers failed to be established (see more detail in ts?36.413?[36]) and for dedicated bearers initiate the bearer release procedure as specified in clause?5.4.4.2 to release the core network resources of the failed dedicated eps bearers. the target enodeb shall delete the corresponding bearer contexts when it is informed that bearers have not been established in the core network.
 if none of the default eps bearers have been switched successfully in the core network or if they have not been accepted by the target enodeb or the lipa pdn connection has not been released, the mme shall send a path switch request failure message (see more detail in ts?36.413?[36]) to the target enodeb. the mme performs explicit detach of the ue as described in the mme initiated detach procedure of clause?5.3.8.3.
7. by sending release resource the target enodeb informs success of the handover to source enodeb and triggers the release of resources. this step is specified in ts?36.300?[5].
8. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies. if isr is activated for the ue when the mme receives the tracking area update request, the mme should maintain isr by indicating isr activated in the tracking area update accept message.
note?2: it is only a subset of the ta update procedure that is performed by the mme, since the ue is in ecm connected state and the mme is not changed.
5.5.1.1.3 x2-based handover with serving gw relocation
this procedure is used to hand over a ue from a source enodeb to a target enodeb using x2 when the mme is unchanged and the mme decides that the serving gw is to be relocated. the presence of ip connectivity between the source serving gw and the source enodeb, between the source serving gw and the target enodeb, and between the target serving gw and target enodeb is assumed. (if there is no ip connectivity between target enodeb and source serving gw, it is assumed that the s1-based handover procedure in clause 5.5.1.2 shall be used instead.)

figure 5.5.1.1.3-1: x2-based handover with serving gw relocation
note?1: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2].
1a. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends a ran usage data report (secondary rat usage data, handover flag) message to the mme. the enb shall provide this only when it is to perform a path switch (i.e. the target enb has confirmed it is ready over x2 interface (see ts?36.300?[5] and the source enb has sent a ho command to the ue). the handover flag indicates to the mme that it should buffer the report before forwarding the secondary rat usage charging data.
1b. the target enodeb sends a path switch request message to mme to inform that the ue has changed cell, including the ecgi of the target cell and the list of eps bearers to be switched.
 if dual connectivity is activated for the ue, the pscell id shall be included in the path switch request message.
 if the target cell is a csg cell, the target enodeb includes the csg id of the target cell in path switch request message. if the target cell is in hybrid mode, it includes the csg id of the target cell and csg access mode set to "hybrid" in the path switch request message. moreover, the path switch request message contains the csg membership status ie if the hybrid cell accessed by the ue has a different csg from the source cell or the source cell does not have a csg id. the mme determines the csg membership based on the csg id and the target plmn id received from the target enodeb. the mme updates the user csg information based on the csg id and csg access mode received from the target enodeb and csg membership if one of the parameters has changed.
 for sipto at the local network with stand-alone gw architecture, the target enodeb shall include the local home network id of the target cell in the path switch request message.
 the mme determines that the serving gw is relocated and selects a new serving gw according to clause 4.3.8.2 on "serving gw selection function".
note?2: the mme knows the s gw service area with a ta granularity.
2. the mme sends a create session request (bearer context(s) with pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic, enodeb address(es) and teids for downlink UP for the accepted eps bearers, the protocol type over s5/s8, serving network, ue time zone, secondary rat usage data) message per pdn connection to the target serving gw for each pdn connection where the default bearer has been accepted by the target enodeb. the target serving gw allocates the s gw addresses and teids for the uplink traffic on s1_u reference point (one teid per bearer). the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface. if the pdn gw requested location information change reporting, the mme also includes the user location information ie in this message if it is different compared to the previously sent information. if the pdn gw requested ue's user csg information (determined from the ue context), the mme includes the user csg information ie in this message if the user csg information has changed.
 the mme uses the list of eps bearers to be switched, received in step?1, to determine whether any dedicated eps bearers in the ue context have not been accepted by the target enodeb. the mme releases the non-accepted dedicated bearers by triggering the bearer release procedure as specified in clause?5.4.4.2 via target serving gw. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
 if the default bearer of a pdn connection has not been accepted by the target enodeb and there are multiple pdn connections active, the mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3 via source serving gw.
 if none of the default eps bearers have been accepted by the target enodeb or there is a lipa pdn connection that has not been released, the mme shall act as specified in step?5.
 if the mme received it from the source enodeb in step?1a and pdn gw secondary rat reporting is active, the mme includes the secondary rat usage data with a flag stating that the target sgw shall not process the information and only forward it to the pdn gw.
3. the target serving gw assigns addresses and teids (one per bearer) for downlink traffic from the pdn gw. the serving gw allocates dl teids on s5/s8 even for non-accepted bearers. it sends a modify bearer request (serving gw addresses for UP and teid(s), serving network, pdn charging pause support indication, secondary rat usage data) message per pdn connection to the pdn gw(s). the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if it is present in step?2. the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. the pdn gw starts sending downlink packets to the target gw using the newly received address and teids. these downlink packets will use the new downlink path via the target serving gw to the target enodeb. the serving gw shall allocate teids for the failed bearers and inform to the mme. the serving gw forwards the secondary rat usage data to the pdn gw, if the serving gw received it in step?2 and if pgw secondary rat usage data reporting is active.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb. the source serving gw shall forward the "end marker" packets to the source enodeb.
4. the target serving gw sends a create session response (serving gw addresses and uplink teid(s) for UP) message back to the target mme. the mme starts a timer, to be used in step 7.
5. the mme confirms the path switch request message with the path switch request ack (serving gw addresses and uplink teid(s) for UP) message. if the ue ambr is changed, e.g. all the eps bearers which are associated to the same apn are rejected in the target enodeb, the mme shall provide the updated value of ue ambr to the target enodeb in the path switch request ack message. the target enodeb starts using the new serving gw address(es) and teid(s) for forwarding subsequent uplink packets.
 if the csg membership status was included in the path switch request message, the mme shall include its verified csg membership status in the path switch request ack message.
 if some eps bearers have not been switched successfully in the core network, the mme shall indicate in the path switch request ack message which bearers failed to be established (see more detail in ts?36.413?[36]) and for dedicated bearers initiate the bearer release procedure as specified in clause?5.4.4.2 to release the core network resources of the failed dedicated eps bearers. the target enodeb shall delete the corresponding bearer contexts when it is informed that bearers have not been established in the core network.
 if none of the default eps bearers have been switched successfully in the core network or if they have not been accepted by the target enodeb or the lipa pdn connection has not been released, the mme shall send a path switch request failure message (see more detail in ts?36.413?[36]) to the target enodeb. the mme performs explicit detach of the ue as described in the mme initiated detach procedure of clause?5.3.8.3.
6. by sending release resource the target enodeb informs success of the handover to source enodeb and triggers the release of resources. this step is specified in ts?36.300?[5].
7. when the timer has expired after step 4, the source mme releases the bearer(s) in the source serving gw by sending a delete session request message (cause, operation indication, secondary rat usage data). the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. the source serving gw acknowledges with delete session response messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node. the mme includes the secondary rat usage data in this message if it received it in step?1a.
8. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies.
note?3: it is only a subset of the ta update procedure that is performed by the mme, since the ue is in ecm connected state. the ue is informed about the isr status in the tracking area update procedure.
5.5.1.2 s1-based handover
5.5.1.2.1 general
the s1-based handover procedure is used when the x2-based handover cannot be used. the source enodeb initiates a handover by sending handover required message over the s1-mme reference point. this procedure may relocate the mme and/or the serving gw. the source mme selects the target mme. the mme should not be relocated during inter-enodeb handover unless the ue leaves the mme pool area where the ue is served. the mme (target mme for mme relocation) determines if the serving gw needs to be relocated. if the serving gw needs to be relocated the mme selects the target serving gw, as specified in clause?4.3.8.2 on serving gw selection function.
the source enodeb decides which of the eps bearers are subject for forwarding of downlink and optionally also uplink data packets from the source enodeb to the target enodeb. the epc does not change the decisions taken by the ran node. packet forwarding can take place either directly from the source enodeb to the target enodeb, or indirectly from the source enodeb to the target enodeb via the source and target serving gws (or if the serving gw is not relocated, only the single serving gw).
the availability of a direct forwarding path is determined in the source enodeb and indicated to the source mme. if x2 connectivity is available between the source and target enodebs, a direct forwarding path is available.
if a direct forwarding path is not available, indirect forwarding may be used. the source mme uses the indication from the source enodeb to determine whether to apply indirect forwarding. the source mme indicates to the target mme whether indirect forwarding should apply. based on this indication, the target mme determines whether it applies indirect forwarding.
if the mme receives a rejection to an s1 interface procedure (e.g. dedicated bearer establishment/modification/release; location reporting control; nas message transfer; etc.) from the enodeb with an indication that an s1 handover is in progress (see ts?36.300?[5]), the mme shall reattempt the same s1 interface procedure when either the handover is complete or is deemed to have failed if the mme is still the serving mme, except in case of serving gw relocation. if the s1 handover changes the serving mme, the source mme shall terminate any other ongoing s1 interface procedures except the handover procedure.
if the s1 handover includes the serving gw relocation, and if the mme receives a rejection to a nas message transfer for a downlink nas transport or downlink generic nas transport message from the enodeb with an indication that an s1 handover is in progress, the mme should resend the corresponding message to the target enodeb when either the handover is complete or to the source enodeb when the handover is deemed to have failed if the mme is still the serving mme.
if the mme receives a rejection to a nas message transfer for a cs service notification or to a ue context modification request message with a cs fallback indication from the enodeb with an indication that an s1 handover is in progress, the mme shall resend the corresponding message to the target enodeb when either the handover is complete or to the source enodeb when the handover is deemed to have failed if the mme is still the serving mme.
in order to minimise the number of procedures rejected by the enodeb, the mme should pause non-handover related s1 interface procedures (e.g. downlink nas message transfer, e-rab setup/modify/release, etc.) while a handover is ongoing (i.e. from the time that a handover required has been received until either the handover procedure has succeeded (handover notify) or failed (handover failure)) and continue them once the handover procedure has completed if the mme is still the serving mme, except in case of serving gw relocation.
if during the handover procedure the mme detects that the serving gw or/and the mme needs be relocated, the mme shall reject any pdn gw initiated eps bearer(s) request received since handover procedure started and shall include an indication that the request has been temporarily rejected due to handover procedure in progress. the rejection is forwarded by the serving gw to the pdn gw, with the indication that the request has been temporarily rejected.
upon reception of a rejection for an eps bearer(s) pdn gw initiated procedure with an indication that the request has been temporarily rejected due to handover procedure in progress, the pdn gw start a locally configured guard timer. the pdn gw shall re-attempt, up to a pre-configured number of times, when either it detects that the handover is completed or has failed using message reception or at expiry of the guard timer.
if emergency bearer services are ongoing for the ue, handover to the target enodeb is performed independent of the handover restriction list. the mme checks, as part of the tracking area update in the execution phase, if the handover is to a restricted area and if so mme releases the non-emergency bearers as specified in clause?5.10.3.
if emergency bearer services are ongoing for the ue, handover to the target csg cell is performed independent of the ue's csg subscription. if the handover is to a csg cell that the ue is not subscribed, the target enodeb only accepts the emergency bearers and the target mme releases the non-emergency pdn connections that were not accepted by the target enodeb as specified in clause?5.10.3.
for inter-plmn handover to a csg cell, if the source mme has the csg-id list of the target plmn, the source mme shall use it to validate the csg membership of the ue in the target csg cell. otherwise, based on operator's configuration the source mme may allow the handover by validating the csg membership of the ue in the target csg cell using the csg-id list of the registered plmn-id. if neither the csg-id list of the target plmn nor the operator's configuration permits the handover,the source mme shall reject the handover due to no csg membership information of the target plmn-id.
as specified in clause?4.3.8.3, with regard to ciot eps optimisations, the source mme attempts to perform handover to a target mme that can support the ue's preferred network behaviour. for a ue that is using a non-ip connection to a PGW, or a pdn connection to a scef, if these bearers cannot be supported by the target mme, the source mme does not attempt to handover those bearers, but instead releases them upon successful completion of the handover. if the mme does not have any bearer for the ue that can be transferred, then the mme sends an s1-ap handover preparation failure message to the source enb.
note: inter-plmn handover to a csg cell in a plmn which is not an equivalent plmn for the ue is not supported.
5.5.1.2.2 s1-based handover, normal
this procedure describes the s1-based handover in the normal case, clause?5.5.1.2.3 describes it when the procedure is rejected by the target enodeb or the target mme and clause?5.5.1.2.4 describes when the procedure is canceled by the source enodeb.

figure 5.5.1.2.2-1: s1-based handover
note?1: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. steps 16 and 16a concern gtp based s5/s8.
note?2: if the serving gw is not relocated, the box "source serving gw" in figure 5.5.1.2.2-1 is acting as the target serving gw.
1. the source enodeb decides to initiate an s1-based handover to the target enodeb. this can be triggered e.g. by no x2 connectivity to the target enodeb, or by an error indication from the target enodeb after an unsuccessful x2-based handover, or by dynamic information learnt by the source enodeb.
2. the source enodeb sends handover required (direct forwarding path availability, source to target transparent container, target enodeb identity, csg id, csg access mode, target tai, s1ap cause) to the source mme. the source enodeb indicates which bearers are subject to data forwarding. direct forwarding path availability indicates whether direct forwarding is available from the source enodeb to the target enodeb. this indication from source enodeb can be based on e.g. the presence of x2. the target tai is sent to mme to facilitate the selection of a suitable target mme. when the target cell is a csg cell or a hybrid cell, the source enodeb shall include the csg id of the target cell. if the target cell is a hybrid cell, the csg access mode shall be indicated.
3. the source mme selects the target mme as described in clause 4.3.8.3 on "mme selection function" and if it has determined to relocate the mme, it sends a forward relocation request (mme ue context, source to target transparent container, ran cause, target enodeb identity, csg id, csg membership indication, target tai, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, direct forwarding flag, serving network, local home network id, lte-m ue indication) message to the target mme. the target tai is sent to the target mme to help it to determine whether s gw relocation is needed (and, if needed, aid sgw selection). the old serving network is sent to target mme to support the target mme to resolve if serving network is changed. in network sharing scenarios serving network denotes the serving core network.
 the source mme shall perform access control by checking the ue's csg subscription when csg id is provided by the source enodeb. if there is no subscription data for this csg id or the csg subscription is expired, and the target cell is a csg cell, the source mme shall reject the handover with an appropriate cause unless the ue has emergency bearer services.
 the mme ue context includes imsi, me identity, ue security context, ue network capability, ambr, selected cn operator id, apn restriction, serving gw address and teid for control signalling, and eps bearer context(s).
 an eps bearer context includes the pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic, apn, serving gw addresses and teids for uplink traffic, and ti.
 based on the ciot eps optimisation capabilities of the target mme (determined according to the target mme selection procedure of clause?4.3.8.3) the source mme only includes the eps bearer context(s) that the target mme can support. if none of the ue's eps bearers can be supported by the selected target mme, the source mme rejects the s1 handover attempt by sending a handover preparation failure (cause) message to the source enodeb. if the target mme supports ciot eps optimisation and the use of header compression has been negotiated between the ue and the source mme, the source mme also includes in the forward relocation request the previously negotiated header compression configuration that includes the information necessary for the rohc channel setup but not the rohc context itself.
 if the source mme includes eps bearer context, in addition to the serving gw ip address and teid for s1-u use plane, the source mme also includes serving gw ip address and teid for s11-u, if available.
note?3: if the handover is successful, the source mme will signal to the sgw and/or scef to release any non-included eps bearers after step?14. the non-included bearers are locally released by the ue following the bearer context status synchronisation that occurs during the tracking area update at step?18.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw the source mme shall include the local home network id of the source cell in the eps bearer context corresponding to the sipto at the local network pdn connection.
 ran cause indicates the s1ap cause as received from source enodeb.
 the source mme includes the csg id in the forward relocation request when the target cell is a csg or hybrid cell. when the target cell is a hybrid cell, or if there are one or several emergency bearers and the target cell is a csg cell, the csg membership indication indicating whether the ue is a csg member shall be included in the forward relocation request message.
 the direct forwarding flag indicates if direct forwarding is applied, or if indirect forwarding is going to be set up by the source side.
 the target mme shall determine the maximum apn restriction based on the apn restriction of each bearer context in the forward relocation request, and shall subsequently store the new maximum apn restriction value.
 if the ue receives only emergency services and the ue is uiccless, imsi can not be included in the mme ue context in forward relocation request message. for emergency attached ues, if the imsi cannot be authenticated, then the imsi shall be marked as unauthenticated. also, in this case, security parameters are included only if available.
 if the old mme is aware the ue is a lte-m ue, it provides the lte-m ue indication to the new mme.
4. if the mme has been relocated, the target mme verifies whether the source serving gw can continue to serve the ue. if not, it selects a new serving gw as described in clause 4.3.8.2 on "serving gw selection function". if the mme has not been relocated, the source mme decides on this serving gw re-selection.
 if the source serving gw continues to serve the ue, no message is sent in this step. in this case, the target serving gw is identical to the source serving gw.
 if a new serving gw is selected, the target mme sends a create session request (bearer context(s) with pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic, serving network, ue time zone) message per pdn connection to the target serving gw. the target serving gw allocates the s gw addresses and teids for the uplink traffic on s1_u reference point (one teid per bearer). the target serving gw sends a create session response (serving gw addresses and uplink teid(s) for UP) message back to the target mme.
5. the target mme sends handover request (eps bearers to setup, ambr, s1ap cause, source to target transparent container, csg id, csg membership indication, handover restriction list) message to the target enodeb. this message creates the ue context in the target enodeb, including information about the bearers, and the security context. for each eps bearer, the bearers to setup includes serving gw address and uplink teid for UP, and eps bearer qos. if the direct forwarding flag indicates unavailability of direct forwarding and the target mme knows that there is no indirect data forwarding connectivity between source and target, the bearers to setup shall include "data forwarding not possible" indication for each eps bearer. handover restriction list is sent if available in the target mme; it is described in clause 4.3.5.7 "mobility restrictions".
 s1ap cause indicates the ran cause as received from source mme.
 the target mme shall include the csg id and csg membership indication when provided by the source mme in the forward relocation request message.
 the target enodeb sends a handover request acknowledge (eps bearer setup list, eps bearers failed to setup list target to source transparent container) message to the target mme. the eps bearer setup list includes a list of addresses and teids allocated at the target enodeb for downlink traffic on s1 u reference point (one teid per bearer) and addresses and teids for receiving forwarded data if necessary. if the ue ambr is changed, e.g. all the eps bearers which are associated to the same apn are rejected in the target enodeb, the mme shall recalculate the new ue-ambr and signal the modified ue ambr value to the target enodeb.
 if none of the default eps bearers have been accepted by the target enodeb, the target mme shall reject the handover as specified in clause?5.5.1.2.3.
 if the target cell is a csg cell, the target enodeb shall verify the csg id provided by the target mme, and reject the handover with an appropriate cause if it does not match the csg id for the target cell. if the target enodeb is in hybrid mode, it may use the csg membership indication to perform differentiated treatment for csg and non-csg members. if the target cell is a csg cell, and if the csg membership indication is "non member", the target enodeb only accepts the emergency bearers.
6. if indirect forwarding applies and the serving gw is relocated, the target mme sets up forwarding parameters by sending create indirect data forwarding tunnel request (target enodeb addresses and teids for forwarding) to the serving gw. the serving gw sends a create indirect data forwarding tunnel response (target serving gw addresses and teids for forwarding) to the target mme. if the serving gw is not relocated, indirect forwarding may be set up in step?8 below.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
7. if the mme has been relocated, the target mme sends a forward relocation response (cause, target to source transparent container, serving gw change indication, eps bearer setup list, addresses and teids) message to the source mme. for indirect forwarding, this message includes serving gw address and teids for indirect forwarding (source or target). serving gw change indication indicates a new serving gw has been selected.
8. if indirect forwarding applies, the source mme sends create indirect data forwarding tunnel request (addresses and teids for forwarding) to the serving gw. if the serving gw is relocated it includes the tunnel identifier to the target serving gw.
 the serving gw responds with a create indirect data forwarding tunnel response (serving gw addresses and teids for forwarding) message to the source mme.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
9. the source mme sends a handover command (target to source transparent container, bearers subject to forwarding, bearers to release) message to the source enodeb. the bearers subject to forwarding includes list of addresses and teids allocated for forwarding. the bearers to release includes the list of bearers to be released.
9a. the handover command is constructed using the target to source transparent container and is sent to the ue. upon reception of this message the ue will remove any eps bearers for which it did not receive the corresponding eps radio bearers in the target cell.
9b. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends a ran usage data report (secondary rat usage data, handover flag) message to the source mme. the handover flag indicates to the mme that it should buffer the report before forwarding the secondary rat usage data.
10. the source enodeb sends the enodeb status transfer message to the target enodeb via the mme(s) to convey the pdcp and hfn status of the e-rabs for which pdcp status preservation applies, as specified in ts?36.300?[5]. the source enodeb may omit sending this message if none of the e-rabs of the ue shall be treated with pdcp status preservation.
 if there is an mme relocation the source mme sends this information to the target mme via the forward access context notification message which the target mme acknowledges. the source mme or, if the mme is relocated, the target mme, sends the information to the target enodeb via the mme status transfer message.
11. the source enodeb should start forwarding of downlink data from the source enodeb towards the target enodeb for bearers subject to data forwarding. this may be either direct (step 11a) or indirect forwarding (step 11b).
12. after the ue has successfully synchronized to the target cell, it sends a handover confirm message to the target enodeb. downlink packets forwarded from the source enodeb can be sent to the ue. also, uplink packets can be sent from the ue, which are forwarded to the target serving gw and on to the pdn gw.
13. the target enodeb sends a handover notify (tai+ecgi, local home network id) message to the target mme. if dual connectivity is activated for the ue, the pscell id shall be included in the handover notify message.
 for sipto at the local network with stand-alone gw architecture, the target enodeb shall include the local home network id of the target cell in the handover notify message.
14. if the mme has been relocated, the target mme sends a forward relocation complete notification message to the source mme. the source mme in response sends a forward relocation complete acknowledge (secondary rat usage data) message to the target mme. the source mme includes secondary rat usage data in this message if it received this in step?9b. regardless if mme has been relocated or not, a timer in source mme is started to supervise when resources in source enodeb and if the serving gw is relocated, also resources in source serving gw shall be released.
 upon receipt of the forward relocation complete acknowledge message the target mme starts a timer if the target mme allocated s gw resources for indirect forwarding.
 for all bearers that were not included in the forward relocation request message sent in step?3, the mme now releases them by sending a delete bearer command to the sgw, or, the appropriate message to the scef.
15. the mme sends a modify bearer request (enodeb address and teid allocated at the target enodeb for downlink traffic on s1 u for the accepted eps bearers, isr activated, secondary rat usage data if pgw secondary rat usage data reporting is active) message to the target serving gw for each pdn connection, including the pdn connections that need to be released. if the pdn gw requested location information change reporting and/or user csg information (determined from the ue context), the mme also includes the user location information ie (if it is different compared to the previously sent information) and/or user csg information ie in this message. if the ue time zone has changed, the mme includes the ue time zone ie in this message. if serving gw is not relocated but the serving network has changed or if the mme has not received any old serving network information from the old mme, the mme includes the serving network ie in this message. for the case that neither mme nor s-gw changed, if isr was activated before this procedure mme should maintain isr. the ue is informed about the isr status in the tracking area update procedure. if the serving gw supports modify access bearers request procedure and if there is no need for the sgw to send the signalling to the pdn gw, the mme may send modify access bearers request (enodeb address and teid allocated at the target enodeb for downlink traffic on s1 u for the accepted eps bearers, isr activated) per ue to the serving gw to optimise the signalling. if serving gw is not relocated and if secondary rat usage data was received in step?9a, the mme includes the secondary rat usage data in the message. if the serving gw has been relocated and if pgw secondary rat reporting is active, the mme includes the secondary rat usage data and also includes a flag stating that the serving gw should not process the information and only forward it to the pdn gw.
 the mme releases the non-accepted dedicated bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
 if the default bearer of a pdn connection has not been accepted by the target enodeb and there are other pdn connections active, the mme shall handle it in the same way as if all bearers of a pdn connection have not been accepted. the mme releases these pdn connections by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
 when the modify bearer request does not indicate isr activated the serving gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the serving gw reserved.
16. if the serving gw is relocated, the target serving gw assigns addresses and teids (one per bearer) for downlink traffic from the pdn gw. it sends a modify bearer request (serving gw addresses for UP and teid(s), serving network, pdn charging pause support indication, secondary rat usage data) message per pdn connection to the pdn gw(s). the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if they are present in step?15. the serving gw also includes serving network ie if it is present in step?4 or step?15. the serving gw allocates dl teids on s5/s8 even for non-accepted bearers. the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) message to the target serving gw. the msisdn is included if the pdn gw has it stored in its ue context. the pdn gw starts sending downlink packets to the target gw using the newly received address and teids. these downlink packets will use the new downlink path via the target serving gw to the target enodeb. the secondary rat usage data is included if it was received in step?15 and if pgw secondary rat usage data reporting is active.
 if the serving gw is not relocated, but has received the user location information ie and/or ue time zone ie and/or user csg information ie and/or serving network ie from the mme in step?15, the serving gw shall inform the pdn gw(s) about these information that e.g. can be used for charging, by sending the message modify bearer request (user location information ie, ue time zone ie, user csg information ie, serving network ie) to the pdn gw(s) concerned. a modify bearer response message is sent back to the serving gw.
 if the serving gw is not relocated and it has not received user location information ie nor ue time zone ie nor user csg information ie nor serving network ie from the mme in step?15, no message is sent in this step and downlink packets from the serving gw are immediately sent on to the target enodeb.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb. the source serving gw shall forward the "end marker" packets to the source enodeb. if data forwarding -direct or indirect) occurs, the source enodeb shall forward the "end marker" packets to the target enodeb via the forwarding tunnel.
17. the serving gw shall return a modify bearer response (serving gw address and teid for uplink traffic) message to the mme as a response to a modify bearer request message, or a modify access bearers response (serving gw address and teid for uplink traffic) as a response to a modify access bearers request message. if the serving gw cannot serve the mme request in the modify access bearers request message without s5/s8 signalling other than to unpause charging in the pdn gw or without corresponding gxc signalling when pmip is used over the s5/s8 interface, it shall respond to the mme with indicating that the modifications are not limited to s1-u bearers, and the mme shall repeat its request using modify bearer request message per pdn connection.
 if the serving gw does not change, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb. if data forwarding (direct or indirect) occurs, the source enodeb shall forward the "end marker" packets to the target enodeb via the forwarding tunnel.
18. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies.
 for a ue supporting ciot eps optimisations, the eps bearer status information shall be included in the tau request. the mme shall then indicate the eps bearer status to the ue in the tau accept and the ue shall locally release any non-transferred bearer.
 the target mme knows that it is a handover procedure that has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target mme performs only a subset of the ta update procedure, specifically it excludes the context transfer procedures between source mme and target mme. in this case, the target mme shall set the header compression context status for each eps bearer in the tau accept message based on information obtained in step?3.
19. when the timer started in step 14 expires the source mme sends a ue context release command () message to the source enodeb. the source enodeb releases its resources related to the ue and responds with a ue context release complete () message. when the timer started in step 14 expires and if the source mme received the serving gw change indication in the forward relocation response message, it deletes the eps bearer resources by sending delete session request (cause, lbi, operation indication, secondary rat usage data) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. secondary rat usage data is included if it was received in step?9b. the source serving gw acknowledges with delete session response () messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
20. if indirect forwarding was used then the expiry of the timer at source mme started at step?14 triggers the source mme to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding that were allocated at step?8.
21. if indirect forwarding was used and the serving gw is relocated, then the expiry of the timer at target mme started at step?14 triggers the target mme to send a delete indirect data forwarding tunnel request message to the target s gw to release temporary resources used for indirect forwarding that were allocated at step?6.
5.5.1.2.3 s1-based handover, reject
the target enodeb rejects the use of the handover procedure if none of the requested bearers in the handover request message could be established. in this case no ue context is established in the target mme/enodeb and no resources are allocated. further, the target mme rejects the handover request and clears all resource in target enodeb and target mme if the target enodeb accepts the handover request but none of the default eps bearers gets resources allocated. in both cases, the ue remains in the source enodeb/mme.

figure 5.5.1.2.3-1: s1-based handover, reject
note?1: steps 3, 4, 7 and 8 are performed if the mme is relocated.
note?2: if the mme is not relocated steps 5 and 6 are performed by the source mme and, in the description below, the source mme acts as the target mme.
1-5. steps 1 to 5 in the flow are identical to steps 1-5 in clause?5.5.1.2.2.
6a. if the target enodeb fails to allocate any resources for any of the requested eps bearers it sends a handover failure (cause) message to the target mme. the target mme clears any reserved resources for this ue in the target mme.
6b. if the target mme receives a handover request acknowledge message from the target enodeb but none of the default eps bearers are in the eps bearer setup list ie, the target mme clears any reserved resources for this ue in both the target mme and the target enodeb.
7. this step is only performed for serving gw relocation, i.e. if steps?4/4a have been performed. the target mme deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
8. the target mme sends the forward relocation response (cause) message to the source mme.
9. when the source mme receives the forward relocation response message, it sends a handover preparation failure (cause) message to the source enodeb.
5.5.1.2.4 s1-based handover, cancel
instead of completing the handover procedure, the source enodeb may at any time during the handover procedure, up to the time when a handover command message is sent to the ue cancel the handover.
the mme shall cancel the handover resources as defined in clause?5.5.2.5.1 for case the source ran is enodeb.
5.5.2 inter rat handover
5.5.2.0 general
during inter rat handover indirect forwarding may apply for the downlink data forwarding performed as part of the handover. from its configuration data the mme knows whether indirect forwarding applies and it allocates a downlink data forwarding path on a serving gws for indirect forwarding. from its configuration data the s4 sgsn knows whether indirect forwarding applies and it allocates downlink data forwarding paths on serving gws for indirect forwarding. it is configured on mme and s4 sgsn whether indirect downlink data forwarding does not apply, applies always or applies only for inter plmn inter rat handovers.
during the handover procedure, the source mme shall reject any pdn gw initiated eps bearer(s) request received since handover procedure started and shall include an indication that the request has been temporarily rejected due to handover procedure in progress. the rejection is forwarded by the serving gw to the pdn gw, with the indication that the request has been temporarily rejected.
upon reception of a rejection for an eps bearer(s) pdn gw initiated procedure with an indication that the request has been temporarily rejected due to handover procedure in progress, the pdn gw behaves as specified in clause?5.5.1.2.1.
for inter-plmn handover to a csg cell, if the source mme/s4-sgsn has the csg-id list of the target plmn, the source mme/s4-sgsn shall use it to validate the csg membership of the ue in the target csg cell. otherwise, based on operator's configuration the source mme/s4-sgsn may allow the handover by validating the csg membership of the ue in the target csg cell using the csg-id list of the registered plmn-id. if neither the csg-id list of the target plmn nor the operator's configuration permits the handover, the source mme/s4-sgsn shall reject the handover due to no csg membership information of the target plmn-id
note?1: inter-plmn handover to a csg cell in a plmn which is not an equivalent plmn for the ue is not supported.
note?2: inter-plmn handover to a csg cell of an equivalent plmn is only supported if the csg-id of the cell is in the csg-id list of both equivalent plmns.
note?3: upon bearer loss or ue-detected bearer qos degradation during inter-rat 3gpp handover, after receiving the handover command the ue can adopt an implementation dependent mechanism to trigger the handover of one or more pdn connections or mobility of one or more ip flows to wlan (e.g. taking into account policies obtained from andsf).
5.5.2.1 e-utran to utran iu mode inter rat handover
5.5.2.1.1 general
pre-conditions:
- the ue is in ecm-connected state (e-utran mode).
if emergency bearer services are ongoing for an ue, handover to the target rnc is performed independent of the handover restriction list. the sgsn checks, as part of the routing area update in the execution phase, if the handover is to a restricted area and if so sgsn deactivate the non-emergency pdp context as specified in ts?23.060?[7], clause?9.2.4.2.
if emergency bearer services are ongoing for the ue, the source mme evaluates the handover to the target csg cell independent of the ue's csg subscription. if the handover is to a csg cell that the ue is not subscribed, the target rnc will only accept the emergency bearers and the target sgsn deactivates the non-emergency pdp contexts that were not accepted by the target rnc as specified in ts?23.060?[7], clause?9.2.4.2.
5.5.2.1.2 preparation phase

figure 5.5.2.1.2-1: e-utran to utran iu mode inter rat ho, preparation phase
1. the source enodeb decides to initiate an inter-rat handover to the target access network, utran iu mode. at this point both uplink and downlink user data is transmitted via the following: bearer(s) between ue and source enodeb, gtp tunnel(s) between source enodeb, serving gw and pdn gw.
 if the ue has an ongoing emergency bearer service the source enodeb shall not initiate ps handover to a utran cell that is not ims voice capable.
note?1: the process leading to the handover decision is outside of the scope of this specification.
2. the source enodeb sends a handover required (s1ap cause, target rnc identifier, csg id, csg access mode, source to target transparent container) message to the source mme to request the cn to establish resources in the target rnc, target sgsn and the serving gw. the bearers that will be subject to data forwarding (if any) are identified by the target sgsn in a later step (see step?7 below). when the target cell is a csg cell or a hybrid cell, the source enodeb shall include the csg id of the target cell. if the target cell is a hybrid cell, the csg access mode shall be indicated.
3. the source mme determines from the 'target rnc identifier' ie that the type of handover is irat handover to utran iu mode. the source mme selects the target sgsn as described in clause?4.3.8.4 on "sgsn selection function". the source mme initiates the handover resource allocation procedure by sending a forward relocation request (imsi, target identification, csg id, csg membership indication, mm context, pdn connections, mme tunnel endpoint identifier for CP, mme address for CP, source to target transparent container, ran cause, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, isr supported, serving network) message to the target sgsn. the information isr supported is indicated if the source mme and associated serving gw are capable to activate isr for the ue. when isr is activated the message should be sent to the sgsn that maintains isr for the ue when this sgsn is serving the target identified by the target identification. this message includes all pdn connections active in the source system and for each pdn connection includes the associated apn, the address and the uplink tunnel endpoint parameters of the serving gw for CP, and a list of eps bearer contexts. ran cause indicates the s1ap cause as received from source enodeb. the old serving network is sent to target mme to support the target mme to resolve if serving network is changed.
 the source mme shall perform access control by checking the ue's csg subscription when csg id is provided by the source enodeb. if there is no subscription data for this csg id or the csg subscription is expired, and the target cell is a csg cell, the source mme shall reject the handover with an appropriate cause unless the ue has emergency bearer services.
 the source mme includes the csg id in the forward relocation request when the target cell is a csg cell or hybrid cell. when the target cell is a hybrid cell, or if there are one or several emergency bearers and the target cell is a csg cell, the csg membership indication indicating whether the ue is a csg member shall be included in the forward relocation request message.
 the mm context includes information on the eps bearer context(s). the source mme does not include any eps bearer context information for "non-ip" bearers or for any scef connection. if none of the ue's eps bearers can be supported by the selected target sgsn, the source mme rejects the handover attempt by sending a handover preparation failure (cause) message to the source enodeb.
note?2: if the handover is successful, the source mme will signal to the sgw and/or scef to release any non-included eps bearers after step?6 of the execution procedure. the non-included bearers are locally released by the ue following the bearer context status synchronisation that occurs during the routing area update at step?10 of the execution procedure.
 the target sgsn maps the eps bearers to pdp contexts 1-to-1 and maps the eps bearer qos parameter values of an eps bearer to the release?99 qos parameter values of a bearer context as defined in annex e
 prioritization of pdp contexts is performed by the target core network node, i.e. target sgsn.
 the mm context contains security related information, e.g. supported ciphering algorithms as described in ts?29.274?[43]. handling of security keys is described in ts?33.401?[41].
 the target sgsn shall determine the maximum apn restriction based on the apn restriction of each bearer context in the forward relocation request, and shall subsequently store the new maximum apn restriction value.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw the source mme shall include the local home network id of the source cell in the pdn connections corresponding to the sipto at the local network pdn connection.
4. the target sgsn determines if the serving gw is to be relocated, e.g., due to plmn change. if the serving gw is to be relocated, the target sgsn selects the target serving gw as described under clause 4.3.8.2 on "serving gw selection function", and sends a create session request message (imsi, sgsn tunnel endpoint identifier for CP, sgsn address for CP, pdn gw address(es) for UP, pdn gw ul teid(s) for UP, pdn gw address(es) for CP, and pdn gw teid(s) for CP, the protocol type over s5/s8, serving network) per pdn connection to the target serving gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface.
 the target sgsn establishes the eps bearer context(s) in the indicated order. the sgsn deactivates, as provided in step?7 of the execution phase, the eps bearer contexts which cannot be established.
4a. the target serving gw allocates its local resources and returns a create session response (serving gw address(es) for UP, serving gw ul teid(s) for UP, serving gw address for CP, serving gw teid for CP) message to the target sgsn.
5. the target sgsn requests the target rnc to establish the radio network resources (rabs) by sending the message relocation request (ue identifier, cause, cn domain indicator, integrity protection information (i.e. ik and allowed integrity protection algorithms), encryption information (i.e. ck and allowed ciphering algorithms), rab to be setup list, csg id, csg membership indication, source rnc to target rnc transparent container, service handover related information). if the access restriction is present in the mm context, the service handover related information shall be included by the target sgsn for the relocation request message in order for rnc to restrict the ue in connected mode to handover to the rat prohibited by the access restriction.
 for each rab requested to be established, rabs to be setup shall contain information such as rab id, rab parameters, transport layer address, and iu transport association. the rab id information element contains the nsapi value, and the rab parameters information element gives the qos profile. the transport layer address is the serving gw address for UP (if direct tunnel is used) or the sgsn address for UP (if direct tunnel is not used), and the iu transport association corresponds to the uplink tunnel endpoint identifier data in serving gw or sgsn respectively.
 ciphering and integrity protection keys are sent to the target rnc to allow data transfer to continue in the new rat/mode target cell without requiring a new aka (authentication and key agreement) procedure. information that is required to be sent to the ue (either in the relocation command message or after the handover completion message) from rrc in the target rnc shall be included in the rrc message sent from the target rnc to the ue via the transparent container. more details are described in ts?33.401?[41].
 the target sgsn shall include the csg id and csg membership indication when provided by the source mme in the forward relocation request message.
 in the target rnc radio and iu UP resources are reserved for the accepted rabs. cause indicates the ran cause as received from source mme. the source rnc to target rnc transparent container includes the value from the source to target transparent container received from the source enodeb.
 if the target cell is a csg cell, the target rnc shall verify the csg id provided by the target sgsn, and reject the handover with an appropriate cause if it does not match the csg id for the target cell. if the target cell is in hybrid mode, the target rnc may use the csg membership indication to perform differentiated treatment for csg and non-csg members. if the target cell is a csg cell, and if the csg membership indication is "non member", the target rnc only accepts the emergency bearers.
5a. the target rnc allocates the resources and returns the applicable parameters to the target sgsn in the message relocation request acknowledge (target rnc to source rnc transparent container, rabs setup list, rabs failed to setup list).
 upon sending the relocation request acknowledge message the target rnc shall be prepared to receive downlink gtp pdus from the serving gw, or target sgsn if direct tunnel is not used, for the accepted rabs.
 each rabs setup list is defined by a transport layer address, which is the target rnc address for user data, and the iu transport association, which corresponds to the downlink tunnel endpoint identifier for user data.
 any eps bearer contexts for which a rab was not established are maintained in the target sgsn and the ue. these eps bearer contexts shall be deactivated by the target sgsn via explicit sm procedures upon the completion of the routing area update (rau) procedure.
6. if 'indirect forwarding' and relocation of serving gw apply and direct tunnel is used the target sgsn sends a create indirect data forwarding tunnel request message (target rnc address and teid(s) for dl data forwarding) to the serving gw. if 'indirect forwarding' and relocation of serving gw apply and direct tunnel is not used, then the target sgsn sends a create indirect data forwarding tunnel request message (sgsn address and teid(s) for dl data forwarding) to the serving gw.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
6a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw address(es) and serving gw dl teid(s) for data forwarding) message to the target sgsn.
7. the target sgsn sends the message forward relocation response (cause, sgsn tunnel endpoint identifier for CP, sgsn address for CP, target to source transparent container, cause, rab setup information, additional rab setup information, address(es) and teid(s) for user traffic data forwarding, serving gw change indication) to the source mme. serving gw change indication indicates a new serving gw has been selected. the target to source transparent container contains the value from the target rnc to source rnc transparent container received from the target rnc.
 the ie 'address(es) and teid(s) for user traffic data forwarding' defines the destination tunnelling endpoint for data forwarding in target system, and it is set as follows:
- if 'direct forwarding' applies, or if 'indirect forwarding' and no relocation of serving gw apply and direct tunnel is used, then the ie 'address(es) and teid(s) for user traffic data forwarding' contains the addresses and gtp-u tunnel endpoint parameters to the target rnc received in step?5a.
- if 'indirect forwarding' and relocation of serving gw apply, then the ie 'address(es) and teid(s) for user traffic data forwarding' contains the addresses and dl gtp-u tunnel endpoint parameters to the serving gw received in step?6. this is independent from using direct tunnel or not.
- if 'indirect forwarding' applies and direct tunnel is not used and relocation of serving gw does not apply, then the ie 'address(es) and teid(s) for user traffic data forwarding' contains the dl gtp-u tunnel endpoint parameters to the target sgsn.
8. if "indirect forwarding" applies, the source mme sends the message create indirect data forwarding tunnel request (address(es) and teid(s) for data forwarding (received in step 7)), eps bearer id(s)) to the serving gw used for indirect forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
8a. the serving gw returns the forwarding parameters by sending the message create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding). if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
5.5.2.1.3 execution phase

figure 5.5.2.1.3-1: e-utran to utran iu mode inter rat ho, execution phase
note: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. step (b) shows pcrf interaction in the case of pmip-based s5/s8. steps 8 and 8a concern gtp based s5/s8
 the source enodeb continues to receive downlink and uplink UP pdus.
1. the source mme completes the preparation phase towards source enodeb by sending the message handover command (target to source transparent container, e-rabs to release list, bearers subject to data forwarding list). the "bearers subject to data forwarding list" ie may be included in the message and it shall be a list of 'address(es) and teid(s) for user traffic data forwarding' received from target side in the preparation phase (step?7 of the preparation phase) when 'direct forwarding' applies, or the parameters received in step?8a of the preparation phase when 'indirect forwarding' applies.
 the source enodeb initiates data forwarding for bearers specified in the "bearers subject to data forwarding list". the data forwarding may go directly to target rnc or alternatively go via the serving gw if so decided by source mme and or/ target sgsn in the preparation phase.
2. the source enodeb will give a command to the ue to handover to the target access network via the message ho from e-utran command. this message includes a transparent container including radio aspect parameters that the target rnc has set-up in the preparation phase. the details of this e-utran specific signalling are described in ts?36.300?[5].
 upon the reception of the ho from e-utran command message containing the handover command message, the ue shall associate its bearer ids to the respective rabs based on the relation with the nsapi and shall suspend the uplink transmission of the UP data.
3. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends the ran usage data report message (secondary rat usage data) to the mme. since the handover is an inter-rat handover, the mme continues with the secondary rat usage data reporting procedure as in clause?5.7a.3. the reporting procedure in clause?5.7a.3 is only performed if pgw secondary rat usage reporting is active.
4. the ue moves to the target utran iu (3g) system and executes the handover according to the parameters provided in the message delivered in step 2. the procedure is the same as in step 6 and 8 in clause 5.2.2.2 in ts?43.129?[8] with the additional function of association of the received rabs and existing bearer id related to the particular nsapi.
 the ue may resume the user data transfer only for those nsapis for which there are radio resources allocated in the target rnc.
5. when the new source rnc-id + s-rnti are successfully exchanged with the ue, the target rnc shall send the relocation complete message to the target sgsn. the purpose of the relocation complete procedure is to indicate by the target rnc the completion of the relocation from the source e-utran to the rnc. after the reception of the relocation complete message the target sgsn shall be prepared to receive data from the target rnc. each uplink n-pdu received by the target sgsn is forwarded directly to the serving gw.
 for sipto at the local network with stand-alone gw architecture, the target rnc shall include the local home network id of the target cell in the relocation complete message.
6. then the target sgsn knows that the ue has arrived to the target side and target sgsn informs the source mme by sending the forward relocation complete notification (isr activated, serving gw change) message. if indicated, isr activated indicates to the source mme that it shall maintain the ue's context and that it shall activate isr, which is only possible when the s gw is not changed. the source mme will also acknowledge that information. a timer in source mme is started to supervise when resources in source enodeb and source serving gw (for serving gw relocation) shall be released.
 when the timer expires and isr activated is not indicated by the target sgsn the source mme releases all bearer resources of the ue. if serving gw change is indicated and this timer expires the source mme deletes the eps bearer resources by sending delete session request (cause, operation indication) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
 upon receipt of the forward relocation complete acknowledge message the target sgsn starts a timer if the target sgsn allocated s gw resources for indirect forwarding.
 for all bearers that were not included in the forward relocation request message sent in step?3, the mme now releases them by sending a delete bearer command to the sgw, or, the appropriate message to the scef.
7. the target sgsn will now complete the handover procedure by informing the serving gw (for serving gw relocation this will be the target serving gw) that the target sgsn is now responsible for all the eps bearer contexts the ue has established. this is performed in the message modify bearer request (sgsn tunnel endpoint identifier for CP, nsapi(s), sgsn address for CP, sgsn address(es) and teid(s) for user traffic for the accepted eps bearers (if direct tunnel is not used) or rnc address(es) and teid(s) for user traffic for the accepted eps bearers (if direct tunnel is used) and rat type, isr activated) per pdn connection. as it is a mobility from e-utran, if the target sgsn supports location information change reporting, the target sgsn shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information (determined from the ue context), the sgsn also includes the user csg information ie in this message. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message. if serving gw is not relocated but the serving network has changed or if the sgsn has not received any old serving network information from the old mme, the sgsn includes the new serving network ie in this message. in network sharing scenarios serving network denotes the serving core network. if indicated, the information isr activated indicates that isr is activated, which is only possible when the s gw is not changed. when the modify bearer request does not indicate isr activated and s gw is not changed, the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved.
 the sgsn releases the non-accepted eps bearer contexts by triggering the bearer context deactivation procedure. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the sgsn.
8. the serving gw (for serving gw relocation this will be the target serving gw) may inform the pdn gw(s) the change of for example for serving gw relocation or the rat type that e.g. can be used for charging, by sending the message modify bearer request per pdn connection. the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if they are present in step?7. serving network should be included if it is received in step?7 or in step?4 in clause?5.5.2.1.2. for serving gw relocation, the serving gw allocates dl teids on s5/s8 even for non-accepted bearers and may include the pdn charging pause support indication. the pdn gw must acknowledge the request with the message modify bearer response. in the case of serving gw relocation, the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. if location information change reporting is required and supported in the target sgsn, the pdn gw shall provide ms info change reporting action in the modify bearer response.
 if pcc infrastructure is used, the pdn gw informs the pcrf about the change of, for example, the rat type.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path. the source serving gw shall forwards the "end marker" packets to the source enodeb.
9. the serving gw (for serving gw relocation this will be the target serving gw) acknowledges the UP switch to the target sgsn via the message modify bearer response (cause, serving gw tunnel endpoint identifier for CP, serving gw address for CP, protocol configuration options, ms info change reporting action). at this stage the UP path is established for all eps bearer contexts between the ue, target rnc, target sgsn if direct tunnel is not used, serving gw (for serving gw relocation this will be the target serving gw) and pdn gw.
 if the serving gw does not change, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path.
10. when the ue recognises that its current routing area is not registered with the network, or when the ue's tin indicates "guti", the ue initiates a routing area update procedure with the target sgsn informing it that the ue is located in a new routing area. it is ran functionality to provide the pmm-connected ue with routing area information.
 the target sgsn knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target sgsn performs only a subset of the rau procedure, specifically it excludes the context transfer procedures between source mme and target sgsn.
 for a ue supporting ciot eps optimisations, the ue uses the bearer status information in the rau accept to identify any non-transferred bearers that it shall locally release.
11. when the timer started at step?6 expires, the source mme sends a release resources message to the source enodeb. the source enodeb releases its resources related to the ue.
 when the timer started in step 6 expires and if the source mme received the serving gw change indication in the forward relocation response message, it deletes the eps bearer resources by sending delete session request (cause, operation indication, secondary rat usage data) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. secondary rat usage data is included if it was received in step?3. the source serving gw acknowledges with delete session response (cause) messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
12. if indirect forwarding was used then the expiry of the timer at source mme started at step?6 triggers the source mme to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
13. if indirect forwarding was used and the serving gw is relocated, then the expiry of the timer at target sgsn started at step?6 triggers the target sgsn to send a delete indirect data forwarding tunnel request message to the target s gw to release temporary resources used for indirect forwarding.
5.5.2.1.4 e-utran to utran iu mode inter rat handover reject
the target rnc may reject the use of the handover procedure if none of the requested rabs in the relocation request message could be established. in this case no ue context is established in the target sgsn/rnc and no resources are allocated. the ue remains in the source enodeb/mme.

figure 5.5.2.1.4-1: e-utran to utran iu mode inter rat ho reject
1. the step 1 to 5 in the flow are identical to the ones in clause?5.5.2.1.2.
6. if the target rnc fails to allocate any resources for any of the requested rabs it sends a relocation failure (cause) message to the target sgsn. when the target sgsn receives the relocation failure message from target rnc the target sgsn clears any reserved resources for this ue.
7. this step is only performed for serving gw relocation, i.e. if steps?4/4a have been performed. the target sgsn deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
8. the target sgsn sends the forward relocation response (cause) message to the source mme.
9. when the source mme receives the forward relocation response message it send a handover preparation failure (cause) message to the source enodeb.
5.5.2.2 utran iu mode to e-utran inter rat handover
5.5.2.2.1 general
the utran iu mode to e-utran inter rat handover procedure takes place when the network decides to perform a handover. the decision to perform ps handover from utran iu mode to e-utran is taken by the network based on radio condition measurements reported by the ue to the utran rnc.
if emergency bearer services are ongoing for the ue, the mme checks as part of the tracking area update in the execution phase, if the handover is to a restricted area and if so mme releases the non-emergency bearers as specified in clause?5.10.3.
if emergency bearer services are ongoing for the ue, the source sgsn evaluates the handover to the target csg cell independent of the ue's csg subscription. if the handover is to a csg cell that the ue is not subscribed, the target enodeb only accepts the emergency bearers and the target mme releases the non-emergency pdn connections that were not accepted by the target enodeb as specified in clause?5.10.3.
5.5.2.2.2 preparation phase

figure 5.5.2.2.2-1: utran iu mode to e-utran inter rat ho, preparation phase
1. the source rnc decides to initiate an inter-rat handover to the e-utran. at this point both uplink and downlink user data is transmitted via the following: bearers between ue and source rnc, gtp tunnel(s) between source rnc, source sgsn (only if direct tunnel is not used), serving gw and pdn gw.
note?1: the process leading to the handover decision is outside of the scope of this specification.
2. the source rnc sends a relocation required (cause, target enodeb identifier, csg id, csg access mode, source rnc identifier, source rnc to target rnc transparent container) message to the source sgsn to request the cn to establish resources in the target enodeb, target mme and the serving gw. the bearers that will be subject to data forwarding (if any) are identified by the target mme in a later step (see step?7 below). when the target cell is a csg cell or a hybrid cell, the source rnc shall include the csg id of the target cell. if the target cell is a hybrid cell, the csg access mode shall be indicated.
3. the source sgsn determines from the 'target enodeb identifier' ie that the type of handover is irat handover to e-utran. the source sgsn selects the target mme as described in clause?4.3.8.3 on "mme selection function". the source sgsn initiates the handover resource allocation procedure by sending forward relocation request (imsi, target identification, csg id, csg membership indication, mm context, pdn connections, sgsn tunnel endpoint identifier for CP, sgsn address for CP, source to target transparent container, ran cause, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, isr supported, serving network, change to report (if present)) message to the target mme. this message includes all eps bearer contexts corresponding to all the bearers established in the source system and the uplink tunnel endpoint parameters of the serving gw. if the information isr supported is indicated, this indicates that the source sgsn and associated serving gw are capable to activate isr for the ue. when isr is activated the message should be sent to the mme that maintains isr for the ue when this mme is serving the target identified by the target identification. ran cause indicates the cause as received from source rnc. the source to target transparent container contains the value from the source rnc to target rnc transparent container received from the source rnc. the old serving network is sent to target mme to support the target mme to resolve if serving network is changed.
 change to report flag is included by the source sgsn if reporting of change of ue time zone, or serving network, or both towards serving gw / pdn gw was deferred by the source sgsn.
 the source sgsn shall perform access control by checking the ue's csg subscription when csg id is provided by the source rnc. if there is no subscription data for this csg id or the csg subscription is expired, and the target cell is a csg cell, the source sgsn shall reject the handover with an appropriate cause unless the ue has emergency bearer services.
 the source sgsn includes the csg id in the forward relocation request when the target cell is a csg cell or hybrid cell. when the target cell is a hybrid cell, or if there are one or several emergency bearers and the target cell is a csg cell, the csg membership indication indicating whether the ue is a csg member shall be included in the forward relocation request message.
 this message includes all pdn connections active in the source system and for each pdn connection includes the associated apn, the address and the uplink tunnel endpoint parameters of the serving gw for CP, and a list of eps bearer contexts.
 prioritization of eps bearer contexts is performed by the target core network node.
 the mm context contains security related information, e.g. ue network capabilities and used umts integrity and ciphering algorithm(s) as well as keys, as described in clause?5.7.2 (information storage for mme).
 the target mme selects the nas ciphering and integrity algorithms to use. these algorithms will be sent transparently from the target enodeb to the ue in the target to source transparent container (epc part).
 the mme establishes the eps bearer(s) in the prioritized order. the mme deactivates, as provided in step?8 of the execution phase, the eps bearers which cannot be established.
 the target mme shall determine the maximum apn restriction based on the apn restriction of each bearer context received in the forward relocation request, and shall subsequently store the new maximum apn restriction value.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw the source sgsn shall include the local home network id of the source cell in the pdn connections corresponding to the sipto at the local network pdn connection.
4. the target mme determines if the serving gw is to be relocated, e.g., due to plmn change. if the serving gw is to be relocated, the target mme selects the target serving gw as described under clause 4.3.8.2 on "serving gw selection function". the target mme sends a create session request message (imsi, mme address and teid, mme tunnel endpoint identifier for CP, mme address for CP, pdn gw address(es) for UP, pdn gw ul teid(s) for UP, pdn gw address for CP, and pdn gw teid(s) for CP, the protocol type over s5/s8, serving network) per pdn connection to the target serving gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface.
4a. the target serving gw allocates its local resources and returns them in a create session response (serving gw address(es) for UP, serving gw ul teid(s) for UP, serving gw address for CP, serving gw teid for CP) message to the target mme.
5. the target mme requests the target enodeb to establish the bearer(s) by sending the message handover request (ue identifier, s1ap cause, kenb, allowed as integrity protection and ciphering algorithm(s), nas security parameters to e-utran, eps bearers to be setup list, csg id, csg membership indication, source to target transparent container). the nas security parameters to e utran includes the nas integrity protection and ciphering algorithm(s), eksi and noncemme are targeted for the ue. s1ap cause indicates the ran cause as received from source sgsn. the source to target transparent container contains the value from the ran transparent container received from the source sgsn.
note?2: the target mme derives k'asme from ck and ik in the mm context and associates it with eksi, as described in ts?33.401?[41] and selects nas integrity protection and ciphering algorithm(s). the mme and ue derive the nas keys and kenb from k'asme. if the mme shares an eps security association with the ue, the mme may activate this native eps security context by initiating a nas smc procedure after having completed the handover procedure.
 for each eps bearer requested to be established, 'eps bearers to be setup' ie shall contain information such as id, bearer parameters, transport layer address, "data forwarding not possible" indication, and s1 transport association. the target mme ignores any activity status indicator within an eps bearer context and requests the target enodeb to allocate resources for all eps bearer contexts received from the source side. the transport layer address is the serving gw address for user data, and the s1 transport association corresponds to the uplink tunnel endpoint identifier data. "data forwarding not possible" indication shall be included if the target mme decides the corresponding bearer will not be subject to data forwarding.
 the target mme shall include the csg id and csg membership indication when provided by the source sgsn in the handover request message.
 the information about the selected nas ciphering and integrity protection algorithm(s), ksi and noncemme will be sent transparently from the target enodeb to the ue in the target to source transparent container, and in the message utran ho command from source rnc to the ue. this will then allow data transfer to continue in the new rat/mode target cell without requiring a new aka (authentication and key agreement) procedure. more details are described in ts?33.401?[41].
 if the target cell is a csg cell, the target enodeb shall verify the csg id provided by the target mme, and reject the handover with an appropriate cause if it does not match the csg id for the target cell. if the target enodeb is in hybrid mode, it may use the csg membership status to perform differentiated treatment for csg and non-csg members. if the target cell is a csg cell, and if the csg membership indication is "non member", the target enodeb only accepts the emergency bearers.
5a. the target enodeb allocates the requested resources and returns the applicable parameters to the target mme in the message handover request acknowledge (target to source transparent container, eps bearers setup list, eps bearers failed to setup list). the target enodeb shall ignore it if the number of radio bearers in the source to target transparent container does not comply with the number of bearers requested by the mme and allocate bearers as requested by the mme. upon sending the handover request acknowledge message the target enodeb shall be prepared to receive downlink gtp pdus from the serving gw for the accepted eps bearers.
 the target enodeb selects as integrity and ciphering algorithm(s). in addition to the information provided by the mme (eksi, nas integrity protection and ciphering algorithm(s) and noncemme), the target enodeb inserts as integrity and ciphering algorithm(s) into the utran rrc message, which is contained in the target to source transparent container.
6. if 'indirect forwarding' and relocation of serving gw apply the target mme sends a create indirect data forwarding tunnel request message (target enodeb address, teid(s) for dl data forwarding) to the serving gw.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
6a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw address(es) and serving gw dl teid(s) for data forwarding) message to the target mme.
7. the target mme sends the message forward relocation response (cause, list of set up rabs, eps bearers setup list, mme tunnel endpoint identifier for CP, ran cause, mme address for CP, target to source transparent container, address(es) and teid(s) for data forwarding, serving gw change indication) to the source sgsn. serving gw change indication indicates whether a new serving gw has been selected. the target to source transparent container includes the value from the target to source transparent container received from the target enodeb.
 the ie 'address(es) and teid(s) for user traffic data forwarding' defines the destination tunnelling endpoint for data forwarding in target system, and it is set as follows. if 'direct forwarding' or if 'indirect forwarding' but no relocation of serving gw applies, then the ies 'address(es) and teid(s) for data forwarding' contains the forwarding dl gtp-u tunnel endpoint parameters to the enodeb received in step?5a.
 if 'indirect forwarding' and relocation of serving gw apply the ies 'address(es) and teid(s) for data forwarding' contains the dl gtp-u tunnel endpoint parameters to the target enodeb or to the forwarding serving gw received in step?6a.
8. if "indirect forwarding" applies, the source sgsn shall send the message create indirect data forwarding tunnel request (address(es) and teid(s) for data forwarding (received in step?7)) to the serving gw used for indirect forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
8a. the serving gw returns the forwarding UP parameters by sending the message create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding). if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
5.5.2.2.3 execution phase

figure 5.5.2.2.3-1: utran iu mode to e-utran inter rat ho, execution phase
note: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. step (b) shows pcrf interaction in the case of pmip-based s5/s8. steps 9 and 9a concern gtp based s5/s8.
 the source rnc continues to receive downlink and uplink UP pdus.
1. the source sgsn completes the preparation phase towards source rnc by sending the message relocation command (target rnc to source rnc transparent container, rabs to be released list, rabs subject to data forwarding list). the "rabs to be released list" ie will be the list of all nsapis (rab ids) for which a bearer was not established in target enodeb. the "rabs subject to data forwarding list" ie may be included in the message and it shall be a list of 'address(es) and teid(s) for user traffic data forwarding' received from target side in step?7 of the preparation phase when 'direct forwarding' applies. if 'indirect forwarding' is applicable and direct tunnel is used the "rabs subject to data forwarding list" ie includes the parameters received in step?8a of the preparation phase. if 'indirect forwarding' is applicable and direct tunnel is not used the "rabs subject to data forwarding list" ie includes the source sgsn address(es) and teid(s) allocated for indirect data forwarding by source sgsn. the target rnc to source rnc transparent container contains the value from the target to source transparent container received from the target mme.
2. the source rnc will command to the ue to handover to the target enodeb via the message ho from utran command. the access network specific message to ue includes a transparent container including radio aspect parameters that the target enodeb has set-up in the preparation phase.
 the source rnc may initiate data forwarding for the indicated rabs/eps bearer contexts specified in the "rabs subject to data forwarding list". the data forwarding may go directly to target enodeb, or alternatively go via the serving gw if so decided by source sgsn and/or target mme in the preparation phase.
 upon the reception of the ho from utran command message containing the relocation command message, the ue shall associate its rab ids to the respective bearers id based on the relation with the nsapi and shall suspend the uplink transmission of the UP data.
3. void.
4. the ue moves to the e-utran and performs access procedures toward target enodeb.
5. when the ue has got access to target enodeb it sends the message ho to e-utran complete.
the ue shall implicitly derive the eps bearers for which an e-rab was not established from the ho from utran command and deactivate them locally without an explicit nas message at this step.
6. when the ue has successfully accessed the target enodeb, the target enodeb informs the target mme by sending the message handover notify (tai+ecgi, local home network id).
 for sipto at the local network with stand-alone gw architecture, the target enodeb shall include the local home network id of the target cell in the handover notify message.
7. then the target mme knows that the ue has arrived to the target side and target mme informs the source sgsn by sending the forward relocation complete notification (isr activated, serving gw change) message. if isr activated is indicated, this indicates to the source sgsn that it shall maintain the ue's contexts and activate isr, which is only possible when the s gw is not changed. the source sgsn shall also acknowledge that information. a timer in source sgsn is started to supervise when resources in the in source rnc and source serving gw (for serving gw relocation) shall be released
 upon receipt of the forward relocation complete acknowledge message the target mme starts a timer if the target mme applies indirect forwarding.
8. the target mme will now complete the inter-rat handover procedure by informing the serving gw (for serving gw relocation this will be the target serving gw) that the target mme is now responsible for all the bearers the ue have established. this is performed in the message modify bearer request (cause, mme tunnel endpoint identifier for CP, eps bearer id, mme address for CP, enodeb address(es) and teid(s) for user traffic for the accepted eps bearers and rat type, isr activated) per pdn connection. as it is a mobility from utran, if the target mme supports location information change reporting, the target mme shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information (determined from the ue context), the mme also includes the user csg information ie in this message. if either the ue time zone has changed or forward relocation request message from source sgsn indicated pending ue time zone change reporting (via change to report flag), the mme includes the ue time zone ie in this message. if either serving gw is not relocated but the serving network has changed or forward relocation request message from source sgsn indicated pending serving network change reporting (via change to report flag), the mme includes the new serving network ie in this message. if indicated, the information isr activated indicates that isr is activated, which is only possible when the s gw was not changed. when the modify bearer request does not indicate isr activated and s gw is not changed, the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved.
 the mme releases the non-accepted dedicated bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
 if the default bearer of a pdn connection has not been accepted by the target enodeb and there are other pdn connections active, the mme shall handle it in the same way as if all bearers of a pdn connection have not been accepted. the mme releases these pdn connections by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
9. the serving gw (for serving gw relocation this will be the target serving gw) may inform the pdn gw the change of for example for serving gw relocation or the rat type that e.g. can be used for charging, by sending the message modify bearer request per pdn connection. the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if they are present in step?8. serving network should be included if it is received in step?8 or in step?4 in clause?5.5.2.2.2. for serving gw relocation, the serving gw allocates dl teids on s5/s8 even for non-accepted bearers and may include the pdn charging pause support indication. the pdn gw must acknowledge the request with the message modify bearer response. in the case of serving gw relocation, the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. if location information change reporting is required and supported in the target mme, the pdn gw shall provide ms info change reporting action in the modify bearer response.
 if pcc infrastructure is used, the pdn gw informs the pcrf about the change of, for example, the rat type.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb. the source serving gw shall forward the "end marker" packets to the source sgsn or rnc.
10. the serving gw (for serving gw relocation this will be the target serving gw) acknowledges the UP switch to the target mme via the message modify bearer response (cause, serving gw tunnel endpoint identifier for CP, serving gw address for CP, protocol configuration options, ms info change reporting action). at this stage the UP path is established for all bearers between the ue, target enodeb, serving gw (for serving gw relocation this will be the target serving gw) and pdn gw.
 if the serving gw does not change, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb.
11. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies.
 the target mme knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target mme performs only a subset of the ta update procedure, specifically it excludes the context transfer procedures between source sgsn and target mme.
 if the subscription data received from the hss (during the tau in step?11) contains information that is necessary for the e-utran to be aware of (e.g. a restriction in the ue's permission to use nr as a secondary rat, unlicensed spectrum or a combination of them), or an existing ue context in the mme indicates that the ue is not permitted to use nr as a secondary rat or unlicensed spectrum or a combination of them and the mme has not provided this information to the target enodeb during step?5 of the handover preparation phase, then the mme sends an updated handover restriction list in the downlink nas transport message that it sends to ran. if the ue is not allowed to use nr as secondary rat, the mme indicates that to the ue in tau accept message.
12. when the timer started in step 7 expires the source sgsn will clean up all its resources towards source rnc by sending the iu release command to the rnc. when there is no longer any need for the rnc to forward data, the source rnc responds with an iu release complete message.
 when the timer started in step 7 expires and if the source sgsn received the serving gw change indication in the forward relocation response message, it deletes the eps bearer resources by sending delete session request (cause, operation indication) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. the source serving gw acknowledges with delete session response (cause) messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
13. if indirect forwarding was used then the expiry of the timer at source sgsn started at step?7 triggers the source sgsn to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
14. if indirect forwarding was used and the serving gw is relocated, then the expiry of the timer at target mme started at step?7 triggers the target mme to send a delete indirect data forwarding tunnel request message to the target s gw to release temporary resources used for indirect forwarding.
5.5.2.2.4 utran iu mode to e-utran inter rat handover reject
the target enodeb may reject the use of the handover procedure if none of the requested eps bearers in the handover request message could be established. in this case no ue context is established in the target mme/enodeb and no resources are allocated. the ue remains in the source rnc/sgsn.

figure 5.5.2.2.4-1: utran iu mode to e-utran inter rat ho reject
1. steps?1 to 5 in the flow are identical to the ones in clause?5.5.2.2.2.
6. if the target enodeb fails to allocate any resources for any of the requested eps bearers it sends a handover failure (cause) message to the target mme. when the target mme receives the handover failure message from target enodeb the target mme clears any reserved resources for this ue.
7. this step is only performed for serving gw relocation, i.e. if steps?4/4a have been performed. the target mme deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
8. the target mme sends the forward relocation response (cause) message to the source sgsn.
9. when the source sgsn receives the forward relocation response message it send a relocation preparation failure (cause) message to the source rnc.
5.5.2.3 e-utran to geran a/gb mode inter rat handover
5.5.2.3.1 general
the procedure is based on packet-switched handover for geran a/gb mode defined in ts?43.129?[8].
pre-conditions:
- the ue is in ecm-connected state (e-utran mode);
- the bss must support pfm, packet flow management, procedures.
5.5.2.3.2 preparation phase

figure 5.5.2.3.2-1: e-utran to geran a/gb inter rat ho, preparation phase
1. the source enodeb decides to initiate an inter rat handover to the target geran a/gb mode (2g) system. at this point both uplink and downlink user data is transmitted via the following: bearer(s) between ue and source enodeb, gtp tunnel(s) between source enodeb, serving gw and pdn gw.
 if the ue has an ongoing emergency bearer service the source enodeb shall not initiate ps handover to geran.
note?1: the process leading to the handover decision is outside of the scope of this specification
2. the source enodeb sends a handover required (s1ap cause, target system identifier, source to target transparent container) message to the source mme to request the cn to establish resources in the target bss, target sgsn and the serving gw. the bearers that will be subject to data forwarding (if any) are identified by the target sgsn in a later step (see step?7 below).
 the 'target system identifier' ie contains the identity of the target global cell id.
3. the source mme determines from the 'target system identifier' ie that the type of handover is irat handover to geran a/gb mode. the source mme selects the target sgsn as described in clause?4.3.8.4 on "sgsn selection function". the source mme initiates the handover resource allocation procedure by sending a forward relocation request (imsi, target identification (shall be set to "empty"), mm context, pdn connections, mme tunnel endpoint identifier for CP, mme address for CP, source to target transparent container, packet flow id, xid parameters (if available), target cell identification, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, isr supported, ran cause, serving network) message to the target sgsn. if the information isr supported is indicated, this indicates that the source mme and associated serving gw are capable to activate isr for the ue. when isr is activated the message should be sent to the sgsn that maintains isr for the ue when this sgsn is serving the target identified by the target identification. this message includes all pdn connections active in the source system and for each pdn connection includes the associated apn, the address and the uplink tunnel endpoint parameters of the serving gw for CP, and a list of eps bearer contexts. the old serving network is sent to target mme to support the target mme to resolve if serving network is changed. in network sharing scenarios serving network denotes the serving core network.
 the mm context includes information on the eps bearer context(s). if none of the ue's eps bearers can be supported by the selected target sgsn, the source mme rejects the handover attempt by sending a handover preparation failure (cause) message to the source enodeb.
note?2: if the handover is successful, the source mme will signal to the sgw and/or scef to release any non-included eps bearers after step?8 of the execution procedure. the non-included bearers are locally released by the ue following the bearer context status synchronisation that occurs during the routing area update at step?13 of the execution procedure.
 the target sgsn maps the eps bearers to pdp contexts 1-to-1 and maps the eps bearer qos parameter values of an eps bearer to the release?99 qos parameter values of a bearer context as defined in annex e.
 prioritization of pdp contexts is performed by the target core network node, i.e. target sgsn.
 if the source mme supports irat handover to geran a/gb procedure it has to allocate a valid pfi during the bearer activation procedure. ran cause indicates the s1ap cause as received from the source enodeb. the source to target transparent container includes the value from the source to target transparent container received from the source enodeb.
 the mm context contains security related information, e.g. supported ciphering algorithms, as described in ts?29.274?[43]. handling of security keys is described in ts?33.401?[41].
 the target sgsn selects the ciphering algorithm to use. this algorithm will be sent transparently from the target sgsn to the ue in the nas container for handover (part of the target to source transparent container). the iov-ui parameter, generated in the target sgsn, is used as input to the ciphering procedure and it will also be transferred transparently from the target sgsn to the ue in the nas container for handover. more details are described in ts?33.401?[41].
 when the target sgsn receives the forward relocation request message the required eps bearer, mm, sndcp and llc contexts are established and a new p-tmsi is allocated for the ue. when this message is received by the target sgsn, it begins the process of establishing pfcs for all eps bearer contexts.
 when the target sgsn receives the forward relocation request message it extracts from the eps bearer contexts the nsapis and sapis and pfis to be used in the target sgsn. if for a given eps bearer context the target sgsn does not receive a pfi from the source mme, it shall not request the target bss to allocate tbf resources corresponding to that eps bearer context. if none of the eps bearer contexts forwarded from the source mme has a valid pfi allocated the target sgsn shall consider this as a failure case and the request for handover shall be rejected.
 if when an sapi and pfi was available at the source mme but the target sgsn does not support the same sapi and pfi for a certain nsapi as the source mme, the target sgsn shall continue the handover procedure only for those nsapis for which it can support the same pfi and sapi as the source mme. all eps bearer contexts for which no resources are allocated by the target sgsn or for which it cannot support the same sapi and pfi (i.e. the corresponding nsapis are not addressed in the response message of the target sgsn), are maintained and the related sapis and pfis are kept. these eps bearer contexts may be modified or deactivated by the target sgsn via explicit sm procedures upon rau procedure.
 the source mme shall indicate the current xid parameter settings if available (i.e. those xid parameters received during a previous irat handover procedure) to the target sgsn. if the target sgsn can accept all xid parameters as indicated by the source mme, the target sgsn shall create a nas container for handover indicating 'reset to the old xid parameters'. otherwise, if the target sgsn cannot accept all xid parameters indicated by the source mme or if no xid parameters were indicated by the source mme, the target sgsn shall create a nas container for handover indicating reset (i.e. reset to default parameters).
 the target sgsn shall determine the maximum apn restriction based on the apn restriction of each bearer context received in the forward relocation request, and shall subsequently store the new maximum apn restriction value.
 if sipto at the local network is active for a pdn connection in the architecture with stand-alone gw the source mme shall include the local home network id of the source cell in the pdn connections corresponding to the sipto at the local network pdn connection.
4. the target sgsn determines if the serving gw is to be relocated, e.g., due to plmn change. if the serving gw is to be relocated, the target sgsn selects the target serving gw as described under clause 4.3.8.2 on "serving gw selection function", and sends a create session request message (imsi, sgsn tunnel endpoint identifier for CP, sgsn address for CP, pdn gw address(es) for UP, pdn gw ul teid(s) for UP, pdn gw address(es) for CP, and pdn gw teid(s) for CP, the protocol type over s5/s8, serving network) per pdn connection to the target serving gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface.
4a. the target serving gw allocates its local resources and returns a create session response (serving gw address(es) for UP, serving gw ul teid(s) for UP, serving gw address for CP, serving gw teid for CP) message to the target sgsn.
5. the target sgsn establishes the eps bearer context(s) in the indicated order. the sgsn deactivates, as provided in step?9 of the execution phase, the eps bearer contexts which cannot be established.
 the target sgsn requests the target bss to establish the necessary resources (pfcs) by sending the message ps handover request (local tlli, imsi, cause, target cell identifier, pfcs to be set-up list, source rnc to target bss transparent container and nas container for handover). the target sgsn shall not request resources for which the activity status indicator within a eps bearer context indicates that no active bearer exists on the source side for that pdp context. the cause indicates the ran cause as received from the source mme. the source rnc to target bss transparent container contains the value from the source to target transparent container received from the source mme. all eps bearer contexts indicate active status because e-utran does not support selective rab handling.
 based upon the abqp for each pfc the target bss makes a decision about which pfcs to assign radio resources. the algorithm by which the bss decides which pfcs that need resources is implementation specific. due to resource limitations not all downloaded pfcs will necessarily receive resource allocation. the target bss allocates tbfs for each pfc that it can accommodate.
 the target bss shall prepare the 'target to source transparent container' which contains a ps handover command including the epc part (nas container for handover) and the rn part (handover radio resources).
5a. the target bss allocates the requested resources and returns the applicable parameters to the target sgsn in the message ps handover request acknowledge (local tlli, list of set-up pfcs, target bss to source rnc transparent container, cause). upon sending the ps handover request acknowledge message the target bss shall be prepared to receive downlink llc pdus from the target sgsn for the accepted pfcs.
 any eps bearer contexts for which a pfc was not established are maintained in the target sgsn and the related sapis and pfis are kept. these eps bearer contexts shall be deactivated by the target sgsn via explicit sm procedures upon the completion of the routing area update (rau) procedure.
6. if indirect forwarding and relocation of serving gw applies the target sgsn sends a create indirect data forwarding tunnel request message (target sgsn address(es) and teid(s) for dl data forwarding) to the serving gw used for indirect packet forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
6a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw dl address(es) and teid(s) for data forwarding) message to the target sgsn.
7. the target sgsn sends the message forward relocation response (cause, sgsn tunnel endpoint identifier for CP, sgsn address for CP, target to source transparent container, ran cause, list of set-up pfis, address(es) and teid(s) for user traffic data forwarding, serving gw change indication) to the source mme. serving gw change indication indicates a new serving gw has been selected. ran cause indicates the cause as received from the target bss. the target to source transparent container includes the value from the target bss to source rnc transparent container received from the target bss.
 if 'indirect forwarding' and relocation of serving gw applies, then the ies 'address(es) and teid(s) for user traffic data forwarding' contain the dl gtp-u tunnel endpoint parameters received in step?6a. otherwise the ies 'address(es) and teid(s) for user traffic data forwarding' contains the dl gtp-u tunnel endpoint parameters to the target sgsn.
 the target sgsn activates the allocated llc/sndcp engines as specified in ts?44.064?[23] for an sgsn originated reset or 'reset to the old xid parameters'.
8. if "indirect forwarding" applies, the source mme sends the message create indirect data forwarding tunnel request (address(es) and teid(s) for data forwarding (received in step?7)) to the serving gw used for indirect packet forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
8a. the serving gw returns the forwarding UP parameters by sending the message create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding). if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
5.5.2.3.3 execution phase

figure 5.5.2.3.3-1: e-utran to geran a/gb mode inter rat ho, execution phase
note?1: for a pmip-based s5/s8, procedure steps (a) and (b) are defined in ts?23.402?[2]. step (b) shows pcrf interaction in the case of pmip-based s5/s8. steps 10 and 10a concern gtp based s5/s8
 the source enodeb continues to receive downlink and uplink UP pdus.
1. the source mme completes the preparation phase towards source enodeb by sending the message handover command (target to source transparent container (ps handover command with rn part and epc part), e rabs to release list, bearers subject to data forwarding list), s1ap cause. the "bearers subject to data forwarding list" may be included in the message and it shall be a list of 'address(es) and teid(s) for user traffic data forwarding' received from target side in the preparation phase (step?7 of the preparation phase for direct forwarding, else parameters received in step?8a of the preparation phase). s1ap cause indicates the ran cause as received from the target sgsn.
 source enodeb initiate data forwarding for the bearers specified in the "bearers subject to data forwarding list". the data forwarding may go directly i.e. to target sgsn or alternatively go via the serving gw if so decided by source mme and/or target sgsn in the preparation phase.
2. the source enodeb will give a command to the ue to handover to the target access system via the message ho from e-utran command. this message includes a transparent container including radio aspect parameters that the target bss has set-up in the preparation phase (rn part). this message also includes the xid and iov-ui parameters received from the target sgsn (epc part).
 upon the reception of the ho from e-utran command message containing the handover command message, the ue shall associate its bearer ids to the respective pfis based on the relation with the nsapi and shall suspend the uplink transmission of the UP data.
3. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends the ran usage data report message (secondary rat usage data) to the mme. since the handover is an inter-rat handover, the mme continues with the secondary rat usage data reporting procedure as in clause?5.7a.3. the reporting procedure in clause?5.7a.3 is only performed if pgw secondary rat usage reporting is active.
4. the ue moves to the target geran a/gb (2g) system and performs executes the handover according to the parameters provided in the message delivered in step 2. the procedure is the same as in step 6 in clause 5.3.2.2 in ts?43.129?[8] with the additional function of association of the received pfi and existing bearer id related to the particular nsapi.
5. after accessing the cell using access bursts and receiving timing advance information from the bss in step 4, the ue processes the nas container and then sends one xid response message to the target sgsn via target bss. the ue sends this message immediately after receiving the packet physical information message containing the timing advance or, in the synchronised network case, immediately if the ps handover access message is not required to be sent.
 upon sending the xid response message, the ue shall resume the user data transfer only for those nsapis for which there are radio resources allocated in the target cell. for nsapis using llc adm, for which radio resources were not allocated in the target cell, the ue may request for radio resources using the legacy procedures.
 if the target sgsn indicated xid reset (i.e. reset to default xid parameters) in the nas container included in the ho from e-utran command message, and to avoid collision cases the mobile station may avoid triggering xid negotiation for any llc sapi used in llc adm, but wait for the sgsn to do so (see step 12). in any case the mobile station may avoid triggering xid negotiation for any llc sapi used in llc abm, but wait for the sgsn to do so (see step 12a).
 this step is the same as specified in clause 5.3.2.2 in ts?43.129?[8].
6. upon reception of the first correct rlc/mac block (sent in normal burst format) from the ue to the target bss, the target bss informs the target sgsn by sending the message ps handover complete (imsi, and local tlli, request for inter rat handover info). the target bss that supports inter-rat ps handover to utran shall, when the inter rat handover info was not included in the source bss to target bss transparent container received in the ps handover request message as specified in ts?48.018?[42], request the inter rat handover info from the target sgsn by setting the 'request for inter rat handover info' to '1'.
7. the target bss also relays the message xid response to the target sgsn. note, the message in step 6 and 7 may arrive in any order in the target sgsn.
8. then the target sgsn knows that the ue has arrived to the target side and target sgsn informs the source mme by sending the forward relocation complete notification (isr activated, serving gw change) message. if isr activated is indicated, the source mme shall maintain the ue's contexts and activate isr, which is only possible when the s gw is not changed. the source mme will also acknowledge that information. a timer in source mme is started to supervise when resources in source enodeb and source serving gw (for serving gw relocation) shall be released.
 upon receipt of the forward relocation complete acknowledge message the target sgsn starts a timer if the target sgsn allocated s gw resources for indirect forwarding.
 for all bearers that were not included in the forward relocation request message sent in step?3, the mme now releases them by sending a delete bearer command to the sgw, or, the appropriate message to the scef.
9. the target sgsn will now complete the handover procedure by informing the serving gw (for serving gw relocation this will be the target serving gw) that the target sgsn is now responsible for all the eps bearer context(s) the ue has established. this is performed in the message modify bearer request (sgsn tunnel endpoint identifier for CP, nsapi(s), sgsn address for CP, sgsn address(es) and teid(s) for user traffic for the accepted eps bearers and rat type, isr activated) per pdn connection. as it is a mobility from e-utran, if the target sgsn supports location information change reporting, the target sgsn shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information (determined from the ue context), the sgsn also includes the user csg information ie in this message. if the ue time zone has changed, the sgsn includes the ue time zone ie in this message. if serving gw is not relocated but the serving network has changed or if the sgsn has not received any old serving network information from the old mme, the sgsn includes the new serving network ie in this message. in network sharing scenarios serving network denotes the serving core network. if indicated, isr activated indicates that isr is activated, which is only possible when the s gw was not changed. when the modify bearer request does not indicate isr activated and s gw is not changed, the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved.
 the sgsn releases the non-accepted eps bearer contexts by triggering the eps bearer context deactivation procedure. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the sgsn.
10. the serving gw (for serving gw relocation this will be the target serving gw) may inform the pdn gw the change of, for example, for serving gw relocation or the rat type, that e.g. can be used for charging, by sending the message modify bearer request per pdn connection. the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if they are present in step?9. serving network should be included if it is received in step?9 or in step?4 in clause?5.5.2.3.2. for serving gw relocation, the serving gw allocates dl teids on s5/s8 even for non-accepted bearers and may include the pdn charging pause supported indication. the pdn gw must acknowledge the request with the message modify bearer response. in the case of serving gw relocation, the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. if location information change reporting is required and supported in the target sgsn, the pdn gw shall provide ms info change reporting action in the modify bearer response.
 if pcc infrastructure is used, the pdn gw informs the pcrf about the change of, for example, the rat type.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path. the source serving gw shall forward the "end marker" packets to the source enodeb.
11. the serving gw (for serving gw relocation this will be the target serving gw) acknowledges the UP switch to the target sgsn via the message modify bearer response (cause, serving gw tunnel endpoint identifier for CP, serving gw address for CP, protocol configuration options, ms info change reporting action). at this stage the UP path is established for all eps bearer contexts between the ue, target bss, target sgsn, serving gw (for serving gw relocation this will be the target serving gw) and pdn gw.
 if the serving gw does not change, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path.
12. if the target sgsn indicated xid reset (i.e. reset to default xid parameters) in the nas container included in the ho from e-utran command message, then on receipt of the ps handover complete the target sgsn initiates an llc/sndcp xid negotiation for each llc sapi used in llc adm. in this case if the target sgsn wants to use the default xid parameters, it shall send an empty xid command. if the target sgsn indicated 'reset to the old xid parameters' in the nas container, no further xid negotiation is required for llc sapis used in llc adm only.
12a. the target sgsn (re-)establishes llc abm for the eps bearer contexts which use acknowledged information transfer. during the exchange of sabm and ua the sgsn shall perform llc/sndcp xid negotiation.
 these steps (12 and 12a) are the same as specified in clause 5.3.2.2 in ts?43.129?[8].
13. after the ue has finished the reconfiguration procedure the ue shall initiate the routing area update procedure.
note?2: the rau procedure is performed regardless if the ue has this routing area registered or not, as specified by ts?43.129?[8]. this is needed e.g. to update the start-ps value stored in the 2g-sgsn. the start_ps is delivered to sgsn in inter rat handover info parameter of rau complete message when requested by sgsn in rau accepted.
 the target sgsn knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target sgsn performs only a subset of the rau procedure, specifically it excludes the context transfer procedures between source mme and target sgsn.
 for a ue supporting ciot eps optimisations, the ue uses the bearer status information in the rau accept to identify any non-transferred bearers that it shall locally release.
13a. upon reception of the ps handover complete message with the 'request for inter rat handover info' set to '1', the sgsn should send then ps handover complete acknowledge (tlli, inter rat handover info) to the target bss.
note?3: an sgsn that does not recognize the "request for inter rat handover info" in the ps handover complete message will not send the ps handover complete acknowledge message back to the bss.
 the target bss receiving the ps handover complete acknowledge message shall set the 'reliable inter rat handover' to '1' in the ps handover required message in any subsequent ps handover to geran a/gb mode. the target bss failing to receive the ps handover complete acknowledge message shall set the 'reliable inter rat handover' to '0' in the ps handover required message in any subsequent ps handover to geran a/gb mode. the target bss shall, upon receipt of the inter rat handover info in the ps handover complete acknowledge message, overwrite its current inter rat handover info with this new one.
14. when the timer started at step?8 expires, the source mme sends a release resources message to the source enodeb. the source enodeb releases its resources related to the ue.
 when the timer started in step 8 expires and if the source mme received the serving gw change indication in the forward relocation response message, it deletes the eps bearer resources by sending delete session request (cause, operation indication, secondary rat usage data) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the serving gw changes and the source serving gw shall not initiate a delete procedure towards the pdn gw. secondary rat usage data is included if it was received in step?3. the source serving gw acknowledges with delete session response (cause) messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
15. if indirect forwarding was used then the expiry of the timer at source mme started at step?8 triggers the source mme to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
16. if indirect forwarding was used and the serving gw is relocated, then the expiry of the timer at target sgsn started at step?8 triggers the target sgsn to send a delete indirect data forwarding tunnel request message to the target s gw to release temporary resources used for indirect forwarding.
5.5.2.3.4 e-utran to geran a/gb mode inter rat handover reject
the target bss may reject the use of the handover procedure if none of the requested pfcs in the ps handover request message could be established. in this case no ue context is established in the target sgsn/bss and no resources are allocated. the ue remains in the source enodeb/mme.

figure 5.5.2.3.4-1: e-utran to geran a/gb inter rat ho reject
1. steps?1 to 5 in the flow are identical to the ones in clause?5.5.2.3.2.
6. if the target bss fails to allocate any resources for any of the requested pfcs it sends a ps handover request nack (cause) message to the target sgsn. when the target sgsn receives the ps handover request nack message from target bss the target sgsn clears any reserved resources for this ue.
7. this step is only performed for serving gw relocation, i.e. if steps?4/4a have been performed. the target sgsn deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
8. the target sgsn sends the forward relocation response (cause) message to the source mme.
9. when the source mme receives the forward relocation response message it send a handover preparation failure (cause) message to the source enodeb.
5.5.2.4 geran a/gb mode to e-utran inter rat handover
5.5.2.4.1 general
the procedure is based on packet-switched handover for geran a/gb mode, defined in ts?43.129?[8].
pre-conditions:
- the ue is in ready state (geran a/gb mode);
- the ue has at least one pdp/eps bearer context established;
- the bss must support pfm, packet flow management, procedures.
5.5.2.4.2 preparation phase

figure 5.5.2.4.2-1: geran a/gb mode to e-utran inter rat ho, preparation phase
1. the source access system, source bss, decides to initiate an inter-rat handover to the e-utran. at this point both uplink and downlink user data is transmitted via the following: bearers between ue and source bss, bssgp pfc tunnel(s) between source bss and source sgsn, gtp tunnel(s) between source sgsn, serving gw and pdn gw.
note?1: the process leading to the handover decision is outside of the scope of this specification.
2. the source bss sends the message ps handover required (tlli, cause, source cell identifier, target enodeb identifier, source enodeb to target enodeb transparent container and active pfcs list) to source sgsn to request the cn to establish resources in the target enodeb, target mme and the serving gw.
note?2: in contrast to most inter-rat handover preparation phases, this source to target transparent container does not contain the ue's target rat radio capabilities.
3. the source sgsn determines from the 'target enodeb identifier' ie that the type of handover is irat ps handover to e-utran. the source sgsn selects the target mme as described in clause?4.3.8.3 on "mme selection function". the source sgsn initiates the handover resource allocation procedure by sending message forward relocation request (imsi, target identification, mm context, pdn connections, sgsn tunnel endpoint identifier for CP, sgsn address for CP, source to target transparent container, ran cause, packet flow id, sndcp xid parameters, llc xid parameters, ms info change reporting action (if available), csg information reporting action (if available), ue time zone, isr supported, serving network) to the target mme. when isr is activated the message should be sent to the mme that maintains isr for the ue when this mme is serving the target identified by the target identification. if indicated, the information isr supported indicates that the source sgsn and associated serving gw are capable to activate isr for the ue. this message includes all pdn connections active in the source system and for each pdn connection includes the associated apn, the address and the uplink tunnel endpoint parameters of the serving gw for CP, and a list of eps bearer contexts established in the source system. the eps bearer contexts indicate the pfis and the xid parameters related to those eps bearer contexts, and the uplink tunnel endpoint parameters of the serving gw. the old serving network is sent to target mme to support the target mme to resolve if serving network is changed. in network sharing scenarios serving network denotes the serving core network.
 the ran cause includes the value from the cause ie received from the source bss. source to target transparent container includes the value from the source enodeb to target enodeb transparent container received from the source bss.
 the mm context includes information on the eps bearer context(s). if none of the ue's eps bearers can be supported by the selected target mme, the source sgsn rejects the handover attempt by sending a ps handover required negative acknowledge (cause) message to the source bss.
note?3: if the handover is successful, the source sgsn will signal to the sgw and/or scef to release any non-included eps bearers after step?6 of the execution procedure. the non-included bearers are locally released by the ue following the bearer context status synchronisation that occurs during the tracking area update at step?12 of the execution procedure.
 prioritization of eps bearer contexts is performed by the target core network node.
 the mme establishes the eps bearer(s) in the prioritized order. the mme deactivates, as provided in step?8 of the execution phase, the eps bearers which cannot be established.
 the mm context contains security related information, e.g. supported ciphering algorithms as described in ts?29.274?[43]. handling of security keys is described in ts?33.401?[41].
 for the eps bearer context with traffic class equals 'background', the source sgsn shall indicate via the activity status indicator ie that radio bearers shall be established on the target side.
 the target mme shall determine the maximum apn restriction based on the apn restriction of each bearer context received in the forward relocation request, and shall subsequently store the new maximum apn restriction value.
4. the target mme determines if the serving gw is to be relocated, e.g. due to plmn change. if the serving gw is to be relocated, the target mme selects the target serving gw as described under clause 4.3.8.2 on "serving gw selection function". the target mme sends a create session request message (imsi, mme tunnel endpoint identifier for CP, mme address for CP, pdn gw address(es) for UP, pdn gw ul teid(s) for UP, pdn gw address for CP, and pdn gw teid(s) for CP, the protocol type over s5/s8, serving network) per pdn connection to the target serving gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface.
4a. the target serving gw allocates its local resources and returns them in a create session response (serving gw address(es) for UP, serving gw ul teid(s) for UP, serving gw address for CP, serving gw teid for CP) message to the target mme.
5. the target mme will request the target enodeb to establish the bearer(s) by sending the message handover request (ue identifier, s1ap cause, integrity protection information (i.e. ik and allowed integrity protection algorithms), encryption information (i.e. ck and allowed ciphering algorithms), eps bearers to be setup list, source to target transparent container, handover restriction list). the target mme ignores any activity status indicator within an eps bearer context and requests the enodeb to allocate resources for all eps bearer contexts received from the source side. the s1ap cause includes the value from the ran cause ie received from the source sgsn. the target enodeb shall ignore it if the number of radio bearers in the source to target transparent container does not comply with the number of bearers requested by the mme and allocate bearers as requested by the mme. handover restriction list is sent if it is available in the target mme; it is described in clause?4.3.5.7.
 for each eps bearer requested to be established, 'eps bearers to be setup' ie shall contain information such as id, bearer parameters, transport layer address, "data forwarding not possible" indication, and s1 transport association. the transport layer address is the serving gw address for user data, and the s1 transport association corresponds to the uplink tunnel endpoint identifier data. "data forwarding not possible" indication shall be included if the target mme decides the corresponding bearer will not be subject to data forwarding.
 the ciphering and integrity protection keys will be sent transparently from the target enodeb to the ue in the target to source transparent container, and in the message ps handover command from source bss to the ue. this will then allow data transfer to continue in the new rat/mode target cell without requiring a new aka (authentication and key agreement) procedure. more details are described in ts?33.401?[41].
5a. the target enodeb allocates the request resources and returns the applicable parameters to the target mme in the message handover request acknowledge (target to source transparent container, s1ap cause, eps bearers setup list, eps bearers failed to setup list). upon sending the handover request acknowledge message the target enodeb shall be prepared to receive downlink gtp pdus from the serving gw for the accepted eps bearers.
6. if 'indirect forwarding' and relocation of serving gw apply, the target mme sends a create indirect data forwarding tunnel request message (target enodeb address(es) and teid(s) for dl data forwarding) to the serving gw.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
6a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw address(es) and dl teid(s) for data forwarding) message to the target mme.
7. the target mme sends the message forward relocation response (cause, list of set up pfcs, mme tunnel endpoint identifier for CP, ran cause, mme address for CP, target to source transparent container, address(es) and teid(s) for data forwarding, serving gw change indication) to the source sgsn. serving gw change indication indicates whether a new serving gw has been selected. the ran cause includes the value from the s1ap cause ie received from the target enodeb. the target to source transparent container includes the value from the target to source transparent container received from the target enodeb.
 if 'direct forwarding' applies or if 'indirect forwarding' but no relocation of serving gw applies, then the ies 'address(es) and teid(s) for data forwarding' contain the dl gtp-u tunnel endpoint parameters to the enodeb received in step?5a. if 'indirect forwarding' and relocation of serving gw apply the ies 'address(es) and teid(s) for data forwarding' contain the dl gtp-u tunnel endpoint parameters to the serving gw received in step?6a.
8. if 'indirect forwarding' applies, the source sgsn shall send the message create indirect data forwarding tunnel request (address(es) and teid(s) for data forwarding (received in step?7)) to the serving gw used for indirect packet forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
8a. the serving gw returns the forwarding UP parameters by sending the message create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding). if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
5.5.2.4.3 execution phase

figure 5.5.2.4.3-1: geran a/gb mode to e-utran inter rat ho, execution phase
note: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps 9 and 9a concern gtp based s5/s8.
the source sgsn continues to receive downlink and uplink UP pdus.
when source sgsn receives the forward relocation response message it may start downlink n-pdu relay and duplication to the target enodeb (for direct forwarding) or via the serving gw (for indirect forwarding), and the target enodeb may start blind transmission of downlink user data towards the ue over the allocated radio channels.
1. the source sgsn completes the preparation phase towards source bss by sending the message ps ho required acknowledge (tlli, list of set up pfcs, target rnc to source bss transparent container, cause). this message includes all pfis that could be established on the target side. the cause includes the value from the ran cause ie received from the target mme. the target rnc to source bss transparent container includes the value from the target to source transparent container received from the target mme.
 before sending the ps handover required acknowledge message, the source sgsn may suspend downlink data transfer for any eps bearer contexts.
 before sending the ps handover command message to the ue the source bss, may try to empty the downlink bss buffer for any bss pfcs.
2. the source bss will command the ue to handover to the target enodeb via the message ps handover command. the access system specific message to ue includes a transparent container including radio aspect parameters that the target enodeb has set-up in the preparation phase.
3. void.
4. the ue moves to the e-utran and performs access procedures toward target enodeb.
5. when the ue has got access to target enodeb it sends the message ho to e-utran complete.
the ue shall implicitly derive the eps bearers for which an e-rab was not established from the ps handover command and deactivate them locally without an explicit nas message at this step.
6. when the ue has successfully accessed the target enodeb, the target enodeb informs the target mme by sending the message handover notify (tai+ecgi). as a separate activity the target enodeb retrieves the ue e-utra capability information using the procedure for ue radio capability handling (see clause?5.11.2).
 if dual connectivity is activated for the ue, the pscell id shall be included in the handover notify message.
7. then the target mme knows that the ue has arrived to the target side and target mme informs the source sgsn by sending the forward relocation complete notification (isr activated, serving gw change) message. if indicated, isr activated indicates to the source sgsn that it shall maintain the ue's contexts and activate isr, which is only possible when the s gw is not changed. the source sgsn shall also acknowledge that information. when the forward relocation complete notification message has been received and there is no longer any need for the sgsn to forward data, the sgsn stops data forwarding. a timer in source sgsn is started to supervise when resources in the source serving gw (for serving gw relocation) shall be released.
 upon receipt of the forward relocation complete acknowledge message the target mme starts a timer if the target mme applies indirect forwarding.
8. the target mme will now complete the handover procedure by informing the serving gw (for serving gw relocation this will be the target serving gw) that the target mme is now responsible for all the eps bearers the ue have established. this is performed in the message modify bearer request (cause, mme tunnel endpoint identifier for CP, eps bearer id(s), mme address for CP, enodeb address(es) and teid(s) for user traffic for the accepted eps bearers and rat type, isr activated) per pdn connection. as it is a mobility from geran, if the target mme supports location information change reporting, the target mme shall include the user location information (according to the supported granularity) in the modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw. if the pdn gw requested user csg information (determined from the ue context), the mme also includes the user csg information ie in this message. if the ue time zone has changed, the mme includes the ue time zone ie in this message. if the serving gw is not relocated but the serving network has changed or if the mme has not received any old serving network information from the old sgsn, the mme includes the new serving network ie in this message. if indicated, isr activated indicates that isr is activated, which is only possible when the s gw was not changed. when the modify bearer request does not indicate isr activated and s gw is not changed, the s gw deletes any isr resources by sending a delete bearer request to the other cn node that has bearer resources on the s gw reserved.
 the mme releases the non-accepted dedicated bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
 if the default bearer of a pdn connection has not been accepted by the target enodeb and there are other pdn connections active, the mme shall handle it in the same way as if all bearers of a pdn connection have not been accepted. the mme releases these pdn connections by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
9. the serving gw (for serving gw relocation this will be the target serving gw) informs the pdn gw(s) the change of, for example, for serving gw relocation or the rat type, that e.g. can be used for charging, by sending the message modify bearer request per pdn connection. the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if they are present in step?8. serving network should be included if it is received in step?8 or in step?4 in clause?5.5.2.4.2. for serving gw relocation, the serving gw allocates dl teids on s5/s8 even for non-accepted bearers and pdn charging pause support indication shall be included. the pdn gw must acknowledge the request with the message modify bearer response (charging id, msisdn, pdn charging pause enabled indication (if pdn gw has chosen to enable the function), etc.) to the serving gw. if location information change reporting is required and supported in the target mme, the pdn gw shall provide ms info change reporting action in the modify bearer response.
 if pcc infrastructure is used, the pdn gw informs the pcrf about the change of, for example, the rat type.
 if the serving gw is relocated, the pdn gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb. the source serving gw shall forward the "end marker" packets to the source sgsn.
10. the serving gw (for serving gw relocation this will be the target serving gw) acknowledges the UP switch to the target mme via the message modify bearer response (cause, serving gw tunnel endpoint identifier for CP, serving gw (for serving gw relocation this will be the target serving gw) address for CP, protocol configuration options, ms info change reporting action). at this stage the UP path is established for all bearers between the ue, target enodeb, serving gw (for serving gw relocation this will be the target serving gw) and pdn gw.
 if the serving gw does not change, the serving gw shall send one or more "end marker" packets on the old path immediately after switching the path in order to assist the reordering function in the target enodeb.
11. when the timer at the source sgsn started in step 7 expires the source sgsn will clean-up all its resources towards source bss by performing the bss packet flow delete procedure.
12. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies.
 the target mme knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target mme performs only a subset of the ta update procedure, specifically it excludes the context transfer procedures between source sgsn and target mme.
 if the subscription data received from the hss (during the tau in step?12) contains information that is necessary for the e-utran to be aware of (e.g. a restriction in the ue's permission to use nr as a secondary rat, unlicensed spectrum or a combination of them), or an existing ue context in the mme indicates that the ue is not permitted to use nr as a secondary rat, unlicensed spectrum or a combination of them and the mme has not provided this information to the target enodeb during step?5 of the handover preparation phase, then the mme sends an updated handover restriction list in the downlink nas transport message that it sends to e-utran. if the ue is not allowed to use nr as secondary rat, the mme indicates that to the ue in tau accept message.
13. when the timer at the source sgsn started in step?7 expires and if the source sgsn received the serving gw change indication in the forward relocation response message, it deletes the eps bearer resources by sending delete session request (cause, operation indication) messages to the source serving gw. the operation indication flag is not set, that indicates to the source serving gw that the source serving gw shall not initiate a delete procedure towards the pdn gw. the source serving gw acknowledges with delete session response (cause) messages. if isr has been activated before this procedure, the cause indicates to the source s gw that the source s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
14. if indirect forwarding was used then the expiry of the timer at source sgsn started at step?7 triggers the source sgsn to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
15. if indirect forwarding was used and the serving gw is relocated, then the expiry of the timer at target mme started at step?6 triggers the target mme to send a delete indirect data forwarding tunnel request message to the target s gw to release temporary resources used for indirect forwarding.
5.5.2.4.4 geran a/gb mode to e-utran inter rat handover reject
the target enodeb may reject the use of the handover procedure if none of the requested eps bearers in the handover request message could be established. in this case no ue context is established in the target mme/enodeb and no resources are allocated. the ue remains in the source bss/sgsn.

figure 5.5.2.4.4-1: geran a/gb mode to e-utran inter rat ho reject
1. steps 1 to 5 in the flow are identical to the ones in clause?5.5.2.4.2.
6. if the target enodeb fails to allocate any resources for any of the requested eps bearers it sends a handover failure (cause) message to the target mme. when the target mme receives the handover failure message from target enodeb the target mme clears any reserved resources for this ue.
7. this step is only performed for serving gw relocation, i.e. if steps?4/4a have been performed. the target mme deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
8. the target mme sends the forward relocation response (cause) message to the source sgsn.
9. when the source sgsn receives the forward relocation response message it send a ps handover required negative acknowledge (cause) message to the source bss.
5.5.2.5 inter rat handover cancel
5.5.2.5.1 general
instead of completing the handover procedure, the source ran node (enodeb, rnc or bss) may at any time during the handover procedure, up to the time when a handover command message is sent to the ue cancel the handover. the reason for cancelling may be e.g. due to a timer expiration or due to other events within the source ran node and is initiated by sending a handover cancel pdu to the source epc node (mme or sgsn).
a handover cancel pdu shall also be sent by the source ran node after a handover command message is sent to the ue for the case where the handover fails and the ue returns to the old cell or radio contact with the ue is lost. this is done in order to release the resources reserved for the handover in the target system.
5.5.2.5.2 source ran to target ran inter rat handover cancel

figure 5.5.2.5.2-1: inter rat handover cancel
1. the source ran decides to cancel the previously requested relocation of handover resources. this may be due to not enough accepted bearers, ue returned to source cell or any other reason.
2. the source ran sends a cancel message with a cause to the source epc node (sgsn or mme). if the source ran is:
a) bss the message sent is ps handover cancel (cause),
b) rnc the message sent is relocation cancel (cause), or
c) enodeb the message sent is handover cancel (cause).
3. the source epc node terminates the relocation towards the target side by sending a relocation cancel request (imsi) message to the target epc node. the source epc node also resumes operation on the resources in the source side.
4. the target epc node triggers the release of resources in the target ran and also releases its own resources allocated for this handover.
5. this step is only performed for serving gw relocation. the target epc node deletes the eps bearer resources by sending delete session request (cause) messages to the target serving gw. the target serving gw acknowledges with delete session response (cause) messages.
6. the target epc node acknowledge the release of all resources on the target side by returning a relocation cancel response (cause) message to the source epc node.
7. the source epc node returns a cancel acknowledge message to the source ran. if the source ran is:
a) bss there will be no acknowledge message sent to the source bss,
b) rnc the message sent is relocation cancel acknowledge (cause), or
c) enodeb the message sent is handover cancel acknowledge (cause).
8. if indirect forwarding tunnel is setup during handover preparation then cancellation of handover triggers the source mme/sgsn to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
9. if indirect forwarding tunnel is setup during handover preparation and serving gw is relocated then cancellation of handover triggers the target mme/sgsn to send a delete indirect data forwarding tunnel request message to the s gw to release the temporary resources used for indirect forwarding.
5.6 network assisted cell change
network assisted cell change (nacc) is a means that enables better performance for packet data services upon inter-cell change for those networks that do not support ps handover. it reduces the service interruption time for ues in active mode upon cell change by providing in the source cell, prior to the cell change, system information of a target cell allowing packet access.
within the scope of this specification, nacc is applicable for inter-rat cell changes from a source e utran cell towards a target geran cell.
when the ue changes from a source e-utran cell towards a target geran cell, the ue locally deactivates isr by setting its tin from "rat-related tmsi" to "guti", if any eps bearer context activated after the isr was activated in the ue exists.
when the ue changes from a source e-utran cell in connected mode towards a target geran cell from the same ra via cell change order that is not for cs fallback and the isr is active, the ue locally deactivates isr by setting its tin from "rat-related tmsi" to "guti".
5.6.1 architecture principles for e-utran to geran nacc
introducing nacc from e utran to geran follows the principles of the network assisted cell change between utran and geran as described in ts?25.413?[22] and ts?23.060?[7]. it specifies the ran information management (rim) procedures as specified in clause?5.15 and depicted in figure?5.6 1.

figure 5.6-1: e-utran to geran nacc basic network architecture
the support for the nacc from e utran to geran has the following impacts on e utran / geran architecture:
- affected nodes: bsc, enodeb, mme, sgsn;
- affected network interfaces: gb, iu, s3, gn, s1;
- affected radio interfaces: um and uu.
5.6.2 void

5.7 information storage
this clause describes information storage structures required for the eps when 3gpp access only is deployed. information storage for the case where non 3gpp accesses are deployed is in ts?23.402?[2].
5.7.1 hss
imsi is the prime key to the data stored in the hss. the data held in the hss is defined in table 5.7.1-1 here below.
the table below is applicable to e utran in stand-alone operation only.
table 5.7.1-1: hss data
field
description
imsi
imsi is the main reference key.
msisdn
the basic msisdn of the ue (presence of msisdn is optional).
imei / imeisv
international mobile equipment identity - software version number
external identifier list
external identifier(s) used in the external network(s) to refer to the subscription. see ts?23.682?[74] for more information.
mme identity
the identity of the mme currently serving this ue.
mme capabilities
indicates the capabilities of the mme with respect to core functionality e.g. regional access restrictions.
ms ps purged from eps
indicates that the emm and esm contexts of the ue are deleted from the mme.
odb parameters
indicates that the status of the operator determined barring 
access restriction
indicates the access restriction subscription information. it may include different values for hplmn and roaming case. it includes separate settings for wb-e-utran and nb-iot. it includes restriction information on the use of nr as a secondary rat for UP connectivity and use of unlicensed spectrum (in the form of laa, or lwa/lwip).
eps subscribed charging characteristics
the charging characteristics for the ue, e.g. normal, prepaid, flat-rate, and/or hot billing subscription.
trace reference
identifies a record or a collection of records for a particular trace.
trace type
indicates the type of trace, e.g. hss trace, and/or mme/ serving gw / pdn gw trace.
omc identity
identifies the omc that shall receive the trace record(s).
subscribed-ue-ambr
the maximum aggregated uplink and downlink mbrs to be shared across all non-gbr bearers according to the subscription of the user.
apn-oi replacement
indicates the domain name to replace the apn oi when constructing the pdn gw fqdn upon which to perform a dns resolution. this replacement applies for all the apns in the subscriber's profile. see ts?23.003?[9] clause?9.1.2 for more information on the format of domain names that are allowed in this field.
rfsp index
an index to specific rrm configuration in the e-utran
urrp-mme
ue reachability request parameter indicating that ue activity notification from mme has been requested by the hss.
csg subscription data
the csg subscription data is a list of csg ids per plmn and for each csg id optionally an associated expiration date which indicates the point in time when the subscription to the csg id expires; an absent expiration date indicates unlimited subscription.
for a csg id that can be used to access specific pdns via local ip access, the csg id entry includes the corresponding apn(s).
vplmn lipa allowed
specifies per plmn whether the ue is allowed to use lipa.
eplmn list
indicates the equivalent plmn list for the ue's registered plmn.
subscribed periodic rau/tau timer
indicates a subscribed periodic rau/tau timer value
extended idle mode drx cycle length
indicates a subscribed extended idle mode drx cycle length value.
rat specific subscribed paging time window
indicates a subscribed paging time window value for the associated rat, nb-iot, wb-e-utran or both.
mps cs priority
indicates that the ue is subscribed to the emlpp or 1x rtt priority service in the cs domain.
ue-srvcc- capability
indicates whether the ue is utran/geran srvcc capable or not.
mps eps priority
indicates that the ue is subscribed to mps in the eps domain.
ue usage type
indicates the usage characteristics of the ue for use with dedicated core networks (see clause?4.3.25).
group id-list
list of the subscribed group(s) that the ue belongs to
communication patterns
indicates per ue the communication patterns and their corresponding validity times as specified in ts?23.682?[74].the communication patterns are not provided to the sgsn.
monitoring event information data
describes the monitoring event configuration information. see ts?23.682?[74] for more information.
pdn connection restriction
indicates whether the establishment of the pdn connection is restricted for the ue.
enhanced coverage restricted
specify plmn(s) with enhanced coverage restrictions.
acknowledgements of downlink nas data pdus
indicates whether acknowledgement of downlink nas data pdus for CP ciot eps optimisation is disabled for this ue (enabled by default).
service gap time
used to set the service gap timer for service gap control (see clause?4.3.17.9).
each subscription profile contains one or more pdn subscription contexts:
context identifier
index of the pdn subscription context (note 8).
pdn address
indicates subscribed ip address(es).
pdn type
indicates the subscribed pdn type (ipv4, ipv6, ipv4v6, non-ip)
apn-oi replacement
apn level apn-oi replacement which has same role as ue level apn-oi replacement but with higher priority than ue level apn-oi replacement. this is an optional parameter. when available, it shall be used to construct the pdn?gw fqdn instead of ue level apn-oi replacement.
access point name (apn)
a label according to dns naming conventions describing the access point to the packet data network (or a wildcard) (note?6).
invoke scef selection
indicates whether this apn is used for establishing pdn connection to the scef
scef id
indicates the fqdn or ip address of the scef which is to be selected for this apn. it is required if "invoke scef seletion" indicator is set.
sipto permissions
indicates whether the traffic associated with this apn is prohibited for sipto, allowed for sipto excluding sipto at the local network, allowed for sipto including sipto at the local network or allowed for sipto at the local network only (note?7).
lipa permissions
indicates whether the pdn can be accessed via local ip access. possible values are: lipa-prohibited, lipa-only and lipa-conditional.
wlan offloadability
indicates whether the traffic associated with this apn is allowed to be offloaded to wlan using the wlan/3gpp radio interworking feature or if it shall be kept on 3gpp access (see clause?4.3.23). the indication may contain separate values per rat (e-utra and utra).
eps subscribed qos profile
the bearer level qos parameter values for that apn's default bearer (qci and arp) (see clause 4.7.3).
subscribed-apn-ambr
the maximum aggregated uplink and downlink mbrs to be shared across all non-gbr bearers, which are established for this apn.
eps pdn subscribed charging characteristics
the charging characteristics of this pdn subscribed context for the ue, e.g. normal, prepaid, flat-rate, and/or hot billing subscription. the charging characteristics is associated with this apn.
vplmn address allowed
specifies per vplmn whether for this apn the ue is allowed to use the pdn gw in the domain of the hplmn only, or additionally the pdn gw in the domain of the vplmn.
pdn gw identity
the identity of the pdn gw used for this apn. the pdn gw identity may be either an fqdn or an ip address. the pdn gw identity refers to a specific pdn gw.
pdn gw allocation type
indicates whether the pdn gw is statically allocated or dynamically selected by other nodes. a statically allocated pdn gw is not changed during pdn gw selection.
pdn continuity at inter rat mobility
provides for this apn how to handle a pdn connection when ue the moves between "broadband" (wb-e-utran and utran) and "narrowband" (nb-iot, gprs, ec-gsm-iot). possible values are: maintain the pdn connection; disconnect the pdn connection with a reactivation request; disconnect pdn connection without reactivation request; or to leave it to local vplmn policy.
plmn of pdn gw
identifies the plmn in which the dynamically selected pdn gw is located.
homogenous support of ims voice over ps sessions for mme
indicates per ue and mme if "ims voice over ps sessions" is homogeneously supported in all tas in the serving mme or homogeneously not supported, or, support is non-homogeneous/unknown, see clause?4.3.5.8a.
list of apn pdn gw id relations (for pdn subscription context with wildcard apn):
apn - p gw relation #n
the apn and the identity of the dynamically allocated pdn?gw of a pdn connection that is authorised by the pdn subscription context with the wildcard apn. the pdn?gw identity may be either an fqdn or an ip address. the pdn?gw identity refers to a specific pdn?gw.

note?1: imei and svn are stored in hss when the automatic device detection feature is supported, see clause 15.5 of ts?23.060?[7].
note?2: the 'eps subscribed qos profile' stored in hss is complementary to the legacy 'gprs subscribed qos profile'.
note?3: void.
note?4: how to indicate which of the pdn subscription contexts stored in the hss is the default one for the ue is defined in stage?3.
note?5: to help with the selection of a co-located or topologically appropriate pdn gw and serving gw, the pdn gw identity shall be in the form of an fqdn.
note?6: the "access point name (apn)" field in the table above contains the apn-ni part of the apn.
note?7: in this specification, the values "prohibited for sipto" and " allowed for sipto excluding sipto at the local network" correspond to the pre rel 12 values "prohibited for sipto" and "allowed for sipto". actual coding of these values belongs to stage 3 domain.
note?8: there may be at most two default apns for a given user. one default apn can belong to either of the three pdn types of "ipv4", "ipv6", or "ipv4v6", and another default apn can belong to pdn type of "non-ip".
an expired csg subscription should not be removed from the hss subscription data before it is removed from the ue's allowed csg list or operator csg list. when a csg subscription is cancelled it should be handled as an expired subscription in hss subscription data to allow for removing it from ue's allowed csg list or operator csg list first.
one (and only one) of the pdn subscription contexts stored in the hss may contain a wild card apn (see ts?23.003?[9]) in the access point name field.
the pdn subscription context marked as the default one shall not contain a wild card apn.
the pdn subscription context with a wildcard apn shall not contain a statically allocated pdn?gw.
if the lipa permission and sipto permission flags are both included for a particular apn, they shall be set in a consistent manner, e.g, if the lipa permission is set to lipa-only or lipa-conditional, the sipto permission shall be set to sipto-prohibited. conversely, if the sipto permission indicates the apn is a sipto-allowed apn, the lipa permission shall be set to lipa-prohibited. a sipto-allowed apn is an apn for which the sipto permission is set to allowed for sipto excluding sipto at the local network, allowed for sipto including sipto at the local network or allowed for sipto at the local network only.
5.7.2 mme
the mme maintains mm context and eps bearer context information for ues in the ecm-idle, ecm connected and emm-deregistered states. table?5.7.2-1 shows the context fields for one ue.
table 5.7.2-1: mme mm and eps bearer contexts
field
description
imsi
imsi (international mobile subscriber identity) is the subscriber's permanent identity.
imsi-unauthenticated-indicator
this is an imsi indicator to show the imsi is unauthenticated.
msisdn
the basic msisdn of the ue. the presence is dictated by its storage in the hss.
mm state
mobility management state ecm-idle, ecm-connected, emm-deregistered.
guti
globally unique temporary identity.
me identity
mobile equipment identity ? (e.g. imei/imeisv) software version number
tracking area list
current tracking area list
tai of last tau
tai of the ta in which the last tracking area update was initiated.
e-utran cell global identity
last known e-utran cell
e-utran cell identity age
time elapsed since the last e-utran cell global identity was acquired
ps cell global identity
last known primary cell of secondary cell group
ps cell age
time elapsed since the last primary cell of secondary cell group identity was acquired
csg id
last known csg id when the ue was active
csg membership
last known csg membership of the ue when the ue was active
access mode
access mode of last known ecgi when the ue was active
authentication vector
temporary authentication and key agreement data that enables an mme to engage in aka with a particular user. an eps authentication vector consists of four elements:
a) network challenge rand,
b) an expected response xres,
c) key kasme,
d) a network authentication token autn.
ue radio access capability
ue radio access capabilities including wb-e-utran capabilities but not nb-iot capabilities.
lte-m indication
indicates the ue is a lte-m ue and the ue radio access capability includes lte cat- m1 or lte cat-m1 and lte cat-m2. this is based on indication from the e-utran provides.
nb-iot specific ue radio access capability
nb-iot specific ue radio access capabilities.
ms classmark 2
geran/utran cs domain core network classmark (used if the ms supports srvcc to geran or utran)
ms classmark 3
geran cs domain radio network classmark (used if the ms supports srvcc to geran)
supported codecs
list of codecs supported in the cs domain (used if the ms supports srvcc to geran or utran)
ue network capability
ue network capabilities including security algorithms and key derivation functions supported by the ue
ms network capability
for a geran and/or utran capable ue, this contains information needed by the sgsn.
ue specific drx parameters
ue specific drx parameters for a/gb mode, iu mode and s1 mode
active time value for psm
ue specific active time value allocated by mme for power saving mode handling.
extended idle mode drx parameters
negotiated extended idle mode drx parameters for s1-mode.
rat specific subscribed paging time window
indicates a subscribed paging time window value for the associated rat, nb-iot, wb-e-utran or both.
selected nas algorithm
selected nas security algorithm
eksi
key set identifier for the main key kasme. also indicates whether the ue is using security keys derived from utran or e-utran security association.
kasme
main key for e-utran key hierarchy based on ck, ik and serving network identity
nas keys and count
knasint, k_nasenc, and nas count parameter.
selected cn operator id
selected core network operator identity (to support network sharing as defined in ts?23.251?[24]). 
recovery
indicates if the hss is performing database recovery.
access restriction
the access restriction subscription information. for this purpose, wb-e-utran and nb-iot are separate rats. in addition, it includes restriction information on the use of nr as secondary rat for UP connectivity and use of unlicensed spectrum (in the form of laa, or lwa/lwip).
odb for ps parameters
indicates that the status of the operator determined barring for packet oriented services.
apn-oi replacement
indicates the domain name to replace the apn-oi when constructing the pdn?gw fqdn upon which to perform a dns resolution. this replacement applies for all the apns in the subscriber's profile. see ts?23.003?[9] clause?9.1.2 for more information on the format of domain names that are allowed in this field.
mme ip address for s11
mme ip address for the s11 interface (used by s gw)
mme teid for s11
mme tunnel endpoint identifier for s11 interface.
s gw ip address for s11/s4
s gw ip address for the s11 and s4 interfaces
s gw teid for s11/s4
s gw tunnel endpoint identifier for the s11 and s4 interfaces.
sgsn ip address for s3
sgsn ip address for the s3 interface (used if isr is activated for the geran and /or utran capable ue)
sgsn teid for s3
sgsn tunnel endpoint identifier for s3 interface (used if isr is activated for the e-utran capable ue)
enodeb address in use for s1-mme
the ip address of the enodeb currently used for s1-mme.
enb ue s1ap id
unique identity of the ue within enodeb.
mme ue s1ap id
unique identity of the ue within mme.
subscribed ue-ambr
the maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers according to the subscription of the user.
ue-ambr
the currently used maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers.
eps subscribed charging characteristics
the charging characteristics for the ue e.g. normal, prepaid, flat rate and/or hot billing.
subscribed rfsp index
an index to specific rrm configuration in the e-utran that is received from the hss.
rfsp index in use
an index to specific rrm configuration in the e-utran that is currently in use.
trace reference
identifies a record or a collection of records for a particular trace.
trace type
indicates the type of trace
trigger id
identifies the entity that initiated the trace
omc identity
identifies the omc that shall receive the trace record(s).
urrp-mme
urrp-mme indicating that the hss has requested the mme to notify the hss regarding ue reachability at the mme
dl data buffer expiration time
when extended buffering of dl data has been invoked for ues that uses power saving functions e.g. psm, this time is when the buffer will expire in the serving gw.
suggested number of buffered downlink packets
suggested number of buffered downlink packets at extended buffering. this is an optional parameter.
csg subscription data
the csg subscription data is associated lists of csg ids for the visiting plmn and the equivalent plmns fo the visitng plmn, and for each csg id optionally an associated expiration date which indicates the point in time when the subscription to the csg id expires; an absent expiration date indicates unlimited subscription.
for a csg id that can be used to access specific pdns via local ip access, the csg id entry includes the corresponding apn(s).
lipa allowed
specifies whether the ue is allowed to use lipa in this plmn.
subscribed periodic rau/tau timer
indicates a subscribed periodic rau/tau timer value.
mps cs priority
indicates that the ue is subscribed to the emlpp or 1x rtt priority service in the cs domain.
mps eps priority
indicates that the ue is subscribed to mps in the eps domain.
voice support match indicator
an indication whether the ue radio capabilities are compatible with the network configuration (e.g. whether the srvcc and frequency support by the ue matches those that the network relies upon for voice coverage). the mme uses it as an input for setting the ims voice over ps session supported indication.
homogenous support of ims voice over ps sessions
indicates per ue if "ims voice over ps sessions" is homogeneously supported in all tas in the serving mme or homogeneously not supported, or, support is non-homogeneous/unknown, see clause?4.3.5.8a.
ue radio capability for paging information
information used by the enb to enhance the paging towards the ue (see clause?5.11.4). the ue radio capability for paging information is defined in ts?36.413?[36].
information on recommended cells and enbs for paging
information sent by the enb, and used by the mme when paging the ue to help determining the enbs to be paged as well as to provide the information on recommended cells to each of these enbs, in order to optimise the probability of successful paging while minimizing the signalling load on the radio path.
paging attempt count
information provided by the mme and used by the enb to optimise signalling load and the use of network resources to successfully page a ue.
information for enhanced coverage
information for enhanced coverage level and cell id provided by the last enb the ue was connected to.
ce mode b support indicator
indicates whether ce mode b is supported by the ue. the mme receives this from enb (see ts?36.413?[36]).
enhanced coverage restricted
specifies whether the ue is restricted to use enhanced coverage feature or not.
ce mode b restricted
specifies whether the ue is restricted to use ce mode b (i.e. coverage extension mode b) or not.
ue usage type
indicates the usage characteristics of the ue for use with dedicated core networks (see clause?4.3.25).
group id-list
list of the subscribed group(s) that the ue belongs to
monitoring event information data
describes the monitoring event configuration information. see ts?23.682?[74] for more information.
delay tolerant connection
indicates that the pdn connection is delay tolerant such that the pdn gw supports holding the procedure, after receiving a reject with a cause indicating that ue is temporarily not reachable due to power saving, until the pdn gw receives a message indicating that the ue is available for end to end signalling
pdn connection restriction
indicates whether the establishment of the pdn connection is restricted for the ue.
acknowledgements of downlink nas data pdus
indicates whether acknowledgement of downlink nas data pdus for CP ciot eps optimisation is disabled for this ue (enabled by default).
service gap time
used to set the service gap timer for service gap control (see clause?4.3.17.9).
list of apn rate control statuses
indicates for each apn, the apn rate control status (see clause?4.7.7.3).
for each active pdn connection:
apn in use
the apn currently used. this apn shall be composed of the apn network identifier and the default apn operator identifier, as specified in ts?23.003?[9], clause?9.1.2. any received value in the apn oi replacement field is not applied here.
apn restriction
denotes the restriction on the combination of types of apn for the apn associated with this eps bearer context. 
apn subscribed
the subscribed apn received from the hss.
pdn type
ipv4, ipv6,r ipv4v6 or non-ip
scef id
the ip address of the scef currently being used for providing pdn connection to the scef.
ip address(es)
ipv4 address and/or ipv6 prefix
note: the mme might not have information on the allocated ipv4 address. alternatively, following mobility involving a pre-release 8 sgsn, this ipv4 address might not be the one allocated to the ue.
header compression configuration
rohc configuration and context(s) for ip header compression for CP ciot eps optimisation.
eps pdn charging characteristics
the charging characteristics of this pdn connection, e.g. normal, prepaid, flat-rate and/or hot billing.
apn-oi replacement
apn level apn-oi replacement which has same role as ue level apn-oi replacement but with higher priority than ue level apn-oi replacement. this is an optional parameter. when available, it shall be used to construct the pdn?gw fqdn instead of ue level apn-oi replacement.
sipto permissions
indicates whether the traffic associated with this apn is prohibited for sipto, allowed for sipto excluding sipto at the local network, allowed for sipto including sipto at the local network or allowed for sipto at the local network only.
local home network id
if sipto@ln is enabled for this pdn connection it indicates the identity of the local home network to which the (h)enb belongs.
lipa permissions
indicates whether the pdn can be accessed via local ip access. possible values are: lipa-prohibited, lipa-only and lipa-conditional.
wlan offloadability
indicates whether the traffic associated with this pdn connection is allowed to be offloaded to wlan using the wlan/3gpp radio interworking feature or if it shall be kept on 3gpp access (see clause?4.3.23). the indication may contain separate values per rat (e-utra and utra).
vplmn address allowed
specifies whether the ue is allowed to use the apn in the domain of the hplmn only, or additionally the apn in the domain of the vplmn.
pdn gw address in use (CP)
the ip address of the pdn gw currently used for sending CP signalling.
pdn gw teid for s5/s8 (CP)
pdn gw tunnel endpoint identifier for the s5/s8 interface for the CP. (for gtp-based s5/s8 only).
ms info change reporting action
need to communicate change in user location information to the pdn gw with this eps bearer context.
csg information reporting action
need to communicate change in user csg information to the pdn gw with this eps bearer context.
this field denotes separately whether the mme/sgsn are requested to send changes in user csg information for (a) csg cells, (b) hybrid cells in which the subscriber is a csg member and (c) hybrid cells in which the subscriber is not a csg member.
presence reporting area action
need to communicate a change of ue presence in presence reporting area. this field denotes separately the pra identifier(s), and the list(s) of the presence reporting area elements (if provided by the pdn gw). the status (i.e. active or inactive) for each presence reporting area is stored in the mme when dynamic resource handling for presence reporting area is configured in the mme.
eps subscribed qos profile
the bearer level qos parameter values for that apn's default bearer (qci and arp) (see clause?4.7.3).
subscribed apn-ambr
the maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers, which are established for this apn, according to the subscription of the user.
apn-ambr
the maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers, which are established for this apn, as decided by the pdn?gw.
pdn gw gre key for uplink traffic (UP)
pdn gw assigned gre key for the s5/s8 interface for the UP for uplink traffic. (for pmip-based s5/s8 only)
default bearer
identifies the eps bearer id of the default bearer within the given pdn connection.
low access priority
indicates that the ue requested low access priority when the pdn connection was opened.
note: the low access priority indicator is only stored for the purpose to be included in charging records.
communication patterns
indicates per ue the communication patterns and their corresponding validity times as specified in ts?23.682?[74]. the communication patterns are not provided to the sgsn.
pdn continuity at inter rat mobility
provides for this apn how to handle a pdn connection when ue the moves between "broadband" (wb-e-utran and utran) and "narrowband" (nb-iot, gprs, ec-gsm-iot). possible values are: maintain the pdn connection; disconnect the pdn connection with a reactivation request; disconnect pdn connection without reactivation request; or to leave it to local vplmn policy.
for each bearer within the pdn connection:
eps bearer id 
an eps bearer identity uniquely identifies an ep s bearer for one ue accessing via e-utran
ti
transaction identifier
s-gw ip address for s1-u/s11-u
ip address of the s gw for the s1-u interface. also ip address of the s-gw for the s11-u interface if no separation of s1-u and s11-u is required. the s11-u interface is used for CP ciot eps optimisation.
s-gw ip address for s11-u
ip address of the s gw for the s11-u interfaces if s11-u is separated from s1-u. the s11-u interface is used for CP ciot eps optimisation.
s-gw teid for s1-u/s11-u
tunnel endpoint identifier of the s gw for the s1-u interface. also tunnel endpoint identifier of the s-gw for the s11-u interface if no separation of s1-u and s11-u is required. the s11-u interface is used for CP ciot eps optimisation.
s-gw teid for s11-u
tunnel endpoint identifier of the s gw for the s11-u interface if if s11-u is separated from s1-u. the s11-u interface is used for CP ciot eps optimisation.
mme ip address for s11-u
mme ip address for the s11-u interface (used by the s-gw). the s11-u interface is used for CP ciot eps optimisation.
mme teid for s11-u
mme tunnel endpoint identifier for the s11-u interface (used by the s-gw). the s11-u interface is used for CP ciot eps optimisation.
pdn gw teid for s5/s8 (UP)
p gw tunnel endpoint identifier for the s5/s8 interface for the UP. (used for s gw change only).
note: the pdn gw teid is needed in mme context as s gw relocation is triggered without interaction with the source s gw, e.g. when a tau occurs. the target s gw requires this information element, so it must be stored by the mme.
pdn gw ip address for s5/s8 (UP)
p?gw ip address for UP for the s5/s8 interface for the UP. (used for s gw change only).
note: the pdn gw ip address for UP is needed in mme context as s gw relocation is triggered without interaction with the source s gw, e.g. when a tau occurs. the target s gw requires this information element, so it must be stored by the mme.
eps bearer qos
qci and arp
optionally: gbr and mbr for gbr bearer
tft
traffic flow template. (for pmip-based s5/s8 only)
serving plmn-rate-control
the serving plmn-rate-control limits the maximum number of nas data pdus per deci hour sent per direction (uplink/downlink) using the CP ciot eps optimisation for a pdn connection.

table 5.7.2-2: mme emergency configuration data
the mme emergency configuration data is used instead of ue subscription data received from the hss, for all emergency bearer services that are established by an mme on ue request.

field
description
emergency access point name (em apn)
a label according to dns naming conventions describing the access point used for emergency pdn connection (wild card not allowed).
emergency qos profile
the bearer level qos parameter values for emergency apn's default bearer (qci and arp). the arp is an arp value reserved for emergency bearers.
emergency apn-ambr
the maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers, which are established for the emergency apn, as decided by the pdn gw.
emergency pdn gw identity
the statically configured identity of the pdn gw used for emergency apn. the pdn gw identity may be either an fqdn or an ip address.
non-3gpp ho emergency pdn gw identity
the statically configured identity of the pdn gw used for emergency apn when a plmn supports handover to non-3gpp access. the pdn gw identity may be either an fqdn or an ip address.(note?1)
note-1: the fqdn always resolves to one pdn gw.

note: qci for emergency apn's default bearer is set per operator configuration.
5.7.3 serving gw
the serving gw maintains the following eps bearer context information for ues. table?5.7.3-1 shows the context fields for one ue.
for emergency attached ues which are not authenticated, imei is stored in context.
table 5.7.3-1: s gw eps bearer context
field
description
e-utran
utran/
geran
imsi
imsi (international mobile subscriber identity) is the subscriber permanent identity.
x
x
imsi-unauthenticated-indicator
this is an imsi indicator to show the imsi is unauthenticated.
x
x
me identity
mobile equipment identity (e.g. imei/imeisv).
x
x
msisdn
the basic msisdn of the ue. the presence is dictated by its storage in the hss.
x
x
selected cn operator id
selected core network operator identity (to support network sharing as defined in ts?23.251?[24]). 
x
x
lte-m indication
information used by the core network to differentiate traffic from category m ues for charging purposes, where different values of m (e.g. m1, m2) are defined in ts?36.306?[82].
x

mme teid for s11
mme tunnel endpoint identifier for the s11 interface
x

mme ip address for s11
mme ip address the s11 interface.
x

s gw teid for s11/s4 (CP)
s gw tunnel endpoint identifier for the s11 interface and the s4 interface (CP).
x
x
s gw ip address for s11/s4 (CP)
s gw ip address for the s11 interface and the s4 interface (CP).
x
x
sgsn ip address for s4 (CP)
sgsn ip address for the s4 interface (used by the s gw).

x
sgsn teid for s4 (CP)
sgsn tunnel endpoint identifier for the s4 interface.

x
trace reference
identifies a record or a collection of records for a particular trace.
x
x
trace type
indicates the type of trace
x
x
trigger id
identifies the entity that initiated the trace
x
x
omc identity
identifies the omc that shall receive the trace record(s).
x
x
last known cell id
this is the last location of the ue known by the network
x
(note?1)
x
(note?1)
last known cell id age
this is the age of the above ue location information
x
(note?1)
x
(note?1)
dl data buffer expiration time
the time until the serving gw buffers dl data, when the mme has requested extended buffering in an ddn ack (e.g. when a ue is in psm).
x
x
serving plmn-rate-control
for inclusion on serving gw cdr to allow post processing of cdrs and permit detection of abusive ues.
x

for each pdn connection:
note: the following entries are repeated for each pdn.
apn in use
the apn currently used, as received from the mme or s4 sgsn.
x
x
pdn type
ipv4, ipv6, ipv4v6 or non-ip. (this information is needed by the sgw in order to determine whether to perform paging policy differentiation).
x

eps pdn charging characteristics
the charging characteristics of this pdn connection, e.g. normal, prepaid, flat-rate and/or hot billing.
x
x
p gw address in use (CP)
the ip address of the p gw currently used for sending CP signalling.
x
x
p gw teid for s5/s8 (CP)
p gw tunnel endpoint identifier for the s5/s8 interface for the CP. (for gtp-based s5/s8 only).
x
x
p gw address in use (UP)
the ip address of the p gw currently used for sending UP traffic. (for pmip-based s5/s8 only)
x
x
p gw gre key for uplink traffic (UP)
pdn gw assigned gre key for the s5/s8 interface for the UP for uplink traffic. (for pmip-based s5/s8 only)
x
x
s gw ip address for s5/s8 (CP)
s gw ip address for the s5/s8 for the CP signalling. 
x
x
s gw teid for s5/s8 (CP)
s gw tunnel endpoint identifier for the s5/s8 CP interface. (for gtp-based s5/s8 only).
x
x
s gw address in use (UP)
the ip address of the s gw currently used for sending UP traffic. (for pmip-based s5/s8 only)
x
x
s gw gre key for downlink traffic (UP)
serving gw assigned gre key for the s5/s8 interface for the UP for downlink traffic. (for pmip-based s5/s8 only)
x
x
default bearer
identifies the default bearer within the pdn connection by its eps bearer id. (for pmip based s5/s8.)
x
x
for each eps bearer within the pdn connection:
note: the following entries defining the eps bearer specific parameters are included within the set of parameters defining the pdn connection.
eps bearer id
an eps bearer identity uniquely identifies an eps bearer for one ue accessing via e-utran
x
x
tft
traffic flow template
x
x
p gw address in use (UP)
the ip address of the p gw currently used for sending UP traffic. (for gtp-based s5/s8 only).
x
x
p gw teid for s5/s8 (UP)
p gw tunnel endpoint identifier for the s5/s8 interface for the UP. (for gtp-based s5/s8 only).
x
x
s gw ip address for s5/s8 (UP)
s gw ip address for UP data received from pdn gw. (for gtp-based s5/s8 only).
x
x
s gw teid for s5/s8 (UP)
s gw tunnel endpoint identifier for the s5/s8 interface for the UP. (for gtp-based s5/s8 only).
x
x
s gw ip address for s1-u, s12, s4 (UP) and s11-u
s gw ip address for the s1-u interface (used by the enodeb), for the s12 interface (used by the rnc) and for the s4 interface (used by the sgsn). also s gw ip address for the s11-u interface (used by the mme) if no separation of s1-u and s11-u is required. the s11-u interface is used for CP ciot eps optimisation.
x
x
s gw ip address for s11-u
s gw ip address for the s11-u interface (used by the mme). if s11-u is separated from s1-u. the s11-u interface is used for CP ciot eps optimisation.
x

s gw teid for s1-u, s12, s4 (UP) and s11-u
s gw tunnel endpoint identifier for the s1-u interface, for the s12 interface (used by the rnc) and for the s4 interface (used by the sgsn). also s gw tunnel endpoint identifier for the s11-u interface (used by the mme) if no separation of s1-u and s11-u is required. the s11-u interface is used for CP ciot eps optimisation.
x
x
s gw teid for s11-u
s gw tunnel endpoint identifier for the s11-u interface (used by the mme) if s11-u is separated from s1-u. the s11-u interface is used for CP ciot eps optimisation.
x

mme ip address for s11-u
mme ip address for the s11-u interface (used by the s-gw). the s11-u interface is used for CP ciot eps optimisation.
x

mme teid for s11-u
mme tunnel endpoint identifier for the s11-u interface (used by the s-gw). the s11-u interface is used for CP ciot eps optimisation.
x

enodeb ip address for s1-u
enodeb ip address for the s1-u interface (used by the s gw).
x

enodeb teid for s1-u
enodeb tunnel endpoint identifier for the s1-u interface.
x

rnc ip address for s12
rnc ip address for the s12 interface (used by the s gw).

x
rnc teid for s12
rnc tunnel endpoint identifier for the s12 interface.

x
sgsn ip address for s4 (UP)
sgsn ip address for the s4 interface (used by the s gw).

x
sgsn teid for s4 (UP)
sgsn tunnel endpoint identifier for the s4 interface.

x
eps bearer qos
arp, gbr, mbr, qci.
x
x
charging id
charging identifier, identifies charging records generated by s gw and pdn gw.
x
x
note?1: the "last known cell id age" is stored so that when ue location information is made available from both e-utran and utran/geran, the serving gw can determine the "last known cell id".

5.7.4 pdn gw
the pdn gw maintains the following eps bearer context information for ues. table?5.7.4-1 shows the context fields for one ue.
for emergency attached ues which are not authenticated, imei is stored in context.
table 5.7.4-1: p gw context
field
description
e-utran
utran/
geran
imsi
imsi (international mobile subscriber identity) is the subscriber permanent identity.
x
x
imsi-unauthenticated-indicator
this is an imsi indicator to show the imsi is unauthenticated.
x
x
me identity
mobile equipment identity (e.g. imei/imeisv).
x
x
msisdn
the basic msisdn of the ue. the presence is dictated by its storage in the hss.
x
x
selected cn operator id
selected core network operator identity (to support network sharing as defined in ts?23.251?[24]). 
x
x
rat type
current rat
x
x
lte-m indication
information used by the core network to differentiate traffic from category m ues for charging purposes, where different values of m (e.g. m1, m2) are defined in ts?36.306?[82].
x

trace reference
identifies a record or a collection of records for a particular trace.
x
x
trace type
indicates the type of trace
x
x
trigger id
identifies the entity that initiated the trace
x
x
omc identity
identifies the omc that shall receive the trace record(s).
x
x
for each apn in use:
note: the following entries are repeated for each apn.
apn in use
the apn currently used, as received from the s-gw.
x
x
apn ambr
the maximum aggregated uplink and downlink mbr values to be shared across all non-gbr bearers, which are established for this apn.
x
x
apn rate control
the apn-rate-control limits the maximum number of uplink/downlink packets and the maximum number of additional exception report packets per a specific time unit (e.g. minute, hour, day, week) for this apn. it includes an indication as to whether or not exception reports may still be sent when the limit has been met.
x

for each pdn connection within the apn:
note: the following entries are repeated for each pdn connection within the apn.
ip address(es)
ipv4 address and/or ipv6 prefix
x
x
pdn type
ipv4, ipv6, ipv4v6 or non-ip
x
x
s gw address in use (CP)
the ip address of the s gw currently used for sending CP signalling.
x
x
s gw teid for s5/s8 (CP)
s gw tunnel endpoint identifier for the s5/s8 interface for the CP. (for gtp-based s5/s8 only).
x
x
s gw address in use (UP)
the ip address of the s gw currently used for sending UP traffic. (for pmip-based s5/s8 only).
x
x
s gw gre key for downlink traffic (UP)
serving gw assigned gre key for the s5/s8 interface for the UP for downlink traffic. (for pmip-based s5/s8 only).
x
x
p gw ip address for s5/s8 (CP)
p gw ip address for the s5/s8 for the CP signalling. 
x
x
p gw teid for s5/s8 (CP)
p gw tunnel endpoint identifier for the s5/s8 CP interface. (for gtp-based s5/s8 only).
x
x
p gw address in use (UP)
the ip address of the p gw currently used for sending UP traffic. (for pmip-based s5/s8 only).
x
x
p gw gre key for uplink traffic (UP)
pdn gw assigned gre key for the s5/s8 interface for the UP for uplink traffic. (for pmip-based s5/s8 only).
x
x
ms info change reporting support indication
the mme and/or sgsn serving the ue support(s) procedures for reporting user location information and/or user csg information.
x
x
ms info change reporting action
denotes whether the mme and/or the sgsn is/are requested to send changes in user location information change.
x
x
csg information reporting action
denotes whether the mme and/or the sgsn is/are requested to send changes in user csg information change.
this field denotes separately whether the mme/sgsn are requested to send changes in user csg information for (a) csg cells, (b) hybrid cells in which the subscriber is a csg member, and (c) hybrid cells in which the subscriber is not a csg member, or any combination of the above.
x
x
presence reporting area action
denotes whether the mme and/or the sgsn is/are requested to send changes of ue presence in presence reporting area.this field denotes separately the presence reporting area identifier and the list of presence reporting area elements.
x
x
bcm
the negotiated bearer control mode for geran/utran.

x
default bearer
identifies the default bearer within the pdn connection by its eps bearer id. the default bearer is the one which is established first within the pdn connection. (for gtp based s5/s8 or for pmip based s5/s8 if multiple pdn connections to the same apn are supported).
x
x
eps pdn charging characteristics
the charging characteristics of this pdn connection e.g. normal, prepaid, flat-rate and/or hot billing.


serving plmn-rate-control
the serving plmn-rate-control limits the maximum number of uplink/downlink messages per a specific time unit (e.g. minute, hour, day, week) for a pdn connection.
x

3gpp ps data off status
current 3gpp ps data off status of the ue.


for each eps bearer within the pdn connection:
note?1: the following entries defining the eps bearer specific parameters are included within the set of parameters defining the pdn connection.
note?2: the following entries are stored only for gtp-based s5/s8.
eps bearer id
an eps bearer identity uniquely identifies an eps bearer for one ue accessing via e-utran
x
x
tft
traffic flow template
x
x
s gw address in use (UP)
the ip address of the s gw currently used for sending UP traffic.
x
x
s gw teid for s5/s8 (UP)
s gw tunnel endpoint identifier for the s5/s8 interface for the UP.
x
x
p gw ip address for s5/s8 (UP)
p gw ip address for UP data received from pdn gw.
x
x
p gw teid for s5/s8 (UP)
p gw tunnel endpoint identifier for the gtp based s5/s8 interface for UP.
x
x
eps bearer qos
arp, gbr, mbr, qci.
x
x
charging id
charging identifier, identifies charging records generated by s gw and pdn gw.
x
x

5.7.5 ue
the ue maintains the following context information. table?5.7.5-1 shows the context fields. a geran or utran capable ue maintains in addition the context information as described in a similar ue context table in ts?23.060?[7].
table 5.7.5-1: ue context
field
description
imsi
imsi (international mobile subscriber identity) is the subscriber's permanent identity.
emm state
mobility management state emm-registered, emm-deregistered.
guti
globally unique temporary identity.
me identity
mobile equipment identity ? (e.g. imei/imeisv) software version number.
tracking area list
current tracking area list.
last visited tai
a tai which is contained in the ta list the ue registered to the network and which identifies the tracking area last visited by the ue.
selected nas algorithm
selected nas security algorithm.
selected as algorithm
selected as security algorithms.
eksi
key set identifier for the main key kasme. also indicates whether the ue is using security keys derived from utran or e-utran security association
kasme
main key for e-utran key hierarchy based on ck, ik and serving network identity.
nas keys and count
knasint, knasenc, and nas count parameter.
temporary identity used in next update (tin)
this parameter is used internally by the ue to memorise which temporary id it has to indicate in the attach request and rau/tau request as specified in clause 4.3.5.6.
ue specific drx parameters
preferred e-utran drx cycle length
active time value for psm
ue specific active time value allocated by mme for power saving mode handling.
extended idle mode drx parameters
extended idle mode drx parameters received from the mme.
allowed csg list
the allowed csg list, which is under both user and operator control, indicates the list of csg ids and the associated plmn where the ue is a member.
operator csg list
the operator csg list, which is under exclusive operator control, indicates the list of csg ids and the associated plmn where the ue is a member.
service gap time
used to set the service gap timer for service gap control (see clause?4.3.17.9).
for each active pdn connection:
apn in use
the apn currently used. this apn shall be composed of the apn network identifier and the default apn operator identifier, as specified in ts?23.003?[9], clause?9.1.2.
apn ambr
the maximum aggregated uplink and downlink mbr to be shared across all non-gbr bearers, which are established for this apn.
assigned pdn type
the pdn type assigned by the network (ipv4, ipv6, ipv4v6 or non-ip).
ip address(es)
ipv4 address and/or ipv6 prefix
header compression configuration
rohc configuration and context(s) for ip header compression for CP ciot eps optimisation.
default bearer
identifies the default bearer within the pdn connection by its eps bearer id. the default bearer is the one which is established first within the pdn connection.
wlan offloadability
indicates whether the traffic associated with this pdn connection is allowed to be offloaded to wlan using the wlan/3gpp radio interworking feature or if it shall be kept on 3gpp access (see clause?4.3.23). the indication may contain separate values per rat (e-utra and utra).
apn rate control
the apn-rate-control limits the maximum number of uplink packets and the maximum number of additional exception report packets per a specific time unit (e.g. minute, hour, day, week) for this apn. it includes an indication as to whether or not exception reports may still be sent when the limit has been met.
serving plmn-rate-control
the serving plmn-rate-control limits the maximum number of nas data pdus per deci hour sent uplink using the CP ciot eps optimisation for a pdn connection.
for each eps bearer within the pdn connection
eps bearer id
an eps bearer identity uniquely identifies an eps bearer for one ue accessing via e-utran.
ti
transaction identifier
eps bearer qos
gbr and mbr for gbr bearer.
tft
traffic flow template.

5.7.6 handling of wild card apn
when the wild card apn is present in the subscription context, the ue is authorized to connect to apns which are not present in the subscription context.
when a request is received for registering a pdn gw id and there is no pdn subscription context with this apn, the nodes (hss/mme/ s4 sgsn) shall store the pdn gw id - apn relation for the ue.
when a request is received for deregistering of pdn gw id and there is no pdn subscription context with this apn, the nodes (hss/mme/s4 sgsn) shall delete the pdn gw id - apn relation from the list of apn - pdn gw id relations.
5.7.7 css
please refer to ts?23.008?[28] for the content of the information storage for the css.
5.7a charging
5.7a.1 general
accounting functionality is provided by the serving gw and the pdn gw. when a secondary rat may be used, the serving gw and pdn gw can be assisted by the e-utran (see clause?5.7a.4).
the serving gw shall be able to collect and report for each ue accounting information, i.e. the amount of data transmitted in uplink and downlink direction categorized with the qci and arp pair per ue per pdn connection. for gtp-based s5/s8 the accounting information is collected and reported per bearer.
the serving gw shall not collect ue accounting information for packets that are being processed for the sole purpose of indirect forwarding.
the serving gw for inter-operator charging, and the pdn gw shall be able to interface the ofcs according to charging principles and through reference points specified in ts?32.240?[51].
the pdn gw shall be able to provide charging functionality for each ue according to ts?23.203?[6]. the pdn gw data collection for charging and usage monitoring purposes can be temporarily paused as described in clause?5.3.6a.
a pdn gw without a gx interface shall be able to support flow based online and offline charging based on local configuration and interaction with the online and offline charging systems.
the online charging system may provide a pra identifier(s) to the pdn gw to subscribe to notifications about changes of ue presence in presence reporting area as defined in the ts?23.203?[6]. for ue-dedicated presence reporting areas the online charging system also provides the list(s) of the elements comprising each subscribed ue-dedicated presence reporting area.
the pdn gw shall be able to collect and report, for each ue, accounting information, i.e. the amount of data received and transmitted in uplink and downlink direction categorized with the qci and arp pair per ue per pdn connection. for gtp-based s5/s8 the accounting information is collected and reported per bearer. the pdn gw data collection can be temporarily paused as described in clause?5.3.6a based on operator configuration in the pdn gw.
note: a consequence of pausing the pdn gw data collection is that pdn gw accounting information may not correspond to the volume that traversed the pdn gw and it is therefore not possible to verify accounting information collected at the serving gw for inter-operator charging.
the charging identifier(s) generated by the pdn gw per bearer for gtp-based s5/s8 and per pdn connection for pmip-based s5/s8 and the pdn gw address for control signalling enables the correlation of the reporting from a serving gw and a pdn gw. the charging identifier is uniquely assigned within the pdn gw.
the pdn gw receives charging characteristics from the serving gw through gtp-s5/s8, or through pmip for pmip-based s5/s8. the handling of the charging characteristics in the p gw is defined in ts?32.251?[44].
to enable csg charging function for a subscriber consuming network services via a csg cell or a hybrid cell, user csg information is transferred to the pdn gw as indicated by csg information reporting action. user csg information includes csg id, access mode and csg membership indication. csg membership indication of whether the ue is a member of the csg is included if the access mode is hybrid.
the valid csg information shall be available in the serving gw and pdn gw in connected mode.
the pcrf shall, if deployed, provide user csg information reporting rules to the pdn gw at attach and pdn connectivity request. pdn gw sets the csg information reporting action ie according to the user csg information reporting rules and sends it to serving gw and mme.
to enable the mme to signal the correct rat type (nb-iot or wb-e-utran) to the sgw and pdn gw for accounting information generation purposes, the enodeb informs the mme of the rat type and tac associated with each cell in the s1 setup request and enb configuration update messages (ts?36.413?[36]). if the enodeb signals wb-eutran and the ue is of category m from the ue's radio capability, the mme reports rat type lte-m to the sgw. see clause?5.11.5 for more details.
5.7a.2 usage data reporting for secondary rat
when a secondary rat can be used in conjunction with e-utran, the hplmn or vplmn operator may wish to record the data volume sent on the secondary rat.
in order to reduce the complexity of this procedure, and to align with existing per eps bearer accounting procedures, the following principles are used in this release:
a) the plmn locally activates the secondary rat usage data reporting by e-utran o&m. the activation can happen separately for data volume reporting of nr and unlicensed spectrum. if the plmn uses this feature, it should ensure that this functionality is supported by all enodebs that support nr, unlicensed spectrum aggregation (if used to record data volume sent over unlicensed spectrum) as a secondary rat.
b) the e-utran reports uplink and downlink data volumes to the epc for the secondary rat on a per eps bearer basis and per time interval.
note?1: secondary rat includes access type nr and usage data reporting for secondary rat includes reporting of the combination of nr usage as defined in ts?37.340?[85].
c) at x2 handover and s1 handover, the source enodeb reports the data volumes to the epc. the reported data volume excludes data forwarded to the target ran node.
d) at s1 release, connection suspend, and eps bearer deactivation the enodeb reports the data volumes to the epc.
e) to assist "partial cdr" generation at the serving gw and the pdn gw, e-utran o&m can instruct the e-utran to also make periodic reports in case no event has triggered a report before the period expires.
note?2: the timing of these periodic e-utran reports is not expected to align with the timing of partial cdr generation. hence the frequency of e-utran reports might be greater than that of partial cdr generation.
note?3: ran needs to be able to partition the measurements in a report to indicate usage that occurred before and after an absolute time. an example of the absolute time is that ran is configured to partition data usage reports that occurred before and after midnight.
f) as an option, the SGW sends the data volume reports on to pdn gws identified in bilateral roaming agreements.
5.7a.3 secondary rat usage data reporting procedure
the procedure in figure 5.7a.3-1 may be used to report secondary rat usage data from enodeb to the mme. it is executed by the enodeb to report the secondary rat usage data information which is then included in messages on s11 towards serving gw and s5/s8 interface to the pgw (e.g. during i-rat handover procedures, s1 handover, x2 handover). this then further uses existing epc signaling of the procedures involved.
the procedure in figure 5.7a.3-2 may be used to report the secondary rat usage data from mme to the serving gw. optionally, it is used to report the secondary rat usage data from serving gw to the pdn gw when the reporting to pdn gw is activated.
if the secondary rat usage data is provided by an s1ap message from enodeb to mme other than the one indicated in figure 5.7a.3-1, the procedures in clause?5.7a.3-2 may be used to transfer the secondary rat usage data to the serving gw and pdn gw (e.g. during s1 release procedure).
during irat handovers, the procedures 5.7a.3-1 to 5.7a.3-2 in its entirety is executed to provide reporting of secondary rat usage data to the serving gw and to the pdn gw if pgw secondary rat usage data reporting is active.
handover related signalling of irat procedures may be used to provide reporting of secondary rat usage data to the serving gw instead of the signaling of figure?5.7a.3-2, when pgw secondary rat usage data reporting is not active.

figure 5.7a.3-1: ran secondary rat usage data reporting procedure
1. the enb, if it supports dual connectivity with secondary rat (using nr radio (see clause?4.3.2a on support for dual connectivity), using unlicensed spectrum aggregation in the form of laa/lwa/lwip (see clause?4.3.30)) and it is configured to report secondary rat usage data for the ue, depending on certain conditions documented in this specification, it shall send a ran usage data report message to the mme including the secondary rat usage data for the ue. the enb will send only one ran usage report for a ue when the ue is subject to handover by ran. the ran usage data report includes a handover flag to indicate when the message is sent triggered by x2-handover.
 if dual connectivity is active or had been activated by that enb, the enb shall add the pscell id (and the time elapsed since the dual connectivity was released if dual connectivity is no longer activated) to the rat usage data report message.

figure 5.7a.3-2: gw secondary rat usage data reporting procedure
the enb, if it supports dual connectivity with secondary rat (using nr radio (see clause?4.3.2a on support for dual connectivity), using unlicensed spectrum aggregation in the form of laa/lwa/lwip (see clause?4.3.30)) and it is configured to report secondary rat usage data for the ue, it shall send include the secondary rat usage data for the ue to the mme in certain messages depending on certain conditions documented elsewhere in this ts.
secondary rat usage reporting from the enb is provided using s1 signaling message which are either at the ue level (eg. path switch request, etc), or at bearer level (eg. e-rab modification indication, deactivate bearer response, etc.) as captured in relevant clauses in this specification. in case secondary rat usage report is provided in bearer level signaling message by the enodeb, the secondary rat usage report is related only to the specific bearer.
1. the mme forwards the secondary rat usage data to the sgw in a change notification request (secondary rat usage data) message. if the sgw is requested to forward secondary rat usage data to the pgw, the mme includes a flag causing the sgw to forward this to the pgw. also, the mme informs the serving gw if the secondary rat usage data shall not be processed by the serving gw (e.g. during serving gw relocation when the usage data is to be forwarded via the target serving gw).
2. the serving gw may, based on flags received in the previous message and local configuration in the serving gw, send the change notification (secondary rat usage data) message to the pdn gw.
3. the pdn gw acknowledges receiving the secondary rat usage data for the ue by a change notification ack() message to the serving gw.
4. the sgw acknowledges by sending a change notification ack() message back to the mme.
5.7a.4 secondary rat periodic usage data reporting procedure
periodic reporting of the secondary rat usage data is an optional function. when enodeb, as defined in bullet e) of clause?5.7a.2, is configured with a "time interval for secondary rat usage data reporting", the enodeb shall send a ran usage data report message for periodic reporting purposes to the mme only when this timer expires for a ue for which secondary rat usage data reporting is ongoing. the timer runs from the last usage reporting for the ue. the mme also indicates to sgw if secondary rat usage data reporting to the pgw is active.
the procedures 5.7a.3-1 to 5.7a.3-2 in its entirety is executed to provide periodic reporting of secondary rat usage data to the serving gw and to the pdn gw when pgw secondary rat usage data reporting is active. at use for periodic usage data reporting, the procedure 5.7a.3-1 uses signalling from enb which does not include a handover flag.
5.8 mbms
mbms is a point-to-multipoint service in which data is transmitted from a single source entity to multiple recipients. transmitting the same data to multiple recipients allows network resources to be shared.
support of mbms for eps is defined in ts?23.246?[13].
5.9 interactions with other services
5.9.1 location reporting procedure
this procedure is used by an mme to request the enodeb to report where the ue is currently located when the target ue is in ecm-connected state. the need for the enodeb to continue reporting ceases when the ue transitions to ecm-idle. this procedure may be used for services that require accurate cell identification (e.g. for emergency services, lawful intercept, charging). when dual connectivity is activated, the pscell information is only reported if requested by the mme.

figure 5.9.1-1: location reporting procedure
1) the mme sends a location reporting control message to the enodeb. the location reporting control message shall identify the ue for which reports are requested, the requested location information and may contain information such as reporting type. requested location information is tai+egci, and if requested by the mme, pscell id.
 reporting type indicates whether the message is intended to trigger:
- a single stand alone report about the current cell id serving the ue; or
 start the enodeb to report whenever the ue changes cell.
 in addition, the mme shall be able to control whether or not the ran reports changes in the ue's pscell id.
note?1: requesting reports whenever the ue changes cell can increase signalling load on multiple interfaces. requesting reports for changes in pscell id can further increase signalling load. hence it is recommended that any such reporting is only applied for a limited number of subscribers.
2) the enodeb sends a location report message informing the mme about the location of the ue which shall include the requested location information.
3) the mme can send a cancel location reporting message to inform the enodeb that it should terminate location reporting for a given ue. this message is needed only when the reporting was requested for a reporting period.
note?2: location reporting is transferred during x2 handover, although new control signalling is not transferred during an active handover.
5.9.2 location change reporting procedure
5.9.2.1 general
the pdn gw may request for each pdn connection independently whether the mme shall report changes of ecgi/enodeb id/tai (by using the "ms info change reporting action" parameter) and/or the ue entering/leaving a presence reporting area (by using the "presence reporting area action" parameter) and/or whether the mme shall report changes of user csg information (by using "csg information reporting action" parameter) to the pdn gw.
this reporting (any combination of "ms info change reporting action" and/or "presence reporting area action" and/or "csg information reporting action") may be controlled by the pdn gw at the following procedures:
- attach,
- tracking area update (when inducing a modify bearer procedure to the pdn gw),
- inter-rat mobility to e-utran (when inducing a modify bearer procedure to the pdn gw),
- dedicated bearer activation,
- pdn gw initiated bearer modification with bearer qos update,
- pdn gw initiated bearer modification without bearer qos update,
- ue requested pdn connectivity,
- ue requested bearer resource modification.
the "presence reporting area action" and "presence reporting area information" parameters apply to all procedures listed above but, within this specification, their usage has only been described in the message flows related with the attach and the ue requested pdn connectivity procedures.
the reporting of ue entering/leaving a presence reporting area is further described in clause?5.9.2.2.
the pdn gw may also request the mme to stop any of the above mentioned types of reporting. the mme shall obey the last explicit instruction received from the pdn gw or source mme.
during both mobility management and session management procedures, the mme shall indicate to the pdn gw the support of reporting location changes (using the ms info change reporting support indication):
- if ecgi/enodeb id/tai information is permitted to be sent to the pdn gw according to mme operator's policy,
- if csg information is permitted to be sent to the pdn gw according to mme operator's policy.
the mme may be configured to report ecgi/enodeb id/tai changes only when one or more e-rab(s) are established. otherwise the mme shall report ecgi/enodeb id/tai changes as soon as detected.
if the level of support changes during a mobility management procedure then the mme shall indicate the current level of support to the s-gw and shall in addition provide ecgi/enodeb id/tai even if the pdn gw has not requested this information. this could for example happen during mme change when the level of support indicated by the old mme is not the same as in the new mme.
note?1: the inclusion of ecgi/enodeb id/tai will trigger a modify bearer request message from s-gw to the pdn gw and therefore this will make sure that the new level of support reaches the pdn gw.
at change of serving node (mme/s4-sgsn), the old serving node provides the new serving node with "ms info change reporting action" as previously requested by the pdn gw. the new serving node takes the "ms info change reporting action" immediately into account with the exception that, at mobility between a s4-sgsn and a mme, the new mme (respectively s4-sgsn) does not take into account the "ms info change reporting action" received from the s4-sgsn (respectively mme) but assumes that no location information change reporting is requested for the target rat. at a change of rat type between eutran and utran or between eutran and geran, if location information change reporting is required in the target rat, the pdn gw shall request "ms info change reporting action" from the new serving node (mme or s4-sgsn). upon inter-rat mobility, if the target mme/s4-sgsn supports location information change reporting, the target mme/s4-sgsn shall include the user location information in the create session request / modify bearer request, regardless of whether location information change reporting had been requested in the previous rat by the pdn gw.
the pdn gwpdn gw shall not request the mme to report location changes if it has not received the indication for corresponding support from the mme.
note?2: for e-utran access, homogeneous support of reporting changes of ue presence in a presence reporting area in a network is assumed: when the pcrf configuration indicates that reporting changes of ue presence in a presence reporting area is supported for e-utran, this means it is supported by all the pdn gwpdn gw, all mme and all the sgw including the mme and sgw working in network sharing mode. if change of ue presence in presence reporting area reporting is not supported, the pcrf may instead activate location information change reporting at cell, enodeb or tracking area level.
the following procedure shall be used for location change reports to the pdn gwpdn gw where the report is not combined with other mobility management or session management signalling. the procedure shall only apply when the mme has been explicitly requested to report location changes.
the following procedure can be used for mo exception data counter reporting where the report is not combined with other mobility management or session management signalling. the mme only includes the mo exception data counter if the rrc establishment cause is set to "mo exception data" and the ue is accessing via the nb-iot rat. the mme maintains the mo exception data counter for serving plmn rate control purposes (see clause?4.7.7.2). the mme may immediately send the mo exception data counter to the serving gw. alternatively, in order to reduce signalling, the mme may send the mo exception data counter to the serving gw as described in ts?29.274?[43]. the sgw and pdn gwpdn gw indicate each use of this rrc establishment cause by the related counter on its cdr.
note?3: due to the increased signalling load, it is recommended that ecgi/enodeb id/tai or csg reporting is only applied for a limited number of subscribers.
figure 5.9.2.1-1 represents the ecgi change triggering a report of change in ecgi, and/or the user csg information change triggering a report of change in user csg information. the figure also shows the reporting of a tai change and/or when a ue enters or leaves a presence reporting area.

figure 5.9.2.1-1: notification of the ecgi, tai and/or user csg information changes
1a. the mme has received an ecgi information update from the enodeb.
1b. the mme detects that the user csg information has changed by comparing with the mme stored user csg information, or
1c. the mme detects that the tai of the ue has changed, or
1d. the mme detects that the ue has entered or left a presence reporting area defined for this ue.
note?4: it is possible that these changes are triggered at same time.
2. if the mme has been requested to report location changes to the pdn gwpdn gw for the ue (under the conditions specified in clause?5.9.2), the mme shall send the change notification message to the sgw indicating the new ecgi, tai and/or user csg information. the mme stores the notified user csg information. if the mme has been requested to report a change of ue presence in presence reporting area (under the conditions specified in clause?5.9.2), the mme shall send the change notification message including the presence reporting area information comprising the area identifier(s) and indication(s) on whether the ue is inside or outside the area(s). if mme decides to reactivate one or more of the inactive presence reporting area(s), the presence reporting area information in this message also comprises the reactivated pra identifier(s), and indication(s) on whether the ue is inside or outside the reactivated area(s).
3. the sgw forwards the change notification message to the pdn gwpdn gw. if dynamic pcc is deployed, and location changes need to be conveyed to the pcrf, then the pdn gwpdn gw shall send this information to the pcrf as defined in ts?23.203?[6]. if presence reporting area information has been received, the pdn gwpdn gw shall forward the presence reporting area information to the pcrf, to the ocs or to both as defined in ts?23.203?[6].
4. the pdn gw sends the change notification ack to the sgw.
5. the sgw forwards the change notification ack to the mme.
5.9.2.2 reporting at presence reporting area entering and leaving
in some use cases policy control/charging decisions, such as qos modification or charging rate change depend on whether the ue is located inside or outside a specific area of interest (presence reporting area), and especially on whether the ue enters or leaves that specific area of interest.
a presence reporting area can be:
- either a "ue-dedicated presence reporting area", defined in the subscriber profile and composed of a short list of tas/ras, or enbs and/or cells/sas in a plmn;
- or a "core network predefined presence reporting area", predefined in mme/sgsn and composed of a short list of tas/ras, or enbs and/or cells/sas in a plmn.
note?1: enbs are identified via the global enb id ie defined in ts?36.413?[36].
note?2: change of ue presence in presence reporting area reporting does not apply to roaming.
the reporting of changes of ue presence in presence reporting area is for a specific ue and is triggered as defined in ts?23.203?[6]. the pdn gw may request to start/stop reporting of changes of ue presence for one or more presence reporting area(s) by using the presence reporting area action parameter. for ue-dedicated presence reporting areas, the reporting request (start) shall contain the pra identifier(s) and the list(s) of tas/ras, or enbs and/or cells/sais composing the presence reporting area(s). for core network predefined presence reporting areas, the reporting request (start) shall contain the pra identifier(s). the request to stop a reporting contains the pra identifier(s).
each core network predefined presence reporting area can be configured with a priority level in the mme/s4-sgsn. in order to prevent overload, the mme/s4-sgsn may set the reporting for one or more of the received presence reporting area(s) to inactive under consideration of the priority configured for each of core network predefined presence reporting area(s), while storing the reporting request for this presence reporting area in the user context.
upon reception of a request for change of ue presence in presence reporting area reporting, the mme/s4-sgsn shall report to the pdn gw via the sgw the presence reporting area information comprising the pra identifier(s) and indication(s) on whether the ue is inside or outside the presence reporting area(s). if the ue is in ecm-idle state, the mme may either bring the ue into ecm-connected state, or, report based on the ue's last known location and when the ue was there. one or more presence reporting area may be set for a given pdn connection at a time. the serving node if needed only sets the reporting of ue presence in a presence reporting area to inactive when receiving the reporting request for this presence reporting area. if the mme/s4-sgsn decides to set the reporting of ue presence in one or more of the received presence reporting area(s) to inactive, the mme/s4-sgsn shall also report the inactive presence reporting area(s).
the mme/s4-sgsn shall notify the pdn gw when the ue enters or leaves a presence reporting area, and no notifications are sent for ue movements inside or outside a presence reporting area. the report of the change of ue presence in presence reporting area shall contain the presence reporting area information comprising the pra identifier(s) and indication(s) on whether the ue is inside or outside the area(s). a report shall be sent if the ue presence is different to the last one reported.
the mme/s4-sgsn may be configured with a pra identifier which refers to a set of core network predefined presence reporting areas. the pdn gw may request start reporting for this set of presence reporting areas by only indicating this pra identifier in the presence reporting area action. when the presence reporting area(s) to be reported belong to a set of core network predefined presence reporting areas in which the mme/s4-sgsn is requested to report on change of ue presence, the mme/s4-sgsn shall additionally add to the report the pra identifier of the set of core network predefined presence reporting areas.
upon change of serving epc node (mme, s4-sgsn), the pra identifier(s) and if provided by the pdn gw the list(s) of presence reporting area elements are transferred for all pdn connections as part of mm context information to the target serving node during the mobility procedure. if one or more presence reporting area(s) was set to inactive, the target serving node may decide to reactivate one or more of the inactive presence reporting area(s). the target serving node indicates per pdn connection to the corresponding pdn gw the pra identifier(s) and whether the ue is inside or outside the presence reporting area(s) as well as the inactive presence reporting area(s), if any.
note?3: the target serving node cannot set the presence reporting area(s) received from the source serving node to inactive.
5.9.3 imsi and apn information retrieval procedure
this procedure is used by the rcaf to determine the ues that are served by a congested enb or e-utran cell and the apns of the active pdn connections of these ues. this information is used to determine the pcrfs serving these ues and subsequently report ran user-plane congestion information (ruci) to the pcrfs. the decision whether the rcaf requests mme to retrieve the list of ues on enb or e-utran cell level is up to operator configuration.
note?1: the details of congestion reporting to the pcrf are specified in ts?23.203?[6].
the rcaf determines the mmes that are serving the congested enb or e-utran cell based on the tracking area identities served by the congested enb or e-utran cell. for further details on the related dns procedure see ts?29.303?[61]. the following steps are applied to all mmes serving the congested enb or e-utran cell.
note?2: in network sharing scenarios the rcaf belongs to the ran operator. in this case it is up to inter-operator agreements and operator configuration which sharing partner's mmes the rcaf queries imsi and apn information from.

figure 5.9.3-1: imsi and apn information retrieval procedure
1. the rcaf sends an imsi/apn information request to the mme. the request shall identify whether the request refers to an enb or an e-utran cell and shall contain the related enb id or ecgi.
note?3: the enb id is defined in ts?36.413?[36].
2. the mme sends the imsi/apn information response to the rcaf. the response shall contain the list of ues (identified by the imsis) served by the enb or e-utran cell and the list of apns of the active pdn connections of each imsi.
 if the rcaf requested the imsi/apn information on e-utran cell level, then the mme first determines the list of ues served by that e-utran cell. the mme may achieve this by querying the enb that the e-utran cell belongs to for the exact ecgi for all ues served by this enb using the location reporting procedure (clause?5.9.1).
note?4: applying the location reporting feature due to an e-utran cell level rcaf request can increase s1-mme interface signalling load.
note?5: in order for rcaf to maintain the list of impacted ues (identified by the imsis) (and related apn information) for a congested cell, the rcaf needs to regularly receive imsi/apn information updates from the mme. the details of whether the rcaf needs to query the mme regularly or whether the mme updates the rcaf regularly without further explicit requests from the rcaf is specified in stage 3.
5.10 multiple-pdn support and pdn activation for ues supporting "attach without pdn connectivity"
5.10.1 general
the eps shall support simultaneous exchange of traffic to multiple pdns through the use of separate pdn gws or a single pdn gw. the usage of multiple pdns is controlled by network policies and defined in the user subscriptioneps optimisation.
the eps shall support ue-initiated connectivity establishment in order to allow multiple pdn connections to one or more pdns. it shall be possible for a ue to initiate disconnection from any pdn.
all simultaneously active pdn connections of a ue that are associated with the same apn shall be provided by the same pdn gw.
ue support for multiple pdn connections is optional.
if the CP ciot eps optimisation is supported:
- a pdn connection of non-ip pdn type may also be served by an scef (see ts?23.682?[74]); multiple pdn connections of non-ip pdn type may be served by the same or multiple scefs; and
- the mme decides, based on apn configuration information, whether a pdn connection is served by an scef or a pdn gw.
5.10.2 ue requested pdn connectivity
the ue requested pdn connectivity procedure for an e-utran is depicted in figure 5.10.2-1. the procedure allows the ue to request for connectivity to an additional pdn over e-utran including allocation of a default bearer, if the ue already has active pdn connections over e-utran. this procedure may also be used when a ue has set "attach without pdn connectivity is supported" in the preferred network behaviour at attach time and the network has acknowledged its support to the ue. if so, the ue may remain attached without a default pdn connection and, at any time, request a pdn connection to be established. this procedure is also used to request for connectivity to an additional pdn over e-utran, if the ue is simultaneously connected to e-utran and a non-3gpp access and the ue already has active pdn connections over both accesses. the pdn connectivity procedure may trigger one or multiple dedicated bearer establishment procedures to establish dedicated eps bearer(s) for that ue.
an emergency attached ue shall not initiate any pdn connectivity request procedure. a normal attached ue shall request a pdn connection for emergency services when emergency service is required and an emergency pdn connection is not already active.
the ue supporting 15 eps bearers as defined in clause?4.12 shall not initiate a ue requested pdn connectivity procedure if it has already 8 eps bearers established and the ue has not received an indication for support of 15 eps bearers per ue or has received cause #65 "maximum number of eps bearers reached".

figure 5.10.2-1: ue requested pdn connectivity
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps 3, 4, 5 and 13a/b concern gtp based s5/s8.
note?2: the ue also uses this procedure to request re-establishment of existing pdn connectivity upon handover from non-3gpp accesses.
note?3: the steps in (b) are executed only upon handover from non-3gpp access or if presence reporting area information is received from the mme.
note?4: when using the CP ciot eps optimisation, steps 7 and 8 are modified and 9 and 10 are skipped.
1. the ue initiates the ue requested pdn procedure by the transmission of a pdn connectivity request (apn, pdn type, protocol configuration options, request type, header compression configuration) message. if the ue was in ecm-idle mode, this nas message is preceded by the service request procedure if any of the exiting pdn connections were using the UP without ciot eps optimisation, or, if the UP was used just with UP ciot eps optimisations, a connection resume procedure is executed instead. pdn type indicates the requested ip version (ipv4, ipv4v6, ipv6, non-ip).
 the mme verifies that the apn provided by ue is allowed by subscription. if the apn provided by the ue is not allowed by subscription, based on operator policy, the mme may reject the request from the ue with an appropriate cause, or accept the request by replacing the ue requested apn with a network supported apn. the mme uses that network supported apn for the remainder of this procedure, except that the mme provides to the ue the same apn that the ue requested. if the ue did not provide an apn, the mme shall use the apn from the default pdn subscription context, and, use this apn for the remainder of this procedure.
 protocol configuration options (pco) are used to transfer parameters between the ue and the network and are sent transparently through the mme and the serving gw. the protocol configuration options may include the address allocation preference, which indicates that the ue prefers to obtain an ipv4 address only after the default bearer activation by means of dhcpv4. if the ue has utran or geran capabilities, it shall send the nrsu in the pco to indicate the support of the network requested bearer control in utran/geran. the ue sends the etftu in the pco to indicate the support of the extended tft filter format. the request type indicates "initial request" if the ue requests new additional pdn connectivity over the 3gpp access network for multiple pdn connections, the request type indicates "handover" when the ue is performing a handover from non-3gpp access and the ue has already established connectivity with the pdn over the non-3gpp access.
 the ue shall indicate request type "emergency" when it requests a pdn connection for emergency services.
 if the message is being sent via a henb which has a collocated l-gw, it includes the l-gw address in the uplink nas transport message to the mme.
 if a ue indicated CP ciot eps optimisation supported in preferred network behavior and supports header compression, it shall include the header compression configuration, unless "non-ip" pdn type is indicated. the header compression configuration includes the information necessary for the rohc channel setup. optionally, the header compression configuration may also include additional header compression context setup parameters, if the ue already has the application traffic information, e.g. the target server ip address.
 the ue shall include in the pco the 3gpp ps data off ue status, which indicates whether the user has activated or deactivated 3gpp ps data off.
2. if the mme receives a pdn connectivity request from an emergency attached ue or the pdn connectivity request is for normal services and the mobility or access restrictions do not allow the ue to access normal services the mme shall reject this request.
 if the request type indicates "emergency" and the mme is not configured to support pdn connections for emergency services the mme shall reject the pdn connectivity request with an appropriate reject cause.
 if the request type is not set to "emergency", and the ue has indicated support for attach without pdn connectivity, and the network supports attach without pdn connectivity, and the pdn connection restriction is set in the subscriber data, then the mme should reject the pdn connectivity request with an appropriate cause value.
 if the request type indicates "emergency", the mme derives a pdn gw from the mme emergency configuration data or the mme selects a pdn gw as described in clause?4.3.12.4 on pdn gw selection function (3gpp accesses) according to the emergency apn in the mme emergency configuration data. this selection shall provide a pdn gw from visited plmn only.
 if the request type indicates "emergency" and the mme is configured to support pdn connections for emergency services, it uses the mme emergency configuration data for the bearer establishment in this step and ignores any subscription data limitation.
 if the request type indicates "handover", the mme uses the pdn gw stored in the subscription data retrieved by the mme during the update location performed at attach. if the request type indicates "initial request" the mme selects a pdn gw as described in clause?4.3.8.1 on pdn gw selection function (3gpp accesses).
 if the ue provided apn is authorized for lipa according to the user subscription, the mme shall use the csg subscription data to authorize the connection.
 if the subscription context does not indicate that the apn is for a pdn connection to an scef the mme allocates a bearer id, and sends a create session request (imsi, msisdn, mme teid for CP, rat type, lte-m rat type reporting to pgw flag, pdn gw address, pdn address, default eps bearer qos, pdn type, subscribed apn-ambr, apn, eps bearer id, protocol configuration options, handover indication, me identity, user location information (ecgi), ue time zone, user csg information, ms info change reporting support indication, selection mode, charging characteristics, trace reference, trace type, trigger id, omc identity, maximum apn restriction, dual address bearer flag) message to the serving gw. if CP ciot eps optimisation applies, then the mme shall also indicate s11-u tunnelling of nas user data and send its own s11-u ip address and mme dl teid for dl data forwarding by the sgw.
 if the mme determines the pdn connection shall only use the CP ciot eps optimisation, the mme shall include a CP only pdn connection indicator in create session request.
 for pdn type "non-ip", if the apn subscription data indicate a scef connection needs to be used, then the mme allocates an eps bearer identity for the default bearer associated with the ue and established connection to the scef address indicated in subscription data according to ts?23.682?[74] and the steps 2,3,4,5,6 are not executed. the rest of the interactions with the ue apply as specified below.
 the rat type is provided in this message for the later pcc decision. the rat type shall enable nb-iot, lte-m and wb-e-utran to be differentiated by the pdn-gw the msisdn is included if the mme has it stored for that ue. handover indication is included if the request type indicates "handover". selection mode indicates whether a subscribed apn was selected, or a non-subscribed apn sent by the ue was selected. the p gw may use selection mode when deciding whether to accept or reject the default bearer activation. for example, if an apn requires subscription, the p gw is configured to accept only the default bearer activation that requests a subscribed apn as indicated by selection mode. charging characteristics indicates which kind of charging the bearer context is liable for.
 the charging characteristics for the ps subscription and individually subscribed apns as well as the way of handling charging characteristics and whether to send them or not to the p gw is defined in ts?32.251?[44]. the mme shall include trace reference, trace type, trigger id, and omc identity if s gw and/or p gw trace is activated. the mme shall copy trace reference, trace type, and omc identity from the trace information received from the hlr or omc.
 the maximum apn restriction denotes the most stringent restriction as required by any already active bearer context. if there are no already active bearer contexts, this value is set to the least restrictive type (see clause?15.4 of ts?23.060?[7]). if the p gw receives the maximum apn restriction, then the p gw shall check if the maximum apn restriction value does not conflict with the apn restriction value associated with this bearer context request. if there is no conflict the request shall be allowed, otherwise the request shall be rejected with sending an appropriate error cause to the ue.
 if the pdn subscription context contains a subscribed ipv4 address and/or ipv6 prefix, the mme indicates it in the pdn address. the mme may change the requested pdn type according to the subscription data for this apn as described in clause?5.3.1.1. the mme shall set the dual address bearer flag when the pdn type is set to ipv4v6 and all sgsns which the ue may be handed over to are release?8 or above supporting dual addressing, which is determined based on node pre-configuration by the operator.
 if there is an apn rate control status in the mme mm context for the ue, the mme forwards it to the sgw.
3. the serving gw creates a new entry in its eps bearer table and sends a create session request (imsi, msisdn, serving gw address for the UP, serving gw teid of the UP, serving gw teid of the CP, rat type, default eps bearer qos, pdn type, pdn address, subscribed apn-ambr, apn, bearer id, protocol configuration options, handover indication, me identity, user location information (ecgi), ue time zone, user csg information, ms info change reporting support indication, pdn charging pause support indication, selection mode, charging characteristics, trace reference, trace type, trigger id, omc identity, maximum apn restriction, dual address bearer flag, apn rate control status) message to the pdn gw indicated in the pdn gw address received in the previous step. after this step, the serving gw buffers any downlink packets it may receive from the pdn gw until receives the message in step 13 below. the msisdn is included if received from the mme. if the handover indication is included, the serving gw includes it in the create session request message.
 if the serving gw has received the CP only pdn connection indicator in step?2, the serving gw informs the pdn gw this information in create session request. the serving gw and pdn gw shall indicate the use of cp only on their cdrs.
 p-gws shall not perform any checks of maximum apn restriction if create default bearer request includes emergency apn.
 if the pdn gw detects that the 3gpp ps data off ue status has changed, the pdn gw shall indicate this event to the charging system for offline and online charging.
4. if dynamic pcc is deployed and the handover indication is not present, the pdn gw may employ an ip can session establishment procedure as defined in ts?23.203?[6] with the pcrf to get the default pcc rules for the ue. this may lead to the establishment of a number of dedicated bearers following the procedures defined in clause 5.4.1 in association with the establishment of the default bearer which is described in annex?f.
 the rat type is provided to the pcrf by the pdn gw if received by the previous message. if the pdn gw/pcef is configured to activate predefined pcc rules for the default bearer, the interaction with the pcrf is not required (e.g. operator may configure to do this) at the moment.
 the etftu is provided to the pcrf by the pdn?gw, if received in the pco from the ue and the pdn?gw supports the extended tft filter format. if the pcrf decides that the pdn connection may use extended tft filters, it shall return the etftn indicator to the pdn?gw for inclusion in the protocol configuration options returned to the ue.
 the pcrf may modify the apn-ambr and the qos parameters (qci and arp) associated with the default bearer in the response to the pdn gw as defined in ts?23.203?[6].
 if the pcc is configured to support emergency services and dynamic pcc is deployed, the pcrf, based on the emergency apn, sets the arp of the pcc rules to a value that is reserved for emergency services and the authorization of dynamic pcc rules as described in ts?23.203?[6]. if dynamic pcc is not deployed, the pdn gw is configured to set the arp to a value that is reserved for emergency services.
 if dynamic pcc is deployed and the handover indication is present, the pdn gw executes a pcef initiated ip can session modification procedure with the pcrf as specified in ts?23.203?[6] to report the new ip can type. depending on the active pcc rules, the establishment of dedicated bearer for the ue may be required. the establishment of those bearers shall take place in combination with the default bearer activation as described in annex f. this procedure can continue without waiting for a pcrf response. if changes to the active pcc rules are required, the pcrf may provide them after the handover procedure is finished.
 in both cases (handover indication is present or not), if dynamic pcc is not deployed, the pdn gw may apply local qos policy. this may lead to the establishment of a number of dedicated bearers for the ue following the procedures defined in clause?5.4.1 in combination with the establishment of the default bearer, which is described in annex?f.
 if the csg information reporting triggers are received from the pcrf, the pdn gw should set the csg information reporting action ie accordingly.
 if 3gpp ps data off status is received in the pco from the ue and pdn gw supports 3gpp ps data off, the pdn gw shall provide the 3gpp ps data off status to the pcrf. if the pcrf supports 3gpp ps data off, it shall return 3gpp ps data off support to the pdn gw for inclusion in the pco returned to the ue.
 if the 3gpp ps data off ue status indicates that 3gpp ps data off is activated for the ue, the pdn gw shall enforce the pcc rules for downlink traffic to be used when 3gpp ps data off is activated.
 if received, the pdn gw may take the apn rate control status into account when encoding the apn rate control parameters in protocol configuration options and when enforcing the apn rate control as described in clause?4.7.7.3.
5. the p gw creates a new entry in its eps bearer context table and generates a charging id for the default bearer. the new entry allows the p gw to route UP pdus between the s gw and the packet data network, and to start charging. the way the p gw handles charging characteristics that it may have received is defined in ts?32.251?[44].
 the pdn gw returns a create session response (pdn gw address for the UP, pdn gw teid of the UP, pdn gw teid of the CP, pdn type, pdn address, eps bearer id, eps bearer qos, protocol configuration options, charging id, prohibit payload compression, apn restriction, cause, ms info change reporting action (start) (if the pdn gw decides to receive ue's location information during the session), csg information reporting action (start) (if the pdn gw decides to receive ue's user csg information during the session), presence reporting area action (if the pdn gw decides to receive notifications about a change of ue presence in presence reporting area), pdn charging pause enabled indication (if pdn gw has chosen to enable the function), apn-ambr, delay tolerant connection) message to the serving gw. the pdn gw takes into account the received pdn type, the dual address bearer flag and the policies of operator when the pdn gw selects the pdn type to be used as follows. if the received pdn type is ipv4v6 and both ipv4 and ipv6 addressing are possible in the pdn but the dual address bearer flag is not set, or only single ip version addressing for this apn is possible in the pdn, the pdn gw selects a single ip version (either ipv4 or ipv6). if the received pdn type is ipv4 or ipv6, the pdn gw uses the pdn type if it is supported in the pdn, otherwise an appropriate error cause will be returned. the pdn gw allocates a pdn address according to the selected pdn type if the pdn gw has selected a pdn type different from the received pdn type, the pdn gw indicates together with the pdn type ie a reason cause to the ue why the pdn type has been modified, as described in clause?5.3.1.1. pdn address may contain an ipv4 address for ipv4 and/or an ipv6 prefix and an interface identifier. if the pdn has been configured by the operator so that the pdn addresses for the requested apn shall be allocated by usage of dhcpv4 only, or if the pdn gw allows the ue to use dhcpv4 for address allocation according to the address allocation preference received from the ue, the pdn address shall be set to 0.0.0.0, indicating that the ipv4 address shall be negotiated by the ue with after completion of the default bearer activation procedure. for external pdn addressing for ipv6, the pdn gw obtains the ipv6 prefix from the external pdn using either radius or diameter client function. in the pdn address field of the create session response, the pdn gw includes the interface identifier and ipv6 prefix. the pdn gw sends router advertisement to the ue after default bearer establishment with the ipv6 prefix information for all cases. if the pdn address is contained in the create session request, the pdn gw shall allocate the ipv4 address and/or ip6 prefix contained in the pdn address to the ue. if handover indication indicates "handover", the pdn address information shall contain the same ip address the ue obtained during pdn connectivity establishment over the non-3gpp access. the pdn gw derives the bcm based on the nrsu and operator policy. the pdn?gw derives whether the extended tft filter format is to be used based on the etftu, etftn received from the pcrf and operator policy. protocol configuration options contains the bcm, etftn as well as optional pdn parameters that the p gw may transfer to the ue. these optional pdn parameters may be requested by the ue, or may be sent unsolicited by the p gw. protocol configuration options are sent transparently through the mme.
 if the pdn type is non-ip, the pdn-gw uses the apn and imsi to determine what local actions to perform before answering the serving gw.
 the pdn gw includes a delay tolerant connection indication if the pdn gw supports receiving a rejection cause from the sgw indicating that the ue is temporarily not reachable due to power saving, and holding mobile terminated procedures until the pdn gw receives a message indicating that the ue is available for end to end signalling.
 when the handover indication is present, the pdn gw does not yet send downlink packets to the s gw; the downlink path is to be switched at step?13a.
 if the pdn gw is an l-gw, it does not forward downlink packets to the s-gw. the packets will only be forwarded to the henb at step?10 via the direct UP path for local ip access.
 if the 3gpp ps data off ue status was present in the create session request pco, and if the network supports 3gpp ps data off, the pdn gw shall include the 3gpp ps data off support indication in the create session response pco.
6. the serving gw returns a create session response (pdn type, pdn address, serving gw address for UP, serving gw teid for UP, serving gw teid for CP, eps bearer id, eps bearer qos, pdn gw address and teid (gtp-based s5/s8) or gre key (pmip-based s5/s8) at the pdn gw for uplink traffic, protocol configuration options, prohibit payload compression, apn restriction, cause, ms info change reporting action (start), csg information reporting action (start), presence reporting area action, apn-ambr, dtc) message to the mme. the dl tft for pmip-based s5/s8 is obtained from interaction between the serving gw and the pcrf as described in clause 5.6.1 of ts?23.402?[2], when pcc is deployed; otherwise, the dl tft ie is wildcarded, matching any downlink traffic. if the ue indicates the request type as "handover", this message also serves as an indication to the mme that the s5/s8 bearer setup and update has been successful. at this step the gtp tunnel(s) over s5/s8 are established
 if CP ciot eps optimisation applies, and if mme doesn't include CP only pdn connection indicator in the create session request:
- if separation of s11-u from s1-u is required, the serving gw shall include the serving gw ip address and teid for s11-u and additionally the serving gw ip address and teid for s1-u in the create session response.
- otherwise if separation of s11-u from s1-u is not required, the serving gw includes the serving gw ip address and teid for s11-u in create session response.
7. if an apn restriction is received, then the mme shall store this value for the bearer context and the mme shall check this received value with the stored value for the maximum apn restriction to ensure there are no conflicts between values. if the consequence of this check results in the pdn connectivity being rejected, the mme shall initiate a bearer deactivation and return an appropriate error cause. if the pdn connectivity request is accepted, the mme shall determine a (new) value for the maximum apn restriction. if there is no previously stored value for maximum apn restriction, then the maximum apn restriction shall be set to the value of the received apn restriction.
 the p-gw shall ignore maximum apn restriction if the request includes the emergency apn.
 for emergency service mme shall not deactivate bearer(s), if present, to maintain valid apn restriction combination.
 if the ms info change reporting action (start) and/or the csg information reporting action (start) are received for this bearer context, then the mme shall store this for the bearer context and the mme shall report to that p-gw via the s-gw whenever a ue's location information and/or user csg information change occurs that meets the p-gw request, as described in clause?15.1.1a of ts?23.060?[7]. if presence reporting area action is received for this bearer context, the mme shall store this information for the bearer context and shall report to that p-gw via the s-gw whenever a change of ue presence in a presence reporting area is detected, as described in clause?5.9.2.2.
 the mme may need to modify the ue ambr, which has been assigned to the enodeb, based on the subscribed ue-ambr and the updated set of apn-ambrs in use. the principles to determine the ue-ambr are described in clause?4.7.3.
 the mme sends pdn connectivity accept session management request (apn, pdn type, pdn address, eps bearer id, protocol configuration options, header compression configuration, CP only indicator) message to the ue. if the pdn connection uses the UP over the radio, this message is contained in an s1_mme control message bearer setup request (eps bearer qos, ue-ambr, pdn connectivity accept, s1-teid) to the enodeb. however, if CP ciot eps optimisation applies to the pdn connection, an s1-ap downlink nas transport message is used. the s1-ap initial context setup request message includes the teid at the serving gw used for UP and the address of the serving gw for UP. if the pdn type is set to "non-ip" the mme includes it in the s1-ap initial context setup request so that the enodeb disables header compression. in addition, if the pdn connection is established for local ip access, the corresponding s1 initial context setup request message includes a correlation id for enabling the direct UP path between the henb and the l-gw. if the pdn connection is established for sipto at the local network with l gw function collocated with the (h)enb, the corresponding s1-ap initial context setup request includes a sipto correlation id for enabling the direct UP path between the (h)enb and the l-gw. lipa and sipto do not apply to CP ciot eps optimisation.
note?5: in this release of the 3gpp specification the correlation id and sipto correlation id is set equal to the UP pdn gw teid (gtp-based s5) or gre key (pmip-based s5) that the mme has received in step?6.
 in the pdn connectivity accept message, the mme does not include the ipv6 prefix within the pdn address. the mme includes the apn-ambr and the eps bearer qos parameter qci into the session management request. furthermore, if the ue has utran or geran capabilities and the network supports mobility to utran or geran, the mme uses the eps bearer qos parameters to derive the corresponding pdp context parameters qos negotiated (r99 qos profile), radio priority, packet flow id and ti and includes them in the session management request. if the ue indicated in the ue network capability that it does not support bss packet flow procedures, then the mme shall not include the packet flow id. mme will not send the s1 bearer setup request message until any outstanding s1 bearer setup response message for the same ue has been received or timed out. if the apn-ambr has changed the mme may update the ue-ambr if appropriate. the mme may include an indication whether the traffic of this pdn connection is allowed to be offloaded to wlan, as described in clause?4.3.23. if the ue has indicated pdn type "non-ip", the mme and pdn gw shall not change pdn type.
 if the mme or pdn gw has changed the pdn type, an appropriate reason cause shall be returned to the ue as described in clause?5.3.1.1.
 if CP ciot eps optimisation applies for an ip pdn connection, and the ue has sent in the pdn connectivity request the header compression configuration, the mme shall include the header compression configuration in the pdn connectivity accept message. the mme also binds the uplink and downlink rohc channels to support header compression feedback signalling. if the ue has included rohc context setup parameters in header compression configuration in the pdn connectivity request, the mme may acknowledge rohc context setup parameters. if the rohc context is not established during the pdn connection establishment procedure, before using the compressed format for sending the data, the ue and the mme need to establish the rohc context with rohc ir packet based on header compression configuration.
 if the mme based on local policy determines the pdn connection shall only use the CP ciot eps optimisation, the mme shall include a CP only indicator in the session management request. for pdn connections with an scef, the mme shall always include the CP only indicator. if there is an existing sgi pdn connection for this ue for which the mme included a CP only indicator, the mme shall include it also for the additional sgi pdn connection. if the mme did not include a CP only indicator for any of the existing sgi pdn connections of this ue, the mme shall not include it for the additional sgi pdn connection. a ue receiving the CP only indicator, for a pdn connection shall only use the CP ciot eps optimisation for this pdn connection.
note?6: the mme decision whether to include a CP only indicator to an sgi pdn connection for a ue that previously had no sgi connections will impact other potential subsequent sgi pdn connections for that ue.
8. if the enodeb received an s1-ap initial context setup request, the enodeb sends rrc connection reconfiguration to the ue including the pdn connectivity accept message.
 if the enodeb received an s1-ap downlink nas transport message containing the nas pdn connectivity accept message, the enode b sends a rrc direct transfer message to the ue and the steps 9 and 10 are not executed.
 the ue shall store the qos negotiated, radio priority, packet flow id and ti, which it received in the session management request ie, for use when accessing via geran or utran. the ue may provide eps bearer qos parameters to the application handling the traffic flow. the application usage of the eps bearer qos is implementation dependent. the ue shall not reject the rrc connection reconfiguration on the basis of the eps bearer qos parameters contained in the session management request.
 if the ue receives an ipv4 address set to 0.0.0.0, it may negotiate the ipv4 address with dhcpv4 as specified in ts?29.061?[38], if the ue receives an ipv6 interface identifier, it may wait for the router advertisement from the network with the ipv6 prefix information or it may send a router solicitation if necessary.
note?7: the ip address allocation details are described in clause 5.3.1 on "ip address allocation".
9. the ue sends the rrc connection reconfiguration complete to the enodeb.
10. the enodeb send an s1-ap bearer setup response to the mme. the s1-ap message includes the teid of the enodeb and the address of the enodeb used for downlink traffic on the s1_u reference point.
 if the correlation id or sipto correlation id is included in the bearer setup request, the enodeb shall use the included information to establish a direct UP path to the l-gw and forward uplink data for local ip access or sipto at the local network with l-gw function collocated with the (h)enb accordingly.
11. the ue nas layer builds a pdn connectivity complete message including eps bearer identity. the ue then sends a direct transfer (pdn connectivity complete) message to the enodeb.
12. the enodeb sends an uplink nas transport (pdn connectivity complete) message to the mme.
 after the pdn connectivity accept message and once the ue (if applicable to the pdn type) has obtained a pdn address information, the ue can then send uplink packets towards the enodeb which may then be tunnelled by the mme to the serving gw and pdn gw, or transferred by the mme to an scef (see ts?23.682?[74]), as per subscription information related to apn discussed above in step?2. if the ue requested for a dual address pdn type (ipv4v6) to a given apn and was granted a single address pdn type (ipv4 or ipv6) by the network with a reason cause indicating that only single ip version per pdn connection is allowed, the ue should request for the activation of a parallel pdn connection to the same apn with a single address pdn type (ipv4 or ipv6) other than the one already activated. if the ue receives no reason cause in step 8 in response to a ipv4v6 pdn type and it receives an ipv6 interface identifier apart from the ipv4 address or 0.0.0.0 in the pdn address field, it considers that the request for a dual address pdn was successful. it can wait for the router advertisement from the network with the ipv6 prefix information or it may send router solicitation if necessary.
13. upon reception of the bearer setup response message in step 10 and the pdn connectivity complete message in step?12, the mme sends a modify bearer request (eps bearer identity, enodeb address, enodeb teid, handover indication, presence reporting area information) message to the serving gw. if the CP ciot eps optimisation applies and the pdn connection is not served via a scef type of connectivity, steps 13 and 14 are executed only if the mme needs to report a change of ue presence in presence reporting area, otherwise, if the pdn connection is served by scef, steps 13,14, 15, and 16 are not executed. if request type indicates "handover", the handover indication is also included. if the mme has been requested to report a change of ue presence in presence reporting area, the mme includes in this message the presence reporting area information comprising the pra identifier(s) and indication(s) on whether the ue is inside or outside the area(s). when receiving the request for reporting change of ue presence in presence reporting area, and the mme decides not to activate reporting ue presence in one or more of the received presence reporting area(s), the mme reports also the inactive presence reporting area(s) in this message.
13a. if the handover indication is included in step?13, the serving gw sends a modify bearer request (handover indication) message to the pdn gw to prompt the pdn gw to tunnel packets from non 3gpp ip access to 3gpp access system and immediately start routing packets to the serving gw for the default and any dedicated eps bearers established. if presence reporting area information is included in step?13, the serving gw sends a modify bearer request (presence reporting area information) message to the pdn gw.
note?8: the pdn gw forwards the presence reporting area information to the pcrf, to the ocs or to both as defined in ts?23.203?[6].
13b. the pdn gw acknowledges by sending modify bearer response to the serving gw.
14. the serving gw acknowledges by sending modify bearer response (eps bearer identity) to the mme. the serving gw can then send its buffered downlink packets.
15. after the mme receives modify bearer response in step 14, if request type does not indicate handover and an eps bearer was established and if the subscription data indicates that the user is allowed to perform handover to non-3gpp accesses and if this is the first pdn connection associated with this apn and if the mme selected a pdn gw that is different from the pdn gw identity which was previously indicated by the hss in the pdn subscription context, the mme shall send a notify request including the pdn gw address and the apn to the hss for mobility with non-3gpp accesses. the message shall include information that identifies the plmn in which the pdn?gw is located.
 for an unauthenticated or roaming ue, if the request type of the ue requested connectivity procedure indicates "emergency", the mme shall not send any notify request to the hss. for a non-roaming authenticated ue, based on operator configuration (e.g. on whether voice over wlan is supported or not by the operator), if the request type indicates "emergency", the mme may send a notify request to the hss including the "pdn gw currently in use for emergency services", which comprises the pdn gw address and an indication that the pdn connection is for emergency services. the hss shall store it as part of the ue context for emergency services.
16. in the case of non-emergency services, the hss stores the pdn gw identity and the associated apn. in the case of emergency services, the hss stores the "pdn gw currently in use for emergency services". then the hss sends a notify response to the mme.
note?9: for handover from non-3gpp access, the pdn gw initiates resource allocation deactivation procedure in the trusted/untrusted non-3gpp ip access as specified in ts?23.402?[2].
5.10.3 ue or mme requested pdn disconnection
the ue or mme requested pdn disconnection procedure for an e-utran is depicted in figure 5.10.3-1. the procedure allows the ue to request for disconnection from one pdn. bearers including the default bearer of this pdn shall be deleted during this procedure. the procedure also allows the mme to initiate the release of a pdn connection.
this procedure is also used as part of the sipto function when the mme determines that gw relocation is desirable. in this situation the mme deactivates the pdn connection(s) relevant to sipto-allowed apn(s) using the "reactivation requested" cause value, and the ue should then re-establish those pdn connection(s).
note?1: the deactivation with reactivation requested does not work with pre-rel 9 lte ues.
it shall be possible to configure the mme to deactivate a pdn connection, for pdn gw relocation due to sipto above ran, only when ue is in ecm-idle mode or during a tracking area update procedure without established rab(s).
this procedure is not used to terminate the last pdn connection unless "attach without pdn connectivity is supported" in the preferred network behaviour indicated by the ue at attach time is supported by the network and the ue at any time it requires the last pdn connection to be disconnected. the ue uses the ue-initiated detach procedure in clause?5.3.8.2 to disconnect the last pdn connection. the mme uses the mme-initiated detach procedure in clause?5.3.8.3 to release the last pdn connection.

figure 5.10.3-1: ue or mme requested pdn disconnection
note?2: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?3, 4 and 5 concern gtp based s5/s8.
note?3: if after step?6, the mme determines that pdn being disconnected has no active bearers in the e-utran, (e.g. because data is transported using CP ciot eps optimisation) steps 7, 8. 10a and 10b are modified to only transfer the indicated esm signalling messages and steps 9a and 9b are skipped.
1. the procedure is triggered by either step?1a or step?1b.
1a. the ue initiates the ue requested pdn disconnection procedure by the transmission of a pdn disconnection request (lbi) message. the lbi indicates the default bearer associated with the pdn connection being disconnected. if the ue was in ecm-idle mode, this nas message is preceded by the service request procedure if any of the exiting pdn connections were using the UP without ciot eps optimisation, or, if the UP was used just with UP ciot eps optimisations, a resume procedure is executed instead.
1b. the mme decides to release the pdn connection. this may be e.g. due to change of subscription, lack of resources, due to sipto in case the pdn connection serves a sipto-allowed apn or on receiving a pdn gw restart notification from the serving gw as specified in ts?23.007?[72]. if the ue is in ecm-idle state and the reason for releasing pdn connection is "reactivation requested" e.g. due to sipto, the mme initiates paging via network triggered service request procedure in clause?5.3.4.3 from step?3a onwards in order to inform ue of the request.
2. if the plmn has configured secondary rat usage reporting, the mme shall perform step?7 through 10 before step?2 onwards. if the pdn connection was served by a p-gw, the eps bearers in the serving gw for the particular pdn connection are deactivated by the mme by sending delete session request (cause, lbi, user location information (ecgi), secondary rat usage data) to the serving gw. this message indicates that all bearers belonging to that pdn connection shall be released. if the ue time zone has changed, the mme includes the ue time zone ie in this message. for pdn connection to the scef the mme indicates to the scef the connection for the ue is no longer available according to ts?23.682?[74] and steps 2,3,4,5,6 are not executed. if the mme received secondary rat usage data in step?9b, the mme shall include it in this delete session request message.
3. the serving gw sends delete session request (cause, lbi, user location information (ecgi), secondary rat usage data) to the pdn gw. the s gw also includes user location information ie and/or ue time zone ie if it is present in step?2. the serving gw also includes the secondary rat usage data in this message if it was present in step?2 and if pdn gw secondary rat usage data reporting is active.
4. the pdn gw acknowledges with delete session response (optionally, apn rate control status).
5. the pdn gw employs the pcef-initiated ip can session termination procedure as defined in ts?23.203?[6] to indicate to the pcrf that the ip-can session is released if pcrf is applied in the network. if requested the pdn?gw indicates user location information and/or ue time zone information to the pcrf as defined in ts?23.203?[6].
6. the serving gw acknowledges with delete session response (optionally, apn rate control status).
 if received, the mme stores the apn rate control status in the mm context.
7. if the ue is in ecm idle state and the pdn disconnection is decided by the mme, the mme shall delete the corresponding contexts of the pdn connection locally, steps?7 to 10b are skipped except if the mme has decided to restore certain pdn connections as specified in ts?23.007?[72] or for other reasons e.g. sipto. the mme initiates the deactivation of all radio bearers associated with the pdn connection to the enodeb by sending the deactivate bearer request message to the enodeb. the mme shall re-calculate the ue-ambr (see clause?4.7.3). this s1-ap message carries the list of eps bearers to be released, the new ue-ambr, and a nas deactivate eps bearer context request (lbi) message. the mme builds a nas message deactivate eps bearer context request including the eps bearer identity, and includes it in the s1-ap deactivate bearer request message.
 if the network wants to trigger gw relocation (e.g. for sipto), the nas message deactivate eps bearer context request includes the request for reactivation of the same pdn connection via the same apn by the ue.
 if the mme released the pdn connection due to failed bearer set up during handover, the ue and the mme deactivate the failed contexts locally without peer-to peer esm signalling.
note?4: if the ue is in ecm idle state and the pdn disconnection is decided by the mme, the eps bearer state is synchronized between the ue and the network at the next ecm idle to ecm connected transition (e.g. service request or tau procedure).
8. the enodeb sends the rrc connection reconfiguration message including the corresponding bearers to be released and the nas deactivate eps bearer context request (lbi) message to the ue.
9a. the ue releases all resources corresponding to the pdn connection and acknowledges this by sending the rrc connection reconfiguration complete message to the enodeb.
9b. the enodeb sends an acknowledgement of the deactivation to the mme. if the plmn has configured secondary rat usage reporting and the enodeb has secondary rat usage data to report, the secondary rat usage data is included.
10a. the ue nas layer builds a deactivate eps bearer context accept message. the ue then sends a direct transfer (deactivate eps bearer context accept) message to the enodeb.
 if the deactivate eps bearer context request message from the mme indicated reactivation requested, the ue starts the ue initiated pdn connection request procedure as specified in clause?5.10.2 by using the same apn of the released pdn connection.
10b. the enodeb sends an uplink nas transport (deactivate eps bearer context accept) message to the mme.
the mme determines the maximum apn restriction for the remaining pdn connections and stores this new value for the maximum apn restriction.
5.10.4 mme triggered serving gw relocation
the mme triggered serving gw relocation procedure for e-utran is depicted in figure 5.10.4-1. the procedure allows the mme to trigger serving gw relocation due to events other than those described in the mobility scenarios (see clause?5.3.3.1 and clause?5.5.1). such scenario exists during the establishment of a sipto at local network pdn connection with stand-alone gw or during the establishment of a sipto above ran pdn connection.

figure 5.10.4-1: mme triggered serving gw relocation
1. the serving gw relocation procedure may be triggered by the mme due to events that may benefit from a serving gw relocation other than those described in the mobility events scenarios.
2. if the mme determines that the serving gw is to be relocated then it selects a new serving gw according to clause?4.3.8.2. the mme sends a create session request (bearer context(s) with pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic, enodeb address(es) and teids for downlink UP for the existing eps bearers, the protocol type over s5/s8, serving network) message per pdn connection to the new serving gw. the new serving gw allocates the s gw addresses and teids for the uplink traffic on s1_u reference point (one teid per bearer). the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface. if the pdn gw requested ue's location info, the mme also includes the user location information ie in this message. if the pdn gw requested ue's user csg information (determined from the ue context), the mme includes the user csg information ie in this message if the user csg information has changed.
3. the new serving gw assigns addresses and teids (one per bearer) for downlink traffic from the pdn gw. the serving gw allocates dl teids on s5/s8. it sends a modify bearer request (serving gw addresses for UP and teid(s), serving network) message per pdn connection to the pdn gw(s). the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if it is present in step?2. the pdn gw updates its context field and returns a modify bearer response (charging id, msisdn, etc.) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. the pdn gw starts sending downlink packets to the new gw using the newly received address and teids. these downlink packets will use the new downlink path via the new serving gw to the enodeb. this step?is performed for all connected pdn-gws for that specific ue.
4. the new serving gw sends a create session response (serving gw addresses and uplink teid(s) for UP) message back to the mme. the mme starts a timer, to be used in step?6.
5. the mme sends a bearer modify request (serving gw addresses and uplink teid(s) for UP, secondary rat usage data request) message to enodeb. the enodeb starts using the new serving gw address(es) and teid(s) for forwarding subsequent uplink packets and sends a bearer modify response message to the mme. if the plmn has configured secondary rat usage reporting, the mme may request the enodeb for secondary rat usage data in the bearer modify request message. if the enodeb has secondary rat usage data, it provides it in the bearer modify response message.
5a. if secondary rat usage data is included in the previous message and if pdn gw secondary rat usage reporting is active, the mme uses the secondary rat usage data reporting procedure as described in clause?5.7a.3 figure 5.7a.3-2 to provide this information to the serving gw and pdn gw. the mme includes a flag that the serving gw shall not process this information and forward it to the pdn gw.
6. when the timer has expired after step?4, the mme releases the bearer(s) in the old serving gw by sending a delete session request message (cause, operation indication, secondary rat usage data). the operation indication flag is not set, that indicates to the old serving gw that the old serving gw shall not initiate a delete procedure towards the pdn gw. the old serving gw acknowledges with delete session response messages. the mme includes the secondary rat usage data if the enodeb had provided it to the mme in step?5.
if the serving gw relocation procedure towards a new serving gw fails, based on operator policy, the mme should go back to the old serving gw and disconnects the affected pdn connections (e.g. sipto at local network) that are no longer allowed to remain connected.
5.11 ue capability handling
5.11.1 general
the ue capability information is made up of the ue radio capability information and the ue core network capability information.
the ue radio capability for paging information is separate from both the ue radio capability information and the ue core network capability information. the ue radio capability for paging information may be used to enhance the paging in the e-utran.
5.11.2 ue radio capability handling
the ue radio capability information contains information on rats that the ue supports (e.g. power class, frequency bands, etc). consequently, this information can be sufficiently large (e.g. >50 octets for a ue supporting a small number of frequency bands; or multiple kilo bytes for a ue supporting many frequency bands and a large multiplicity of combinations of these frequency bands) that it is undesirable to send it across the radio interface at every transition from ecm idle to ecm connected. to avoid this radio overhead, the mme stores the ue capability information during ecm idle state and the mme shall, if it is available, send its most up-to-date ue radio capability information to the e utran in the s1 interface initial context setup request message unless the ue is performing an attach procedure or a tracking area update procedure for the "first tau following geran/utran attach" or for a "ue radio capability update".
note?1: the utran radio capabilities are excluded from the information stored in the mme owing to issues with the handling of dynamic umts security parameters.
if a ue supports both nb-iot and wb-e-utran, the ue handles the ue radio capability information as follows:
- when the ue is camping on nb-iot the ue provides only nb-iot ue radio capabilities to the network.
- when the ue is camping on wb-e-utran, the ue provides ue radio capabilities including wb-e-utran ue radio capabilities but not nb-iot ue radio capabilities to the network.
in order to handle the distinct ue radio capabilities, the mme stores a separate nb-iot specific ue radio capability information when the ue provides the ue radio capability information while camping on nb-iot.
when the ue is camping on nb-iot, the mme sends, if available, the nb-iot specific ue radio capability information to the e-utran.
when the ue is camping on wb-e-utran, the mme sends, if available, ue radio capabilities including wb-e-utran ue radio capabilities but not nb-iot radio capabilities.
for a ue that supports nr as a secondary rat, the ue's nr radio capabilities are contained within the ue radio capability ie.
if the ue is performing an attach procedure or a tracking area update procedure for the "first tau following geran/utran attach" or for "ue radio capability update", the mme shall delete (or mark as deleted) any ue radio capability information that it has stored, and, if the mme sends an s1 interface initial context setup request or ue radio capability match request message during that procedure, the mme shall not send any ue radio capability information to the e utran in that message. this triggers the e utran to request the ue radio capability from the ue and to upload it to the mme in the s1 interface ue capability info indication message. the size of the ue radio capability information may be greater than can be carried in single rrc message but less than the maximum size of messages on the s1 interface. in this case, to obtain the information that it needs the ran should send multiple requests to the ue for different sub-sets of ue radio capability information (e.g. one request per rat). then the ran shall combine these subsets (excluding utran and nb-iot capabilities) into a single ue radio capability ie and upload it to the mme in the s1 interface ue capability info indication message.
the mme stores the ue radio capability information, and include it in further initial context setup request or ue radio capability match request messages in other cases than attach procedure, tracking area update procedure for the "first tau following geran/utran attach" and "ue radio capability update" procedure.
if the ue is performing a service request (or other) procedure and the mme does not have ue radio capability information available (or it is available, but marked as "deleted"), then the mme sends an s1 interface initial context setup request message to the e utran without any ue radio capability information in it. this triggers the e utran to request the ue radio capability from the ue and upload it to the mme in the s1 interface ue capability info indication message.
note?2: this use of the initial context setup request message means that for a signalling only procedure such as a periodic tracking area update, the ue radio capability would not be sent to the e utran.
note?3: if a "first tau following geran/utran attach" tracking area update is performed during ecm-connected mode, e.g. after an inter rat handover, no initial context setup request is sent and the ue radio capability information in the mme will remain deleted until the next ecm-idle to ecm-connected transition (or later, e.g. if the next activity from the ue is another tracking area update).
when the ciot eps optimisations do not apply, if the mme has not stored the ue radio capability information, in order to obtain ue radio capability for paging information, the mme can trigger the retrieval of the ue radio capability information by indicating ue radio capability request in downlink nas transport message during attach or tau procedure.
for the ciot eps optimisations, during the attach procedure or the tracking area update procedure, e.g. for the "first tau following geran/utran attach", if the mme does not send an s1 interface initial context setup request to the e-utran, the mme should obtain the ue radio capability information by sending either the downlink nas transport message indicating ue radio capability request or the connection establishment indication message without ue radio capability information included to the e-utran. this triggers the e utran to request the ue radio capability from the ue and upload it to the mme in the s1 interface ue capability info indication message, as specified in ts?36.300?[5]. in subsequent ecm connections, if the mme does not send an s1 interface initial context setup request to the e utran, the mme sends the ue radio capability to the e-utran in the connection establishment indication message or downlink nas transport message.
the ue radio capability is not provided directly from one cn node to another. it will be uploaded to the mme when the e-utran requests the ue radio capability information from the ue.
during handover via the mme (both intra rat and inter rat), the radio capability information for the source and target 3gpp rats (with the possible exception of utran and e-utran) are transferred in the "source to target transparent container". information on additional 3gpp rats is optionally transferred in the "source to target transparent container".
at handover, transfer of the radio capability information related to the source and/or additional rats is beneficial as it avoids the need for the target rat to retrieve the information from the ue prior to a subsequent inter-rat handover. however, there may be situations where the size of the ue radio capability may be too large for the information on all of the ue's rats to be carried in a single message on one or more of the network interfaces involved in the handover. hence, the source ran shall ensure that the size of the ue radio capability information does not cause the size of the "source to target transparent container" to exceed the limits that can be handled by interfaces involved in the handover (e.g. iu interface (ts?25.413?[22]) and, following srvcc, e interface (ts?29.002?[86])). this may result in some radio capability information being omitted from the "source to target transparent container" at inter-rat handover. in this situation, the ue might be subject to an inter-rat handover to e-utran via the mme which has the context stored for that ue, and, the mme may detect that the "source to target transparent container" is smaller than the ue radio capability stored in that ue's context. the mme may then add the full ue radio capability as a standalone information element in the s1-ap handover request message. as an implementation option, the enb may use this mme supplied information to avoid retrieving any missing ue radio capability information from the ue.
in the case that a source ran node omits some radio capability information from the "source to target transparent container" at handover, the source ran node shall ensure that any future target ran node can detect that that radio capability information has been omitted.
owing to issues with dynamic utran security parameters, special rules apply to the handling of the utran radio capability information at inter-rat handover (see e.g. the handoverpreparationinformation message description in ts?36.331?[37] and the usage of the ps handover complete ack message in ts?43.129?[8] and ts?48.018?[42])
to allow for the addition of future radio technologies, frequency bands, and other enhancements, the mme shall store the ue radio capability information as defined in ts?23.008?[28].
the e utran stores the ue radio capability information, received in the s1 interface initial context setup request message or obtained from the ue, for the duration of the rrc connection for that ue. before any handover attempt from e utran to utran, the e utran retrieves the ue's utran radio capabilities from the ue.
if the ue's non-utran ue radio capability information changes while in ecm-idle state (including cases of being in geran/utran coverage), the ue shall perform a tracking area update indicating "ue radio capability update" when it next returns to e utran coverage. when the ue is in ecm-idle with as information stored (as defined in clause?4.11 for UP ciot eps optimisation), nas shall trigger as to establish a new rrc connection and not resume the existing one in order to send tracking area update indicating "ue radio capability update". as a result of this, the access stratum in the ue will discard the as information and establish a new rrc connection as defined in ts?36.331?[37].
the mme may also request for voice support match information. if requested, the enb then derives and provides an indication to the mme whether the ue radio capabilities are compatible with the network configuration (e.g. whether the ue supports the frequency bands that the network may rely upon for providing "full" ps voice coverage or whether the ue supports the srvcc configuration of the network e.g. e-utran to geran) as defined in clause?5.3.14.
5.11.3 ue core network capability
the ue core network capability is split into the ue network capability ie (mostly for e-utran access related core network parameters) and the ms network capability ie (mostly for utran/geran access related core network parameters) and contains non radio-related capabilities, e.g. the nas security algorithms etc. both the ue network capability and the ms network capability are transferred between cn nodes at mme to mme, mme to sgsn, sgsn to sgsn, and sgsn to mme changes.
in order to ensure that the ue core network capability information stored in the mme is up to date (e.g. to handle the situation when the usim is moved into a different device while out of coverage, and the old device did not send the detach message; and the cases of inter-rat tracking area update), the ue shall send the ue core network capability information to the mme during the attach and non-periodic tracking area update procedure within the nas message.
the mme shall store always the latest ue core network capability received from the ue. any ue core network capability that an mme receives from an old mme/sgsn is replaced when the ue provides the ue core network capability with attach and the tracking area update signalling. the mme shall remove the stored ms network capability, if ms network capability is not included in attach or non-periodic tracking area update signaling e.g. ue is only capable of e-utran.
if the ue's ue core network capability information changes (in either ecm-connected or in ecm-idle state (including cases of being in geran/utran coverage and having isr activated)), the ue shall perform a tracking area update ('type' different to 'periodic') when it next returns to e utran coverage - see clause?5.3.3.0.
if the ue supports multiple UP radio bearers on the nb-iot rat (see ts?36.306?[82], ts?36.331?[37]), then the ue shall indicate this in the ue network capability ie.
if the ue supports dual connectivity with nr (see clause?4.3.2a), then the ue shall indicate its support in a nas indicator.
if the ue supports service gap control (see clause?4.3.17.9), then the ue shall indicate this in the ue network capability ie.
to allow for the addition of future features, the mme shall store the ue network capability and the ms network capability even if either or both is larger than specified in ts?24.008?[47]/ts?24.301?[46], up to a maximum size of 32?octets for each ie.
5.11.4 ue radio capability for paging information
the aim of this procedure is to assist the e-utran in optimising the radio paging procedures.
as specified in ts?36.413?[36] , the enb uploads the ue radio capability for paging information to the mme in the s1 interface ue capability info indication message (in a separate ie from the ue radio capability). as specified in ts?36.331?[37], the ue radio capability for paging information may contain ue radio paging information provided by the ue to the enb, and other information derived by the enb (e.g. band support information) from the ue radio capability information.
typically this is at the same time as the enb uploads the ue radio capability information. the mme stores the ue radio capability for paging information in the mme context. when it needs to page, the mme provides the ue radio capability for paging information to the enb as part of the s1 paging message. the enb may use the ue radio capability for paging information to enhance the paging towards the ue.
if the ue radio capability for paging information changes, the ue shall follow the same procedures as if the ue radio capability changes.
in order to handle the situations of connected mode inter-mme change, the ue radio capability for paging information is sent to the target mme as part of the mm context information. the ue radio capability for paging information is only applicable for mmes, i.e. it is not applicable for sgsns. therefore, it will not be included by mme during context transfers towards sgsns.
5.11.5 ue radio capability for category m differentiation
this functionality is used by the core network to be able to identify traffic to/from category m ues for charging differentiation.
the enb determines whether a ue is of category m from the ue's radio capability if ue signals one or more of the specific category m. the enb then indicates to the mme whether the ue is category m in the "ue radio capability for category m differentiation" information in s1-ap message(s) used to upload the ue radio capabilities to the mme.
typically this is at the same time as the enb uploads the ue radio capability information. the mme stores the "lte-m indication" in the mme context.
if the ue context in mme contains the "lte-m indication" the mme indicates to the s-gw that the rat type of the ue is lte-m in every create session request message and every modify bearer request message, so this is handled for charging and pcc purposes. if the mme requests the sgw to pass lte-m rat type to the pdn gw, based on operator policy (e.g. based on roaming agreements or based on the need to pass the lte-m rat type information to pgw also), the mme informs the serving gw that it is requested to relay the lte-m rat type to the pgw also. otherwise, the serving gw indicates wb-e-utran rat type to the pdn gw.
in order to handle the situations of inter-mme change, the lte-m indication is sent from the source mme to the target mme as part of the mm context information. the ue radio capability for category m differentiation is only applicable for mmes, i.e. it is not applicable for sgsns. therefore, it will not be included during context transfers from and towards sgsns.
5.12 warning message delivery
5.12.1 general
warning message delivery is similar to cell broadcast service defined in ts?23.041?[48], it permits a number of unacknowledged warning messages to be broadcast to ues within a particular area.
the maximum size of the warning message for e-utran is different from that of utran/geran.
when s1-flex is used, the enodeb may receive duplicated warning messages.
for details on the warning system message delivery, see ts?23.041?[48].
5.12.2 void

5.12.3 void

5.13 discontinuous reception and ue specific drx parameter handling
during the attach procedure in e-utran, utran and/or geran, the ue can signal its ue specific drx parameters to the core network (mme in the e-utran case and sgsn in utran/geran case).
in e-utran and utran, the ue may signal that it wishes to use the drx cycle length broadcast in the ran's system information. alternatively, the ue can propose a drx cycle length for use when not camped on an nb-iot cell. the mme shall accept the value proposed by the ue.
in each s1 interface page request message, the mme shall send the e-utran relevant information from the ue specific drx parameters (to help determine the drx cycle length) and information derived from the imsi (which defines when the ue will be awake from its sleep mode). details are specified in ts?36.304?[34]. the ue specific drx parameter is not used by the e-utran for paging from nb-iot cells (see ts?36.304?[34]).
note?1: to ease backward compatibility with pre-release?8 sgsns, the utran and e-utran drx cycle lengths are encoded in the same field within the ts?24.008?[47] drx parameter information element.
at mme to mme, mme to sgsn and sgsn to mme mobility, the ue specific drx parameters are sent from the old cn node to the new cn node as part of the mm context information and should not be sent by the ue in the tracking area update message.
note?2: it is assumed that all sgsns are release?99 or newer and hence support storage of the release?'99 encoding of the ts?24.008?[47] drx parameter information element.
during attach and tracking area update procedures performed on nb-iot cells, the normal eps procedures apply, e.g. the ue can (but need not) provide a ue specific drx parameter that applies on wb-e-utran cells.
if a cn node receives ue specific drx parameters in a dedicated message from the ue (e.g. in a tracking area update or attach message), then the cn node updates any stored information with the information supplied by the ue and uses the ue provided information in preference to any information that might be received from another cn node during the same procedure.
if the ue wishes to alter its geran or utran/e-utran ue specific drx parameters while in e-utran, then it shall send a tracking area update request message to the mme containing its new ue specific drx parameters. if isr had been activated for the ue, then the ue shall deactivate isr by setting its tin to "guti" so that the ue performs a routing area update when it next enters geran/utran coverage. when the ue performs that routing area update, the sgsn will receive the updated drx parameters within the mm context information sent by the mme and hence the ue should not include them again in the routing area update request message.
if the ue wishes to alter its e utran/utran or geran drx parameters while in geran or utran coverage, then the ue shall send a routing area update request message to the sgsn containing its new ue drx parameters. if isr has been activated, the ue shall deactivate isr by setting its tin to "p-tmsi" so that the ue performs a tracking area update when it next returns to e utran coverage. when the ue performs that tracking area update, the mme will receive the updated drx parameters within the mm context information sent by the sgsn and hence the ue should not include them again in the tracking area update message.
5.13a extended idle mode discontinuous reception (drx)
the extended idle mode drx value range is described in ts?23.682?[74].
a ue and the core network may negotiate the use of extended idle mode drx as described in ts?23.682?[74]. the mme includes the extended idle mode drx cycle length in paging message to assist the enodeb in paging the ue
for extended idle mode drx cycle length of 5.12s, the network should follow regular paging strategy as defined in clause?5.13
for extended idle mode drx cycle length of 10.24s or longer, the following applies:
 if the ue decides to request for extended idle mode drx, the ue includes an extended idle mode drx parameters information element in the attach request and/or tau request message. the ue may also include the ue specific drx parameters for regular idle mode drx according to clause?5.13. the extended idle mode drx parameters information element includes the idle mode drx length.
 the mme decides whether to accept or reject the ue request for enabling extended idle mode drx as described in ts?23.682?[74]. in case the mme accepts the extended idle mode drx, the mme based on operator policies and, if available, the extended idle mode drx cycle length value in the subscription data from the hss, may also provide different values of the extended idle mode drx parameters than what was requested by the ue. the mme taking into account the rat specific subscribed paging time window, the ues current rat (nb-iot or wb-e-utran) and local policy also assigns a paging time window length to be used, and provides this value to the ue during attach/tau procedures together with the extended idle mode drx cycle length in extended idle mode drx parameter. if the mme accepts the use of extended idle mode drx, the ue shall apply extended idle mode drx based on the received extended idle mode drx length, the ues current rat (nb-iot or wb-e-utran) and rat specific paging time window length. if the ue does not receive the extended idle mode drx parameters information element in the relevant accept message because the sgsn/mme rejected its request or because the request was received by sgsn/mme not supporting extended idle mode drx, the ue shall apply its regular discontinuous reception as defined in clause?5.13.
note: the extended idle mode drx cycle length requested by ue takes into account requirements of applications running on the ue. subscription based determination of edrx cycle length can be used in those rare scenarios when applications on ue cannot be modified to request appropriate extended idle mode drx cycle length. the network accepting extended drx while providing an extended idle mode drx cycle length value longer than the one requested by the ue, can adversely impact reachability requirements of applications running on the ue.
 when the ue has bearers for emergency bearer services, the ue and mme follow regular discontinuous reception as defined in clause?5.13 and shall not use the extended idle mode drx. extended idle mode drx parameters may be negotiated while the ue has bearers for emergency bearer services.when the bearers for emergency bearer services are released, the ue and mme shall reuse the negotiated extended idle mode drx parameters in the last tau/attach procedure.
 the ue shall include the extended idle mode drx parameters information element in each tau message if it still wants to use extended idle mode drx. at mme to mme, mme to sgsn and sgsn to mme mobility, the extended idle mode drx parameters are not sent from the old cn node to the new cn node as part of the mm context information.
 if extended idle mode drx is enabled, the mme handles paging as defined in ts?23.682?[74].
if the mme is requested to monitor reachability for data and the ue is about to become reachable for paging, the mme sends a monitoring report message to the address that was indicated in the related monitoring request as described in ts?23.682?[74].
5.14 configuration transfer procedure
the purpose of the configuration transfer is to enable the transfer of information between two enodebs at any time via s1 interface and the core network. an example of application is to exchange the enodebs ip addresses in order to be able to use x2 interface between the enodebs for self-optimised networks (son), as specified in ts?36.413?[36].
5.14.1 architecture principles for configuration transfer
configuration transfer between two enodebs follows the principles used by ran information management (rim) procedures (see clause?5.15) between utran, e-utran and geran i.e. providing a generic mechanism for the exchange of arbitrary information between applications belonging to the ran nodes. however configuration transfer is only used for intra-e-utran information exchange whereas rim procedures are designed for inter-rat information exchange involving geran/utran. such a separate procedure allows avoiding impacts to other rat access systems when transferred information is added or modified.
the information is transferred via the mme core network node(s). in order to make the information transparent for the core network, the information is included in an e-utran transparent container that includes source and target enodeb addresses, which allows the core network nodes to route the messages. if the information is to be transferred between a source enodeb and a target en-gnb via a target enodeb for dual connectivity with e-utran as master ran node and nr as secondary ran node as defined in ts?37.340?[85], the source enodeb indicates the target en-gnb and may indicate the connected target enodeb as described in ts?36.300?[5], and the target enodeb further transfers the e-utran transparent container to the en-gnb transparently. the mechanism is depicted in figure?5.14 1. an example for such transferred information is the son information, as specified in ts?36.413?[36].

figure 5.14-1: inter e-utran configuration transfer basic network architecture
the e-utran transparent containers are transferred from the source e-utran node to the destination e-utran node by use of configuration transfer messages.
an enb configuration transfer message is used from the enodeb to the mme over s1 interface, a mme configuration transfer message is used from the mme to the enodeb over s1 interface, and a configuration transfer tunnel message is used to tunnel the e-utran transparent container from a source mme to a target mme over the s10 interface.
each configuration transfer message carrying the e-utran transparent container is routed and relayed independently by the core network node(s). any relation between messages is transparent for the mme, i.e. a request/response exchange between applications, for example son applications, is routed and relayed as two independent messages by the mme. an mme supporting the configuration transfer procedures provides addressing, routing and relaying functions.
5.14.2 addressing, routing and relaying
5.14.2.1 addressing
all the configuration transfer messages contain the addresses of the source and destination ran nodes. an enodeb is addressed by the target enodeb identifier. for dual connectivity with e-utran as master ran node and nr as secondary ran node as defined in ts?37.340?[85], the destination ran node includes the candidate en-gnb identifier and may include a target enodeb identifier for the target enodeb which is x2 connected to the candidate en-gnb and a tai associated with the en-gnb.
5.14.2.2 routing
the following description applies to all the configuration transfer messages used for the exchange of the e-utran transparent container.
the source ran node sends a message to its mme including the source and destination addresses. the mme uses the destination address to route the message encapsulated in a gtpv2 message to the correct mme via the s10 interface (see ts?29.274?[43]).
the mme connected to the target enodeb decides which ran node to send the message to, based on the destination address. for dual connectivity with e-utran as master ran node and nr as secondary ran node as defined in ts?37.340?[85], target enodeb decides which candidate en-gnb to send the message to, based on the destination address.
5.14.2.3 relaying
the mme performs relaying between gtpv2 messages as described in ts?29.274?[43]. the mme performs relaying between s1 and s10 messages as described in ts?36.413?[36], ts?23.501?[83] and ts?29.274?[43]. the target enodeb performs relaying between s1 and x2 message as described in ts?36.413?[36] and ts?36.423?[76].
5.14.2.4 applications using the configuration transfer procedures
the ran node applications, which use the configuration transfer procedures, are fully transparent for the mme. these applications are described in ran specifications. an example of application is the transfer of information required for self-optimised networks (son).
5.15 ran information management (rim) procedures
5.15.1 general
the ran information management (rim) procedures provide a generic mechanism for the exchange of arbitrary information between applications belonging to the ran nodes. the ran information is transferred via the mme and sgsn core network node(s). in order to make the ran information transparent for the core network, the ran information is included in a rim container that shall not be interpreted by the core network nodes.
the rim procedures are optional both in the ran and the cn nodes. for the gb interface the use of rim procedures is negotiated at start/restart of the gb link. for the iu interface there is no negotiation of using rim procedures or not at iu link start/restart.
the ran information is transferred in rim containers from the source ran node to the destination ran node by use of messages. source and destination ran nodes can be e-utran, utran or geran. each message carrying the rim container is routed and relayed independently by the core network node(s). any relation between messages is transparent for the mme/sgsn, i.e. a request/response exchange between rim applications, for example, is routed and relayed as two independent messages by the mme/sgsn.
the interfaces which will be used are the gb, the iu, the s1, gn and the s3 interfaces. the ran information in the rim container shall be transparent for the core network. an mme or sgsn supporting the rim procedures provides addressing, routing and relaying functions.
5.15.2 addressing, routing and relaying
5.15.2.1 addressing
all the messages used for the exchange of ran information contain the addresses of the source and destination ran nodes. a bss is addressed by routing area identity (rai) + cell identity (ci) of one of its cells. an enodeb is addressed by the target enodeb identifier. an rnc is addressed by global rnc-id as defined in ts?23.003?[9].
5.15.2.2 routing
the following description applies to all the messages used for the exchange of ran information.
the source ran node sends a message to its mme or sgsn including the source and destination addresses. the sgsn/mme uses the destination address to route the message encapsulated in a gtp message to the correct mme/sgsn via the s3 or gn interface.
the mme/sgsn connected to the destination ran node decides which ran node to send the message to based on the destination address.
5.15.2.3 relaying
the sgsn performs relaying between bssgp messages, ranap messages and gtp messages as described in ts?48.018?[42], ts?25.413?[22], ts?29.060?[14] and ts?29.274?[43]. the mme performs relaying between s1 and s3/gn messages as described in ts?36.413?[36] and ts?29.274?[43] / ts?29.060?[14].
5.15.3 applications using the rim procedures
the ran node applications, which use the rim procedures, are fully transparent for the mme and sgsn. these applications are described in ran specifications. an example between e-utran and geran is the network assisted cell change described in ts?48.018?[42], ts?25.413?[22] and ts?36.413?[36]. an example between e-utran and utran is the exchange of son related information described in ts?36.413?[36]
5.16 mme-initiated procedure on ue's csg membership change
if the ue is in ecm-connected state and connected via a csg cell and the mme detects that the ue's csg membership to that cell has expired, the mme shall send an s1ap ue context modification request message to the enodeb which includes an indication that the csg membership of the ue has expired. the enodeb receiving this indication may initiate a handover to another cell. if the ue is not handed over the enodeb should initiate the s1 release procedure with an appropriate cause. the mme initiates s1 release after a configurable time if the ue is not handed over or released by the csg cell. if the csg membership expires for a ue with ongoing emergency bearer service, no indication that the csg membership of the ue has expired is sent to the enodeb and the mme shall deactivate all non-emergency pdn connections.
if the ue is in ecm-connected state and connected via a hybrid cell and the mme detects that the ue's csg membership to that cell has changed or expired, and the csg information reporting action indicates user csg information shall be reported to the p gw then the mme shall modify the last known csg membership and send a change notification message to the serving gw with user csg information to indicate the csg membership change. the serving gw shall send the change notification message with the user csg information to the pdn gw. the mme shall also send the s1ap ue context modification request message to the enodeb which includes an indication of whether the ue is a csg member. based on this information the enodeb may perform differentiated treatment for csg and non-csg members. mme shall release the impacted lipa pdn connection if the lipa csg authorization data for this csg cell is no longer valid due to ue's csg membership changed or expired.
5.17 home enodeb multicast packet forwarding function
a home enodeb l-gw should receive and process multicast group membership report messages (e.g. according to rfc 3376?[62] / rfc 3810?[63]) sent either by the network accessed by lipa or by the ue. based upon these messages, the l-gw should forward multicast ip datagrams sent by the ue to the network accessed by lipa, or from the network accessed by lipa to the ue, as appropriate.
the ue may implement rfc3376?[62] or rfc 3810?[63] to report multicast groups that the ue seeks to receive.
to make upnp/dlna service advertisements sent with an ip ttl=1 available to ues that employ lipa, a proxying function in the l-gw may be implemented, e.g. to retransmit upnp service advertisements to ues after changing the source address. this proxying to the ue shall not be performed if the multicast packet is transmitted with an ipv4 or ipv6 link-local source address, rfc?3927?[64], rfc?4291?[65].
5.18 hplmn notification with specific indication due to mme initiated bearer removal
when initiating a delete session request procedure, the mme shall add an appropriate cause code facilitating the operator of the p-gw to take appropriate action (e.g. alarm, o&m action by operator's management network) if needed.
note: this is for the hplmn operator to be able to differentiate delete session request procedures due to a failure case (e.g. due to a qos parameter mismatch at initial attach) from delete session request procedures that are executed in cases not related to any failure conditions (e.g. due to a tracking area update). action taken by the hplmn operator is outside the scope of 3gpp specification.
5.19 procedures to support dedicated core networks
5.19.1 nas message redirection procedure
when dcns are used, these steps are used to reroute a nas message (and thereby a ue) from one cn node to another cn node during attach, tau or rau procedure. these steps are also used by the mme/sgsn or hss initiated dedicated core network reselection procedure in clause?5.19.3.

figure 5.19.1-1: nas message redirection procedure
the procedure is started when a first new mme/sgsn decides to move the handling of an attach request, tau request or rau request to another cn node.
1. the first new mme/sgsn sends a reroute nas message request (original ran message, reroute parameters, additional guti/p-tmsi, ue usage type, and optionally the imsi) to the ran node. the reroute parameter is a mmegi (for e-utran) or null-nri/sgsn group id (for utran/geran) corresponding to the dcn that corresponds to the ue usage type. a ue provided additional guti/p-tmsi (if available) from the nas request message is included. the mme/sgsn may determine the mmegi or null-nri/sgsn group id corresponding to the dcn using dns procedures. the original ran message is the complete pdu received from the ran which contains the original nas request message and all ran ies. the ue usage type shall be included, if available. for the condition to include the imsi, see step?6 in clause?5.19.2.
2. the ran node's nnsf selects a new mme/sgsn based on the mmegi or null-nri/sgsn group id and possibly also based on an additional guti/p-tmsi. if additional guti/p-tmsi identifies an mme/sgsn within the set of valid nodes identified by mmegi or null-nri/sgsn group id, it should be the selected node. otherwise a valid cn node corresponding to the mmegi or null-nri/sgsn group id will be selected. if no valid mme/sgsn is available within the set of valid nodes identified by mmegi or null-nri/sgsn group id, the ran node selects an mme/sgsn from the default dcn or selects the mme/sgsn that sent the reroute request, based on operator configuration. the mme/sgsn is selected from the network corresponding to the selected cn operator.
3. dependent on rat, the enodeb/rnc sends the initial ue message to the selected mme/sgsn or the bsc sends the ul-unitdata message to the selected sgsn. the initial ue message/ul-unitdata message includes the nas request message, the mmegi or null-nri/sgsn group id, ue usage type and the imsi if received from the first sgsn/mme in step?1. the mmegi or null-nri/sgsn group id indicates that the message is a rerouted message and the second new mme/sgsn shall not reroute the nas message. the ue usage type shall be included if received in the reroute nas message request to be used by the second new mme/sgsn to select sgw and pdn gw (see clauses 4.3.8.1 and 4.3.8.2).
5.19.2 attach, tau and rau procedure for dedicated core network
when dcns are used, the attach, tau and rau procedures in this clause?apply.

figure 5.19.2-1: attach,tau and rau procedure for dedicated core network
1. attach, tau, or rau procedure is initiated as specified in the relevant clauses of this specification and ts?23.060?[7]. the relevant steps of the procedure as specified in the figure above are executed. the following modifications apply:
- in the rrc connection complete message transferring the nas request message, the ue provides the dcn-id, if available. if the ue has a plmn specific dcn-id the ue shall provide this value and if no plmn specific dcn-id exist the pre-provisioned default standardized dcn-id shall be provided, if pre-provisioned in the ue. the ran node selects a dcn and a serving mme/sgsn within the network of the selected core network operator based on the dcn-id and configuration in the ran node. the nas request message is sent to the selected node. the dcn-id is provided by the ran to the mme/sgsn together with the nas request message.
- e-utran initial attach procedure (clause?5.3.2.1 (figure 5.3.2.1-1)) and combined gprs/imsi attach procedure (ts?23.060?[7] clause?6.5.3 (figure 22)): in the identification response message, the old mme/sgsn provides ue usage type parameter, if available.
- tracking area update procedure (clause?5.3.3.1 (figure 5.3.3.1-1) and 5.3.3.2 (figure 5.3.3.2-1)): in the context response message, the old mme/sgsn provides ue usage type parameter, if available.
- routing area update procedure (clause?5.3.3.3 (figure 5.3.3.3-1) and 5.3.3.6 (figure 5.3.3.6-1), ts?23.060?[7] clauses?6.9.1.2.2 (figure 33), 6.9.1.2.2a (figure 33a), 6.9.1.3.2 (figure 35), 6.9.2.1 (figure 36), 6.9.2.1a (figure 36a), 6.13.1.1.1 (figure 52), 6.13.2.1.1 (figure 54), 6.13.2.1.2 (figure 54-2), 6.13.2.2.1 (figure 55), 6.13.2.2.2 (figure 55-2)): in the context response message, the old mme/sgsn provides ue usage type parameter, if available.
2. if the (first) new mme/sgsn, i.e. the mme/sgsn that has not received any mmegi or null-nri/sgsn group id from ran, does not have sufficient information to determine whether it should serve the ue, it sends an authentication information request message to the hss requesting ue usage type by adding the parameter "send ue usage type" flag in the message. the mme/sgsn may also request one or more authentication vectors in addition to the ue usage type. the (first) new mme/sgsn has sufficient information in the following cases and may then skip this step?and step?3:
i. the (first) new mme/sgsn has received the ue usage type from the old mme/sgsn in the identification response (for attach) or context response (for tau/rau) message or forward relocation request (for handover).
ii. based on configuration in the (first) new mme/sgsn and ue context information, the mme/sgsn is able to determine whether it should serve the ue.
 this step and redirection of nas message (i.e. step?5 onwards) shall not be performed for tau/rau procedure triggered in connected mode, e.g. during handover.
3. the hss, if supporting dcns, provides the ue usage type in the authentication information answer message, if any is stored for the ue. the ue usage type is returned by the hss in addition to requested authentication vectors.
4. if the (first) new mme/sgsn determines that it shall not reroute the nas message to another cn node, the mme/sgsn either continues from the designated step?as stated in the figure above or depending on operator configuration rejects the nas request message and the nas procedure ends in this step. the nas message is rejected with parameters, e.g. backoff timer, such that the ue does not immediately re-initiate the nas procedure.
 the mme/sgsn sends the dcn-id, if available, for the dcn to the ue in the nas accept message. the ue updates its stored dcn-id parameter for the serving plmn if dcn-id for serving plmn is changed.
5. if the (first) new mme/sgsn determines that it should reroute the nas request message to another cn node, the procedure is a tau or rau procedure and ue context was received from the old mme/sgsn, the (first) new mme sends a context acknowledge message with cause code indicating that the procedure is not successful. the old mme/sgsn shall continue as if context request was never received.
6. if the (first) new mme/sgsn determines that it should reroute the nas request message to another cn node, it uses the "nas message redirection procedure" in clause?5.19.1. the nas message is re-routed to a (second) new mme/sgsn. if the imsi was retrieved unencrypted from the ue by the (first) new mme/sgsn in step?1, the (first) new mme/sgsn shall include the imsi in the reroute message request.
7. the (second) new mme/sgsn, i.e. the mme/sgsn that receives the rerouted nas message from ran with mmegi or null-nri/sgsn group id, performs nas procedure as stated for e-utran in this specification and for geran/utran in ts?23.060?[7] from the steps shown in the figure above. the following modifications apply:
- e-utran initial attach procedure (clause?5.3.2.1 (figure 5.3.2.1-1)) and combined gprs/imsi attach procedure (ts?23.060?[7] clause?6.5.3 (figure 22)): in the identification response message, the old mme/sgsn provides ue usage type parameter, if available.
- tracking area update procedure (clause?5.3.3.1 (figure 5.3.3.1-1) and 5.3.3.2 (figure 5.3.3.2-1)): in the context response message, the old mme/sgsn provides ue usage type parameter, if available.
- in case the imsi was received from the first (new) mme/sgsn as part of the nas message redirection procedure, the second (new) mme/sgsn does not have to retrieve the imsi from the ue.
- routing area update procedure (clause?5.3.3.3 (figure 5.3.3.3-1) and 5.3.3.6 (figure 5.3.3.6-1), ts?23.060?[7] clauses? 6.9.1.2.2 (figure 33), 6.9.1.2.2a (figure 33a), 6.9.1.3.2 (figure 35), 6.9.2.1 (figure 36), 6.9.2.1a (figure 36a), 6.13.1.1.1 (figure 52), 6.13.2.1.1 (figure 54), 6.13.2.1.2 (figure 54-2), 6.13.2.2.1 (figure 55), 6.13.2.2.2 (figure 55-2)): in the context response message, the old mme/sgsn provides ue usage type parameter, if available.
- the mme/sgsn sends the dcn-id, if available, for the new dcn to the ue in the nas accept message. the ue updates its stored dcn-id parameter for the serving plmn if dcn-id for serving plmn is changed.
 in case network sharing and the selected plmn information is not provided by the ue, the sgsn may also include the plmn id of selected cn operator in the nas accept message.
 the (second) new mme/sgsn shall not reroute the nas message to another cn node since the initial ue message/ul-unitdata message from ran includes mmegi or null-nri/sgsn group id. the (second) new mme/sgsn either completes the nas procedure as stated above or depending on operator configuration rejects the nas request message and the nas procedure ends. when rejecting the nas request, an appropriate cause and backoff time should be included.
 in the case of tau or rau procedure, the (second) new mme/sgsn may check (e.g. based on the indication that the nas message has been rerouted and on local configuration) if the pdn gw (for one or more pdn connection(s)) of the ue needs to be changed. if the pdn gw needs to be changed, the (second) new mme/sgsn initiates detach with reattach required or pdn disconnection with reactivation required procedure after the completion of the tau or rau procedure.
5.19.2a impacts to handover procedures
when dcns are used, the impacts to the handover procedures are captured as below.
- forward relocation request message: when mme changes during handover, in the step where forward relocation request message is sent from the source mme/sgsn to target mme/sgsn, the source mme/sgsn also includes the ue usage type, if available, in the message. this applies to the following clauses and step:
- 5.5.1.2.2 s1-based handover, normal: step 3
- 5.5.2.1.2 preparation phase (e-utran to utran iu mode inter rat handover): step 3
- 5.5.2.2.2 preparation phase (utran iu mode to e-utran inter rat handover): step 3
- 5.5.2.3.2 preparation phase (e-utran to geran a/gb mode inter rat handover): step 3
- 5.5.2.4.2 preparation phase (geran a/gb mode to e-utran inter rat handover): step 3
- selection of new sgw: in the step, subsequent to the forward relocation request message, in which the target mme/sgsn determines if the serving gw is to be relocated, if the target mme/sgsn supports dcn, the target mme/sgwn also determines if the existing serving gw supports the dcn for the ue based on ue usage type of the ue, locally configured operator's policies as well as ue related context information available at the target network, e.g. information about roaming. this applies to the following clauses and step:
- 5.5.1.2.2 s1-based handover, normal: step 4
- 5.5.2.1.2 preparation phase (e-utran to utran iu mode inter rat handover): step 4
- 5.5.2.2.2 preparation phase (utran iu mode to e-utran inter rat handover): step 4
- 5.5.2.3.2 preparation phase (e-utran to geran a/gb mode inter rat handover): step 4
- 5.5.2.4.2 preparation phase (geran a/gb mode to e-utran inter rat handover): step 4
- handover from service area where dcn is not used to an area where dcn is supported: when handover occurs from a service area where dcn is not used to a service area where dcn is supported and the mme or sgsn changes, the target mme or sgsn obtains the ue usage type information from the hss during the subsequent tau or rau procedure. if the target mme/sgsn determines that the serving gw does not support the ue usage type, the target mme/sgsn triggers the serving gw relocation as part of the handover procedures described in clause?5.5. if the target mme or sgsn does not serve the ue usage type, the handover procedure should complete successfully and then the target mme or sgsn may use the procedure in clause?5.19.3 step 5 onwards, to change the serving dcn of the ue.
5.19.3 mme/sgsn or hss initiated dedicated core network reselection
if dcns are deployed, this procedure is used by the hss to update (i.e. add, modify or delete) the ue usage type subscription parameter in the serving node. this procedure may result in change of serving node of the ue. this procedure may also be used for mme/sgsn intiated serving node change for ues, e.g. when configuration about the ue usage types served by mme/sgsn is changed. this procedure may also be used after a handover procedure by the target mme/sgsn to redirect a ue to a serving node of another dcn.
if ue assisted dcn selection feature is supported by the core network, the ue is provided with the new dcn-id.
the subscription change may be applied to a large number of ues and similar considerations as in the case of mme/sgsn rebalancing specified in clause?4.3.7.3 should be applied to avoid sudden redirection of ues that could overload the core network nodes (and possibly the ran if paging is needed).

figure 5.19.3-1: mme/sgsn or hss initiated dedicated core network reselection
steps 1 and 2 apply for hss initiated dedicated core network reselection procedure only.
1. the hss sends an insert subscriber data request (imsi, subscription data) message to the mme/sgsn. the subscription data includes ue usage type information or ue usage type withdrawal information.
note?1: in case the ue usage type subscription change or withdrawal needs to be applied for a large number of subscribers, the hss should stagger the insertion of subscription changes to serving nodes, e.g. based on oam.
2. the mme/sgsn updates the stored subscription data and acknowledges the insert subscriber data request message by returning an insert subscriber data answer (imsi) message to the hss. the procedure ends if the mme/sgsn can continue to serve the ue.
3. if the mme/sgsn decides to transfer the ue immediately to another cn or if the mme/sgsn determines that dcn-id immediately needs to be updated and the ue is in idle-mode, the mme/sgsn pages the ue. alternatively the mme waits until the ue becomes active.
if mme/sgsn decides to transfer the ue to another cn either steps 4 through 7 or step 8 occur. steps 4 through 7 occur in case the ue is already in connected mode or ue enters connected mode by initiating data transfer. step 8 occurs in case the ue is in idle mode and performs a tau/rau procedure. if the mme/sgsn determines that only dcn-id shall be updated in the ue (i.e. serving cn node is kept) only step?4 and 5 occurs.
4. either triggered by the paging or by uplink data the ue initiates nas connection establishment. alternatively the ue initiates nas connection establishment by sending a tau/rau request.
5. when a nas connection already exists or when a nas connection is established for initiating data transfer, the mme/sgsn triggers the guti reallocation/p-tmsi reallocation procedure. if dcn-id is available and the mme/sgsn determines that the ue shall be updated with a new dcn-id, the new dcn-id shall be included in the guti reallocation command/p-tmsi reallocation command.
 if the mme/sgsn determines that a cn node re-selection needs to be performed, a non-broadcast tai/rai shall be included.
6. the mme/sgsn releases ran resources and ue is moved to idle mode.
note?2: in case a large number of ues need to be offloaded the mme/sgsn should not release ran resources for all ues immediately to avoid sudden redirection of ues that could overload the core network nodes (and possibly the ran if paging is needed). the mme/sgsn should wait until the release is performed due to inactivity.
7. the non-broadcast tai/rai triggers the ue to immediately start the tau/rau procedure. if available, the new dcn-id shall be sent from the ue to the ran.
 the mme/sgsn receives the tau/rau request message.
8. the ue performs a tau/rau request. the mme/sgsn receives the tau/rau request message.
9. if the ue usage type for the ue has been added or modified and if it is not served by the mme/sgsn, or if the ue usage type has been withdrawn from the hss subscription data and subscriptions without ue usage type are not served by the mme/sgsn, the mme/sgsn triggers the nas message redirection procedure of clause?5.19.1 to redirect the ue. this is followed by step?7 of clause?5.19.2 where the tau/rau procedure completes at the mme of the selected dcn.

annex a (informative):
void


annex b (informative):
void


annex c (informative):
void


annex d (normative):
interoperation with gn/gp sgsns
d.1 general considerations
this annex specifies interworking between the eps and 3gpp 2g and/or 3g sgsns, which provide only gn and gp interfaces but no s3, s4 or s5/s8 interfaces, i.e. these gn/gp sgsns provide no functionality that is introduced specifically for the eps or for interoperation with the e-utran.
interoperation scenarios for operating e-utran with a plmn maintaining gn/gp sgsns are supported only with a gtp-based s5/s8.
note: pmip-based s5/s8 may be used, but does not support handovers between the gn/gp sgsn and mme/s gw.
the s5/s8 interface for the operator with gn/gp sgsns will be gtp-based, but can be changed to pmip-based s5/s8 when the gn/gp sgsns evolve to s4 sgsns.
for these interoperation scenarios the geran/utran has to support interoperation with e utran.
ts?23.682?[74] defines the monitoring events feature, and ts?23.060?[7] specifies that the monitoring events feature for the gn/gp sgsn is not supported. therefore, during interoperation with gn/gp sgsns monitoring event information shall not be expected by the mme/s4-sgsn from a gn/gp sgsn, nor shall the mme/s4-sgsn or the hss transfer monitoring event information to a gn/gp sgsn. this applies to all operations defined in this annex.
d.2 interoperation scenario
d.2.1 roaming interoperation scenario
in the roaming scenario the vplmn operates gn/gp 2g and/or 3g sgsns as well as mme and s gw for e-utran access. the hplmn operates a p gw.
roaming and inter access mobility between gn/gp 2g and/or 3g sgsns and an mme/s gw are enabled by:
- gn functionality as specified between two gn/gp sgsns, which is provided by the mme, and
- gp functionality as specified between gn/gp sgsn and gn/gp ggsn that is provided by the p gw.
all this gp and gn functionality bases on gtp version 1 only.
the architecture for interoperation with gn/gp sgsns in the non-roaming case is illustrated in figure d.2.1-1.

figure d.2.1-1: roaming architecture for interoperation with gn/gp sgsn
d.2.2 non-roaming interoperation scenario
in the non-roaming scenario the plmn operates gn/gp 2g and/or 3g sgsns as well as mme and s gw for e-utran access.
intra plmn roaming and inter access mobility between gn/gp 2g and/or 3g sgsns and an mme/s gw are enabled by:
- gn functionality as specified between two gn/gp sgsns, which is provided by the mme, and
- gn functionality as specified between gn/gp sgsn and gn/gp ggsn that is provided by the p gw.
all this gn functionality is based on gtp version 1 only.
the architecture for interoperation with gn/gp sgsns in the non-roaming case is illustrated in figure d.2.2-1.

figure d.2.2-1: non-roaming architecture for interoperation with gn/gp sgsns
note: if the rel-7 sgsn applies direct tunnel there is a UP connection between p gw and utran.
d.3 interoperation procedures
d.3.1 general
the interoperation procedures describe information flows for gn/gp sgsns and other eps network elements. all messages between gn/gp sgsn and mme, between gn/gp sgsn and hss and between gn/gp sgsn and p gw as well as the therein contained information elements are the same as specified for the adequate ts?23.060?[7] procedures that are between gn/gp sgsns. these messages and procedure step descriptions are taken from ts?23.060?[7] for explanatory purposes only. these descriptions are in italic text and shall not be modified by the interoperation procedures. it cannot be assumed that the messages and procedure step descriptions that are taken from ts?23.060?[7] will be updated when modifications or corrections are performed for ts?23.060?[7]. if there are any discrepancies for these messages and procedure step descriptions ts?23.060?[7] takes precedence. the messages between the mme and any other node than the gn/gp sgsn as well as the therein contained information elements are the same as specified in the main body of this technical specification for the inter rat routing area update procedure. if there are any discrepancies for these messages the descriptions from the main body of this technical specification take precedence.
an operator that has pre-rel 8 sgsns in its network should use separate eps bearers for ipv4 and ipv6 addressing, such that both addresses can be maintained when moving to a pre-rel 8 sgsn from a rel 8 sgsn or mme (see clause?5.3.1). this is configured into the sgsn and mme nodes which set the dual address bearer flag depending on whether a ue may or may not be handed over to a pre-rel 8 sgsn, as specified in clauses?5.3.2.1 and 5.10.2.
an operator supporting emergency services shall not have pre-rel-9 sgsns in its network where a ue may be handed over.
d.3.2 void

d.3.3 mme to 3g sgsn combined hard handover and srns relocation procedure
the mme to 3g gn/gp sgsn combined hard handover and srns relocation procedure is illustrated in figure?d.3.3-1.
any steps descriptions that are from inter gn/gp sgsns procedures of ts?23.060?[7] are shown as italic text and remain unmodified. in those step descriptions an ms stands for ue, old sgsn for old mme and ggsn for p gw.
the procedure parts between e-utran enodeb and ue, and between e-utran enodeb and mme are compliant with the equivalent procedure parts in clause "5.5 handover".
if emergency bearer services are ongoing for the ue, handover to the target rnc is performed independent of the handover restriction list. the sgsn checks, as part of the routing area update in the execution phase, if the handover is to a restricted area and if so sgsn deactivate the non-emergency pdp context as specified in ts?23.060?[7], clause?9.2.4.2.

figure d.3.3-1: mme to 3g sgsn combined hard handover and srns relocation procedure
1. the source enodeb decides to initiate a handover to the target access network, utran iu mode. at this point both uplink and downlink user data is transmitted via the following: bearer(s) between ue and source enodeb, gtp tunnel(s) between source enodeb, serving gw and pdn gw.
2. the source enodeb sends a handover required (s1ap cause, target rnc identifier, source to target transparent container) message to the source mme to request the cn to establish resources in the target rnc and the target sgsn. the bearers that will be subject to data forwarding (if any) are identified by the new sgsn in a later step (see step?5 below).
3. the old mme sends a forward relocation request message (imsi, tunnel endpoint identifier signalling, mm context, pdp context, target identification, ran transparent container, ranap cause, gcsi) to the new sgsn. for relocation to an area where intra domain connection of ran nodes to multiple cn nodes is used, the old mme may have multiple new gn/gp sgsns for each relocation target in a pool area, in which case the old mme will select one of them to become the new gn/gp sgsn, as specified in ts?23.236?[30]. pdp context contains ggsn address for UP and uplink teid for data (to this ggsn address and uplink teid for data, the serving gw and the new sgsn send uplink packets). at the same time a timer is started on the mm and pdp contexts in the old mme (see routing area update procedure in clause "location management procedures (iu mode)"). the old mme does not set any gcsi flag as the mme has no gprs camel subscription information. the s1ap cause received from enodeb is indicated as ranap cause. the source to target transparent container received from enodeb is indicated as ran transparent container.
the mm context includes information on the eps bearer context(s). the old mme does not include any eps bearer context information for "non-ip" bearers or for any scef connection. if none of the ms's eps bearers can be supported by the selected new sgsn, the old mme rejects the handover attempt by sending a handover preparation failure (cause) message to the source enodeb.
note?1: if the handover is successful, the old mme will signal to the sgw and/or scef to release any non-included eps bearers after step?15. the non-included bearers are locally released by the ms following the pdp context status synchronisation that occurs during the routing area update at step?17.
note?2: the ggsn UP address and uplink teid are the old p gw UP address and teid. the mme maps the eps bearer parameters to pdp contexts.
4. the new sgsn sends a relocation request message (permanent nas ue identity, cause, cn domain indicator, source rnc to target rnc transparent container, rab to be setup) to the target rnc. for each rab requested to be established, rabs to be setup shall contain information such as rab id, rab parameters, transport layer address, and iu transport association. sgsn shall not establish rabs for pdp contexts with maximum bitrate for uplink and downlink of 0 kbit/s. the list of rabs requested by the new sgsn may differ from list of rabs established in the source rnc contained in the source-rnc to target rnc transparent container. the target rnc should not establish the rabs (as identified from the source-rnc to target rnc transparent container, service handover related information) that did not exist in the source rnc prior to the relocation. the rab id information element contains the nsapi value, and the rab parameters information element gives the qos profile. the transport layer address is the sgsn address for user data, and the iu transport association corresponds to the uplink tunnel endpoint identifier data. the new sgsn may decide to establish direct tunnel unless it has received a 'set' gcsi flag from the old sgsn. if the new sgsn decides to establish direct tunnel, it provides to the target rnc the ggsn's address for UP and teid for uplink data. if the access restriction is present in the mm context, the service handover related information shall be included by the target sgsn for the relocation request message in order for rnc to restrict the ue in connected mode to handover to the rat prohibited by the access restriction.
 after all the necessary resources for accepted rabs including the iu UP are successfully allocated, the target rnc shall send the relocation request acknowledge message (target rnc to source rnc transparent container, rabs setup, rabs failed to setup) to the new sgsn. each rab to be setup is defined by a transport layer address, which is the target rnc address for user data, and the iu transport association, which corresponds to the downlink tunnel endpoint identifier for user data. the transparent container contains all radio-related information that the ms needs for the handover, i.e. a complete rrc message (e.g., physical channel reconfiguration in utran case, or handover from utran, or handover command in geran iu mode case) to be sent transparently via cn and source srnc to the ms. for each rab to be set up, the target rnc may receive simultaneously downlink user packets both from the source srnc and from the new sgsn.
note?3: this step for the new sgsn is unmodified compared to pre-rel-8. if the new sgsn decides to establish direct tunnel, it provides to the target rnc the p gw address for UP and teid for uplink data. the ue acts as the ms; the old enodeb acts as the source srnc.
5. when resources for the transmission of user data between target rnc and new sgsn have been allocated and the new sgsn is ready for relocation of srns, the forward relocation response (cause, ran transparent container, ranap cause, target-rnc information) message is sent from the new sgsn to the old sgsn. this message indicates that the target rnc is ready to receive from source srnc the forwarded downlink pdus, i.e., the relocation resource allocation procedure is terminated successfully. ran transparent container and ranap cause are information from the target rnc to be forwarded to the source srnc. the target rnc information, one information element for each rab to be set up, contains the rnc tunnel endpoint identifier and rnc ip address for data forwarding from the source srnc to the target rnc. the forward relocation response message is applicable only in case of inter-sgsn srns relocation.
note?4: this step is unmodified compared to pre-rel-8. the old mme acts as the old sgsn, and the source enodeb as the source srnc.
6. if 'indirect forwarding' applies the source mme sends a create indirect data forwarding tunnel request message (imsi, mme tunnel endpoint identifier for CP, mme address for CP, target rnc address and teid(s) for dl UP) to the serving gw.
7. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw dl teid(s)) message to the source mme. if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned.
8. the source mme completes the preparation phase towards source enodeb by sending the message handover command (target to source transparent container, bearers subject to data forwarding list, s1ap cause). "bearers subject to data forwarding list" may be included in the message and it shall be a list of 'address(es) and teid(s) for user traffic data forwarding' received from target side in the preparation phase (step 5) in the case of direct forwarding or received from the serving gw in the preparation phase (step?7) in the case of indirect forwarding. ranap cause as received from new sgsn is indicated as s1ap cause. ran transparent container as received from new sgsn is indicated as target to source transparent container.
9. the source enodeb initiates data forwarding for bearers specified in the "bearers subject to data forwarding list". the data forwarding may go directly to target rnc or alternatively go via the serving gw if so decided by source mme in the preparation phase.
10. the source enodeb will give a command to the ue to handover to the target access network via the message ho from e-utran command. this message includes a transparent container including radio aspect parameters that the target rnc has set-up in the preparation phase. the details of this e-utran specific signalling are described in ts?36.300?[5].
11. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends the ran data report message (secondary rat usage data) to the mme. since the handover is an inter-rat handover, the mme continues with the secondary rat usage data reporting procedure as in clause?5.7a.3. the reporting procedure in clause?5.7a.3 is only performed if pgw secondary rat usage reporting is active.
note?5: the source enodeb does not send any ran contexts towards the target rnc.
12. the target rnc shall send a relocation detect message to the new sgsn when the relocation execution trigger is received. for srns relocation type "ue involved", the relocation execution trigger may be received from the uu interface; i.e., when target rnc detects the ms on the lower layers. when the relocation detect message is sent, the target rnc shall start srnc operation.
note?6: this step is unmodified compared to pre-rel-8.
13. when the ms has reconfigured itself, it sends an rrc message e.g., a physical channel reconfiguration complete message to the target srnc.
 the ue locally deactivates isr by setting its tin from "rat-related tmsi" to "guti", if any eps bearer context activated after the isr was activated in the ue exists.
14. when the target srnc receives the appropriate rrc message, e.g. physical channel reconfiguration complete message or the radio bearer release complete message in utran case, or the handover to utran complete message or handover complete message in geran case, i.e. the new srnc id?+ s rnti are successfully exchanged with the ms by the radio protocols, the target srnc shall initiate a relocation complete procedure by sending the relocation complete message to the new sgsn. the purpose of the relocation complete procedure is to indicate by the target srnc the completion of the relocation of the srns to the cn.
note?7: this step is unmodified compared to pre-rel-8. the ue acts as the ms.
15. upon receipt of relocation complete message, if the srns relocation is an inter sgsn srns relocation, the new sgsn signals to the old sgsn the completion of the srns relocation procedure by sending a forward relocation complete message.
 a timer in source mme is started to supervise when resources in source enodeb and source serving gw shall be released.
 for all bearers that were not included in the forward relocation request message sent in step?3, the mme now releases them by sending a delete bearer command to the sgw, or, the appropriate message to the scef.
note?8: for the sgsn this step is unmodified compared to pre-rel-8. the old mme acts as the old sgsn, and the source enodeb as the source srnc.
16. upon receipt of the relocation complete message, the cn shall switch the UP from the source rnc to the target srnc. if the srns relocation is an inter-sgsn srns relocation or if direct tunnel was established in intra-sgsn srns relocation, the new sgsn sends update pdp context request messages (new sgsn address, sgsn tunnel endpoint identifier, qos negotiated, serving network identity, cgi/sai, user csg information, rat type, ms info change reporting support indication, nrsn, dti) to the ggsns concerned. the sgsn shall send the serving network identity to the ggsn. if direct tunnel is established the sgsn provides to ggsn the rnc's address for UP and teid for downlink data and shall include the dti to instruct the ggsn to apply direct tunnel specific error handling procedure as described in clause?13.8. nrsn indicates sgsn support of the network requested bearer control. the ggsns update their pdp context fields and return an update pdp context response (ggsn tunnel endpoint identifier, prohibit payload compression, apn restriction, ms info change reporting action, csg information reporting action, bcm) message. the prohibit payload compression indicates that the sgsn should negotiate no data compression for this pdp context.
 the pdn gw shall include a charging id to be used at the sgsn as the charging id for reporting usage for this pdp context. the pdn gw shall include the charging id in the offline charging data.
note?9: this step is unmodified compared to pre-rel-8. the p gw acts as the ggsn.
17. after the ms has finished the reconfiguration procedure and if the new routing area identification is different from the old one or if the ms' tin indicates "guti", the ms initiates the routing area update procedure. see clause "location management procedures (iu mode)".
 for a ms supporting ciot eps optimisations, the ms uses the pdp context status information in the rau accept to identify any non-transferred bearers that it shall locally release.
note?10: it is only a subset of the ra update procedure that is performed, since the ms is in pmm connected state.
note?11: this step is unmodified compared to pre-rel-8. the ue acts as the ms. the old eps bearer information in old mme and serving gw is removed as part of the routing area update procedure.
18. when the timer started in step?15 expires, the source mme deletes the eps bearer resources by sending delete session request (cause, operation indication, secondary rat usage data) messages to the serving gw because the new sgsn is a gn/gp sgsn, which is derived from using gtpv1 for relocation signalling between new gn/gp sgsn and old mme. the new gn/gp sgsn does not signal any serving gw change. the operation indication flag is not set, that indicates to the serving gw that the serving gw shall not initiate a delete procedure towards the pdn gw. secondary rat usage data was included if it was received in step?11a. the source serving gw acknowledges with delete session response (cause) messages. if isr is activated the cause indicates to the old s gw that the old s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node. if resources for indirect forwarding have been allocated then these are released.
 when the timer started in step?15 expires, the source mme sends a release resources message to the source enodeb. when the release resources message has been received and there is no longer any need for the enodeb to forward data, the source enodeb releases its resources.
if the srns relocation is inter-sgsn, then the following camel procedure calls shall be performed (see referenced procedures in ts?23.078?[29])
note?12: the c1 camel procedure call was omitted intentionally from this procedure since eps does not support camel procedure calls. the other camel procedure calls are unmodified compared to pre-rel 8.
the new sgsn shall determine the maximum apn restriction based on the received apn restriction of each pdp context from the ggsn and then store the new maximum apn restriction value.
if the srns relocation is intra-sgsn, then the above mentioned camel procedures calls shall not be performed.
if routing area update occurs, the sgsn shall determine whether direct tunnel can be used based on the received gprs camel subscription information. if direct tunnel can not be maintained the sgsn shall re-establish rabs and initiate the update pdp context procedure to update the ip address and teid for uplink and downlink data.
if routing area update occurs, then the following camel procedure calls shall be performed (see referenced procedures in ts?23.078?[29]):
c2) camel_gprs_routing_area_update_session and camel_ps_notification.
 they are called in the following order:
- the camel_gprs_routing_area_update_session procedure is called. the procedure returns as result "continue".
- then the camel_ps_notification procedure is called. the procedure returns as result "continue".
c3) camel_gprs_routing_area_update_context.
this procedure is called several times: once per pdp context. it returns as result "continue".
for c2 and c3: refer to routing area update procedure description for detailed message flow.
note?13: handover reject is performed as defined in clause?5.5.2.1.4, excluding steps?4 and 7.
d.3.4 3g sgsn to mme combined hard handover and srns relocation procedure
the 3g gn/gp sgsn to mme combined hard handover and srns relocation procedure is illustrated in figure?d.3.4-1.
any steps descriptions that are from ts?23.060?[7] are shown as italic text and remain unmodified. in those step descriptions an ms stands for ue, new sgsn for new mme and ggsn for p gw.
the procedure between e-utran enodeb and ue, and between e-utran enodeb and mme are compliant with the equivalent procedure parts in clause?5.5: handover.
if emergency bearer services are ongoing for the ue, the mme checks as part of the tracking area update in the execution phase, if the handover is to a restricted area and if so mme releases the non-emergency bearers as specified in clause?5.10.3.

figure d.3.4-1: 3g gn/gp sgsn to mme combined hard handover and srns relocation procedure
1. the source rnc decides to initiate a handover to e-utran.
2. the source srnc sends a relocation required message (relocation type, cause, source id, target id, source rnc to target rnc transparent container) to the old sgsn. the source srnc shall set relocation type to "ue involved". source rnc to target rnc transparent container includes the necessary information for relocation co ordination, security functionality and rrc protocol context information (including ms capabilities).
note?1: this step is unmodified compared to pre-rel-8. the target enodeb acts as the target rnc.
note?1a: the target id identifies an enodeb. with rel-8 iu functionality this is an enodeb id. as an implementations option for supporting introduction scenarios with pre-rel8 sgsns the source rnc may be configured to use rnc ids instead of enodeb ids to identify a target enodeb. the cause is relayed transparently by the sgsn to the mme and the mme mappes ranap cause code to an s1ap cause code. source rnc to target rnc transparent container carries information for the target enodeb. this container is relayed transparently by the sgsn.
3. the old sgsn determines from the target id if the srns relocation is intra-sgsn srns relocation or inter-sgsn srns relocation. in case of inter-sgsn srns relocation the old sgsn initiates the relocation resource allocation procedure by sending a forward relocation request message (imsi, tunnel endpoint identifier signalling, mm context, pdp context, target identification, ran transparent container, ranap cause, gcsi) to the new sgsn. for relocation to an area where intra domain connection of ran nodes to multiple cn nodes is used, the old sgsn may ? if it provides intra domain connection of ran nodes to multiple cn nodes -have multiple target sgsns for each relocation target in a pool area, in which case the old sgsn will select one of them to become the new sgsn, as specified in ts?23.236?[30]. pdp context contains ggsn address for UP and uplink teid for data (to this ggsn address and uplink teid for data, the old sgsn and the new sgsn send uplink packets). at the same time a timer is started on the mm and pdp contexts in the old sgsn (see routing area update procedure in clause "location management procedures (iu mode)"). the forward relocation request message is applicable only in case of inter-sgsn srns relocation. the old sgsn 'sets' the gcsi flag if the mm context contains gprs camel subscription information.
note?2: this step is unmodified compared to pre-rel-8. the new mme acts as the new sgsn, and the p gw as the ggsn. the ggsn UP address and uplink teid are the p gw UP address and teid. the mme maps the pdp context parameters to eps bearers.
4. the mme selects a serving gw and sends a create session request (bearer context(s) with pdn gw addresses and teids for uplink traffic, apn-ambr, serving network, ue time zone) message per pdn connection to the target serving gw. for relocation from gn/gp sgsn, the target mme provides the apn-ambr if not received explicitly from the gn/gp sgsn based on the mapping from mbr (as specified in annex?e) to the serving gw.
5. the serving gw allocates the s gw addresses and teids for the uplink traffic on s1_u reference point (one teid per bearer). the target serving gw sends a create session response (serving gw addresses and uplink teid(s) for UP) message back to the target mme.
6. the new mme requests the target enodeb to establish the bearer(s) by sending the message handover request (ue identifier, s1ap cause, cn domain indicator, kenb, nas security parameters to e-utran, eps bearers to be setup list, source to target transparent container, serving gw address(es) and teid(s) for user traffic data, handover restriction list). s1ap cause indicates the ranap cause as received from sgsn. source to target transparent container contains the ran transparent container as received from sgsn. the nas security parameters to e utran includes the nas integrity protection and ciphering algorithm(s), eksi and noncemme information elements. handover restriction list is sent if it is available in the target mme; it is described in clause?4.3.5.7.
 if the mme did not receive the ue network capability information from the old sgsn, then the mme will not have received information on the e-utran integrity protection and encryption algorithms that the ue supports. in this case, the mme can assume that the ue supports both eia1/eea1 and eia2/eea2.
note?3: the mme derives k'asme from ck and ik in the mm context and associates it with eksi, as described in ts?33.401?[41] and selects nas integrity protection and ciphering algorithms(s). eksi and key derivation parameters are targeted for ue. the mme and ue derive the nas keys and kenb from k'asme. if the mme shares an eps security association with the ue, the mme may activate this native eps security context by initiating a nas smc procedure after having completed the handover procedure.
 the mme shall not request the target enodeb to establish eps gbr bearers with maximum bitrate set to 0 and those eps bearers should not be included in the eps bearers to be setup list and should be deactivated by the mme. for the remaining eps bearer contexts the mme ignores any activity status indicator within an eps bearer context and requests the target enodeb to allocate resources for all the remaining eps bearer contexts.
 the mme shall compute the ue-ambr, according to clause?4.7.3, based on explicit apn-ambr values received from the gn/gp sgsn. if explicit apn-ambr values are not received by the mme, a local ue-ambr shall be included in the 'eps bearers be setup list ' ie. the local ue-ambr is described in clause annex?e.
 "data forwarding not possible" indication per bearer shall be included in the 'eps bearers to be setup list' if the target mme decides the corresponding bearer will not be subject to data forwarding.
note?4: the mme derives the security parameters from the security parameters received from the sgsn.
note?5: an mme that supports handovers from pre-rel-8 3g sgsns derives from the rnc id received from old sgsn an enodeb address.
7. the target enodeb allocates the requested resources and returns the applicable parameters to the target mme in the message handover request acknowledge (target to source transparent container, eps bearers setup list, eps bearers failed to setup list, cause). the target enodeb shall ignore it if the number of radio bearers in the source to target transparent container does not comply with the number of bearers requested by the mme and allocate bearers as requested by the mme.
 the target enodeb inserts the information provided by the mme (ksi, selected nas integrity protection and ciphering algorithm(s), noncemme) and selected as integrity and ciphering algorithm(s) into the utran rrc message, which is contained in the target to source transparent container.
8. if 'indirect forwarding' and relocation of serving gw apply the target mme sends a create indirect data forwarding tunnel request message (imsi, mme tunnel endpoint identifier for CP, mme address for CP, target enodeb address and teid(s) for dl UP) to the serving gw. the allocation of a new serving gw by steps?4 and 5 the mme shall consider as a serving gw change.
9. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw dl teid(s)) message to the source mme. if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned.
10. when resources for the transmission of user data between target rnc and new sgsn have been allocated and the new sgsn is ready for relocation of srns, the forward relocation response (cause, ran transparent container, ranap cause, target-rnc information) message is sent from the new sgsn to the old sgsn. this message indicates that the target rnc is ready to receive from source srnc the forwarded downlink pdus, i.e., the relocation resource allocation procedure is terminated successfully. ran transparent container and ranap cause are information from the target rnc to be forwarded to the source srnc. the target rnc information, one information element for each rab to be set up, contains the rnc tunnel endpoint identifier and rnc ip address for data forwarding from the source srnc to the target rnc. the forward relocation response message is applicable only in case of inter-sgsn srns relocation.
 for each rab, if the mme has determined no data forwarding, i.e., the data forwarding from the source rnc to the target enodeb is not required, the mme indicates the reserved teid and ip address parameters to the old sgsn in the target rnc information. the packets received on that reserved teid and ip address are discarded.
note?6: the new mme acts as the new sgsn, and the target enodeb as the target srnc. ranap cause indicates the cause as received from target enodeb. ran transparent container contains the target to source transparent container as received from enodeb.
11. the old sgsn continues the relocation of srns by sending a relocation command message (target rnc to source rnc transparent container, rabs to be released, rabs subject to data forwarding) to the source srnc. the old sgsn decides the rabs to be subject for data forwarding based on qos, and those rabs shall be contained in rabs subject to data forwarding. for each rab subject to data forwarding, the information element shall contain rab id, transport layer address, and iu transport association. these are the same transport layer address and iu transport association that the target rnc had sent to new sgsn in relocation request acknowledge message, and these are used for forwarding of downlink n pdu from the source srnc to the target rnc. the source srnc is now ready to forward downlink user data directly to the target rnc over the iu interface. this forwarding is performed for downlink user data only.
note?7: this step is unmodified compared to pre-rel-8. the target enodeb acts as the target rnc, and the new mme acts as the new sgsn. the forwarding of downlink user data from source srnc may go directly to target enodeb or via the serving gw.
12. the source srnc may, according to the qos profile, begins the forwarding of data for the rabs to be subject for data forwarding.
note?8: the order of steps, starting from step 7 onwards, does not necessarily reflect the order of events. for instance, source rnc may start data forwarding (step 7), send the rrc message to ms (step 8) and forward srns context message to the old sgsn (step 9) almost simultaneously.
 the data forwarding at srns relocation shall be carried out through the iu interface, meaning that the gtp-pdus exchanged between the source srnc and the target rnc are duplicated in the source srnc and routed at the ip layer towards the target rnc. for each radio bearer which uses lossless pdcp the gtp-pdus related to transmitted but not yet acknowledged pdcp-pdus are duplicated and routed at ip layer towards the target rnc together with their related downlink pdcp sequence numbers. the source rnc continues transmitting duplicates of downlink data and receiving uplink data.
 before the serving rnc role is not yet taken over by target rnc and when downlink UP data starts to arrive to target rnc, the target rnc may buffer or discard arriving downlink gtp-pdus according to the related qos profile.
note?9: this step is unmodified compared to pre-rel-8. the target enodeb acts as the target srnc. the data forwarding may go directly to target enodeb or alternatively go via the serving gw if so decided by new mme in the preparation phase.
13. before sending the rrc message the uplink and downlink data transfer shall be suspended in the source srnc for rabs, which require delivery order. the rrc message is for example physical channel reconfiguration for rns to rns relocation, or intersystem to utran handover for bss to rns relocation, or handover from utran command for bss relocation, or handover command for bss to bss relocation. when the source srnc is ready, the source rnc shall trigger the execution of relocation of srns by sending to the ms the rrc message provided in the target rnc to source rnc transparent container, e.g., a physical channel reconfiguration (ue information elements, cn information elements) message. ue information elements include among others new srnc identity and s rnti. cn information elements contain among others location area identification and routing area identification.
 when the ms has reconfigured itself, it sends an rrc message e.g., a physical channel reconfiguration complete message to the target srnc. if the forward srns context message with the sequence numbers is received, the exchange of packets with the ms may start. if this message is not yet received, the target rnc may start the packet transfer for all rabs, which do not require maintaining the delivery order.
note?10: this step is unmodified compared to pre-rel-8. this text is valid for the rrc message sent from source rnc to the ue. when the ue has got access to target enodeb it sends the ho to e-utran complete message. this rrc message received as part of target to source transparent container, includes information about the selected security algorithms and related key information. based on this information, the ue selects the same algorithms for the nas if the ksi value indicates that the mme has no security association with the ue. if the ksi value indicates that the mme has a security association with the ue, but the ue has lost the security context of the e-utran side (error case), the ue will start attach procedure on the e-utran side
14. there is no ran context transfer during inter rat handovers with e-utran. if the source rnc originates any srnc contexts the mme acknowledges the receipt towards the sgsn and ignores the message content.
note?11: this step is unmodified compared to pre-rel-8. the new mme acts as the new sgsn, and the target enodeb as the target srnc.
15. when the ue has successfully accessed the target enodeb, the target enodeb informs the target mme by sending the message handover notify (tai+ecgi). the ue shall implicitly derive the eps bearers for which an e-rab was not established from the ho from utran command and deactivate them locally without an explicit nas message at this step.
 if dual connectivity is activated for the ue, the pscell id shall be included in the handover notify message.
16. upon receipt of handover notify message, if the srns relocation is an inter sgsn srns relocation, the new sgsn signals to the old sgsn the completion of the srns relocation procedure by sending a forward relocation complete message.
 upon receipt of the relocation complete message the new mme starts a timer.
note?12: this step is unmodified compared to pre-rel-8 except that the handover notify message is received instead of a relocation complete message. the new mme acts as the new sgsn.
17. the target mme will now complete the handover procedure by informing the serving gw that the target mme is now responsible for all the bearers the ue have established. this is performed in the message modify bearer request (cause, tunnel endpoint identifier CP, mme address for CP, enodeb address(es) and teid(s) for user traffic, rat type, apn-ambr) per pdn connection. if the pdn gw requested ue's location information and/or user csg information (determined from the ue context), the mme also includes the user location information ie and/or user csg information ie in this message. if the ue time zone has changed, the mme includes the ue time zone ie in this message.
 the mme releases the non-accepted bearers by triggering the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
18. the serving gw informs the pdn gw the apn-ambr and the change of for example the rat type that e.g. can be used for charging, by sending the message modify bearer request (apn-ambr, serving network, pdn charging pause support indication) per pdn connection. the s gw also includes user location information ie and/or ue time zone ie and/or user csg information ie if it is present in step?17. the serving gw allocates dl teids on s5/s8 even for non-accepted bearers. the pdn gw must acknowledge the request with the message modify bearer response (default bearer id, apn restriction, pdn charging pause enabled indication (if pdn gw has chosen to enable the function)). when the ue moves from gn/gp sgsn to the mme, the pdn?gw shall send the apn restriction of each bearer context to the serving gw.
19. the serving gw acknowledges the UP switch to the target mme via the message modify bearer response (cause, tunnel endpoint identifier CP, serving gw address for CP, default bearer id, apn restriction). the serving gw shall forward the received apn restriction to the mme. at this stage the UP path is established for all bearers between the ue, target enodeb, serving gw and pdn gw.
20. upon receiving the relocation complete message or, if it is an inter-sgsn srns relocation, the forward relocation complete message, the old sgsn sends an iu release command message to the source rnc. when the rnc data-forwarding timer has expired, the source rnc responds with an iu release complete message.
note?13: this step is unmodified compared to pre-rel-8.
21. the ue initiates a tracking area update procedure when one of the conditions listed in clause "triggers for tracking area update" applies.
 the target mme knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target mme performs only a subset of the ta update procedure, specifically it excludes the context transfer procedures between source sgsn and target mme. the target mme gets the subscribed ue-ambr value and the subscribed apn-ambr value from the hss during the ta update procedure.
 if the subscription data received from the hss (during the tau) contains information that is necessary for the e-utran to be aware of (e.g. a restriction in the ue's permission to use nr as a secondary rat, unlicensed spectrum or a combination of them), or an existing ue context in the mme indicates that the ue is not permitted to use nr as a secondary rat, unlicensed spectrum or a combination of them, and the mme has not provided this information to the target enodeb during step?6 (the handover request), then the mme sends an updated handover restriction list in the downlink nas transport message that it sends to e-utran.
22. the target mme calculates ue-ambr as defined in clause?4.7.3. if this calculated value is different from the ue-ambr computed during step?6, or the apn-ambr mapped from the subscribed mbr is different from the subscribed apn-ambr, or the mapped subscribed qos profile (i.e. the subscribed qos profile mapped according to annex e) of the default bearer is different from the eps subscribed qos profile received from the hss, the new mme shall initiate subscribed qos modification procedure as described in clause?5.4.2.2, figure 5.4.2.2-1.
23. when the timer started in step?16 expires the new mme releases the resources that have been allocated for indirect forwarding.
if the srns relocation is inter-sgsn, then the following camel procedure calls shall be performed (see referenced procedures in ts?23.078?[29])
c1) camel_gprs_pdp_context_disconnection, camel_gprs_detach and camel_ps_notification.
 they are called in the following order:
- the camel_gprs_pdp_context_disconnection procedure is called several times: once per pdp context. the procedure returns as result "continue".
- then the camel_gprs_detach procedure is called once. the procedure returns as result "continue".
- then the camel_ps_notification procedure is called once. the procedure returns as result "continue".
the new sgsn shall determine the maximum apn restriction based on the received apn restriction of each pdp context from the ggsn and then store the new maximum apn restriction value.
if the srns relocation is intra-sgsn, then the above mentioned camel procedures calls shall not be performed.
if routing area update occurs, the sgsn shall determine whether direct tunnel can be used based on the received gprs camel subscription information. if direct tunnel can not be maintained the sgsn shall re-establish rabs and initiate the update pdp context procedure to update the ip address and teid for uplink and downlink data.
if routing area update occurs, then the following camel procedure calls shall be performed (see referenced procedures in ts?23.078?[29]):
note?14: this camel handling is unmodified compared to pre-rel-8.
note?15: camel procedure calls c2 and c3 were omitted intentionally from this procedure since eps does not support camel procedure calls.
note?16: handover reject procedure is performed as defined in clause?5.5.2.2.4.
d.3.5 routing area update
the routing area update procedure takes place when a ue that is registered with an mme selects a utran or geran cell served by a gn/gp sgsn. in this case, the ue changes to a routing area that the ue has not yet registered with the network. this procedure is initiated by an idle state or by a connected state ue. the routing area update procedure is illustrated in figure?d.3.5-1.
any step descriptions that are taken from ts?23.060?[7] for a gn/gp sgsn are shown as italic text and remain unmodified. in that step descriptions an ms stands for ue, old sgsn for old mme and ggsn for p gw. the old mme behaves towards the new gn/gp sgsn always like an old gn/gp 3g-sgsn, regardless of whether the new gn/gp sgsn is a 2g-sgsn or a 3g-sgsn.

figure d.3.5-1: routing area update procedure
0. the ue selects a utran or geran cell. this cell is in a routing area that the ue not yet registered with the network or the ue reselects a utran or geran cell and the tin indicates "guti". the ue in ecm connected state may change to the geran cell through network assisted cell change (nacc).
1. the ms sends a routing area update request (old p tmsi, old rai, old p tmsi signature, update type, follow on request, classmark, ms network capability, additional p tmsi/rai, ksi) to the new sgsn. update type shall indicate ra update, periodic ra update, combined ra?/?la update or combined ra?/?la update with imsi attach requested. the bss shall add the cell global identity including the rac and lac of the cell where the message was received before passing the message to the sgsn. the srnc shall add the routing area identity before forwarding the message to the 3g-sgsn. classmark contains the ms gprs multislot capabilities and supported gprs ciphering algorithms as defined in ts?24.008?[47]. the sgsn may use, as an implementation option, the follow-on request indication to release or keep the iu connection after the completion of the ra update procedure.
 if the ue's tin indicates "guti" and the ue holds a valid guti then the ue indicates the guti as the old p tmsi and old rai. if the ue's tin indicates "p tmsi" or "rat related tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as old p tmsi and old rai. mapping a guti to a p tmsi and an rai is specified in ts?23.003?[9].
 if the ue holds a valid p tmsi and related rai and the old p-tmsi and old rai indicate a p-tmsi/rai mapped from a guti, then the ue indicates these parameters as additional p tmsi/rai. the gn/gp sgsn shall ignore this additional p tmsi/rai.
 the old p tmsi is indicated in the rau request message for iu mode only. for gb mode the tlli is derived from the value that is determined as the old p tmsi according to the rules above. the routing parameter that is signalled in the rrc signalling to the rnc for routing to the sgsn is derived from the identifier that is signalled as the old p tmsi according to the rules above. for a combined mme/sgsn the ran is configured to route the nri(s) of this combined node to the same combined node. the ran is also configured to route nri(s) of p tmsis that are generated by the ue's mapping of the gutis allocated by the combined node. such a ran configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.
 ksi is mapped from an eksi indentifying a kasme if the ue indicates a p tmsi mapped from guti in the information element "old p tmsi". ksi identifies a (ck, ik) pair if the ue indicates a p tmsi in the information element "old p tmsi".
2. the new sgsn sends sgsn context request (old rai, tlli or old p-tmsi, old p tmsi signature, new sgsn address) to the old sgsn to get the mm and pdp contexts for the ms. if the new sgsn provides functionality for intra domain connection of ran nodes to multiple cn nodes, the new sgsn may derive the old sgsn from the old rai and the old p-tmsi (or tlli) and send the sgsn context request message to this old sgsn. otherwise, the new sgsn derives the old sgsn from the old rai. in any case the new sgsn will derive an sgsn that it believes is the old sgsn. this derived sgsn is itself the old sgsn, or it is associated with the same pool area as the actual old sgsn and it will determine the correct old sgsn from the p-tmsi (or tlli) and relay the message to that actual old sgsn.
note?2: a guti mapped to a p-tmsi/rai provides an old rai that uniquely identifies an old mme then there is no need to relay between mme in the old pool, regardless whether the new sgsn supports such functionality or not. mapping a guti to a p tmsi and an rai is specified in annex?h.
 the old sgsn validates the old p tmsi signature and responds with an appropriate error cause if it does not match the value stored in the old sgsn. this should initiate the security functions in the new sgsn. if the security functions authenticate the ms correctly, the new sgsn shall send an sgsn context request (old rai, tlli, ms validated, new sgsn address) message to the old sgsn. ms validated indicates that the new sgsn has authenticated the ms. if the old p tmsi signature was valid or if the new sgsn indicates that it has authenticated the ms, the old sgsn starts a timer. if the ms is not known in the old sgsn, the old sgsn responds with an appropriate error cause.
 if the ue with emergency bearers is not authenticated in the old mme (in a network supporting unauthenticated ues) the old mme continues the procedure with sending a context response and starting the timer also when it cannot validate the context request.
 if the ue uses power saving functions and the old mme indicates buffered dl data waiting, the new sgsn invokes data forwarding and UP setup corresponding to clause?5.3.3.1a.
note?3: for the new sgsn, this step is unmodified compared to pre-rel-8. the mme (called old sgsn in above description) needs to provide sgsn functionality.
2b. the old 3g sgsn responds with an sgsn context response (mm context, pdp contexts) message. for each pdp context the old 3g-sgsn shall include the gtp sequence number for the next uplink gtp pdu to be tunnelled to the ggsn and the next downlink gtp sequence number for the next pdu to be sent to the ms. each pdp context also includes the pdcp sequence numbers if pdcp sequence numbers are received from the old srns. the new 3g-sgsn shall ignore the ms network capability contained in mm context of sgsn context response only when it has previously received an ms network capability in the routing area request. the gtp sequence numbers received from the old 3g-sgsn are only relevant if delivery order is required for the pdp context (qos profile).
note?4: this step is for the gn/gp sgsn unmodified compared to pre-rel-8. the mme (old sgsn in this step) maps eps bearers one-to-one to pdp contexts and provides the release 99 parameters of the bearer qos profile to the new sgsn. the gn signalling between the new gn/gp sgsn and the old cn node has no capabilities to indicate isr activated or isr supported. the gtp and pdcp sequence numbers are not relevant as the network does not configure usage of "delivery order required" and does not configure loss less utran pdcp as described in clause "compatibility issues".
 for ue using ciot eps optimisation without any activated pdn connection, there is no pdp context(s) included in the sgsn context response message.
 the mme (old sgsn in this step) only transfers the pdp context(s) that the new sgsn supports. if not supported, pdp context(s) of non-ip pdn connection are not transferred to the new sgsn. if the pdp context(s) of a pdn connection has not been transferred, the mme shall consider all bearers of that pdn connection as failed and release that pdn connection by triggering the mme requested pdn disconnection procedure specified in clause?5.10.3.
3. security functions may be executed. these procedures are defined in clause "security function" in ts?23.060?[7]. ciphering mode shall be set if ciphering is supported. if the sgsn context response message did not include imeisv and add is supported by the sgsn, the sgsn retrieves the imeisv from the ms.
 if the security functions fail (e.g. because the sgsn cannot determine the hlr address to establish the send authentication info dialogue), the inter sgsn rau update procedure fails. a reject shall be returned to the ms with an appropriate cause.
note?5: this step is unmodified compared to pre-rel-8.
4. the new sgsn sends an sgsn context acknowledge message to the old sgsn. the old mme (which is the old sgsn from the new sgsn's point of view) marks in its context that the information in the gws and the hss are invalid. this triggers the gws, and the hss to be updated if the ue initiates a tracking area update procedure back to the old mme before completing the ongoing routing area update procedure. if the security functions do not authenticate the ms correctly, then the routing area update shall be rejected, and the new sgsn shall send a reject indication to the old sgsn. the old mme shall continue as if the sgsn context request was never received.
note?6: the new sgsn's operation is unmodified compared to pre-rel-8. the old mme/s-gw (old sgsn from the new sgsn's point of view) does not forward any data towards the new sgsn.
5. void.
6. the new sgsn sends update pdp context request (new sgsn address, teid, qos negotiated, serving network identity, cgi/sai, user csg information, rat type, ms info change reporting support indication, nrsn) to the ggsns concerned. the sgsn shall send the serving network identity to the ggsn. nrsn indicates sgsn support of the network requested bearer control. the sgsn shall only indicate that it supports the procedure if it supports it and it is indicated that the ms also supports it in the sgsn context response message as described above. if the nrsn is not included in the update pdp context request message the ggsn shall, following this procedure, perform a ggsn-initiated pdp context modification to change the bcm to 'ms-only' for all pdp-address/apn-pairs for which the current bcm is 'ms/nw'. the ggsns update their pdp context fields and return update pdp context response (teid, prohibit payload compression, apn restriction, ms info change reporting action, csg information reporting action, bcm). the prohibit payload compression indicates that the sgsn should negotiate no data compression for this pdp context.
note?9: this step is unmodified compared to pre-rel-8.
 for ue using ciot eps optimisation without any activated pdn connection, the steps 6 and 13 are skipped.
7. the new sgsn informs the hlr of the change of sgsn by sending update location (sgsn number, sgsn address, imsi, imeisv, update type, homogenous support of ims voice over ps sessions) to the hlr. imeisv is sent if the add function is supported. update type indicates "normal update". for "homogenous support of ims voice over ps sessions", see clause?5.3.8a of ts?23.060?[7].
note?10: this step is unmodified compared to pre-rel-8. clarification about update type added to show that this is the trigger for the hss to cancel only an old sgsn and not also an old mme.
8. the hlr sends cancel location (imsi, cancellation type) to any old sgsn with cancellation type set to update procedure. the old sgsn removes the mm and eps bearer contexts. the old sgsn acknowledges with cancel location ack (imsi).
note?11: for the gn/gp sgsn the hss interoperation is unmodified compared to earlier standards releases.
9. the hlr sends insert subscriber data (imsi, gprs subscription data) to the new sgsn. the new sgsn validates the ue's presence in the (new) ra. if due to regional subscription restrictions or access restrictions the ms is not allowed to be attached in the ra, the sgsn rejects the routing area update request with an appropriate cause, and may return an insert subscriber data ack (imsi, sgsn area restricted) message to the hlr. if the network supports the mocn configuration for network sharing, the sgsn may, if the ms is not a 'network sharing supporting ms', in this case decide to initiate redirection by sending a reroute command to the rns, as described in ts?23.251?[24] instead of rejecting the routing area update request. if all checks are successful, the sgsn constructs an mm context for the ms and returns an insert subscriber data ack (imsi) message to the hlr.
note?12: this step is unmodified compared to pre-rel-8.
10. the hlr acknowledges the update location by sending update location ack (imsi) to the new sgsn.
note?13: this step is unmodified compared to pre-rel-8.
11. if the new sgsn is a 2g-sgsn: the new sgsn validates the ms's presence in the new ra. if due to roaming restrictions or access restrictions the ms, is not allowed to be attached in the sgsn, or if subscription checking fails, the new sgsn rejects the routing area update with an appropriate cause. if all checks are successful, the new sgsn constructs mm and pdp contexts for the ms. a logical link is established between the new sgsn and the ms. the new sgsn responds to the ms with routing area update accept (p tmsi, p tmsi signature, receive n pdu number, pdp context status). receive n pdu number contains the acknowledgements for each acknowledged-mode nsapi used by the ms, thereby confirming all mobile-originated n pdus successfully transferred before the start of the update procedure.
 if the new sgsn is a 3g-sgsn: the new sgsn validates the ms's presence in the new ra. if due to roaming restrictions or access restrictions the ms is not allowed to be attached in the ra, or if subscription checking fails, the sgsn rejects the routing area update with an appropriate cause. if the network supports the mocn configuration for network sharing, the sgsn may, if the ms is not a 'network sharing supporting ms', in this case decide to initiate redirection by sending a reroute command to the rns, as described in ts?23.251?[24] instead of rejecting the routing area update. if all checks are successful, the new sgsn establishes mm context for the ms. the new sgsn responds to the ms with routing area update accept (p-tmsi, vlr tmsi, p-tmsi signature).
 for a ms with ongoing emergency bearer services, the new 3g-sgsn accepts the routing area update request and deactivates the non-emergency pdp contexts as specified in clause?9.2.4.2 in ts?23.060?[7].
 when receiving the rau accept message and there is no isr activated indication the ue shall set its tin to "p tmsi".
 with the pdp context status information, the ms shall deactivate all those bearers contexts locally which are active in the ms, but are indicated by the sgsn as being inactive.
note 13a: a gn/gp sgsn never indicates isr activated as it does not support isr.
note?14: for the sgsn this step is unmodified compared earlier standards releases. n-pdu numbers are not relevant as the network does not configure usage of acknowledged mode nsapis as described in clause "compatibility issues".
12. if the new sgsn is a 2g-sgsn: the ms acknowledges the new p tmsi by returning a routing area update complete (receive n pdu number) message to the sgsn. receive n pdu number contains the acknowledgements for each acknowledged-mode nsapi used by the ms, thereby confirming all mobile-terminated n pdus successfully transferred before the start of the update procedure. if receive n pdu number confirms reception of n pdus that were forwarded from the old sgsn, these n pdus shall be discarded by the new sgsn. llc and sndcp in the ms are reset.
 if the new sgsn is a 3g-sgsn: the ms confirms the reallocation of the tmsis by returning a routing area update complete message to the sgsn.
note?15: this step is unmodified compared to pre-rel-8. n-pdu numbers are not relevant as the network does not configure usage of acknowledged mode nsapis as described in clause "compatibility issues".
13. when the timer started in step 2) expires the old mme releases any ran and serving gw resources. if the plmn has configured secondary rat usage data reporting, the mme first releases ran resource before releasing serving gw resources.
 when the mme receives secondary rat usage data from enodeb in the s1 ue context release complete message, the mme continues with the secondary rat usage data reporting procedure using change notification message as described in clause?5.7a.3. the reporting procedure in clause?5.7a.3 is only performed if pgw secondary rat usage reporting is active.
 the old mme deletes the eps bearer resources by sending delete session request (cause; operation indication, secondary rat usage data) messages to the serving gw. the operation indication flag is not set, that indicates to the old serving gw that the old serving gw shall not initiate a delete procedure towards the pdn gw. secondary rat usage data is included if it was received from the source enodeb in the s1 ue context release complete message. the old mme derives from the gtpv1 context transfer signalling that the new sgsn is a gn/gp sgsn and therefore any old s gw resources are released by the old mme. a gn/gp sgsn does not signal any s gw change. if the old s gw has due to isr a control connection with another cn node (mme or sgsn) the cause indicates to the old s gw that the old s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that other old cn node.
 if the old mme has an s1-mme association for the ue, the source mme sends a s1-u release command to the source enodeb when receiving the sgsn context acknowledge message from the new sgsn. the rrc connection is released by the source enodeb. the source enodeb confirms the release of the rrc connection and of the s1-u connection by sending a s1-u release complete message to the source mme. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the source enodeb includes secondary rat usage data in this message.
note?16: the new sgsn may initiate rab establishment after execution of the security functions, or wait until completion of the ra update procedure. for the ms, rab establishment may occur anytime after the routing area update request is sent.
in the case of a rejected routing area update operation, due to regional subscription, roaming restrictions, access restrictions (see ts?23.221?[27] and ts?23.008?[28]) or because the sgsn cannot determine the hlr address to establish the locating updating dialogue, the new sgsn shall not construct an mm context. a reject shall be returned to the ms with an appropriate cause and the ps signalling connection shall be released. upon return to idle, the ms shall act according to ts?23.122?[10].
if the network supports the mocn configuration for network sharing, the sgsn may, if the ms is not a 'network sharing supporting ms', in this case decide to initiate redirection by sending a reroute command to the rns, as described in ts?23.251?[24] instead of rejecting the routing area update.
if the new sgsn is unable to update the pdp context in one or more ggsns, the new sgsn shall deactivate the corresponding pdp contexts as described in clause "sgsn-initiated pdp context deactivation procedure". this shall not cause the sgsn to reject the routing area update.
the pdp contexts shall be sent from old to new sgsn in a prioritized order, i.e. the most important pdp context first in the sgsn context response message. (the prioritization method is implementation dependent, but should be based on the current activity).
the new sgsn shall determine the maximum apn restriction based on the received apn restriction of each pdp context from the ggsn and then store the new maximum apn restriction value.
if the new sgsn is unable to support the same number of active pdp contexts as received from old sgsn, the new sgsn should use the prioritisation sent by old sgsn as input when deciding which pdp contexts to maintain active and which ones to delete. in any case, the new sgsn shall first update all contexts in one or more ggsns and then deactivate the context(s) that it cannot maintain as described in clause "sgsn-initiated pdp context deactivation procedure". this shall not cause the sgsn to reject the routing area update.
note?17: in case ms was in pmm-connected state the pdp contexts are sent already in the forward relocation request message as described in clause "serving rns relocation procedures" of ts?23.060?[7].
if the routing area update procedure fails a maximum allowable number of times, or if the sgsn returns a routing area update reject (cause) message, the ms shall enter idle state.
note?18: the c1 camel procedure call was omitted intentionally from this procedure since eps does not support camel procedure calls. the other camel procedure calls are unmodified compared to pre-rel-8.
the camel procedure calls shall be performed, see referenced procedures in ts?23.078?[29]:
c2) camel_gprs_routing_area_update_session and camel_ps_notification.
 they are called in the following order:
- the camel_gprs_routing_area_update_session procedure is called. the procedure returns as result "continue".
- then the camel_ps_notification procedure is called. the procedure returns as result "continue".
c3) camel_gprs_routing_area_update_context.
d.3.6 gn/gp sgsn to mme tracking area update
the gn/gp sgsn to mme tracking area update procedure is illustrated in figure?d.3.6-1.
any steps descriptions that are from ts?23.060?[7] are shown as italic text and remain unmodified. in those step descriptions an ms stands for ue, new sgsn for new mme, old sgsn for old gn/gp sgsn, ggsn for p gw, and hlr for hss. the new mme behaves towards the old gn/gp sgsn always like a gn/gp 3g-sgsn, regardless of whether the old gn/gp sgsn is a 2g-sgsn or a 3g-sgsn.

figure d.3.6-1: gn/gp sgsn to mme tracking area update procedure
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?13 and 15 concern gtp based s5/s8.
1. one of the triggers described in clause?5.3.3.0 for starting the tau procedure occurs.
2. the ue sends to the enodeb a tracking area update request (last visited tai, p tmsi signature, old guti, ue core network capability, preferred network behaviour, active flag, eps bearer status, additional guti, eksi, nas sequence number, nas-mac, ksi) message together with rrc parameters indicating the selected network and the old gummei.
 in the rrc connection establishment signalling associated with the tau request, the ue indicates its support of the ciot eps optimisations relevant for mme selection.
 if the ue's tin indicates "guti" or "rat related tmsi" and the ue holds a valid guti then the old guti indicates this valid guti. if the ue's tin indicates "p tmsi" and the ue holds a valid p tmsi and related rai then these two elements are indicated as the old guti. mapping a p tmsi and an rai to a guti is specified in annex h.
 if the ue holds a valid guti and the old guti indicates a guti mapped from a p-tmsi and rai, then the ue indicates the native guti. if the old guti indicates a guti mapped from a p-tmsi and rai, and the ue has a valid p-tmsi signature, the p-tmsi signature shall be included.
 the rrc parameter "old gummei" takes its value from the identifier that is signalled as the old guti according to the rules above. for a combined mme/sgsn the enodeb is configured to route the mme code(s) of this combined node to the same combined node. this enodeb is also configured to route mme code(s) of gutis that are generated by the ue's mapping of the p tmsis allocated by the combined node. such an enodeb configuration may also be used for separate nodes to avoid changing nodes in the pool caused by inter rat mobility.
note?2: in the scenario of this flow the ue's tin indicates "p tmsi" and therefore the ue indicates a p tmsi as the old guti.
 the last visited tai is included if the ue has any in order to help the mme to produce a good list of tais for any subsequent tau accept message. selected network indicates the network that is selected. active flag is a request by ue to activate the radio and s1 bearers for all the active eps bearers by the tau procedure. the eps bearer status indicates each eps bearer that is active within the ue. the ue's isr capability is included in the ue core network capability element.
 if the ue has valid eps security parameters, the tau request message shall be integrity protected by the nas mac in order to allow validation of the ue by the mme. eksi, nas sequence number and nas mac are included if the ue has valid eps security parameters. nas sequence number indicates the sequential number of the nas message. ksi is included if the ue indicates a guti mapped from a p tmsi in the information element "old guti".
 if a ue includes a preferred network behaviour, this defines the network behaviour the ue is expecting to be available in the network as defined in clause?4.3.5.10.
3. the enodeb derives the mme address from the rrc parameters carrying the old gummei, the indicated selected network and the rat (nb-iot or wb-e-utran). if that gummei is not associated with the enodeb, or the gummei is not available, the enodeb selects the mme as described in clause 4.3.8.3 on "mme selection function".
 the enodeb forwards the tau request message together with the tai+ecgi and rat type of the cell from where it received the message and with the selected network to the mme.
 the rat type shall distinguish between nb-iot and wb-e-utran types.
 to assist location services, the enb indicates the ue's coverage level to the mme.
4. the new mme sends sgsn context request (old rai, p tmsi, old p tmsi signature, new sgsn address) to the old sgsn to get the mm and pdp contexts for the ue.
 the new mme shall support functionality for intra domain connection of ran nodes to multiple cn nodes, i.e. the mme derives the old sgsn from the old rai and the old p-tmsi (or tlli).
 when the internal structure of the pool area where the ms roamed from is not known, the new mme derives the old sgsn from the old rai as described at clause?5.8 in ts?23.060?[7]. for this case, the new mme derives an sgsn that it believes is the old sgsn. this derived sgsn is itself the old sgsn, or it is associated with the same pool area as the actual old sgsn and it will determine the correct old sgsn from the p-tmsi (or tlli) and relay the message to that actual old sgsn.
5. if the old sgsn is a 2g-sgsn: the old 2g-sgsn validates the old p tmsi signature and responds with an appropriate error cause if it does not match the value stored in the old 2g sgsn. this should initiate the security functions in the new sgsn. if the security functions authenticate the ms correctly, the new sgsn shall send an sgsn context request (old rai, old ptmsi, ms validated, new sgsn address) message to the old sgsn. ms validated indicates that the new sgsn has authenticated the ms. if the old p tmsi signature was valid or if the new sgsn indicates that it has authenticated the ms, the old sgsn stops assigning sndcp n pdu numbers to downlink n pdus received, and responds with sgsn context response (mm context, pdp contexts). if the ms is not known in the old sgsn, the old sgsn responds with an appropriate error cause. the old sgsn stores new sgsn address, to allow the old sgsn to forward data packets to the new sgsn. each pdp context includes the sndcp send n pdu number for the next downlink n pdu to be sent in acknowledged mode to the ms, the sndcp receive n pdu number for the next uplink n pdu to be received in acknowledged mode from the ms, the gtp sequence number for the next downlink n pdu to be sent to the ms and the gtp sequence number for the next uplink n pdu to be tunnelled to the ggsn. the old sgsn starts a timer and stops the transmission of n-pdus to the ms. the new sgsn shall ignore the ms network capability contained in mm context of sgsn context response only when it has previously received an ms network capability in the routing area request.
 if the old sgsn is a 3g-sgsn: the old 3g-sgsn validates the old p tmsi signature and responds with an appropriate error cause if it does not match the value stored in the old sgsn. this should initiate the security functions in the new sgsn. if the security functions authenticate the ms correctly, the new sgsn shall send an sgsn context request (imsi, old rai, ms validated) message to the old 3g-sgsn. ms validated indicates that the new sgsn has authenticated the ms. if the old p tmsi signature was valid or if the new sgsn indicates that it has authenticated the ms, the old sgsn starts a timer. if the ms is not known in the old sgsn, the old 3g-sgsn responds with an appropriate error cause.
 if the ue with emergency bearers is not authenticated in the old mme (in a network supporting unauthenticated ues) the old mme continues the procedure with sending a context response and starting the timer also when it cannot validate the context request.
 the old 3g sgsn responds with an sgsn context response (mm context, pdp contexts) message. for each pdp context the old 3g sgsn shall include the gtp sequence number for the next uplink gtp pdu to be tunnelled to the ggsn and the next downlink gtp sequence number for the next pdu to be sent to the ms. each pdp context also includes the pdcp sequence numbers if pdcp sequence numbers are received from the old srns. the new 3g-sgsn shall ignore the ms network capability contained in mm context of sgsn context response only when it has previously received an ms network capability in the routing area request. the gtp sequence numbers received from the old 3g-sgsn are only relevant if delivery order is required for the pdp context (qos profile).
 if the ue uses power saving functions and the dl data buffer expiration time for the ue has not expired, the old gn/gp-sgsn indicates buffered dl data waiting. when this is indicated, the new mme invokes data forwarding and UP setup corresponding to clause?5.3.3.1a.
note?3: in this step, the new "sgsn" shall be understood to be a new "mme" and the old sgsn stores new sgsn address, to allow the old sgsn to forward data packets to the new "s gw or enodeb". this step describes both the 2g and 3g sgsn variants due to combining the 2g or 3g sgsn to mme tau into a single procedure.
note 4: for the old sgsn, this step is unmodified compared to pre-rel-8. the mme (called new sgsn in above description) must provide sgsn functionality which includes mapping pdp contexts to eps bearer information. sndcp, gtp and pdcp sequence numbers are not relevant for the mme as the network does not configure usage of "delivery order required", does not configure acknowledged mode nsapis (sndcp) and does not configure loss less utran pdcp as described in clause "compatibility issues".
6. security functions may be executed. procedures are defined in clause?5.3.10 on security function. if the sgsn context response message from the old sgsn did not include imeisv, the mme shall retrieve the me identity (the imeisv) from the ue.
7. if the new mme identifies that the rat type has changed, the mme checks the subscription information to identify for each apn whether to maintain the pdn connection, disconnect the pdn connection with a reactivation request, or, disconnect the pdn connection without reactivation request. if the mme decides to deactivate a pdn connection it performs mme-initiated pdn connection deactivation procedure after the tracking area update procedure is completed but before the s1/rrc interface connection is released. existing esm cause values as specified in ts?24.301?[46] (e.g. #39, "reactivation requested"; #66 "requested apn not supported in current rat and plmn combination"; and for a dedicated bearer, possibly #37 "eps qos not accepted") are used to cause predictable ue behaviour. if all the pdn connections are disconnected and the ue does not support "attach without pdn connectivity", the mme shall request the ue to detach and reattach.
 the new mme sends an sgsn context acknowledge message to the old sgsn. this informs the old sgsn that the new sgsn is ready to receive data packets belonging to the activated pdp contexts. the old sgsn marks in its context that the msc/vlr association and the information in the ggsns and the hlr are invalid. this triggers the msc/vlr, the ggsns, and the hlr to be updated if the ms initiates a routing area update procedure back to the old sgsn before completing the ongoing routing area update procedure.
 if the security functions do not authenticate the ue correctly, then the tracking area update shall be rejected, and the new mme shall send a reject indication to the old sgsn. the old sgsn shall continue as if the sgsn context request was never received.
note?5: in the italic text of this step, new "sgsn" shall be understood as to be a new "mme". the mme needs to map pdp contexts received from gn/gp sgsn into eps bearer information. the ggsn address(es) and teids map to the pdn gw address(es) and teids respectively. . the mme maps pdp contexts to eps bearers one-to-one and it translates the release 99 qos parameters to the eps bearer qos parameters.
note?6: the sgsn operation is unmodified compared to pre-rel-8. the mme indicates reserved teid and ip address parameters from an s-gw to the old sgsn so that the old gn/gp sgsn can forward data packets when needed. the s-gw discards any packets received from old gn/gp sgsn.
note?7: the gn signalling between the new mme and the old gn/gp sgsn has no capabilities to indicate isr supported or isr activated.
 if there is no pdp context at all and the ciot eps optimisation without pdn connection is not applied, the mme rejects the tau request.
 for ue using ciot eps optimisation without any activated pdn connection, the steps 9, 10, 11, 12 and 13 are skipped.
8. the old sgsn or the old rnc forward data to the s-gw and the s-gw discards these data.
9. the new mme adopts the bearer contexts received from the sgsn as the ue's eps bearer contexts to be maintained by the new mme. the new mme maps the pdp contexts to the eps bearers 1-to-1 and maps the release?99 qos parameter values of a pdp context to the eps bearer qos parameter values of an eps bearer as defined in annex e. the mme establishes the eps bearer(s) in the indicated order. the mme deactivates the eps bearers which cannot be established.
 the mme verifies the eps bearer status received from the ue with the bearer contexts received from the old sgsn and releases any network resources related to eps bearers that are not active in the ue. if the ue has no pdp context, the mme rejects the tau request.
 the new mme selects a serving gw and sends an create session request (imsi, mme address and teid, pdn gw address and teid, eps bearer qos, serving network identity, me identity, user location information ie, ue time zone ie, user csg information ie, rat type, ms info change reporting support indication, nrs (received from the sgsn)) message per pdn connection to the serving gw. the mme shall send the serving network identity to the serving gw. the new mme does not indicate isr activated.
10. the serving gw creates contexts and informs the pdn gw(s) about the change of the rat type. the serving gw sends a modify bearer request (serving gw address and teid, rat type, me identity, user location information ie, ue time zone ie, user csg information ie, ms info change reporting support indication, pdn charging pause support indication) message per pdn connection to the pdn gw(s) concerned.
11. if dynamic pcc is deployed, and rat type information needs to be conveyed from the pdn gw to the pcrf, then the pdn gw shall send rat type information to the pcrf by performing an ip can session modification procedure as defined in ts?23.203?[6].
note?8: the pdn gw does not need to wait for the pcrf response, but continues in the next step. if the pcrf response leads to an eps bearer modification the pdn gw should initiate a bearer update procedure.
12. the pdn gw updates its context field and returns a modify bearer response (pdn gw address and teid, msisdn, default bearer id, charging id, ms info change reporting action (start) (if the pdn gw decides to receive ue's location information during the session), csg information reporting action (start) (if the pdn gw decides to receive ue's user csg information during the session), pdn charging pause enabled indication (if pdn gw has chosen to enable the function), apn restriction) message to the serving gw. the msisdn is included if the pdn gw has it stored in its ue context. when the ue moves from gn/gp sgsn to the mme, the pdn?gw shall send the apn restriction of each bearer context to the serving gw.
13. the serving gw updates its context and returns an create session response (serving gw address and teid for UP, pdn gw address and teid, serving gw address and teid for the CP, default bearer id, apn restriction) message to the new mme. the message also includes ms info change reporting action (start) and/or csg information reporting action (start) if they are included in step?12. the serving gw shall forward the received apn restriction to the mme.
 when the mme receives the create session response message, the mme checks if there is a "availability after ddn failure" monitoring event or a "ue reachability" monitoring event configured for the ue in the mme and in such a case sends an event notification (see ts?23.682?[74] for further information).
14. to ensure the release of all ue resources in the gn/gp sgsn the new mme informs the hss of the change of the serving core network node by sending an update location request (mme address, imsi, me identity, ulr-flags, mme capabilities, homogenous support of ims voice over ps sessions) message to the hss. the me identity is included if the sgsn context response did not contain the imeisv. because of interoperation with an gn/gp sgsn, which the new mme identifies from the gtpv1 context response signalling, the ulr-flags indicates "single-registration-indication". the mme capabilities indicate the mme's support for regional access restrictions functionality. for "homogenous support of ims voice over ps sessions", see clause?4.3.5.8a.
15. if the mme changes, then the hss cancels any old mme. the hss sends a cancel location (imsi, cancellation type) message to the old mme, with a cancellation type set to update procedure.
16. the old mme removes the mm context.
 the old mme releases any local bearer resources and it deletes the eps bearer resources by sending delete session request (cause, operation indication) messages to the serving gw. the operation indication flag is not set, that indicates that the s gw shall not initiate a delete procedure towards the pdn gw. if isr is activated then the cause indicates to the old s gw that the old s gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
 the old mme acknowledges with a cancel location ack (imsi) message.
17. the hss cancels any old sgsn node as the ulr-flags indicates "single-registration-indication". the hss sends a cancel location (imsi, cancellation type) message to the old sgsn. the old sgsn removes the contexts.
 if the timer started in step?5 is not running, the old sgsn removes the mm context. otherwise, the contexts are removed when the timer expires. it also ensures that the mm context is kept in the old sgsn for the case the ue initiates another tau procedure before completing the ongoing tau procedure to the new mme.
note?9: in all other mobility scenarios a new cn node initiates only cancellation of an old cn node of the same type via hss. in this scenario here (gn/gp sgsn to mme tau) the new mme, by indicating single registration, initiates in addition the cancellation of the old gn/gp sgsn via hss to make sure that any pdp contexts of the ue are properly released. mme and s4 sgsn release pdp/pdn contexts based on context transfer signalling.
18. on receipt of cancel location, if the ms is pmm connected in the old sgsn, the old sgsn sends an iu release command message to the old srnc.
19. when the data-forwarding timer has expired, the srns responds with an iu release complete message.
20. the old sgsn acknowledges with a cancel location ack (imsi) message.
21. the new mme validates the ue's presence in the (new) ta. if all checks are successful, the mme constructs an mm context for the ue, the hlr acknowledges the update location by sending update location ack (imsi, subscription data) message to the new mme. if the update location is rejected by the hss, the mme rejects the tau request from the ue with an appropriate cause sent in the tau reject message to the ue.
22. if due to regional subscription restrictions or access restrictions the ue is not allowed to access the ta:
- for ues with ongoing emergency bearer services, the new mme accepts the tracking area update request and releases the non-emergency bearers as specified in clause?5.10.3.
- for all other cases, the new mme rejects tracking area update request with an appropriate cause to the ue and notifies the hss of rejection (details of this notification is stage 3 detail).
 the new mme responds to the ue with a tracking area update accept (guti, tai-list, eps bearer status, nas sequence number, nas-mac, isr activated, supported network behaviour) message. restriction list shall be sent to enodeb as enodeb handles the roaming restrictions and access restrictions in the intra e-utran case.
 if the "active flag" is set in the tau request message the UP setup procedure can be activated in conjunction with the tau accept message. the procedure is described in detail in ts?36.300?[5]. the messages sequence should be the same as for the ue triggered service request procedure specified in clause 5.3.4.1 from the step when mme establishes the bearer(s). if the active flag is set the mme may provide the enodeb with handover restriction list. handover restriction list is described in clause 4.3.5.7 "mobility restrictions". the eps bearer status indicates the active bearers in the network. the ue removes any internal resources related to bearers not marked active in the received eps bearer status. if the eps bearer status information was in the tau request, the mme shall indicate the eps bearer status to the ue.
 for ue using ciot eps optimisation without any activated pdn connection, there is no eps bearer status included in the tau accept message.
 the mme indicates the ciot optimisations it supports and prefers in the supported network behaviour information as defined in clause?4.3.5.10.
 when receiving the tau accept message and there is no isr activated indication the ue shall set its tin to "guti".
note?10: in the case of interoperation with gn/gp sgsns, isr activated is never indicated by the mme as the sgsn does not support isr, which the new mme recognises from gn interface signalling that does not support isr indications.
 if the subscription data received from the hss (during the tau) contains information that is necessary for the e-utran to be aware of (e.g. a restriction in the ue's permission to use nr as a secondary rat, unlicensed spectrum or a combination of them), or an existing ue context in the mme indicates that the ue is not permitted to use nr as a secondary rat, unlicensed spectrum or a combination of them, then the mme sends an updated handover restriction list in the downlink nas transport message that it sends to e-utran. if the ue is not allowed to use nr as secondary rat, the mme indicates that to the ue in tau accept message.
23. if the guti was included in the tau accept message, the ue acknowledges the message by returning a tracking area update complete message to the mme.
 when the "active flag" is not set in the tau request message and the tracking area update was not initiated in ecm-connected state, the mme releases the signalling connection with ue, according to clause?5.3.5.
note?11: the new mme may initiate e rab establishment (see ts?36.413?[36]) after execution of the security functions (step?5), or wait until completion of the ta update procedure. for the ue, e rab establishment may occur anytime after the ta update request is sent (step?2).
24. the target mme calculates ue-ambr as defined in clause?4.7.3. if the local ue-ambr provided by the mme as defined in annex e is different from the corresponding derived ue-ambr, or the apn-ambr mapped from the subscribed mbr is different from the subscribed apn-ambr, or the mapped subscribed qos profile (i.e. the subscribed qos profile mapped according to annex e) of the default bearer is different from the eps subscribed qos profile received from the hss, the new mme shall initiate subscribed qos modification procedure as described in clause?5.4.2.2, figure 5.4.2.2-1.
in the case of a rejected tracking area update operation, due to regional subscription, roaming restrictions, or access restrictions (see ts?23.221?[27] and ts?23.008?[28]) the new mme should not construct a bearer context. in the case of receiving the subscriber data from hss, the new mme may construct an mm context and store the subscriber data for the ue to optimise signalling between the mme and the hss. a reject shall be returned to the ue with an appropriate cause and the s1 connection shall be released. upon return to idle, the ue shall act according to ts?23.122?[10].
if the new mme is unable to update the bearer context in one or more p gws, the new mme shall deactivate the corresponding bearer contexts as described in clause "mme initiated dedicated bearer deactivation procedure". this shall not cause the mme to reject the tracking area update.
the pdp contexts shall be sent from old sgsn to new sgsn (mme) in a prioritized order, i.e. the most important pdp context first in the sgsn context response message. (the prioritization method is implementation dependent, but should be based on the current activity).
the new mme shall determine the maximum apn restriction based on the received apn restriction of each bearer context from the p gw and then store the new maximum apn restriction value.
if there are active eps gbr bearers with maximum bitrate set to 0, the mme should initiate mme initiated dedicated bearer deactivation (as specified in clause?5.4.4.2) to deactivate the related eps bearer context.
if the new mme is unable to support the same number of active bearer contexts as received from old sgsn, the new mme should use the prioritisation sent by old sgsn as input when deciding which bearer contexts to maintain active and which ones to delete. in any case, the new mme shall first update all contexts in one or more p gws and then deactivate the context(s) that it cannot maintain as described in clause "mme initiated dedicated bearer deactivation procedure". this shall not cause the mme to reject the tracking area update.
note?12: if ms (ue) was in pmm-connected state the pdp contexts are sent already in the forward relocation request message as described in clause "serving rns relocation procedures" of ts?23.060?[7].
if the tracking area update procedure fails a maximum allowable number of times, or if the mme returns a tracking area update reject (cause) message, the ue shall enter emm deregistered state.
if the update location ack message indicates a reject, this should be indicated to the ue, and the ue shall not access non-ps services until a successful location update is performed.
the camel procedure calls shall be performed, see referenced procedures in ts?23.078?[29]:
c1) camel_gprs_pdp_context_disconnection, camel_gprs_detach and camel_ps_notification.
 they are called in the following order:
- the camel_gprs_pdp_context_disconnection procedure is called several times: once per pdp context. the procedure returns as result "continue".
- then the camel_gprs_detach procedure is called once. the procedure returns as result "continue".
- then the camel_ps_notification procedure is called once. the procedure returns as result "continue".
note?13: this camel handling is unmodified compared to pre-rel-8.
note?14: camel procedure calls c2 and c3 were omitted intentionally from this procedure since eps does not support camel procedure calls.
d.3.7 e-utran to geran a/gb mode inter rat handover
d.3.7.1 general
the interoperation procedures describe information flows for gn/gp sgsns and other eps network elements. all messages between sgsn and mme, between sgsn and bss, between sgsn and hss and between sgsn and p gw (ggsn in ts?43.129?[8]) as well as the therein contained information elements are the same as specified for the adequate ts?43.129?[8] procedures. these messages and procedure step descriptions are taken from ts?43.129?[8] for explanatory purposes only. these descriptions are in italic text and shall not be modified by the interoperation procedures. it cannot be assumed that the messages and procedure step descriptions that are taken from ts?43.129?[8] will be updated when modifications or corrections are performed for ts?43.129?[8]. if there are any discrepancies for these messages and procedure step descriptions ts?43.129?[8] takes precedence.
the messages between the mme and any other node than the gn/gp sgsn as well as the therein contained information elements are the same as specified in the main body of this technical specification for the irat handover e utran to/from geran a/gb mode procedure (clauses?5.5.2.3 and 5.5.2.4). these descriptions are in bold italic text and should be modified simultaneously when clauses?5.5.2.3 or 5.5.2.4 are updated. if there are any discrepancies, the procedure step descriptions in clauses 5.5.2.3 or 5.5.2.4 take precedence.
d.3.7.2 preparation phase

figure d.3.7.2-1: e-utran to geran a/gb inter rat ho, preparation phase
1. the source enodeb decides to initiate an inter rat handover to the target geran a/gb mode (2g) system. at this point both uplink and downlink user data is transmitted via the following: bearer(s) between ue and source enodeb, gtp tunnel(s) between source enodeb, serving gw and pdn gw.
 if the ue has an ongoing emergency bearer service the source enodeb shall not initiate ps handover to geran.
note?1: the process leading to the handover decision is outside of the scope of this specification
2. the source enodeb sends a handover required (cause, target system identifier, source bss to target bss transparent container) message to the source mme to request the cn to establish resources in the target bss, target sgsn and the serving gw. the bearers that will be subject to data forwarding (if any) are identified by the new sgsn in a later step (see step?8 below).
 the 'target system identifier' ie contains the identity of the target global cell id.
note?2: this step is unmodified compared to clause?5.5.2.3.2. the target sgsn acts as the new sgsn.
3 the old sgsn determines from the target cell identifier that the type of handover is inter-rat/mode handover. in case of inter-rat/ mode inter-sgsn ps handover, the old sgsn initiates the ps handover resource allocation procedure by sending a forward relocation request (imsi, tunnel endpoint identifier CP, ranap cause, target cell identifier, mm context, pdp contexts, packet flow id, sndcp xid parameters, llc xid parameters, pdp context prioritisation, source bss to target bss transparent container [rn part] in the bss container, source rnc id, sgsn address for CP) message to the new sgsn. if the old sgsn supports ps handover procedures then it has to allocate a valid pfi according to clause?4.4.1 during the pdp context activation procedure. each pdp context contains the ggsn address for UP and the uplink teid for data (to this ggsn address and uplink teid for data the old sgsn and the new sgsn send uplink packets).
 the mm context includes information on the eps bearer context(s). if none of the ue's eps bearers can be supported by the selected target sgsn, the old sgsn rejects the handover attempt by sending a handover preparation failure (cause) message to the source enodeb.
note?3: if the handover is successful, the old sgsn will signal to the sgw and/or scef to release any non-included eps bearers after step?8 of the execution procedure. the non-included bearers are locally released by the ms following the pdp context status synchronisation that occurs during the routing area update at step?13 of the execution procedure.
 the mm context contains security related information, e.g. supported ciphering algorithms as described in ts?29.060?[14]. the relation between gsm and umts security parameters is defined in ts?33.102?[40],
 the new sgsn selects the ciphering algorithm to use. this algorithm will be sent transparently from the new sgsn to the ms. the iov-ui parameter generated in the new sgsn and used, as input to the ciphering procedure will also be transferred transparently from the new sgsn to the ms.
 when the new sgsn receives the forward relocation request message the required pdp, mm, sndcp and llc contexts are established and a new p-tmsi is allocated for the ms. when this message is received by the new sgsn it begins the process of establishing pfcs for all pdp contexts.
 when the new sgsn receives the forward relocation request message it extracts from the pdp contexts the nsapis and sapis and pfis to be used in the new sgsn. if for a given pdp context the new sgsn does not receive a pfi from the old sgsn, it shall not request the target bss to allocate tbf resources corresponding to that pdp context. if none of the pdp contexts forwarded from the old sgsn has a valid pfi allocated the new sgsn shall consider this as a failure case and the request for ps handover shall be rejected.
 in case when an sapi and pfi was available at the old sgsn but the new sgsn does not support the same sapi and pfi for a certain nsapi as the old sgsn, the new sgsn shall continue the ps handover procedure only for those nsapis for which it can support the same pfi and sapi as the old sgsn. all pdp contexts for which no resources are allocated by the new sgsn or for which it cannot support the same sapi and pfi (i.e. the corresponding nsapis are not addressed in the response message of the target sgsn), are maintained and the related sapis and pfis are kept. these pdp contexts may be modified or deactivated by the new sgsn via explicit sm procedures upon rau procedure.
 the old sgsn shall indicate the current xid parameter settings if available (i.e. those negotiated at the old sgsn when the ms was in a/gb mode or received during a previous inter-sgsn ps handover) to the new sgsn. if the new sgsn can accept all xid parameters as indicated by the old sgsn, the new sgsn shall create a nas container for ps ho indicating 'reset to the old xid parameters'. otherwise, if the new sgsn cannot accept all xid parameters indicated by the old sgsn or if no xid parameters were indicated by the old sgsn, the new sgsn shall create a nas container for ps ho indicating reset (i.e. reset to default parameters).
note?4: this step is unmodified compared to pre-rel-8. the source enodeb acts as the source rnc, source mme acts as the old sgsn, and the pdn?gw acts as the ggsn.
4. the new sgsn sends a ps handover request (local tlli, imsi, cause, target cell identifier, source bss to target bss transparent container (rn part), pfcs to be set up list, nas container for ps ho) message to the target bss. the new sgsn shall not request resources for pfcs associated with pdp contexts with maximum bit rate for uplink and downlink of 0 kbit/s or for which the activity status indicator within the pdp context indicates that no active rab exists on the source side.
5. based upon the abqp for each pfc the target bss makes a decision about which pfcs to assign radio resources. the algorithm by which the bss decides which pfcs that need resources is implementation specific. due to resource limitations not all downloaded pfcs will necessarily receive resource allocation. the target bss allocates tbfs for each pfc that it can accommodate.
6. the target bss shall prepare the target bss to source bss transparent container which contains a ps handover command including the cn part (nas container for ps ho) and the rn part (ps handover radio resources).
7. target bss shall send the ps handover request acknowledge message (local tlli, list of set up pfcs, target bss to source bss transparent container) message to the new sgsn. upon sending the ps handover request acknowledge message the target bss shall be prepared to receive downlink llc pdus from the new sgsn for the accepted pfcs.
 any pdp contexts for which a pfc was not established are maintained in the new sgsn and the related sapis and pfis are kept. these pdp contexts may be modified or deactivated by the new sgsn via explicit sm procedures upon the completion of the routing area update (rau) procedure.
8. the new sgsn passes the assigned list of teids for each pdp context for which a pfc was assigned in the rab setup information ie in the forward relocation response (cause, list of set up pfcs, target bss to source bss transparent container) in the bss container, tunnel endpoint identifier CP, sgsn address for user traffic, tunnel endpoint identifier data ii) message to the old sgsn. the nsapis of the active pdp contexts received in the forward relocation request message for which the ps handover continues, i.e. for which resources are allocated for the pfcs in the target bss, are indicated in this message.
 the tunnel endpoint identifier data ii, one information for each pdp context, is the tunnel endpoint of the new sgsn and is used for data forwarding from the source enodeb, via the new sgsn, to the target bss.
 the new sgsn activates the allocated llc/sndcp engines as specified in ts?44.064?[23] for an sgsn originated reset or 'reset to the old xid parameters'.
 when the old sgsn receives the forward relocation response message and it decides to proceed with the handover, the preparation phase is finished and the execution phase will follow.
9. if 'indirect forwarding' applies, the source mme sends a create indirect data forwarding tunnel request message (cause, sgsn address(es) and teid(s) for data forwarding) to the serving gw. cause indicates that the bearer(s) are subject to data forwarding.
 indirect forwarding may be performed via a serving gw which is different from the serving gw used as the anchor point for the ue.
9a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding) message to the target mme. if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
note?5: this step is mostly unmodified compared to pre-rel-8. the source mme acts as the old sgsn, and the pdn?gw acts as the ggsn.
d.3.7.3 execution phase

figure d.3.7.3-1: e-utran to geran a/gb mode inter rat ho, execution phase
 the source enodeb continues to receive downlink and uplink UP pdus.
1. the source mme completes the preparation phase towards source enodeb by sending the message handover command (target bss to source bss transparent container (ps handover command with rn part and epc part), bearers subject to data forwarding list). the "bearers subject to data forwarding list" may be included in the message and it shall be a list of 'address(es) and teid(s) for user traffic data forwarding' received from target side in the preparation phase (forward relocation response message (step?8)).
 source enodeb initiate data forwarding for the bearers specified in the "bearers subject to data forwarding list". the data forwarding goes directly to target sgsn decided in the preparation phase.
2. the source enodeb will give a command to the ue to handover to the target access system via the message ho from e-utran command. this message includes a transparent container including radio aspect parameters that the target bss has set-up in the preparation phase (rn part). this message also includes the xid and iov-ui parameters received from the target sgsn (epc part).
 upon the reception of the ho from e-utran command message containing the handover command message, the ue shall associate its bearer ids to the respective pfis based on the relation with the nsapi and shall suspend the uplink transmission of the UP data.
note?1: this step is unmodified compared to clause?5.5.2.3.3. the target sgsn acts as the new sgsn.
3. if the plmn has configured secondary rat usage data reporting and the source enodeb has secondary rat usage data to report, the enodeb sends the ran usage data report message (secondary rat usage data) to the mme. since the handover is an inter-rat handover, the mme continues with the secondary rat usage data reporting procedure as in clause?5.7a.3. the reporting procedure in clause?5.7a.3 is only performed if pgw secondary rat usage reporting is active.
note?2: the source enodeb does not send any ran context towards the target bss.
4. the ms executes the handover according to the parameters provided in the message delivered in step?2. the procedure is the same as in step?6 in clause?5.1.4.2 in ts?43.129?[8] with the additional function of association of the received pfi and existing rab id related to the particular nsapi as described in clause?4.4.1 in ts?43.129?[8].
 the ue locally deactivates isr by setting its tin from "rat-related tmsi" to "guti", if any eps bearer context activated after the isr was activated in the ue exists.
5/7. after accessing the cell using access bursts and receiving timing advance information from the bss in step?2, the ms processes the nas container and then sends one xid response message to the new sgsn. the ms sends this message immediately after receiving the packet physical information message containing the timing advance or, in the synchronised network case, immediately if the ps handover access message is not required to be sent (see clause?6.2 in ts?43.129?[8]).
 upon sending the xid response message, the ms shall resume the user data transfer only for those nsapis for which there are radio resources allocated in the target cell. for nsapis using llc adm for which radio resources were not allocated in the target cell the ms may request for radio resources using the legacy procedures.
note?3: if the new sgsn indicated reset (i.e. reset to default parameters) in the nas container for ps ho included in the handover from utran command message (utran) or the handover from geran iu command message, in order to avoid collision cases the mobile station may avoid triggering xid negotiation for any llc sapi used in llc adm, but wait for the sgsn to do so (see step?12). in any case the mobile station may avoid triggering xid negotiation for any llc sapi used in llc abm, but wait for the sgsn to do so (see step?12a).
note?4: this step is unmodified compared to pre-rel-8. the message "ho from e-utran command" acts as the "handover from utran command" message (utran) or the "handover from geran iu command" message.
6. upon reception of the first correct rlc/mac block (sent in normal burst format) from the ms the target bss sends a ps handover complete (local tlli, handover complete status) message to inform the new sgsn that the ms has arrived in the target cell. each uplink n-pdu received by the new sgsn via the target bss is then forwarded directly to the ggsn.
 a timer in source mme is started to supervise when resources in source enodeb and source serving gw shall be released.
note?5: this step is unmodified compared to pre-rel-8. the pdn?gw acts as the ggsn.
8. upon receiving the ps handover complete message, the new sgsn send a forward relocation complete message to the old sgsn to indicate completion of the ps handover procedures. the old sgsn responds with a forward relocation complete acknowledge message.
 for all bearers that were not included in the forward relocation request message sent in step?3, the old sgsn now releases them by sending a delete bearer command to the sgw, or, the appropriate message to the scef.
note?6: this step is unmodified compared to pre-rel-8. the source mme acts as the old sgsn.
9/11. the new sgsn sends an update pdp context request (new sgsn address, teid, qos negotiated) message to the ggsn concerned. the ggsn updates the pdp context fields and returns an update pdp context response (teid) message. from now on the ggsn sends new incoming downlink ip packets to the new sgsn instead of to the old sgsn.
 the pdn gw shall include a charging id to be used at the sgsn as the charging id for reporting usage for this pdp context. the pdn gw shall include the charging id in the offline charging data.
note?7: this step is unmodified compared to pre-rel-8. the source mme acts as the old sgsn, and the pdn?gw acts as the ggsn.
12. if the new sgsn indicated reset (i.e. reset to default parameters) in the nas container for ps ho included in the handover from utran command message (utran) or the handover from geran iu command message, then on receipt of the ps handover complete the new sgsn initiates an llc/sndcp xid negotiation for each llc sapi used in llc adm. in this case if the sgsn wants to use the default parameters, it shall send an empty xid command. if the new sgsn indicated 'reset to the old xid parameters' in the nas container for ps ho, no further xid negotiation is required for llc sapis used in llc adm only.
note?8: this step is unmodified compared to pre-rel-8. the message "ho from e-utran command" acts as the "handover from utran command" message (utran) or the "handover from geran iu command" message.
12a. the new sgsn (re-)establishes llc abm for the pdp contexts which use acknowledged information transfer. during the exchange of sabm and ua the sgsn shall perform llc/sndcp xid negotiation.
13. the ms sends a routing area update request (old p-tmsi, old rai, old p-tmsi signature, update type) message to the new sgsn informing it that the source cell belongs to a new routing area. the ms shall send this message immediately after message 5, see ts?23.060?[7].
 the new sgsn knows that a handover has been performed for this ms and can therefore exclude the sgsn context procedures which normally are used within the ra update procedure.
 for a ms supporting ciot eps optimisations, the ms uses the pdp context status information in the rau accept to identify any non-transferred bearers that it shall locally release.
 for further descriptions of the routing area update procedure see ts?43.129?[8], clauses?5.5.2.3 and 5.6.1.1.1.
note?9: the rau procedure is performed regardless if the routing area is changed or not, as specified by ts?43.129?[8].
14. when the timer started at step 8 expires, the source mme sends a release resources message to the source enodeb. the source enodeb releases its resources related to the ue.
 additionally, the source mme deletes the eps bearer resources by sending delete session request (cause, operation indication, secondary rat usage data) messages to the serving gw. the operation indication flag is not set, that indicates to the serving gw that it shall not initiate a delete procedure towards the pdn gw. secondary rat usage data was included if it was received in step?3a. the serving gw acknowledges with delete session response (cause) messages. if isr is activated then the cause indicates to the old serving gw that the old serving gw shall delete the bearer resources on the other old cn node by sending delete bearer request message(s) to that cn node.
15. when the timer started in step?8 expires and if resources for indirect forwarding have been allocated then they are released.
d.3.8 geran a/gb mode to e-utran inter rat handover
d.3.8.1 general
see clause?d.3.7.1.
d.3.8.2 preparation phase

figure d.3.8.2-1: geran a/gb mode to e-utran inter rat ho, preparation phase
1. the source bss decides to initiate a ps handover. at this point both uplink and downlink user data is transmitted via the following: tbfs between ms and source bss, bssgp pfcs tunnel(s) between source bss and old sgsn, gtp tunnel(s) between old sgsn and ggsn.
note?1: the ue acts as ms, and the pdn?gw acts as the ggsn.
2. the source bss sends the message ps handover required (tlli, cause, source cell identifier, target enodeb identifier, source to target transparent container (rn part), and active pfcs list) to source sgsn to request the cn to establish resources in the target enodeb, target mme and the serving gw.
note?2: the source sgsn acts as the old sgsn.
note?3: as an implementations option for supporting introduction scenarios with pre-rel8 sgsns the source bss may be configured to use rnc ids instead of enodeb ids to identify a target enodeb. the cause is relayed transparently by the sgsn to the mme and the mme mappes the bssgp cause code to an s1ap cause code. source to target transparent container carries information for the target enodeb. this container is relayed transparently by the sgsn.
3. the source sgsn determines from the 'target enodeb identifier' ie that the type of handover is irat ps handover to e-utran. the source sgsn initiates the handover resource allocation procedure by sending message forward relocation request (imsi, target identification, mm context, pdp context, sgsn tunnel endpoint identifier for CP, sgsn address for CP, source to target transparent container (rn part), packet flow id, sndcp xid parameters, llc xid parameters) to the target mme. this message includes all pdp contexts that are established in the source system indicating the pfis and the xid parameters related to those pdp contexts, and the uplink tunnel endpoint parameters of the serving gw.
 the pdp contexts shall be sent in a prioritized order, i.e. the most important pdp context first. the prioritization method is implementation dependent, but should be based on the current activity.
note?3: assigning the highest priority to the pdp context without tft could be done to get service continuity for all ongoing services regardless of the number of supported eps bearers in the ue and network.
 the target mme maps the pdp contexts to the eps bearers 1-to-1 and maps the release?99 qos parameter values of a pdp context to the eps bearer qos parameter values of an eps bearer as defined in annex e. the mme establishes the eps bearer(s) in the indicated order. the mme deactivates the eps bearers which cannot be established.
 the mm context contains security related information, e.g. supported ciphering algorithms as described in ts?29.060?[14].
 for the pdp context with traffic class equals 'background', the source sgsn shall indicate via the activity status indicator ie that eps bearers shall be established on the target side.
note?4: the source sgsn acts as the old sgsn.
4. the target mme selects the serving gw as described under clause?4.3.8.2 on "serving gw selection function". the target mme sends a create session request message (imsi, mme tunnel endpoint identifier for CP, mme address for CP, pdn gw address(es) for UP, pdn gw ul teid(s) for UP, pdn gw address for CP, and pdn gw teid(s) for CP, the protocol type over s5/s8, apn-ambr, serving network) per pdn connection to the serving gw. the protocol type over s5/s8 is provided to serving gw which protocol should be used over s5/s8 interface. for relocation from gn/gp sgsn, the target mme provides the apn-ambr if not received explicitly from the gn/gp sgsn based on the mapping from mbr (as specified in annex?e) to the serving gw
4a. the serving gw allocates its local resources and returns them in a create session response (serving gw address(es) for UP, serving gw ul teid(s) for UP, serving gw address for CP, serving gw teid for CP) message to the target mme.
5. the target mme will request the target enodeb to establish the bearer(s) by sending the message handover request (ue identifier, s1ap cause, integrity protection information (i.e. ik and allowed integrity protection algorithms), encryption information (i.e. ck and allowed ciphering algorithms), eps bearers to be setup list, source to target transparent container). the target mme shall not request resources for which the activity status indicator within a pdp context indicates that no active bearer exists on the source side for that pdp context.
 for each eps bearer requested to be established, 'eps bearers to be setup' ie shall contain information such as id, bearer parameters, transport layer address, "data forwarding not possible" indication and s1 transport association. the transport layer address is the serving gw address for user data, and the s1 transport association corresponds to the uplink tunnel endpoint identifier data. "data forwarding not possible" indication shall be included if the target mme decides the corresponding bearer will not be subject to data forwarding.
 the target mme shall not request the target enodeb to establish eps gbr bearers with maximum bitrate set to 0 and those eps bearers should not be included in the eps bearers to be setup list and should be deactivated by the mme. for the remaining eps bearer contexts the mme ignores any activity status indicator within an eps bearer context and requests the target enodeb to allocate resources for all the remaining eps bearer contexts.
 the ciphering and integrity protection keys will be sent transparently from the target enodeb to the ue in the target to source transparent container, and in the message ps handover command from source bss to the ue. this will then allow data transfer to continue in the new rat/mode target cell without requiring a new aka (authentication and key agreement) procedure.
 the mme shall compute the ue-ambr, as per clause?4.7.3, based on explicit apn-ambr values received from the gn/gp sgsn. if explicit apn-ambr values are not received by the mme, a local ue-ambr shall be included in the 'eps bearers be setup list ' ie. the local ue-ambr is described in annex?e.
5a. the target enodeb allocates the request resources and returns the applicable parameters to the target mme in the message handover request acknowledge (target to source transparent container, eps bearers setup list, eps bearers failed to setup list). upon sending the handover request acknowledge message the target enodeb shall be prepared to receive downlink gtp pdus from the serving gw for the accepted eps bearers.
 the target enodeb shall ignore it if the number of radio bearers in the source to target transparent container does not comply with the number of bearers requested by the mme and allocate bearers as requested by the mme.
6. if 'indirect forwarding' applies, the target mme sends a create indirect data forwarding tunnel request message (cause, target enodeb address(es), teid(s) for dl UP) to the serving gw. cause indicates that the bearer(s) are subject to data forwarding.
6a. the serving gw returns a create indirect data forwarding tunnel response (cause, serving gw address(es) and teid(s) for data forwarding) message to the target mme. if the serving gw doesn't support data forwarding, an appropriate cause value shall be returned and the serving gw address(es) and teid(s) will not be included in the message.
7. the target mme sends the message forward relocation response (cause, list of set up pfcs, mme tunnel endpoint identifier for CP, bssgp cause, mme address for CP, target to source transparent container, address(es) and teid(s) for data forwarding) to the source sgsn.
 if 'direct forwarding' is applicable, then the ies 'address(es) and teid(s) for data forwarding' contains the dl gtp-u tunnel endpoint parameters to the enodeb. if 'indirect forwarding' applies the ies 'address(es) and teid(s) for data forwarding' contain the dl gtp-u tunnel endpoint parameters to the serving gw.
note?5: the source sgsn acts as the old sgsn.
d.3.8.3 execution phase

figure d.3.8.3-1: geran a/gb mode to e-utran inter rat ho, execution phase
note?1: for a pmip-based s5/s8, procedure steps (a) are defined in ts?23.402?[2]. steps?9 and 9a concern gtp based s5/s8.
the old sgsn continues to receive downlink and uplink UP pdus.
when old sgsn receives the forward relocation response message it may start downlink n-pdu relay and duplication to the target enodeb, and the target enodeb may start blind transmission of downlink user data towards the ue over the allocated radio channels.
1. the source sgsn completes the preparation phase towards source bss by sending the message ps ho required acknowledge (tlli, list of set up pfcs, target to source transparent container). this message includes all pfis that could be established on the target side.
 before sending the ps handover required acknowledge message, the source sgsn may suspend downlink data transfer for any pdp contexts.
 before sending the ps handover command message to the ue the source bss, may try to empty the downlink bss buffer for any bss pfcs.
note?2: the source sgsn acts as the old sgsn.
2. the source bss will command the ue to handover to the target enodeb via the message ps handover command. the access system specific message to ue includes a transparent container including radio aspect parameters that the target enodeb has set-up in the preparation phase.
3. there is no ran context transfer during inter rat handovers with e-utran. if the source sgsn originates any srns contexts the mme acknowledges the receipt towards the sgsn and ignores the message content.
4. the ue moves to the e-utran and performs access procedures toward target enodeb.
5. when the ue has got access to target enodeb it sends the message ho to e-utran complete. the ue shall implicitly derive the eps bearers for which an e-rab was not established from the ps handover command and deactivate them locally without an explicit nas message at this step.
6. when the ue has successfully accessed the target enodeb, the target enodeb informs the target mme by sending the message handover notify.
 upon receipt of the handover notify message the target mme starts a timer if the target mme applies indirect forwarding.
7. then the target mme knows that the ue has arrived to the target side and target mme informs the old sgsn by sending the forward relocation complete () message. the old sgsn will also acknowledge that information. when the forward relocation complete message has been received and there is no longer any need for the old sgsn to forward data, the old sgsn stops data forwarding. a timer in old sgsn is started to supervise when resources shall be released.
8. the target mme will now complete the handover procedure by informing the serving gw (for serving gw relocation this will be the target serving gw) that the target mme is now responsible for all the eps bearers the ue have established. this is performed in the message modify bearer request (cause, mme tunnel endpoint identifier for CP, eps bearer id(s), mme address for CP, enodeb address(es) and teid(s) for user traffic for the accepted eps bearers, pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic and rat type) per pdn connection.
 in case any eps bearers are to be released the mme triggers the bearer release procedure as specified in clause?5.4.4.2. if the serving gw receives a dl packet for a non-accepted bearer, the serving gw drops the dl packet and does not send a downlink data notification to the mme.
note?3: the text regarding "target serving gw" shall be ignored.
9. the serving gw (for serving gw relocation this will be the target serving gw) informs the pdn gw(s) the change of, for example, for serving gw relocation or the rat type, that e.g. can be used for charging, by sending the message modify bearer request per pdn connection. serving network should be included in this message if it is received in step?4. for serving gw relocation, the serving gw allocates dl teids on s5/s8 even for non-accepted bearers. the pdn gw must acknowledge the request with the message modify bearer response (apn restriction). when the ue moves from gn/gp sgsn to the mme, the pdn?gw shall send the apn restriction of each bearer context to the serving gw.
 if pcc infrastructure is used, the pdn gw informs the pcrf about the change of, for example, the rat type.
 the modify bearer response also indicates the identity of the default bearer and the charging id towards the s gw.
note?4: the text regarding "target serving gw" shall be ignored.
10. the serving gw (for serving gw relocation this will be the target serving gw) acknowledges the UP switch to the target mme via the message modify bearer response (cause, serving gw tunnel endpoint identifier for CP, serving gw (for serving gw relocation this will be the target serving gw) address for CP, protocol configuration options, pdn gw addresses and teids (for gtp-based s5/s8) or gre keys (for pmip-based s5/s8) at the pdn gw(s) for uplink traffic, apn restriction).the serving gw shall forward the received apn restriction to the mme. at this stage the UP path is established for all bearers between the ue, target enodeb, serving gw (for serving gw relocation this will be the target serving gw) and pdn gw.
 in addition, the modify bearer response indicates the identity of the default bearer towards the mme.
11. when the timer started in step?7 expires the source sgsn will clean-up all its resources towards source bss by performing the bss packet flow delete procedure.
 when the timer started in step 6 expires the target mme releases the resources that have been allocated for indirect forwarding.
note?5: the text regarding "target serving gw" shall be ignored.
12. the ran triggers the ue to initiate a tracking area update procedure with the target mme. it is ran functionality to provide the ecm connected ue with the trigger information.
 the target mme knows that an irat handover has been performed for this ue as it received the bearer context(s) by handover messages and therefore the target mme performs only a subset of the ta update procedure, specifically it excludes the context transfer procedures between source sgsn and target mme.
the target mme gets the subscribed ue-ambr value and the subscribed apn-ambr value from the hss during the ta update procedure.
 if the subscription data received from the hss (during the tau) contains information that is necessary for the e-utran to be aware of (e.g. a restriction in the ue's permission to use nr as a secondary rat, unlicensed spectrum or a combination of them), or an existing ue context in the mme indicates that the ue is not permitted to use nr as a secondary rat, unlicensed spectrum or a combination of them, and the mme has not provided this information to the target enodeb during step?5 of the handover preparation phase, then the mme sends an updated handover restriction list in the downlink nas transport message that it sends to e-utran.
13. the target mme calculates ue-ambr as defined in clause?4.7.3. if this calculated value is different from the ue-ambr computed during step?6, or the apn-ambr mapped from the subscribed mbr is different from the subscribed apn-ambr, or the mapped subscribed qos profile (i.e. the subscribed qos profile mapped according to annex e) of the default bearer is different from the eps subscribed qos profile received from the hss, the new mme shall initiate subscribed qos modification procedure as described in clause?5.4.2.2, figure 5.4.2.2-1

annex e (normative):
mapping between eps and release 99 qos parameters
this annex specifies how the qos parameter values of an eps bearer are mapped to/from the release?99 qos parameter values of a pdp context in pdn?gw, s4-sgsn and mme.
within this specification, different names are used for the qos parameters of a pdp context e.g. "r99 qos profile" and "r99 qos parameters", but nevertheless the whole qos ie as described in ts?24.008?[47] is referred to including the r99 and r97/98 qos attributes. this means that the mme performs qos mapping, populates and forwards both r99 and r97/98 qos attributes towards the ue in s1 mode, if the ue supports a/gb mode or iu mode or both. the mme also performs qos mapping, populates and forwards both r99 and r97/98 qos attributes also on gn when deployed in the interoperation scenarios as listed in annex?d, clause?d.2. the s4-sgsn performs qos mapping, populates and forwards either both r99 and r97/98 qos attributes or only r97/98 qos attributes towards the ue in iu mode and a/gb mode. the p-gw performs qos mapping, populates and forwards both r99 and r97/98 qos attributes over gn/gp when deployed in the interoperation scenarios as listed in annex?d, clause?d.2.
the following mapping rules hold:
- there is a one-to-one mapping between an eps bearer and a pdp context.
- when eps bearer qos parameters are mapped to release?99 qos parameters the pre-emption capability and the pre-emption vulnerability information of the eps bearer arp are ignored and the priority of the eps bearer parameter arp is mapped to the release?99 bearer parameter arp, as described in table?e.1.
table e.1: mapping of eps bearer arp to release 99 bearer parameter arp
eps
bearer arp priority value
release 99 bearer parameter
arp value
1 to h
1
h+1 to m
2
m+1 to 15
3

 when release?99 qos parameters are mapped to eps bearer qos parameters the pre-emption capability and the pre-emption vulnerability information of the eps bearer arp are set based on operator policy in the entity that performs the mapping. the release?99 bearer parameter arp is mapped to the priority level information of the eps bearer parameter arp as described in table?e.2.
table e.2: mapping of release 99 bearer parameter arp to eps bearer arp
release 99 bearer parameter
arp value
eps
bearer arp priority value
1
1
2
h+1
3
m+1

 the values of h (high priority) and m (medium priority) can be set according to operator requirements to ensure proper treatment of users with higher priority level information. the minimum value of h is 1. the minimum value of m is h+1.
 from release?9 onwards, the priority of the eps bearer parameter arp is mapped one-to-one to/from the evolved arp parameter of a pdp context, if the network supports this parameter.
note?1: the setting of the values for h and m may be based on the sgsn mapping from the release?99 bearer parameter arp to the arp parameter that is used for utran/geran.
note?2: after a handover from utran/geran to e-utran the arp parameter of the eps bearer can be modified by the p gw to re-assign the appropriate priority level, pre-emption capability and pre-emption vulnerability setting.
note?3: a mapping from the eps bearer parameter arp to the release?99 bearer parameter arp is not required for a p gw when connected to an sgsn via gn/gp as any change of the bearer arp parameter may get overwritten by the sgsn due to subscription enforcement. however, the p gw should not combine services with different eps bearer arp values onto the same pdp context to enable a modification of the bearer arp without impacting the assignment of services to bearers after a handover to e-utran.
- the eps bearer parameters gbr and mbr of a gbr eps bearer are mapped one-to-one to/from the release?99 bearer parameters gbr and mbr of a pdp context associated with traffic class 'conversational' or 'streaming'.
- when eps bearer qos parameters are mapped to release?99 qos parameters the release?99 bearer parameter mbr of pdp contexts associated with traffic class 'interactive' or 'background' is set equal to the value of the authorized apn-ambr. if the apn-ambr is modified while the ue accesses the eps through e utran, the ue shall also set the release?99 bearer parameter mbr to the new apn-ambr value for all non-gbr pdp contexts of this pdn connection. the p gw shall enforce the apn-ambr across all pdp contexts with traffic class 'interactive' and 'background' for that apn. the mme or s4-sgsn may attempt to transfer apn-ambr and ue-ambr to a gn/gp sgsn
- when release?99 qos parameters are mapped to eps bearer qos parameters the ambr for the corresponding apn shall be set equal to the mbr value of the subscribed qos profile. at handover from a gn/gp sgsn the mme or s4-sgsn shall provide this apn-ambr value, if not explicitly received from the gn/gp sgsn, to the serving gw and the pdn gw for each pdn connection. it is required that the subscribed mbr in the hlr/hss is set to the desired apn-ambr value for all subscribed apns which may lead to a selection of a p gw. the ue derives the apn-ambr from the value of the mbr of a pdp context created by the pdp context activation procedure as described in ts?23.060?[7].
note?5: if the pre-rel-8 ue with the updated subscribed mbr is connected to a ggsn, the ggsn can downgrade the mbr of the pdp contexts based on either local policy or pcc (where the mbr per qci information is provided to the pcef).
note?6: from release?9 onwards, the apn-ambr is available on gn/gp.
- for handover from a gn/gp sgsn and if the mme does not receive ambr values from the gn/gp sgsn, the mme provides a local ue-ambr to the enodeb until mme gets the eps subscribed ue-ambr. when the mme gets the subscribed ue ambr value from the hss, it calculates the ue-ambr (ue-ambr=min (subscribed ue-ambr, sum apn-ambr of all active apns)). then it compares this value with the local ue-ambr and if the local ue-ambr is different from the corresponding derived ue-ambr, the mme initiates hss initiated subscribed qos modification procedure to notify the derived ue-ambr to the enodeb.
note?7: the local ue-ambr may be for example based on the summing up of the apn-ambr values of all active apns of the ue or on internal configuration.
- a standardized value of the eps bearer parameter qci is mapped one-to-one to/from values of the release?99 parameters traffic class, traffic handling priority, signalling indication, and source statistics descriptor as shown in table e.3.
note?8: when mapping to qci=2 or qci=3, the release?99 parameter transfer delay is used in addition to the four release?99 parameters mentioned above.
- when eps bearer qos parameters are mapped to release?99 qos parameters the setting of the values of the release?99 parameters transfer delay and sdu error ratio is derived from the corresponding qci's packet delay budget and packet loss rate, respectively. when packet loss rate parameter is further mapped to release?99 qos parameter reliability class (ts?23.107?[59], table 7), the residual ber is considered <= 2*10-4. also when release?99 qos parameters are mapped to eps bearer qos parameters the values of the release?99 parameter sdu error ratio are ignored.
- the setting of the values of all other release?99 qos is based on operator policy pre-configured in the mme and s4-sgsn.
- in networks that support mobility from e utran to utran/geran, if the ue has indicated support of utran or geran, the eps network shall provide the ue with the release?99 qos parameters in addition to the eps bearer qos parameters within eps bearer signalling.
table e.3: mapping between standardized qcis and release?99 qos parameter values
qci
traffic
class
traffic
handling
priority
signalling
indication
source
statistics
descriptor
1
conversational
n/a
n/a
speech
2
conversational
n/a
n/a
unknown (note 1)
3
conversational
n/a
n/a
unknown (note 2)
4
streaming
n/a
n/a
unknown (note 3)
5
interactive
1
yes
n/a
6
interactive
1
no
n/a
7
interactive
2
no
n/a
8
interactive
3
no
n/a
9
background
n/a
n/a
n/a
note?1: when qci 2 is mapped to release?99 qos parameter values, the transfer delay parameter is set to 150 ms. when release?99 qos parameter values are mapped to a qci, qci 2 is used for conversational/unknown if the transfer delay parameter is greater or equal to 150?ms.
note?2: when qci 3 is mapped to release?99 qos parameter values, the transfer delay parameter is set to 80 ms as the lowest possible value, according to ts?23.107?[59]. when release?99 qos parameter values are mapped to a qci, qci 3 is used for conversational/unknown if the transfer delay parameter is lower than 150?ms.
note?3: when qci 4 is mapped to release?99 qos parameter values, it is mapped to streaming/unknown and the sdu error ratio is set to 10-5 as the closest available value according to ts?23.107?[59]. when release?99 qos parameter values are mapped to a qci, streaming/unknown and streaming/speech are both mapped to qci?4.


annex f (normative):
dedicated bearer activation in combination with the default bearer activation at attach and ue requested pdn connectivity procedures
for wb-e-utran, it shall be possible for the pdn gw to initiate the activation of dedicated bearers (as specified in clause?5.4.1) as part of the attach procedure (as specified in clause?5.3.2.1) or as part of the ue requested pdn connectivity procedure (as specified in clause?5.10.2) over wb-e utran. however, the result of the dedicated bearer activation procedure shall be logically separate from the attach procedure, meaning that the result of the attach procedure is not dependent on whether the dedicated bearer activation procedure succeeds or not. on the other hand, the dedicated bearer activation may only be regarded as successful if the attach procedure completes successfully.
the messages of the dedicated bearer activation can be sent together with the messages of the attach procedure or of the ue requested pdn connectivity procedure (i.e. attach accept or pdn connectivity accept), as shown in the figure and explanation below.
on the s1 and uu interfaces the messages for the default bearer activation at attach and ue requested pdn connectivity procedures and for the dedicated bearer activation procedure are combined into a single message. if the mme has sent an attach accept message towards the enodeb, and then the mme receives a create bearer request before the mme receives the attach complete message, the mme shall wait for the attach procedure to complete before the mme continues with dedicated bearer activation procedure.
it shall be possible that multiple dedicated bearers can simultaneously be activated in the signalling flow shown below.

figure f.1: dedicated bearer activation in combination with the default bearer activation at attach or ue requested pdn connectivity
note?1: parameters related to dedicated bearer activation are written in italics.
figure?f.1 describes the activation of dedicated bearer(s) in combination with the default bearer activation either as part of the attach procedure (with specific steps?1a, 7a, 10a) or as part of the ue requested pdn connectivity procedure (with specific steps?1b, 7b, 10b). the following steps below require special attention:
5. (on the p gw-s gw interface) create session response message of the attach procedure or ue requested pdn connectivity procedure is combined with create bearer request message of the dedicated bearer activation procedure
6. (on the s gw-mme interface) create session response message of the attach procedure or ue requested pdn connectivity procedure is combined with the create bearer request message of the dedicated bearer activation procedure
7a. for attach procedure: if the mme receives a create session response message combined with a create bearer request message, the mme shall send the s1-ap initial context setup request message to the enodeb, including the nas parts for both the attach accept message of the attach procedure and the bearer setup request of the dedicated bearer activation procedure.
note?2: the mme shall not send a bearer setup request message of a new dedicated bearer activation procedure to the enodeb before sending the attach accept message of the attach procedure to the enodeb. if the mme has already sent the attach accept message of the attach procedure to the enodeb, the mme shall wait for the attach complete message to arrive before sending a separate bearer setup request of a dedicated bearer activation procedure.
7b. for ue requested pdn connectivity procedure: if the mme receives a create session response message combined with a create bearer request message, the mme shall send the s1-ap bearer setup request message to the enodeb, including the nas parts for both the pdn connectivity accept message and the bearer setup request of the dedicated bearer activation procedure.
8-9. the radio bearer establishment of the default and dedicated bearer(s) is performed in the same rrc message.
10a. for attach procedure: the enodeb sends the s1-ap initial context setup response message to the mme.
 the mme shall be prepared to receive this message either before or after, some or all, of the uplink nas uplink transport messages sent in step?12.
10b. for ue requested pdn connectivity procedure: the enodeb sends the s1-ap bearer setup response message to the mme.
 the mme shall be prepared to receive this message either before or after, some or all, of the uplink nas uplink transport messages sent in step?12.
11. for the attach procedure: the ue sends the enodeb a direct transfer message containing the attach complete (session management response for the default bearer) message as response of the attach procedure, and direct transfer messages containing the session management responses of the dedicated bearer setup procedure.
 for the ue requested pdn connectivity procedure: the ue nas layer builds a pdn connectivity complete (session management response) for the default bearer activation and dedicated bearer activation procedures. the ue then sends direct transfer (pdn connectivity complete) message to the enodeb.
 the nas messages to establish the eps bearers shall be handled individually by the ue and be sent in separate rrc direct transfer messages.
12. the enodeb sends an uplink nas transport message to the mme, which contains the nas messages from the rrc message in step?11. there may be multiple uplink nas transport messages when the ue sends multiple rrc messages containing nas messages in step?11.
13. upon reception of the response messages in both step?10 and step?12, the modify bearer request message of the attach procedure or ue requested pdn connectivity procedure is combined with the create bearer response message of the dedicated bearer activation procedure. after that, the serving gw continues with sending a create bearer response message to the pdn gw.

annex g (informative):
void


annex h (normative):
mapping between temporary and area identities
the mapping between temporary and area identities is defined in ts?23.003?[9].

annex i (informative):
guidance for contributors to this specification
the following guidance is provided for drafting figures for this specification that contain specific steps which are different in ts?23.402?[2] due to the pmip-based s5/s8 interface:
- message flows to this specification will contain the complete procedures applicable for gtp-based s5/s8 only.
- in this specification, clause(s) of a message flow that is different for pmip-based s5/s8 interface are shown surrounded by shaded box indexed by an upper-case letter in ascending order, e.g. "a", "b", "c", etc.
for example, at the bottom of the flow, the following text should be included:
"note: procedure steps (a) and (b) for an pmip-based s5/s8 interface are defined in ts?23.402?[2]."
- further guidance for drafting procedures for ts?23.402?[2] can be found in that specification itself.

annex j (informative):
high level isr description
j.1 general description of the isr concept
idle state signalling reduction (isr) aims at reducing the frequency of tau and rau procedures caused by ues reselecting between e-utran and geran/utran which are operated together. especially the update signalling between ue and network is reduced. but also network internal signalling is reduced. to some extent the reduction of network internal signalling is also available when isr is not used or not activated by the network.
umts described already ras containing geran and utran cells, which also reduces update signalling between ue and network. the combination of geran and utran into the same ras implies however common scaling, dimensioning and configuration for geran and utran (e.g. same ra coverage, same sgsn service area, no geran or utran only access control, same physical node for geran and utran). as an advantage it does not require special network interface functionality for the purpose of update signalling reduction.
isr enables signalling reduction with separate sgsn and mme and also with independent tas and ras. thereby the interdependency is drastically minimized compared with the geran/utran ras. this comes however with isr specific node and interface functionality. sgsn and mme may be implemented together, which reduces some interface functions but results also in some dependencies.
isr support is mandatory for e-utran ues that support geran and/or utran and optional for the network. isr requires special functionality in both the ue and the network (i.e. in the sgsn, mme and serving gw) to activate isr for a ue. for this activation, the mme/sgsn detects whether s-gw supports isr based on the configuration and activates isr only if the s-gw supports the isr. the network can decide for isr activation individually for each ue. gn/gp sgsns do not support isr functionality. no specific hss functionality is required to support isr.
note. a release?7 hss needs additional functionality to support the 'dual registration' of mme and sgsn. without such an upgrade, at least ps domain mt location services and mt short messages are liable to fail.
it is inherent functionality of the mm procedures to enable isr activation only when the ue is able to register via e-utran and via geran/utran. for example, when there is no e-utran coverage there will be also no isr activation. once isr is activated it remains active until one of the criteria for deactivation in the ue occurs, or until sgsn or mme indicate during an update procedure no more the activated isr, i.e. the isr status of the ue has to be refreshed with every update.
when isr is activated this means the ue is registered with both mme and sgsn. both the sgsn and the mme have a control connection with the serving gw. mme and sgsn are both registered at hss. the ue stores mm parameters from sgsn (e.g. p-tmsi and ra) and from mme (e.g. guti and ta(s)) and the ue stores session management (bearer) contexts that are common for e-utran and geran/utran accesses. in idle state the ue can reselect between e-utran and geran/utran (within the registered ra and tas) without any need to perform tau or rau procedures with the network. sgsn and mme store each other's address when isr is activated.
when isr is activated and downlink data arrive, the serving gw initiates paging processes on both sgsn and mme. in response to paging or for uplink data transfer the ue performs normal service request procedures on the currently camped-on rat without any preceding update signalling (there are however existing scenarios that may require to perform a rau procedure prior to the service request even with isr is activated when geran/utran ras are used together, as specified in clause?6.13.1.3 of ts?23.060?[7]).
the ue and the network run independent periodic update timers for geran/utran and for e-utran. when the mme or sgsn do not receive periodic updates mme and sgsn may decide independently for implicit detach, which removes session management (bearer) contexts from the cn node performing the implicit detach and it removes also the related control connection from the serving gw. implicit detach by one cn node (either sgsn or mme) deactivates isr in the network. it is deactivated in the ue when the ue cannot perform periodic updates in time. when isr is activated and a periodic updating timer expires the ue starts a deactivate isr timer. when this timer expires and the ue was not able to perform the required update procedure the ue deactivates isr.
part of the isr functionality is also available when isr is not activated because the mm contexts are stored in ue, mme and sgsn also when isr is not active. this results in some reduced network signalling, which is not available for gn/gp sgsns. these sgsns cannot handle mm and session management contexts separately. therefore all contexts on gn/gp sgsns are deleted when the ue changes to an mme. the mme can keep their mme contexts in all scenarios.
j.2 usage of the tin
the ue may have valid mm parameters both from mme and from sgsn. the "temporary identity used in next update" (tin) is a parameter of the ue's mm context, which identifies the ue identity to be indicated in the next rau request or tau request message. the tin also identifies the status of isr activation in the ue.
the tin can take one of the three values, "p-tmsi", "guti" or "rat-related tmsi". the ue sets the tin when receiving an attach accept, a tau accept or rau accept message as specified in table?4.3.5.6-1.
"isr activated" indicated by the rau/tau accept message but the ue not setting the tin to "rat-related tmsi" is a special situation. here the ue has deactivated isr due to special situation handling (see clause?j.6). by maintaining the old tin value the ue remembers to use the rat tmsi indicated by the tin when updating with the cn node of the other rat.
only if the tin is set to "rat-related tmsi" isr behaviour is enabled for the ue, i.e. the ue can change between all registered areas and rats without any update signalling and it listens for paging on the rat it is camped on. if the tin is set to "rat-related tmsi", the ue's p-tmsi and rai as well as its guti and tai(s) remain registered with the network and valid in the ue.
when isr is not active the tin is always set to the temporary id belonging to the currently used rat. this guarantees that always the most recent context data are used, which means during inter-rat changes there is always context transfer from the cn node serving the last used rat. the ue identities, old guti ie and additional guti ie, indicated in the next tau request message, and old p-tmsi ie and additional p-tmsi/rai ie, indicated in the next rau request message depend on the setting of tin and are specified in table?4.3.5.6-2.
the ue indicates also information elements "additional guti" or "additional p-tmsi" in the attach request, tau or rau request. these information elements permit the mme/sgsn to find the already existing ue contexts in the new mme or sgsn, when the "old guti" or "old p-tmsi" indicate values that are mapped from other identities.
j.3 isr activation
the information flow in figure?j.3-1 shows an example of isr activation. for explanatory purposes the figure is simplified to show the mm parts only.
the process starts with an ordinary attach procedure not requiring any special functionality for support of isr. the attach however deletes any existing old isr state information stored in the ue. with the attach request message, the ue sets its tin to "guti". after attach with mme, the ue may perform any interactions via e-utran without changing the isr state. isr remains deactivated. one or more bearer contexts are activated on mme, serving gw and pdn gw, which is not shown in the figure.
the first time the ue reselects geran or utran it initiates a routing area update. this represents an occasion to activate isr. the tin indicates "guti" so the ue indicates a p-tmsi mapped from a guti in the rau request. the sgsn gets contexts from mme. when the mme sends the context to the sgsn, the mme includes the isr supported indication only if the involved s-gw supports the isr. after the isr activated, both cn nodes keep these contexts because isr is being activated. the sgsn establishes a control relation with the serving gw, which is active in parallel to the control connection between mme and serving gw (not shown in figure). the rau accept indicates isr activation to the ue. the ue keeps guti and p-tmsi as registered, which the ue memorises by setting the tin to "rat-related tmsi". the mme and the sgsn are registered in parallel with the hss.
after isr activation, the ue may reselect between e-utran and utran/geran without any need for updating the network as long as the ue does not move out of the ra/ta(s) registered with the network.
the network is not required to activate isr during a rau or tau. the network may activate isr at any rau or tau that involves the context transfer between an sgsn and an mme. the rau procedure for this is shown in figure?j.3-1. isr activation for a ue, which is already attached to geran/utran, with a tau procedure from e-utran works in a very similar way.

figure j.3-1: isr activation example
j.4 downlink data transfer
figure?j.4-1 shows a downlink data transfer to an idle state ue when isr is activated. the serving gw receives downlink data. because of activated isr, the serving gw has control connections with both mme and sgsn and sends therefore downlink data notifications to both nodes. mme and sgsn start their paging procedures, which results in paging of the ue in the registered ra and ta(s) in parallel.
in the example illustrated in figure?j.4-1 it is assumed that the ue camps on e-utran. so the ue responds to paging as usual with service request. this triggers the mme to setup the UP connection between enodeb and serving gw. the downlink data are transferred to the ue.
when the ue camps on utran/geran it performs the paging response as specified for these access systems without any required update or other signalling before. the downlink data are then transferred via utran/geran to the ue.

figure j.4-1: downlink data transfer with isr active
j.5 isr deactivation
deactivation of isr for the ue does not require any specific functionality. the status of isr activation is refreshed in every rau and tau accept message. if there is no explicit indication of isr activated in these messages then isr is deactivated and the ue sets its tin to "guti" or "p-tmsi", as specified in table?4.3.5.6-1. this causes always isr deactivation when a ue performs a rau with a gn/gp sgsn of any standards release as these sgsns never indicate "isr activated" to the ue.
j.6 handling of special situations
situations may occur that cause unsynchronized state information in the ue, mme and sgsn. such situations are:
- modification of any eps bearer context or pdp context which was activated before the isr is activated in the ue;
- at the time when the ue moves from e-utran to geran/utran or moves from geran/utran to e-utran, if any eps bearer context or pdp context activated after the isr was activated in the ue exists;
- missing periodic ta or ra updates, e.g. because the coverage of a rat is lost or the rat is no more selected by the ue (this may result also in implicit detach by sgsn or mme);
- cn node change resulting in context transfer between the same type of cn nodes (sgsn to sgsn or mme to mme);
- serving gw change (both with and without ue mobility);
- change of the ue specific drx parameters;
- change of the ue core network capabilities;
- e-utran selection by a utran-connected ue (e.g. when in ura_pch to release iu on utran side);
 e-utran selection from geran ready state;
- geran selection by an e-utran-connected ue via cell change order that is not for cs fallback.
there are no isr specific procedures to handle such situations to avoid additional complexity and error cases. all special situations that cause context in the ue, mme and sgsn to become asynchronous are handled by isr deactivation. the normal rau/tau procedures synchronize contexts in mme and sgsn and activate isr again when wanted by the network.
some specific handling is defined to enable combined mme/sgsn. for this the ue signals at utran rrc level always an intra domain nas node selector (idnns) derived from the id signalled as p-tmsi (also when mapped from guti). at e-utran rrc level the ue indicates the gummei derived from the guti that is signalled in the tau request message (also when derived from p-tmsi). this handling is performed by the ue independent from the network configuration. it is not visible to the ue whether mme and sgsn are combined.
given the ip-based architecture of eps and the ip-based applications such establishment and deactivation of the eps bearer or pdp context can happen frequently before the ue changes the rat e.g. a ue asking for delivery of an sms (over ip) or starting a voip over ims, an entirely new eps bearer or pdp context may be established for that purpose. then, after the application/service is finished, the newly established eps bearer or pdp context gets deactivated. in such particular situation the deactivation of the isr at the ue and hence performing a rau or tau update when the ue changes the rat is not needed. preventing the ue from deactivating the isr in this case ensures an efficient usage of the ue's battery power and reduces the unnecessary signalling load that is seen as the key objective to be achieved by introducing the isr feature. thus, ue only locally deactivates isr when bearer existed at the time of isr is activated, or when ue changes rat with bearers which are created after isr is activated.

annex k (informative):
isolated e-utran operation for public safety
k.1 general description of the iops concept
isolated e-utran operation for public safety (iops) provides the ability to maintain a level of communications for public safety users, via an iops-capable enb (or set of connected iops-capable enbs), following the loss of backhaul communications.
the isolated e-utran mode of operation is also applicable to the formation of a nomadic eps deployment, i.e. a deployment of one or more standalone iops-capable enbs, creating a serving radio access network without backhaul communications and also providing local ip connectivity and services to public safety users in the absence of normal eps infrastructure availability.
this annex provides implementation and deployment guidelines for the operation of public safety networks in the no backhaul (to macro epc) scenario using a local epc approach.
k.2 operation of isolated public safety networks using a local epc
k.2.1 general description
this approach to the provision of isolated operation (e.g. when there is no s1 connectivity to the macro epc) assumes that the iops-capable enb is co-sited with, or can reach, a local epc instance which is used in iops mode. the local epc instance includes at least mme, sgw/pdn gw and hss functionality.
a plmn identity is dedicated to iops mode of operation and is broadcast in system information by the enb when iops mode is in operation. only authorized iops-enabled ues can access a plmn indicated as an iops plmn.
support of application services over the iops network will be based upon the lte-uu radio interface and eps bearer services supported by the local epc. an iops network will provide local ip connectivity services, i.e. ip address assignment and local routing in the iops network. during the attachment procedure to the local epc a local ip address is assigned to the ue as per the standard procedure when attaching to a macro epc. the local epc acts as an ip router among the ues locally attached to the same iops network. when operating in iops mode iops-enabled ues only use the appropriate usim credentials defined in the uicc, i.e. those defined exclusively for use in an iops plmn.
k.2.2 ue configuration
an iops-enabled ue has the dedicated iops plmn identity configured in a separate dedicated usim application as an hplmn along with the access class status of 11 or 15, subject to regional/national regulatory requirements and operator policy.
note: access class 15 can be reserved for use by network operator personnel who are responsible for critical recovery operations of the network.
an iops-enabled ue can display information on available plmns, including the iops plmn, assisting the user to activate an appropriate usim application. subject to user preferences, e.g. to maintain a group communication, the user can perform a manual usim application switch at any time.
when an authorized iops-enabled ue, with the dedicated iops usim application activated, selects an iops-mode cell, it selects the dedicated iops plmn identity, attaches to the iops plmn (supported by the local epc) and is authenticated using security procedures as specified in ts?33.401?[41] and the security credentials from the active iops usim application.
k.2.3 iops network configuration
an iops network can comprise either:
- a local epc and a single isolated iops-capable enb, which may be co-located or have connectivity to the local epc; or
- a local epc and two or more iops-capable enbs, which have connectity to a single local epc.
existing procedures described in ts?36.300?[5] can be used to achieve dynamic configuration of the s1-mme interface. an iops-capable enb can be pre-provisioned with ip endpoint information, relating to the mmes of one or more candidate local epc instances. for each local mme in turn the enb can try to initialize a sctp association. once sctp connectivity has been established, the enb and local mme exchange application level configuration data over the s1-mme application protocol with the s1 setup procedure (see ts?36.413?[36]). in line with local operator policies the enb can be provisioned with the ip endpoint of a preferred local epc mme instance and the ip endpoints of one or more alternative local epc mme instances. the alternative local epc instances will be used if an s1-mme path cannot be established with the local mme of the preferred local epc instance.
all local epcs deployed by a public safety authority / operator assume the same plmn-id. in order to achieve the broadcast of different tais on separate iops networks the tacs broadcast by the cells of enbs connected to different local epcs are distinct to ensure the required ue mobility behaviour (see clause?k.2.5). therefore, the tac broadcast by the cells of an enb operating in iops mode will be dependent upon the local epc to which the enb has established an s1-mme connection.
if the scope of service of a local epc is a single enb, then all cells served by the enb share the same tac (assigned for use in iops mode) and neighbouring enbs that are also operating in iops mode with the same dedicated plmn-id are assigned different tacs (resulting in different tais) so a tau attempt is triggered upon mobility.
if multiple enbs are configured to be served by a single local epc, configuration of tais for iops can be done according to local operator policies in such a way that a reselection to a cell operating a plmn in normal mode always triggers an attach request.
if sharing the same plmn-id, it is assumed the tac assigned to cells in a nomadic eps would be different from the tacs assigned to infrastructure enbs operating in iops mode, so as to trigger a tau between these systems.
the support by iops network entities of s1-flex and/or embms is up to local operator policy and configuration.
k.2.4 iops network establishment/termination
the decision by an iops-capable enb to enter iops mode of operation is made in accordance with the local policies of the ran operator. such policies can be affected by any ran sharing agreements that are in place.
in situations when the backhaul to the macro epc is lost and an enb can start iops mode of operation based on local policies, or an enb is deployed as part of a nomadic eps, the following enb behaviour is expected:
- if the enb can reach a local epc for iops mode of operation, the enb uses the local epc.
- if the enb cannot reach a local epc, then the enb enters a state where ues do not attempt to select the cells under its control.
in this release of the specification iops networks will be established by the independent actions of each enb entering iops mode of operation. an iops network comprising two or more enbs will be established as a result of multiple enbs entering iops mode of operation and establishing s1-mme paths to the local mme of the same local epc instance.
an enb in iops mode of operation, indicates/broadcasts the iops plmn cell(s) as "not barred" & "reserved for operator use", for the iops plmn identity, as defined in ts?36.304?[34]. this "cell reserved for operator use" feature will allow the iops-enabled ues to get access to the iops network while barring other non-iops-enabled ues in the same area. the dedicated iops usim application configuration (clause?k.2.2) is restricted to use only by users authorised to access a network in iops mode of operation.
when a backhaul to the macro epc is re-established, the s1 connections to the local epc are released according to the local iops network policies, to move the ues to idle mode, and iops mode of operation ceases. the plmn identity of the macro epc is announced by the enb so that ues reselect the normal plmn and attach afresh to the macro epc.
figure k.2.4-1 provides an example of the basic steps involved in iops network establishment, access and termination.

figure k.2.4-1: example of local epc based iops operation
1) the ue is attached to the macro epc accessing normal application (e.g. mcptt) services.
2) the enb detects loss of the backhaul to the macro epc and in accordance with local operator policies decides to activate iops mode of operation. the enb prevents any ues from selecting the cell, using a suitable mechanism such as cell barring, until step?3 and step?4 are completed.
3) local epc is activated.
note?1: steps 1, 2 and 3 are not applicable for the nomadic eps case.
4) the enb establishes an s1 link to the local epc.
5) the enb broadcasts the plmn identity for iops operation with the local epc and indicates the iops plmn cell(s) as "not barred" & "reserved" for operator use.
6) the ue detects the iops plmn-id and a decision is made to switch usim application and the ue activates the iops usim application.
note?2: it is out of scope of this specification how the decision is made to switch usim application.
7) the ue selects the iops plmn-id.
8) the ue attaches to the local epc and obtains a local ip address, if authorised.
9) public safety services supported by the iops network can be accessed at this time.
10) at some point in time the enb detects that the backhaul to the macro epc has been restored.
11) s1 connections to the local epc are released according to the iops network policies to move the ues to idle mode.
12) the enb stops its iops mode of operation and the local epc is de-activated.
13) the enb establishes an s1 link to the macro epc.
14) the plmn-id of the macro epc is announced and the normal tais of the macro epc are advertised by the enb so that ues reselect the normal plmn.
15) the ue detects the plmn-id of the macro epc and a decision is made to switch usim application and the ue activates the normal usim application.
note?3: it is out of scope of this specification how the decision is made to switch usim application.
16) the ue selects the normal plmn-id.
17) the ue attaches as normal to the macro epc, if authorised.
k.2.5 ue mobility
a number of distinct ue mobility scenarios can be identified given the following assumptions:
- multiple enbs can be configured to be served by a single local epc;
- a single dedicated plmn-id will be advertised by all enbs operating in iops mode (of a given public safety authority/operator);
- the tacs broadcast by cells (enbs) served by different local epcs will be different.
the mobility scenarios that can be distinguished are:
1. ue transitions from a cell controlled by the normal macro epc to a cell operating in iops mode;
2. ue transitions from a cell operating in iops mode to a cell controlled by the normal macro epc;
3. ue transitions from a cell operating in iops mode whose enb is served by one local epc to a cell also operating in iops mode whose enb is served by a different local epc (inter-iops network cell transition);
4. ue transitions between cells operating in iops mode whose enb(s) are served by the same local epc (intra-iops network cell transition).
the expected mobility behaviour in each of these scenarios is summarised in table k.2.5-1.
table k.2.5-1: ue mobility behaviour

ecm state
mobility
transition
idle mode
connected mode
normal mode cell to iops mode cell
cell re-selection and usim application switch:
- ue performs cell re-selection based 
radio link failure followed by cell re-selection:
- ue performs radio measurements but source and target cells are on different
iops mode cell to normal mode cell
 upon radio measurements and no suitable cell is found.
- ue switches usim application.
- ue performs cell selection and a suitable cell is found.
- ue initiates attach procedure towards local/normal epc.
 networks. the plmn-id of the target cell is not supported by the subscription details in the currently selected usim application. handover does not occur.
- radio link failure occurs and ue returns to idle mode.
- ue proceeds as per behaviour for idle mode.
intra-iops network cell transition
idle mode mobility as per normal epc mobility.
as per normal epc connected mode mobility procedures.
inter-iops network cell transition
idle mode mobility as per normal epc mobility.
as per normal epc connected mode mobility procedures.


annex l (informative):
optimised eps architecture option for ciot
l.1 introduction
the eps optimised for ciot includes the support of the following characteristics:
- ultra low ue power consumption.
- large number of devices per cell.
- narrowband spectrum rats.
- enhanced coverage level.
the eps optimised for ciot supports traffic patterns that is different as compared to the normal ues and may support only sub-set and necessary functionalities as compared with the existing eps.
an eps optimised for ciot can be enabled by having sub-set of functionalities implemented in single logical entity c-sgn (ciot SGW node). c-sgn is decribed in l.4. mobility and attach procedures are performed as described in other clauses for corresponding entities mme, s-gw and p-gw.
the core network node involved in the eps architecture optimised for ciot can be deployed as dcns within a plmn.
l.2 non-roaming architecture

figure l.2-1: optimised eps architecture option for ciot - non-roaming architecture
l.3 roaming architecture

figure l.3-1: optimised eps architecture option for ciot - roaming architecture
l.4 c-sgn
the c-sgn (ciot SGW node) is a combined node epc implementation option that minimizes the number of physical entities by collocating eps entities in the control and UPs paths (e.g. mme, s-gw, p-gw), which may be preferred in ciot deployments. the external interfaces of c-sgn implementation option are the interfaces of the respective epc entity supported by the c-sgn, such as mme, s-gw, and p-gw.
a c-sgn supports sub-set and necessary functionalities compared with the existing eps core network elements and also supports at least some of the following ciot eps optimisations:
- CP ciot eps optimisation for small data transmission.
- UP ciot eps optimisation for small data transmission.
- necessary security procedures for efficient small data tranmission.
- sms without combined attach for nb-iot only ues.
- paging optimisations for coverage enhancements.
- support for non-ip data transmission via sgi tunnelling and/or scef.
- support for attach without pdn connectivity.

annex m (informative):
functions and procedures over nb-iot rat
in the case of conflict between the information in this annex and other information in the main body of the present document, the information in the main body takes precedence.
the following tables list the functions and procedures that are:
- supported or not supported over nb-iot rat, including whether for cp ciot eps optimisation only, up ciot eps optimisation only or both.
- optional for the ue and/or network when using nb-iot rat.
note: the tables m-1 to m-5 are ordered by clause?number according to the present specification. the table m-6 is ordered by clause?number according to ts?23.682?[74]. the notation "cp/up/both" indicates whether a particular item is supported for cp ciot eps optimisation only, up ciot eps optimisation only or both.
table m-1: clause?4 concepts
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
4.3.3
ip header compression





rohc (nas)
yes
cp
optional
optional

rohc (as)
yes
up
optional
optional
4.3.5
mobility management functions
yes
both



inter-rat idle mode nas mobility (wb-e_utran, utran, geran)
yes
both



reachability management
yes
both
isr optional
isr optional

ta list management (2)
yes
both



isr
yes
both

optional

mobility restrictions
yes
both



ims voice over ps session supported indication
no
n/a
n/a
n/a

voice domain preference and ue usage setting
no
n/a
n/a
n/a

preferred and supported network behaviour
yes
both


4.3.7.1a.2
gtp-c overload control
yes
cp
n/a

4.3.7.4
mme control of overload
yes
both
n/a


extended access barring
no
n/a
n/a
n/a
4.3.7.4.2.7
CP data specific nas level congestion control
yes
cp


4.3.12
ims emergency session
no
n/a
n/a
n/a
4.3.13
closed subscriber group
no
n/a
n/a
n/a
4.3.17
support for mtc





low access priority
yes
both

optional

non-ip data delivery (nidd)
yes
both



nidd scef
yes
cp
n/a (1)
optional (3)

nidd sgi
yes
both
n/a (1)
optional (3)
4.3.18
multimedia priority service
no
n/a
n/a
n/a
4.3.22
power save mode
yes
both
optional
optional
4.3.27a
restriction of use of enhanced coverage for voice centric ue
no
n/a
n/a
n/a
4.3.27b
restriction of use of enhanced coverage for data centric ue
no
n/a
n/a
n/a
4.3.28
restriction of use of enhanced coverage
yes
both

optional
4.3.29
3gpp ps data off
yes
both
optional
optional
4.7
qos





pdn connection to scef
yes
cp

optional

dedicated bearer
no
n/a
n/a
n/a

gbr bearer
no
n/a
n/a
n/a

non-gbr bearer
yes
up



rate control (serving plmn)
yes
cp

optional

rate control (apn)
yes
both

optional
4.7.8
inter-ue qos for nb-iot ues using CP ciot eps optimisation
yes
yes
n/a
optional
4.10
ciot eps optimisation





up
yes
up
optional
optional

cp
yes
cp


note 1: whether the non-ip pdn connection is provided via scef or over sgi is transparent to the ue.
note 2: required for inter-rat idle mode mobility.
note 3: at least one of nidd scef and nidd sgi is required.

table m-2: clause?5.3 authentication, security and location management
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
5.3.1
ip address allocation (1)
yes
both
not required for nidd

5.3.2
attach procedure
yes
both



normal attach
yes
both
optional (2)


attach without pdn connectivity
yes
both
optional (2)
optional

emergency attach
no
n/a
n/a
n/a

sms transfer without combined attach
yes
both

optional
5.3.3
tau procedure
yes (3)
both


5.3.4
service request procedures
yes
both (4)


5.3.4a
connection suspend procedure
yes
up


5.3.4b
data transport in cp ciot eps optimisation
yes
cp



reliable data delivery with hop-by-hop acknowledgement
yes
cp
n/a
optional
5.3.5
s1 release procedure
yes (5)



5.3.5a
connection resume procedure
yes
up


5.3.6a
pdn gw pause of charging procedure
yes
both
n/a
optional
5.3.7
guti reallocation procedure
yes
both


5.3.8
detach procedure
yes (6)
both


5.3.10
security function
yes
both



as security
yes
up



nas security
yes
both


5.3.14
ue radio capability match request
no (7)
n/a
n/a
n/a
note 1: incl. attach without pdn connectivity.
note 2: at least one of normal attach and attach without pdn connectivity is required.
note 3: incl. inter rat.
note 4: also supported with cp ciot eps optimisation when the ue/mme also support s1-u data transfer or up ciot eps optimisation.
note 5: releases the s11-u bearer in case of cp ciot eps optimisation. rrc connection release is used with the ue.
note 6: isr aspects optional.
note 7: ims voice not supported over nb-iot.

table m-3: clause?5.4 session management, qos and interaction with pcc
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
5.4.1
dedicated bearer activation
no
n/a
n/a
n/a
5.4.2
bearer modification with qos update
yes
up
optional
optional
5.4.3
pdn gw initiated bearer modification without bearer qos update
yes
up


5.4.4
bearer deactivation
yes
up


5.4.5
ue-requested bearer resource modification
yes
both
optional with cp ciot eps optimisation

5.4.7
e-utran initiated erab modification procedure
no (1)
n/a
n/a
n/a
5.4.8
e-utran initiated ue context modification procedure
no (1)
n/a
n/a
n/a
note 1: dual connectivity not supported over nb-iot rat.

table m-4: clauses 5.5 and 5.6 handover and nacc
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
5.5
handover
no



5.5.1
intra-e-utran handover
no
n/a
n/a
n/a
5.5.2
inter rat handover
no
n/a
n/a
n/a
5.6
network assisted cell change
no
n/a
n/a
n/a

table m-5: misc.
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
5.8
mbms (3)
(3)
(3)
(3)
(3)
5.10
multiple pdn support and pdn activation for ues supporting attach without pdn connectivity
yes (1)
both


5.11
ue capability handling
yes
both


5.12
warning message delivery
no
n/a
n/a
n/a
5.13
drx and ue-specific drx parameter handling
yes (2)
both


5.13a
extended idle mode drx
yes
both
optional
optional
5.15
ran information management procedures
no
n/a
n/a
n/a
5.16
mme-initiated procedure on ue's csg membership change
no
n/a
n/a
n/a
5.17
henb multicast packet forwarding function
no
n/a
n/a
n/a
note 1: multiple pdn optional.
note 2: ue-specific drx not supported in nb-iot rat.
note 3: see table m-6.

table m-6:mtc/ciot-related items in ts?23.682?[74]
clause
clause title
support


nb-iot rat
cp/up/both
ue
nw
4.5.14.3
reliable data service
yes
cp
optional
optional
4.5.15, 5.14
support of PFD management via scef
yes
both
n/a
optional
4.5.16
msisdn-less mo-sms via t4
yes
both
optional
optional
4.5.18
mbms user service for ues using power saving functions
yes
both
optional
optional
4.5.19
enhancements to location services for ciot
yes
both
optional
optional
note: this table lists mtc/ciot-related items in ts?23.682?[74] not otherwise specified in the present specification.


annex n (informative):
change history
change history
date
meeting
tdoc
cr
rev
cat
subject/comment
new version
2013-06
sp-60
sp-130225
2518
1
a
clarification that imsvops is mmtel
12.1.0
2013-06
sp-60
sp-130225
2520
2
a
immediate cancel location ack during hss-initiated detach procedure
12.1.0
2013-06
sp-60
sp-130324
2521
3
b
isr handling in sipto at local network
12.1.0
2013-06
sp-60
sp-130324
2538
3
c
direct UP path establishment for sipto at local network on enodeb
12.1.0
2013-06
sp-60
sp-130305
2540
1
a
clarification on operations related to dual priority
12.1.0
2013-06
sp-60
sp-130232
2541
5
d
correct inconsistency with stage 1 regarding support for emergency bearer services in the serving network
12.1.0
2013-06
sp-60
sp-130310
2546
5
f
correction to pdn deactivation for sipto@ln
12.1.0
2013-06
sp-60
sp-130232
2557
2
b
individual subscription migration and subscriber troubleshooting
12.1.0
2013-06
sp-60
sp-130232
2559
1
b
addition of end marker support for handover scenarios with sgw relocation
12.1.0
2013-06
sp-60
sp-130310
2561
-
f
correction on the applicability of sipto@ln at a csg cell
12.1.0
2013-06
sp-60
sp-130232
2562
3
c
use of low access priority indication to select mme
12.1.0
2013-06
sp-60
sp-130232
2566
3
f
use of mm backoff timer for voice centric devices
12.1.0
2013-09
sp-61
sp-130375
2528
2
a
interoperation between mme and gn/gp sgsn
12.2.0
2013-09
sp-61
sp-130384
2567
2
b
introduction of gtp-c load control
12.2.0
2013-09
sp-61
sp-130374
2569
2
a
clarifications on qos and roaming
12.2.0
2013-09
sp-61
sp-130384
2571
2
b
gtp-c overload handling
12.2.0
2013-09
sp-61
sp-130379
2574
2
f
correction of sipto at local network
12.2.0
2013-09
sp-61
sp-130375
2576
1
a
fix equivalent plmn list handling
12.2.0
2013-09
sp-61
sp-130385
2578
2
c
addition of a note in general description of inter-rat ho
12.2.0
2013-09
sp-61
sp-130372
2582
2
a
reporting uli and timezone at network-initiated bearer release related procedures
12.2.0
2013-09
sp-61
sp-130378
2584
2
a
avoiding pdn gw relocation when radio and s1 bearers are active
12.2.0
2013-09
sp-61
sp-130379
2585
1
f
correction of local home network
12.2.0
2013-09
sp-61
sp-130379
2587
1
f
clarification on deactivating sipto@ln upon idle mode mobility
12.2.0
2013-12
sp-62
sp-130524
2554
4
a
dl traffic mapping alignment with ts?23.060.
12.3.0
2013-12
sp-62
sp-130524
2590
1
a
clarification on the handling non-mm message during handover
12.3.0
2013-12
sp-62
sp-130726
2594
12
b
core network assisted enodeb parameters tuning
12.3.0
2013-12
sp-62
sp-130524
2597
2
a
handling of uplink packet filters and definition for a valid state of the tft setting
12.3.0
2013-12
sp-62
sp-130669
2598
6
b
pdn gw and sgw charging alignment in downlink
12.3.0
2013-12
sp-62
sp-130526
2600
1
f
correction on the conditions for including the local home network id
12.3.0
2013-12
sp-62
sp-130526
2602
1
f
clarification for optimisation of lipa and sipto@ln paging
12.3.0
2013-12
sp-62
sp-130529
2603
9
b
introducing ue power saving mode
12.3.0
2013-12
sp-62
sp-130540
2605
2
f
addition of a note addressing the behavior of network side during inter-rat 3gpp ps handover
12.3.0
2013-12
sp-62
sp-130526
2607
1
f
deactivate isr for sipto@ln
12.3.0
2013-12
sp-62
sp-130526
2610
-
f
correction in local home network id definition
12.3.0
2013-12
sp-62
sp-130526
2611
1
f
corrections in handover and tau/rau procedures related to sipto at local network
12.3.0
2013-12
sp-62
sp-130526
2612
-
f
correcting reference to the sipto@ln clause
12.3.0
2013-12
sp-62
sp-130534
2613
2
f
use of lapi for mme/sgsn selection during handover
12.3.0
2013-12
sp-62
sp-130523
2616
-
a
local deactivation of isr to resume packet services
12.3.0
2013-12
sp-62
sp-130524
2621
3
a
fix downlink packet delivery failure due to crash with mobility event
12.3.0
2013-12
sp-62
sp-130533
2622
-
b
hplmn notification with specific indication due to mme initiated bearer removal
12.3.0
2013-12
sp-62
sp-130534
2623
5
b
reporting uli and timezone at mme-initiated bearer related procedures
12.3.0
2013-12
sp-62
sp-130533
2624
-
f
correction on the network management functions
12.3.0
2013-12
sp-62
sp-130533
2625
2
f
rollback behaviour for epc
12.3.0
2013-12
sp-62
sp-130583
2627
5
b
introduction of uli reporting at pcc area level
12.3.0
2013-12
sp-62
sp-130585
2629
3
b
introduction of uli reporting only when the ue is in 'connected' state
12.3.0
2013-12
sp-62
sp-130534
2632
1
f
modification on inter-rat handover from utran/geran to e-utran
12.3.0
2014-03
sp-63
sp-140111
2634
2
f
corrections for the pdn gw pause of charging functionality
12.4.0
2014-03
sp-63
sp-140106
2635
2
f
corrections for presence reporting area based location reporting
12.4.0
2014-03
sp-63
sp-140108
2636
2
f
delayed release of ue ip address during inter-rat 3gpp ps handover
12.4.0
2014-03
sp-63
sp-140106
2637
2
b
presence reporting area provided by ocs
12.4.0
2014-03
sp-63
sp-140104
2638
3
f
power saving mode applicability
12.4.0
2014-03
sp-63
sp-140111
2641
2
f
fix downlink message delivery failure due to crash with mobility event
12.4.0
2014-03
sp-63
sp-140098
2644
-
a
correction of ietf reference on prefix delegation
12.4.0
2014-06
sp-64
sp-140255
2654
1
a
add pco handling to the pdn gw initiated bearer modification procedure
12.5.0
2014-06
sp-64
sp-140377
2655
2
f
pdn gw pause of charging functionality and inter-operator charging
12.5.0
2014-06
sp-64
sp-140272
2656
1
f
correction of possible pdn gw actions during pdn connection termination
12.5.0
2014-06
sp-64
sp-140262
2658
3
b
introduction of dual connectivity function
12.5.0
2014-06
sp-64
sp-140256
2660
3
a
irat handover mme handling
12.5.0
2014-06
sp-64
sp-140251
2663
1
a
correction on priority paging
12.5.0
2014-06
sp-64
sp-140377
2672
-
f
handling of mme ue s1ap id in case of s1 release
12.5.0
2014-06
sp-64
sp-140257
2679
5
f
clarifying when the pdn gw can set uli reporting, csg reporting and pra reporting
12.5.0
2014-06
sp-64
sp-140263
2680
1
f
clarification on isr for psm ue
12.5.0
2014-06
sp-64
sp-140257
2681
1
f
clarifications for presence reporting area based location reporting
12.5.0
2014-06
sp-64
sp-140263
2683
2
f
clarifications for power savings mode
12.5.0
2014-06
sp-64
sp-140263
2684
9
f
cn assistance information for enb parameters setting
12.5.0
2014-06
sp-64
sp-140256
2689
2
a
clarification on mme behaviour on roaming situation
12.5.0
2014-06
sp-64
sp-140377
2693
3
f
inter plmn handover for emergency bearer service
12.5.0
2014-06
sp-64
sp-140377
2694
5
f
correction to the mme initiated bearer setup during the tau procedure
12.5.0
2014-06
sp-64
sp-140377
2695
1
f
pdn gw initiated bearer request message arrival during the tau
12.5.0
2014-06
sp-64
sp-140257
2696
3
f
correction of uli reporting only when the ue is in 'connected' state
12.5.0
2014-06
sp-64
sp-140270
2697
4
b
traffic steering for ran-based wlan interworking solution
12.5.0
2014-06
sp-64
sp-140262
2707
4
b
introduction of dual connectivity operation
12.5.0
2014-06
sp-64
sp-140377
2715
2
f
correction on the description of location service function
12.5.0
2014-09
sp-65
sp-140427
2722
1
b
changes and corrections related to gtp-c load/overload control feature
12.6.0
2014-09
sp-65
sp-140490
2727
4
f
clarifications for pra reporting
12.6.0
2014-09
sp-65
sp-140424
2735
3
f
update of 'wlan offloadability' indication via nas
12.6.0
2014-09
sp-65
sp-140429
2723
1
f
clarification on roaming subscription corresponding to specific rat for ts?23.401
13.0.0
2014-09
sp-65
sp-140428
2728
2
b
introducing ran congestion awareness function
13.0.0
2014-09
sp-65
sp-140428
2733
2
b
introduction of UP congestion management function
13.0.0
2014-12
sp-66
sp-140688
2731
7
b
paging policy differentiation for ims voice
13.1.0
2014-12
sp-66
sp-140675
2746
-
a
handling of e-utran inter rat handover information at ps handover from geran
13.1.0
2014-12
sp-66
sp-140686
2747
2
a
paging enhancements for low complexity ue
13.1.0
2014-12
sp-66
sp-140680
2752
1
a
correction of the cn assisted enodeb parameter tuning
13.1.0
2014-12
sp-66
sp-140686
2754
1
a
pending subscription change
13.1.0
2014-12
sp-66
sp-140684
2756
-
a
support of non-seamless offloading with ran rules
13.1.0
2014-12
sp-66
sp-140684
2758
1
a
clarification on the ran assistance parameters based on ran wgs agreements
13.1.0
2014-12
sp-66
sp-140674
2759
3
a
clarifications for tft handling
13.1.0
2014-12
sp-66
sp-140685
2761
1
a
clarifications for multimedia priority services
13.1.0
2014-12
sp-66
sp-140684
2764
1
a
clarification of wlan offload indication from mme in e-utran
13.1.0
2014-12
sp-66
sp-140678
2769
2
a
qos handling at inter-rat mobility
13.1.0
2014-12
sp-66
sp-140672
2773
1
a
correction of 'extended wait timers' in rrc signalling
13.1.0
2014-12
sp-66
sp-140685
2779
1
a
correction to the low access priority indication use by the network
13.1.0
2014-12
sp-66
sp-140689
2780
3
f
adding interoperabilty aspects between ran and cn for the cn-based solution
13.1.0
2014-12
sp-66
sp-140669
2786
1
a
handling cs service notification received during handover
13.1.0
2014-12
sp-66
sp-140685
2789
1
a
clarification to non-3gpp access to 3gpp access handover procedure
13.1.0
2014-12
sp-66
sp-140687
2790
2
a
e-utran initiated e-rab modification procedure update
13.1.0
2014-12
sp-66
sp-140689
2797
-
c
mme - rcaf interface
13.1.0
2014-12
sp-66
sp-140670
2810
1
a
ue capability storage in the mme
13.1.0
2015-03
sp-67
sp-150024
2805
5
f
enhancements when determine the list of ues served by a e-utran cell
13.2.0
2015-03
sp-67
sp-150109
2812
2
a
paging priority setting in the mme
13.2.0
2015-03
sp-67
sp-150021
2821
1
a
clarify handling of "ms info change reporting action" at change of serving node for an ue.
13.2.0
2015-03
sp-67
sp-150025
2822
4
b
group specific nas level congestion control
13.2.0
2015-03
sp-67
sp-150109
2825
1
a
downlink packet delivery failure during mobility event
13.2.0
2015-03
sp-67
sp-150027
2840
2
c
paging priority for push to talk
13.2.0
2015-03
sp-67
sp-150027
2842
1
f
fixing the mme behaviour for nas message transfer
13.2.0
2015-06
sp-68
sp-150230
2831
1
a
correcting esm re-activation attempts at plmn change when only one ip version is supported by the network
13.3.0
2015-06
sp-68
sp-150234
2837
11
b
introduce the dedicated core network (decor) feature
13.3.0
2015-06
sp-68
sp-150237
2843
2
b
apn and group specific nas level congestion control
13.3.0
2015-06
sp-68
sp-150236
2850
2
b
update to psm to support monitoring events
13.3.0
2015-06
sp-68
sp-150236
2851
2
b
support for monitoring events
13.3.0
2015-06
sp-68
sp-150237
2853
-
c
mcc cr implementation correction: group specific nas level congestion control
13.3.0
2015-06
sp-68
sp-150239
2857
1
f
paging priority and arp priority level: extension of cr2812r2 to cr2840r2
13.3.0
2015-06
sp-68
sp-150229
2861
3
a
ms info change reporting action at change of serving node (mme <--> sgsn): update of call flows
13.3.0
2015-06
sp-68
sp-150238
2862
3
b
introducing functions for high latency communication
13.3.0
2015-06
sp-68
sp-150234
2864
3
b
adding support for load re-balancing within dcn
13.3.0
2015-06
sp-68
sp-150239
2865
-
f
user csg information in tau/rau with sgw change procedure
13.3.0
2015-06
sp-68
sp-150237
2866
3
f
group specific nas level congestion control for multiple apns
13.3.0
2015-06
sp-68
sp-150236
2871
2
b
monitoring event configuration in the hss and mme
13.3.0
2015-06
sp-68
sp-150235
2872
2
b
hss and mme updates for aese 3gpp resource optimisations based on providing predictable communication patterns of a ue to the mme
13.3.0
2015-06
sp-68
sp-150230
2876
1
a
dual connectivity handling for the failed e-rab(s)
13.3.0
2015-06
sp-68
sp-150237
2877
1
f
clarification of group specific nas level congestion control
13.3.0
2015-06
sp-68
sp-150284
2869
2
a
clarification on network triggered service request
13.3.0
2015-09
sp-69
sp-150502
2883
3
b
introducing edrx for high latency communication
13.4.0
2015-09
sp-69
sp-150502
2884
-
f
non-applicability of hlcom monitoring events feature to gn/gp-sgsn
13.4.0
2015-09
sp-69
sp-150501
2887
1
b
introducing the solution for s/p-gw retransmissions when handling network originated CP procedure
13.4.0
2015-09
sp-69
sp-150501
2889
2
b
introducing extended idle mode drx feature to lte
13.4.0
2015-09
sp-69
sp-150505
2891
-
f
add reference to the mme/sgsn selection function
13.4.0
2015-09
sp-69
sp-150505
2892
3
b
paging optimisations
13.4.0
2015-09
sp-69
sp-150490
2894
1
a
adding psm parameters in the mme/ue contexts
13.4.0
2015-09
sp-69
sp-150502
2895
1
f
clarification of high latency communication
13.4.0
2015-09
sp-69
sp-150496
2898
1
f
corrections for dedicated core network procedures
13.4.0
2015-09
sp-69
sp-150496
2900
1
f
enhanced ho procedrue for decor
13.4.0
2015-09
sp-69
sp-150491
2902
-
a
correction of access network selection and traffic steering based on ran-assisted wlan interworking
13.4.0
2015-09
sp-69
sp-150493
2903
2
b
add informative annex containing implementation and deployment guidelines for iops
13.4.0
2015-12
sp-70
sp-150609
2905
3
f
update for ue reachability notifications
13.5.0
2015-12
sp-70
sp-150615
2906
2
b
ue radio capability for paging optimisation
13.5.0
2015-12
sp-70
sp-150603
2912
4
f
correct inconsistencies in the description of usim switching
13.5.0
2015-12
sp-70
sp-150606
2915
3
f
ue usage type in handovers
13.5.0
2015-12
sp-70
sp-150611
2916
9
b
paging for extended idle mode drx in lte
13.5.0
2015-12
sp-70
sp-150603
2920
1
f
corrections related to public safety network operator and iops network
13.5.0
2015-12
sp-70
sp-150606
2921
2
f
ue usage type in re-route message
13.5.0
2015-12
sp-70
sp-150615
2924
1
f
correction to pdn gw initiated bearer deactivation
13.5.0
2015-12
sp-70
sp-150796
2926
4
f
clarification of qos modifications restrictions
13.5.0
2015-12
sp-70
sp-150606
2927
2
f
retrieval of ue usage type from hss
13.5.0
2015-12
sp-70
sp-150615
2928
3
f
inclusion of ran/nas cause in delete bearer response
13.5.0
2015-12
sp-70
sp-150611
2929
1
f
clarification on using edrx in case of emergency bearer services
13.5.0
2015-12
sp-70
sp-150615
2935
3
b
addition of crlwi support
13.5.0
2015-12
sp-70
sp-150606
2936
1
f
providing imsi in d?cor redirection procedure
13.5.0
2015-12
sp-70
sp-150606
2943
-
f
enhanced ho procedrue for decor
13.5.0
2015-12
sp-70
sp-150737
2917
3
b
enhanced coverage for paging in lte
13.5.0
2016-03
sp-71
sp-160161
2930
11
b
introduction of solution 18 - suspend and resume procedure
13.6.0
2016-03
sp-71
sp-160161
2934
9
b
introducing support for non-ip data for ciot
13.6.0
2016-03
sp-71
sp-160161
2941
5
b
introducing ciot optimisations
13.6.0
2016-03
sp-71
sp-160161
2942
13
b
introduction of CP ciot eps optimisation
13.6.0
2016-03
sp-71
sp-160161
2948
8
b
introduction of support for nb-iot
13.6.0
2016-03
sp-71
sp-160161
2951
9
b
introduction of attach procedure changes for ciot eps optimisation.
13.6.0
2016-03
sp-71
sp-160156
2953
-
a
correction in mme triggered serving gw relocation procedure
13.6.0
2016-03
sp-71
sp-160161
2954
3
b
detach procedure for ciot optimisation
13.6.0
2016-03
sp-71
sp-160163
2958
1
f
fix wrong wording on dns procedure for decor
13.6.0
2016-03
sp-71
sp-160161
2959
4
b
tau procedure update for ciot eps optimisation
13.6.0
2016-03
sp-71
sp-160163
2961
1
f
alignment of support for decor in shared networks
13.6.0
2016-03
sp-71
sp-160161
2965
2
b
ciot-centric single node eps architecture
13.6.0
2016-03
sp-71
sp-160164
2966
2
f
handling of a 5.12s edrx cycle
13.6.0
2016-03
sp-71
sp-160162
2976
2
f
list of external identifiers in the subscription data
13.6.0
2016-03
sp-71
sp-160161
2977
2
b
ue capability handling for CP ciot eps optimisation
13.6.0
2016-03
sp-71
sp-160161
2980
4
b
disabling irat mobility to and from nb-iot
13.6.0
2016-03
sp-71
sp-160161
2981
3
b
support for overload control
13.6.0
2016-03
sp-71
sp-160161
2982
2
b
hlcom feature update for cp optimisation
13.6.0
2016-03
sp-71
sp-160161
2985
1
b
rau procedure update for ciot eps optimisation
13.6.0
2016-03
sp-71
sp-160161
2986
3
b
tau procedure update with gn/gp sgsn for ciot eps optimisation
13.6.0
2016-03
sp-71
sp-160161
2988
2
b
handover for non-nb-iot devices using ciot optimisations
13.6.0
2016-03
sp-71
sp-160161
2989
1
b
drx handling for nb-iot
13.6.0
2016-03
-
-
-
-
-
mcc correction to change positions of (new) clauses 4.10 and 4.11 for more logical clause ordering
13.6.1
2016-06
sp-72
sp-160292
2956
7
b
support of csg, lipa, and sipto@ln functions for dual connectivity
13.7.0
2016-06
sp-72
sp-160298
2964
2
b
priority treatment based on rrc establishment cause
13.7.0
2016-06
sp-72
sp-160286
2992
3
f
alignment of s11-u procedures with stage 3
13.7.0
2016-06
sp-72
sp-160286
2993
3
f
correction of ciot inter-rat handover conditions
13.7.0
2016-06
sp-72
sp-160286
2994
4
f
corrections for header compression in cp optimisation
13.7.0
2016-06
sp-72
sp-160286
2995
8
f
simultaneous support for cp and up optimisation
13.7.0
2016-06
sp-72
sp-160286
2996
1
f
paging for ce in cp optimisation
13.7.0
2016-06
sp-72
sp-160286
2997
3
f
support for sms using cp optimisation
13.7.0
2016-06
sp-72
sp-160286
2998
4
c
active flag handling for CP ciot optimisation
13.7.0
2016-06
sp-72
sp-160286
2999
8
f
support for rate control of ciot data
13.7.0
2016-06
sp-72
sp-160286
3000
1
f
irat stage 3 reattach alignment
13.7.0
2016-06
sp-72
sp-160298
3002
1
f
'ue reachability' event reports for ues using extended idle mode drx
13.7.0
2016-06
sp-72
sp-160286
3008
1
f
introduction of s11-u teid for CP ciot eps optimisation
13.7.0
2016-06
sp-72
sp-160286
3012
1
f
clarification of the s1 release procedure usage in context of ciot cp eps optimisation
13.7.0
2016-06
sp-72
sp-160286
3013
1
f
alignment of mme selection in attach and tau procedures with clause?4.3.8.3 'mme selection function'
13.7.0
2016-06
sp-72
sp-160286
3014
1
f
network features need to be consistent across tai list
13.7.0
2016-06
sp-72
sp-160286
3015
4
f
rrc layer impacts and system information usage in attach procedure
13.7.0
2016-06
sp-72
sp-160286
3017
-
f
clarification on ciot eps optimisation conflicting terminology
13.7.0
2016-06
sp-72
sp-160286
3022
-
f
handover support for header compression in cp optimisation
13.7.0
2016-06
sp-72
sp-160289
3023
2
f
pending data and user inactivity
13.7.0
2016-06
sp-72
sp-160286
3026
3
f
support for up optimisation from cp optimisation in ecm-idle state
13.7.0
2016-06
sp-72
sp-160286
3035
2
f
correction on mme overload control for ciot
13.7.0
2016-06
sp-72
sp-160286
3041
1
f
introduction of connection establishment indication procedure
13.7.0
2016-06
sp-72
sp-160286
3042
-
f
updates of handover procedures for ciot optimisation
13.7.0
2016-06
sp-72
sp-160286
3046
1
f
mme selection for ciot optimisation
13.7.0
2016-06
sp-72
sp-160286
3049
1
f
tau trigger for preferred network behaviour change
13.7.0
2016-06
sp-72
sp-160286
3051
-
f
handling of exception reports in the core network
13.7.0
2016-06
sp-72
sp-160299
2971
5
b
addition of ecall for ims emergency services
14.0.0
2016-06
sp-72
sp-160303
3024
2
b
ue assisted dcn selection
14.0.0
2016-09
sp-73
sp-160653
3050
8
b
support of multiple pras
14.1.0
2016-09
sp-73
sp-160648
3052
1
b
adding support for nonip & scef in geran
14.1.0
2016-09
sp-73
sp-160633
3058
1
a
clarifying pdn gw & scef role in apn rate control
14.1.0
2016-09
sp-73
sp-160649
3059
1
c
load balancing for mmes with multiple dcn support
14.1.0
2016-09
sp-73
sp-160633
3062
1
a
clarification of new active flag handling for cp ciot eps optimisation
14.1.0
2016-09
sp-73
sp-160649
3063
1
b
relation between the usage type and dcn id
14.1.0
2016-09
sp-73
sp-160649
3064
2
b
the dcn id related serving plmn information
14.1.0
2016-09
sp-73
sp-160633
3068
-
a
updates of edrx for nb-iot
14.1.0
2016-09
sp-73
sp-160633
3072
1
a
voice related indication for nb-iot
14.1.0
2016-09
sp-73
sp-160633
3074
1
a
priority handling of nas signalling and ciot data over nas
14.1.0
2016-09
sp-73
sp-160649
3078
1
f
clarification on usage of default standardized or plmn specific dcn-id.
14.1.0
2016-09
sp-73
sp-160633
3083
-
a
transfer of cell/tac's rat type to mme
14.1.0
2016-09
sp-73
sp-160634
3085
1
a
release assistance information for pair of packets
14.1.0
2016-09
sp-73
sp-160652
3087
1
b
handling of handovers for emergency sessions over wlan
14.1.0
2016-09
sp-73
sp-160659
3088
2
c
operator management of edrx parameters
14.1.0
2016-09
sp-73
sp-160634
3091
2
a
clarification on s1-u establishment during cp optimisation is in use
14.1.0
2016-09
sp-73
sp-160634
3094
-
a
correction of connection suspend
14.1.0
2016-09
sp-73
sp-160634
3099
1
a
correction to reporting of mo exception data
14.1.0
2016-09
sp-73
sp-160652
3100
1
b
pdn gw selection for emergency services with unauthenticated ues
14.1.0
2016-09
sp-73
sp-160658
3101
1
b
adding enodeb change reporting in location change reporting procedure
14.1.0
2016-09
sp-73
sp-160634
3105
2
a
multiple drb capability handling
14.1.0
2016-09
sp-73
sp-160649
3106
-
c
dcn congestion control
14.1.0
2016-09
sp-73
sp-160649
3107
1
c
dcn-id update
14.1.0
2016-09
sp-73
sp-160634
3109
1
a
clarification on cp only indicator for sgi pdn connections
14.1.0
2016-09
sp-73
sp-160635
3111
1
a
correction on bearer synchronization for up ciot eps optimisation
14.1.0
2016-09
sp-73
sp-160635
3112
2
a
CP only pdn connection indication in pdn setup
14.1.0
2016-09
sp-73
sp-160635
3120
2
a
handling of s11-u bearer during service request procedure
14.1.0
2016-09
sp-73
sp-160635
3122
1
a
correction of ue-ambr and apn-ambr handling for ciot eps optimisation
14.1.0
2016-09
sp-73
sp-160658
3123
1
b
adding enodeb change reporting to message flows
14.1.0
2016-09
sp-73
sp-160635
3128
3
a
clarification on nas level congestion for exception reporting.
14.1.0
2016-09
sp-73
sp-160635
3129
1
a
clarification on eab and low access priority indication in rrc over nb-iot
14.1.0
2016-12
sp-74
sp-160807
3070
4
a
nas pdu retransmission strategy for ciot optimisation
14.2.0
2016-12
sp-74
sp-160817
3130
1
f
corrections for allowing seamless handovers of emergency sessions to wlan
14.2.0
2016-12
sp-74
sp-160823
3131
4
c
reliable ue delivery based on hop-by-hop acknowledgements (5c)
14.2.0
2016-12
sp-74
sp-160823
3135
4
b
authorization of use of coverage enhancement
14.2.0
2016-12
sp-74
sp-160825
3137
1
f
clarifying the ue behaviour for switch to up
14.2.0
2016-12
sp-74
sp-160807
3139
-
a
correction of handling of resume cause
14.2.0
2016-12
sp-74
sp-160807
3141
1
a
apn rate control and emergency bearer service
14.2.0
2016-12
sp-74
sp-160823
3143
2
b
CP data back-off timer introduction
14.2.0
2016-12
sp-74
sp-160825
3144
2
f
missing indirect forwarding tunnel deletion in tau with sgw change
14.2.0
2016-12
sp-74
sp-160823
3145
2
b
support for inter-ue qos for nb-iot CP optimisation
14.2.0
2016-12
sp-74
sp-160807
3148
2
a
aligning specifications - no rat type in the initial ue message
14.2.0
2016-12
sp-74
sp-160807
3151
1
a
correction on mt data transport using cp ciot eps optimisation
14.2.0
2016-12
sp-74
sp-160823
3152
3
b
ciot_ki7_sol9 - overload start for CP data
14.2.0
2016-12
sp-74
sp-160818
3153
2
f
mme report for set of pra
14.2.0
2016-12
sp-74
sp-160807
3154
1
a
clarification on apn rate control
14.2.0
2016-12
sp-74
sp-160823
3156
2
b
ue radio capability handling for ues supporting nb-iot and wb-e-utran
14.2.0
2016-12
sp-74
sp-160808
3158
-
a
correction to reporting of mo exception data
14.2.0
2016-12
sp-74
sp-160810
3159
1
a
ue usage type withdraw
14.2.0
2016-12
sp-74
sp-160826
3161
4
b
introduction of ps data off feature
14.2.0
2016-12
sp-74
sp-160823
3163
2
b
location service message size adaptation according to coverage level
14.2.0
2016-12
sp-74
sp-160823
3164
2
b
inter-rat idle mode mobility to and from nb-iot
14.2.0
2017-03
sp-75
sp-170053
3167
1
f
rab setup information in the irat handover
14.3.0
2017-03
sp-75
sp-170050
3169
2
f
corrections of ue capability information to enb for cp ciot ues
14.3.0
2017-03
sp-75
sp-170050
3170
1
f
correction of ce authorization in tau
14.3.0
2017-03
sp-75
sp-170050
3171
1
f
support for restriction of enhanced coverage restriction per rat
14.3.0
2017-03
sp-75
sp-170050
3172
2
f
enhanced coverage restricted parameter in s1-ap in tau
14.3.0
2017-03
sp-75
sp-170050
3173
1
f
location reporting using CP ciot eps optimisation
14.3.0
2017-03
sp-75
sp-170043
3175
2
a
no need to support ue requested bearer resource modification for cp ciot
14.3.0
2017-03
sp-75
sp-170043
3177
4
a
no support for serving plmn rate control across multiple pdn connections
14.3.0
2017-03
sp-75
sp-170043
3179
1
a
indication for support of UP ciot optimisation to e-utran
14.3.0
2017-03
sp-75
sp-170043
3181
4
a
correction of serving plmn rate control
14.3.0
2017-03
sp-75
sp-170050
3188
1
f
restriction of use of coverage enhancement clarification for roaming ues
14.3.0
2017-03
sp-75
sp-170042
3195
3
a
priority treatment based on rrc establishment cause
14.3.0
2017-03
sp-75
sp-170052
3200
1
c
ts?23.401 support for transport level packet marking
14.3.0
2017-03
sp-75
sp-170050
3202
2
f
correction to the CP data back-off timer
14.3.0
2017-03
sp-75
sp-170042
3209
1
a
restriction of ce mode b with dedicated bearer requirements
14.3.0
2017-06
sp-76
sp-170370
3210
3
f
clarification for pdn gw handling of ims services at 3gpp ps data off activation
14.4.0
2017-06
sp-76
sp-170361
3214
1
a
correction serving plmn rate control and apn rate control
14.4.0
2017-06
sp-76
sp-170361
3219
1
a
correction of forwarding of mo exception data counter
14.4.0
2017-06
sp-76
sp-170367
3221
2
f
handling of emergency call numbers received from wlan
14.4.0
2017-06
sp-76
sp-170365
3222
1
f
radio capabilities for ecall only mode
14.4.0
2017-06
sp-76
sp-170369
3231
-
f
clarification for congestion control for default apn
14.4.0
2017-06
sp-76
sp-170369
3233
-
f
removal of ue-ambr from inter-ue qos for nb-iot ues using CP ciot eps optimisation
14.4.0
2017-06
sp-76
sp-170363
3236
2
a
handling of ce mode b support for "voice centric" ues
14.4.0
2017-06
sp-76
sp-170361
3248
2
a
pdn-connection-restricted flag
14.4.0
2017-06
sp-76
sp-170372
3252
2
f
voice/video support for "data centric" ues operating in ce mode a/b
14.4.0
2017-06
sp-76
sp-170369
3254
1
f
clarification on mobility support between nb-iot and gprs
14.4.0
2017-06
sp-76
sp-170375
3225
5
b
ts 23.401 subscription control for epc_dc_nr
15.0.0
2017-06
sp-76
sp-170513
3234
3
b
pdn gw selection for 5gc ue
15.0.0
2017-06
sp-76
sp-170375
3257
1
b
ue capability handling for epc_dc_nr
15.0.0
2017-09
sp-77
sp-170728
3255
1
b
updated scope for dual connectivity with other rats
15.1.0
2017-09
sp-77
sp-170728
3258
2
b
per eps bearer, ran selection of dc (or non-dc) usage
15.1.0
2017-09
sp-77
sp-170719
3260
2
a
corrections to pdn gw handling of ue data off status
15.1.0
2017-09
sp-77
sp-170723
3262
1
a
alignment with enb and mme cp relocation indication procedures
15.1.0
2017-09
sp-77
sp-170728
3267
5
b
secondary rat related data usage reporting
15.1.0
2017-09
sp-77
sp-170716
3271
2
a
correction on the condition for stopping CP back-off timer at the ue
15.1.0
2017-09
sp-77
sp-170728
3272
6
b
indication nr is available to use
15.1.0
2017-09
sp-77
sp-170728
3273
1
b
nas ue indicator for dual connectivity with nr
15.1.0
2017-09
sp-77
sp-170715
3277
1
a
dcns without hss subscription information
15.1.0
2017-09
sp-77
sp-170728
3279
1
f
subscription control for epc_dc_nr
15.1.0
2017-09
sp-77
sp-170728
3285
3
b
control of secondary rat data volume reporting
15.1.0
2017-09
sp-77
sp-170732
3286
2
f
handling of multiple cp parameter sets
15.1.0
2017-09
sp-77
sp-170729
3289
2
c
23.401 pcef support for data off phase 2
15.1.0
2017-09
sp-77
sp-170716
3291
1
a
correction for data centric ues
15.1.0
2017-09
sp-77
sp-170728
3299
1
b
ran specification reference for en-dc
15.1.0
2017-09
sp-77
sp-170728
3300
1
f
clarification to dc procedure when nr is used as secondary rat
15.1.0
2017-09
sp-77
sp-170713
3301
2
a
no support of dedicated bearers for nb-iot
15.1.0
2017-09
sp-77
sp-170713
3304
1
a
correction of header compression for cp optimisation
15.1.0
2017-09
sp-77
sp-170728
3306
-
b
subscription control for epc_dc_nr: handover from gn/gp sgsn
15.1.0
2017-09
sp-77
sp-170713
3314
-
a
correction of apn rate control enforcement and exceptional mo data
15.1.0
2017-09
sp-77
sp-170713
3316
-
a
correction of forwarding of mo exception data counter
15.1.0
2017-09
sp-77
sp-170726
3319
-
a
cp only ue support of bearer modification and hc negotiation
15.1.0
2017-12
sp-78
sp-170912
3295
1
a
correction of capability indication for downlink nas data pdu acknowledgment
15.2.0
2017-12
sp-78
sp-170909
3321
1
a
correction of apn rate control - interoperability with legacy ues
15.2.0
2017-12
sp-78
sp-170914
3324
1
a
update of tau procedure with sgw change and data forwarding
15.2.0
2017-12
sp-78
sp-170920
3325
3
c
secondary rat related data usage reporting improvements
15.2.0
2017-12
sp-78
sp-170920
3326
3
f
secondary rat related data usage reporting format from ran
15.2.0
2017-12
sp-78
sp-170920
3327
1
f
secondary rat related data usage reporting corrections
15.2.0
2017-12
sp-78
sp-170924
3328
4
b
introduction of service gap control
15.2.0
2017-12
sp-78
sp-170921
3331
-
c
clarification on ue behavior when receiving single list of exempt services - ts?23.401
15.2.0
2017-12
sp-78
sp-170920
3332
1
f
clarification of the case that hss provide the access restriction
15.2.0
2017-12
sp-78
sp-170926
3335
4
b
enhanced volte performance cr for ts?23.401
15.2.0
2017-12
sp-78
sp-170909
3340
1
a
non-ip protection from broadcast messages
15.2.0
2017-12
sp-78
sp-170920
3342
-
f
correction on the update of ran in subscription change
15.2.0
2017-12
sp-78
sp-170924
3344
1
c
reliable data service with ptp sgi tunneling
15.2.0
2017-12
sp-78
sp-170912
3346
4
a
s11-u interface separation from s1-u interface
15.2.0
2017-12
sp-78
sp-170912
3348
3
a
data support for "voice centric" ue supporting ce mode b
15.2.0
2017-12
sp-78
sp-170924
3353
2
f
modify bearer request during tau
15.2.0
2017-12
sp-78
sp-170909
3356
2
a
ue ciot capability in rrc connection establishment request for tau
15.2.0
2017-12
sp-78
sp-170927
3357
1
b
data volume reporting when secondary rat is using unlicensed spectrum
15.2.0
2017-12
sp-78
sp-170927
3358
1
b
rat restriction when secondary rat is using unlicensed spectrum
15.2.0
2017-12
sp-78
sp-170924
3359
3
c
use of arp priority level in addition to qci for packet handling
15.2.0
2017-12
sp-78
sp-170920
3360
1
f
correcting the condition for selection of pgw and sgw for nr as secondary rat
15.2.0
2017-12
sp-78
sp-170920
3362
2
f
corrections to secondary rat usage data reporting
15.2.0
2017-12
sp-78
sp-170912
3364
2
a
non-overlapping mmecs for cp ciot eps optimisation
15.2.0
2017-12
sp-78
sp-170919
3365
2
b
dual registration supported indicator from mme
15.2.0
2017-12
sp-78
sp-170915
3367
2
a
clarification on ps data off status reporting - ts?23.401
15.2.0
2017-12
sp-78
sp-170920
3368
1
f
cleaup related to secondary rat related data usage reporting
15.2.0
2017-12
sp-78
sp-170941
3372
3
f
correction to enhanced coverage restriction
15.2.0
2017-12
sp-78
sp-170918
3375
1
a
ciot corrections related to pdn connections
15.2.0
2017-12
sp-78
sp-170924
3376
-
d
editorial corrections for ciot
15.2.0
2018-03
sp-79
sp-180113
3378
1
f
alignment cr for for storing ce mode b ue capability in mme
15.3.0
2018-03
sp-79
sp-180113
3381
2
f
clarification on pra reporting in ecm-idle state
15.3.0
2018-03
sp-79
sp-180085
3391
1
a
addition of ec restriction parameter in s1 ap paging message
15.3.0
2018-03
sp-79
sp-180113
3392
2
c
mme handling of unsupported apn
15.3.0
2018-03
sp-79
sp-180112
3396
3
b
feature definition for supporting 15 eps bearers
15.3.0
2018-03
sp-79
sp-180090
3398
1
f
interworking aspects of eps with 5gs are captured in 23.501 and 23.502
15.3.0
2018-03
sp-79
sp-180111
3403
1
f
alignment with stage-3 reporting and access restriction for unlicensed spectrum
15.3.0
2018-03
sp-79
sp-180108
3405
1
f
missing identification of step?in clause?5.3.8.4
15.3.0
2018-03
sp-79
sp-180089
3407
1
a
correction to enb cp relocation indication procedure
15.3.0
2018-06
sp-80
sp-180498
3350
4
b
additional parameters for nb-iot ue uu operation optimisation
15.4.0
2018-06
sp-80
sp-180496
3404
6
b
identification of lte-m (emtc) traffic
15.4.0
2018-06
sp-80
sp-180496
3408
5
f
correction of apn rate control for pdn connection release and re-establishment
15.4.0
2018-06
sp-80
sp-180496
3410
3
f
alignment with ct1/ran on handling of s1ap connection establishment indication
15.4.0
2018-06
sp-80
sp-180497
3411
4
b
subscription for aerial ue in 3gpp system
15.4.0
2018-06
sp-80
sp-180495
3412
2
f
clarification of using more than eight eps bearers with eps
15.4.0
2018-06
sp-80
sp-180496
3413
1
f
alignment with ct?wg1 for handling of connection resume requests at service gap
15.4.0
2018-06
sp-80
sp-180472
3416
1
a
3gpp ps data off clarification
15.4.0
2018-06
sp-80
sp-180472
3418
1
a
correction of non-3gpp to e-utran handovers
15.4.0
2018-06
sp-80
sp-180495
3419
2
b
ue capability for supporting 15 eps bearers
15.4.0
2018-06
sp-80
sp-180495
3420
2
b
network support for increased number of bearers
15.4.0
2018-06
sp-80
sp-180471
3423
5
f
radio efficient handling of large ue radio capabilities at inter-rat and srvcc handover
15.4.0
2018-06
sp-80
sp-180492
3426
3
f
handling of very large ue radio capabilities for the anticipated en-dc ues
15.4.0
2018-06
sp-80
sp-180471
3429
-
a
handling of large ue radio capabilities at inter-rat and srvcc handover
15.4.0
2018-06
sp-80
sp-180495
3430
-
c
support for 15 bearers in pgws across plmn
15.4.0
2018-06
sp-80
sp-180496
3436
1
b
introducing early data transmission for CP ciot eps optimization
15.4.0
2018-06
sp-80
sp-180496
3438
3
f
applicability of service gap control in idle and connected mode
15.4.0
2018-06
sp-80
sp-180496
3440
4
f
mme request for ue radio capabilities
15.4.0
2018-06
sp-80
sp-180492
3441
2
f
secondary rat usage reporting with multiple pdn connection
15.4.0
2018-09
sp-81
sp-180729
3443
1
f
negotiation of long periodic tau timer value
15.5.0
2018-09
sp-81
sp-180729
3444
6
f
ue radio capability update using tau procedure
15.5.0
2018-09
sp-81
sp-180729
3445
5
c
further proposal for subscribed ptw length
15.5.0
2018-09
sp-81
sp-180729
3446
1
f
corrections for arp priority level
15.5.0
2018-09
sp-81
sp-180729
3448
8
f
clarification on edt procedure
15.5.0
2018-09
sp-81
sp-180725
3450
1
f
correction on secondary rat data usage report
15.5.0
2018-09
sp-81
sp-180729
3451
-
f
ue radio capabilities - alignment with rsrvcc from geran
15.5.0
2018-09
sp-81
sp-180728
3452
5
b
traffic profile for nb-iot ue uu operation optimisation
15.5.0
2018-09
sp-81
sp-180711
3458
1
a
corrections to re-negotiation of header compression configuration
15.5.0
2018-09
sp-81
sp-180729
3459
2
f
correction of apn rate control status in bearer deactivation
15.5.0
2018-12
sp-82
sp-181095
3460
3
f
as rai system impacts
15.6.0
2018-12
sp-82
sp-181080
3466
1
a
reporting ps data off status change when sm back off timer is running
15.6.0
2018-12
sp-82
sp-181080
3470
1
a
ps data off supporting non-ip data
15.6.0
2018-12
sp-82
sp-181082
3472
1
a
correction of reference in CP nas congestion control
15.6.0
2018-12
sp-82
sp-181095
3476
3
f
rat specific subscribed ptw length
15.6.0
2018-12
sp-82
sp-181095
3479
2
f
corrections to service gap control
15.6.0
2018-12
sp-82
sp-181093
3481
2
f
end marker and erab modification for dual connectivity
15.6.0
2018-12
sp-82
sp-181093
3482
1
f
correction of secondary rat periodic reporting description
15.6.0
2018-12
sp-82
sp-181095
3485
1
f
correction of serving plmn rate control
15.6.0
2019-03
sp-83
sp-190153
3493
-
f
end marker and erab modification interaction for dual connectivity
15.7.0
2019-06
sp-84
sp-190403
3505
4
b
updating lcs procedures for location reporting for multiple cells
15.8.0
2019-06
sp-84
sp-190404
3506
2
c
tnl address discovery for en-dc
15.8.0
2019-06
sp-84
sp-190403
3513 
2
f
secondary cell id reporting - completion and signalling efficiency
15.8.0
2019-06
sp-84
sp-190399
3515
-
d
interworking aspects of eps with 5gs are captured in 23.501 and 23.502
15.8.0
2019-09
sp-85
sp-190603
3529
2
f
location reporting: li and signalling load
15.9.0
2019-09
sp-85
sp-190603
3531
1
f
location reporting: periodic pscell id reporting
15.9.0

 [blt[1]tagged procedure
[blt[2]step
[blt[3]reference
[br[4]procedure
[blt[5]condition
[blt[6]pattern execute r p c v i i i y
[br[7]step
[br[8r7]pattern execute a v p y
[blt[9]dummy
[br[10]actor
[br[11]pattern send y v x m a a a
[br[12]actor
[br[13]message
[br[14]args
[br[15]args
[br[16]args
[br[17]condition
[br[18]reference
[br[19]args
[br[20]pattern constraint c r a v p y
[br[21]procedure
[br[22]actor
[br[23]pattern execute y v i p
[br[24]pattern constraint y i v i p
[br[25]procedure
[br[26]procedure
[br[27]actor
[br[28]condition
[br[29]condition
[br[30]condition
[br[31]pattern execute y c i c v i p 
[br[32]pattern execute constraint y i c c i v p 
[br[33]procedure
[br[34]condition
[br[35]actor
[br[36]condition
[br[37]pattern execute c y c v p r
[br[38]procedure
[br[39]reference
[br[40]condition
[br[41]actor
[br[42]pattern constraint c y v p
[br[43]procedure
[br[44]condition
[br[45]condtion
[br[46]actor
[br[47]pattern execute c c y v p
[br[48]procedure
[br[49]actor
[br[50]condition
[br[51]procedure
[br[52]pattern execute y c p v
[br[53]note (applies to new mme when receiving tau request)
[br[54]actor
[br[55]condition
[br[56]pattern execute y c v p
[br[57]procedure
[br[58]pattern execute y c i i v p
[br[59]procedure
[br[60]pattern execute y i i i i i v p
[br[61]procedure
[br[62]configuration
[br[63]pattern execute i v p i i i y
[br[64]procedure
[br[65]pattern execute i v p i y
[br[66]process
[br[67]pattern execute i v y p c
[br[68]actor
[br[69]procedure
[br[70]condition
[br[71]pattern execute i v y c p
[br[72]actor
[br[73]condition
[br[74]procedure
[br[75]pattern execute i v p y
[br[76]procedure
[br[77]actor
[br[78]pattern execute y v p r
[br[79]procedure
[br[80]reference
[br[81]process
[br[82]process
[br[83]pattern execute p i v i i y c
[br[84r83]pattern execute p i v i y c
[br[85]pattern execute i v y c p
[br[86]actor
[br[87]condition
[br[88]procedure
[br[89]procedure
[br[90]pattern execute p v y c 
[br[91]actor
[br[92]condition
[br[93]actor
[br[94]pattern execute y v p
[br[95]procedure
[br[96]actor
[br[97]condition
[br[98]pattern execute y c v i p
[br[99r98]pattern execute y c i v i p
[br[100]process
[br[101]process
[br[102]condition
[br[103]actor
[br[104]pattern execute c y v i p i r
[br[105r104]pattern execute c y i v i p r
[br[106]procedure
[br[107]procedure
[br[108]reference
[br[109]condition
[br[110]actor
[br[111]pattern execute c y v p
[br[112]procedure
[br[113]actor
[br[114]pattern execute y v i p i r
[br[115r114]pattern execute y i v i p r
[br[116]procedure
[br[117]procedure
[br[118]reference
[br[119]actor
[br[120]pattern execute y v p c c
[br[121]procedure
[br[122]condition
[br[123]condition
[br[124]actor
[br[125]condition
[br[126]pattern execute y c v p r
[br[127]procedure
[br[128]reference
[br[129]step
[br[130]actor
[br[131]pattern execute y v p
[br[132]procedure
[br[133]condition
[br[134]condition
[br[135]condition
[br[136]actor
[br[137]pattern execute c or c or c y v r p
[br[138]reference
[br[139]procedure
[br[140]actor
[br[141]pattern send y v m a x
[br[142]message
[br[143]args
[br[144]actor
[br[145]pattern execute y i i i i v p c
[br[146]procedure
[br[147]condition
[br[148]pattern execute y i i i i i i i v p c
[br[149]procedure
[br[150]condition
[br[151]condition
[br[152]condition
[br[153]actor
[br[154]pattern execute c and c y v p
[br[155]procedure
[br[156]condition
[br[157]actor
[br[158]pattern execute c y v i p i c
[br[159]pattern execute c y i v i p c
[br[160]procedure
[br[161]procedure
[br[162]condition
[br[163]actor
[br[164]pattern execute y v p
[br[165]procedure
[br[166]actor
[br[167]step
[br[168]actor
[br[169]pattern execute y v r p
[br[170]reference
[br[171]procedure
[br[172]pattern execute y i i i v p 
[br[173]procedure 
[br[174]pattern send y i i i i i v i m x
[br[175]pattern send y i i i i i i v m i x
[br[176]message
[br[177]actor
[br[178]actor
[br[179]actor
[br[180]pattern execute y v p a a
[br[181]procedure
[br[182]argument
[br[183]argument
[br[184]procedure
[br[185]actor 
[br[186]pattern receive_constraint p y v a
[br[187]args
[br[188]pattern send y i i v m c i i x
[br[189]message
[br[190]condition
[br[191]pattern execute i v p y
[br[192]procedure
[br[193]actor
[br[194]condition
[br[195]actor
[br[196]pattern send c y v m a x
[br[197]message
[br[198]argument
[br[199]actor
[br[200]actor
[br[201]condition
[br[202]condition
[br[203]actor
[br[204]pattern execute c i y v i p
[br[205]pattern execute c y i v p
[br[206]process
[br[207]condition 
[br[208]actor
[br[209]pattern reply c y v m i i i x
[br[210]message
[br[211]pattern execute y i i v p c 
[br[212]procedure
[br[213]condition
[br[214]actor
[br[215]condition
[br[216]pattern execute y c v p
[br[217]procedure
[br[218]step
[br[219r218]pattern execute c v p i i y
[br[220]dummy
[br[221r220]pattern execute c i p v i y
[br[222]condition
[br[223]actor
[br[224]pattern execute c y v p
[br[225]pattern reply c y i v m a x
[br[226]message
[br[227]argument
[br[228]actor
[br[229]actor
[br[230]condition
[br[231]pattern execute y c v a p
[br[232]args
[br[233]process
[br[234]condition
[br[235]actor
[br[236]pattern execute c y v i p
[br[237]pattern execute y c v p
[br[238]pattern reply c y i i v m a x 
[br[239]message
[br[240]args
[br[241]actor
[br[242]condition
[br[243]pattern execute y i i i i i i c v p r
[br[244]procedure
[br[245]reference
[br[246]reference
[br[247]note
[br[248]note
[br[249]condition
[br[250]condition
[br[251]actor
[br[252]pattern execute c c y v p
[br[253]procedure
[br[254]note
[br[255]condition
[br[256]condition
[br[257]condition
[br[258]actor
[br[259]actor
[br[260]pattern reply x i i i c i or c y i v i p
[br[261]pattern reply x i i i i c or c i y i v p
[br[262]process
[br[263]pattern [br[263]execute i v i p y i c
[br[264]pattern [br[264]execute i v p i y c
[br[265]process
[br[266]actor
[br[267]actor
[br[268]condition
[br[269]actor
[br[270]condition
[br[271]actor
[br[272]condition
[br[273]condition
[br[274]pattern execute y c i i c v i p
[br[275]pattern execute y c c i v p
[br[276]procedure
[br[277]condition
[br[278]condition
[br[279]pattern [br[279]execute y i i i i i i i c c v i p
pattern [br[280]execute y i i i i i c c i v p
[br[281]procedure 
[br[282]pattern execute i v i p c i y
[br[283]pattern execute i v p c i i y
[br[284]procedure
[br[285]condition
[br[286]condition
[br[287]actor
[br[288]actor
[br[289]pattern execute c y i v i p
[br[290]pattern execute c i y i v p
[br[291]procedure
[br[292]condition
[br[293]pattern execute y i i i i c v i p
[br[294]pattern execute y i i i c i v p
[br[295]process
[br[296]condition
[br[297]actor
[br[298]pattern execute c y v p
[br[299]procedure
[br[300]condition
[br[301]pattern execute y i i c v p
[br[302]procedure
[br[303]condition
[br[304]actor
[br[305]pattern execute c y v p
[br[306]procedure
[br[307]pattern execute c y i i v p r
[br[308]procedure
[br[309]reference
[br[310]actor
[br[311]pattern execute y v c p
[br[312]condition
[br[313]process
[br[314]condition
[br[315]actor
[br[316]pattern execute c y v p c
[br[317]procedure
[br[318]condition
[br[319]actor
[br[320]condition
[br[321]pattern execute y c v i p
[br[322]actor
[br[323]process
[br[324]step
[br[325]reference
[br[326]condition
[br[327]pattern execute y i i i c v p r
[br[328]procedure
[br[329]reference
[br[330]reference
[br[331]condition
[br[332]condition
[br[333]pattern execute y i i i i i i i r c c v p
[br[334]procedure
[br[335]condition
[br[336]condition
[br[337]actor
[br[338]pattern execute c c y v i p
[br[339]pattern execute c c y i v i p
[br[340]procedure
[br[341]procedure
[br[342]note
[br[343]condition
[br[344]actor
[br[345]condition
[br[346]pattern execute c y c v p
[br[347]process 
[br[348]pattern execute c y c i i v p
[br[349]procedure
[br[350]condition
[br[351]condition
[br[352]actor
[br[353]pattern execute c i c i i i i c and c y v p
[br[354]procedure 
[br[355]pattern execute c i c i i i i c and c y i i v p r
[br[356]procedure
[br[357]referece
[br[358]step
[br[359]actor
[br[360]actor
[br[361]condition
[br[362]pattern execute y i i v i p c
[br[363r362]pattern execute y c i v p c
[br[364]procedure
[br[365]condition
[br[366]actor
[br[367]condition
[br[368]actor
[br[369]pattern execute y i i v i p c c c r
[br[370]pattern execute c y i v p c c c r
[br[371]pocedure
[br[372]condition
[br[373]condition
[br[374]condition
[br[375]reference
[br[376]condition
[br[377]actor
[br[378]pattern send c y v m x a
[br[379]message
[br[380]actor
[br[381]argument
[br[382]actor
[br[383]procedure constraint y v p
[br[384]procedure
[br[385]condition
[br[386]actor
[br[387]pattern constraint c y v p
[br[388]procedure
[br[389]note
[br[390]note
[br[391]condition
[br[392]procedure
[br[393]pattern execute c p v y
[br[394]actor
[br[395]pattern send c i i y v a x i i i i i i m
[br[396]args
[br[397]actor
[br[398]actor
[br[399]pattern execute c i i i i i i y v p
[br[400]procedure
[br[401]args
[br[402]pattern send_constraint y i i i i i i a v p m
[br[403]procedure
[br[404]message
[br[405]condition
[br[406]skip
[br[407]pattern skip c s v
[br[408]step
[br[409]condition
[br[410]actor
[br[411]pattern execute c y v p
[br[412]procedure
[br[413]conditon
[br[414]actor
[br[415]pattern execute c y v p
[br[416]procedure
[br[417]actor
[br[418]pattern execute y v c p
[br[419]condition
[br[420]procedure
[br[421]conditon
[br[422]actor
[br[423]pattern execute c y v i i p
[br[424]pattern execute c y i v i p
[br[425]the implied tau reject message is not in the text
[br[426]procedure
[br[427]actor
[br[428]condition
[br[429]pattern send y c v m a a x a a a a
[br[430]message
[br[431]args
[br[432]args
[br[433]actor
[br[434]args
[br[435]args
[br[436]args
[br[437]args
[br[438]condition
[br[439]condition
[br[440]actor
[br[441]pattern constraint c c y v a p c
[br[442]arguments
[br[443]process
[br[444]condition 
[br[445]condition
[br[446]condition
[br[447]actor
[br[448]pattern constraint c c y v a p c
[br[449]argument
[br[450]procedure
[br[451]condition
[br[452]condition
[br[453]actor
[br[454]pattern constraint c y v p a
[br[455]proces
[br[456]argument
[br[457]condition
[br[458]actor
[br[459]pattern constraint c y v a a p a
[br[460]argument
[br[461]argument
[br[462]pattern
[br[463]argument
[br[464]actor
[br[465]pattern constraint y v p a c
[br[466]procedure
[br[467]argument
[br[468]condition
[br[469]condition
[br[470]actor
[br[471]pattern constraint c y v p a
[br[472]pattern
[br[473]argument
[br[474]condition
[br[475]actor
[br[476]pattern send c y v x m r
[br[477]actor
[br[478]message
[br[479]reference
[br[480]condition
[br[481]condition
[br[482]reference
[br[483]actor
[br[484]pattern execute c c r y v p
[br[485]procedure
[br[486]step
[br[487]pattern execute a v p y
[br[488]dummy
[br[489]actor
[br[490]actor
[br[491]pattern send y x v m a
[br[492]message
[br[493]args
[br[494]args
[br[495]args
[br[496]args
[br[497]args
[br[498]procedure
[br[499]pattern execute y i i i i a i i i p v i i i c
[br[500r499]pattern execute y i i i i i a i i p i v i i c
[br[501r499]pattern execute y i i i i i i a i p i i v i c
[br[502r499]pattern execute y i i i i i i i a p i i i v c
[br[503]condition
[br[504]actor
[br[505]actor
[br[506]pattern execute y i v i p
[br[507]pattern execute y i v p
[br[508]procedure
[br[509]condition
[br[510]actor
[br[511]pattern execute c y v p
[br[512]procedure
[br[513]condition
[br[514]condition
[br[515]actor
[br[516]pattern execute c c y v a p
[br[517]args
[br[518]procedure
[br[519]else
[br[520]actor
[br[521]pattern execute y v p a 
[br[522]procedure
[br[523]args
[br[524]step
[br[525]condition
[br[526]condition
[br[527]actor
[br[528]pattern execute c c y v a p r
[br[529]args
[br[530]procedure
[br[531]reference
[br[532]actor
[br[533]condition
[br[534]pattern execute y c v p
[br[535]procedure
[br[536]condition
[br[537]actor
[br[538]pattern execute c y v p
[br[539]procedure
[br[540]step
[br[541]actor
[br[542]pattern execute y v p
[br[543]procedure
[br[544]pattern reply y i i v i m a a a c i i i i i i i i i i x
[br[545]pattern reply y i i i v m a a i i i i i i i i i i i i x
[br[546]message
[br[547]args
[br[548]args
[br[549]args
[br[550]condition
[br[551]pattern execute i v p y c
[br[552]procedure
[br[553]actor
[br[554]condition
[br[555]condition
[br[556]condition
[br[557]actor
[br[558]pattern execute c c y v a p 
[br[559]args
[br[560]procedure
[br[561]actor
[br[562]condition
[br[563]actor
[br[564]pattern send c y v m x c
[br[565]message
[br[566]actor
[br[567]condition
[br[568]condition
[br[569]actor
[br[570]pattern execute c y v i p
[br[571]pattern execute c y i v i p
[br[572]procedure
[br[573]procedure
[br[574]actor
[br[575]pattern send y v m x
[br[576]message
[br[577]actor
[br[578]step
[br[579]actor
[br[580]pattern execute y v p
[br[581]procedure
[br[582]actor
[br[583]pattern reply y v i m a a a a c i i i x
[br[584]pattern reply y i v m i i i i i c a a x
[br[585]message
[br[586]arg
[br[587]arg
[br[588]arg
[br[589]args
[br[590]condition
[br[591]condition
[br[592]args
[br[593]args
[br[594]actor
[br[595]condition
[br[596]condtition
[br[597]condition
[br[598]actor
[br[599]pattern execute c c c y v a a a a p 
[br[600]arg
[br[601]arg
[br[602]arg
[br[603]arg
[br[604]process
[br[605]condition
[br[606]actor
[br[607]pattern execute c c c i i i i i i i i y v a a p 
[br[608]arg
[br[609]arg
[br[610]process
[br[611]actor
[br[612]condition
[br[613]actor
[br[614]condition
[br[615]pattern send y c x i v i m r
[br[616]pattern send y i x c i v m r
[br[617]message
[br[618]reference
[br[619]step
[br[620]pattern execute a v p y
[br[621]procdure
[br[622]actor
[br[623]pattern execute y v i i p i i c
[br[624r623]pattern execute y i v i i p i i c
[br[625]pattern execute y i i v i i p i i c
[br[626]procedure
[br[627r626]procedure
[br[628r626]procedure
[br[629]condtion
[br[630]condition
[br[631]condition
[br[632]condition
[br[633]condition
[br[634]actor
[br[635]pattern send c or c y v m a x i i i i i i i i a a
[br[636]message
[br[637]args
[br[638]actor
[br[639]pattern execute v p y
[br[640]procedure
[br[641]actor
[br[642]condition
[br[643]pattern execute c v p y i i i i i a i i i i i i i a
[br[644]procedure
[br[645]actor
[br[646]actor
[br[647]pattern execute y v p 
[br[648]procedure
[br[649]actor
[br[650]pattern execute y v p
[br[651]procedure
[br[652]pattern execute i v y p
[br[653]actor
[br[654]procedure
[br[655]args
[br[656]reference
[br[657]pattern execute a r v p y c r
[br[658]procedure
[br[659]actor
[br[660]condition
[br[661]reference
[br[662]pocedure
[br[663]pattern execute p v y c
[br[664]actor
[br[665]condition
[br[666]condition
[br[667]reference
[br[668]actor
[br[669]pattern execute c r y v a p r
[br[670]args
[br[671]procedure
[br[672]procedur reference
[br[673]condition
[br[674]condition
[br[675]condition
[br[676]actor
[br[677]pattern execute c c c y v p r
[br[678]procedure reference
[br[679]reference
[br[680]condition
[br[681]actor
[br[682]pattern send c y v m x a
[br[683]message
[br[684]actor
[br[685]args
[br[686]condition
[br[687]actor
[br[688]pattern execute c y v p
[br[689]procedure
[br[690]pattern execute c y i i v c p
[br[691]condition
[br[692]procedure
[br[693]step
[br[694]actor
[br[695]pattern send y v m a a x a
[br[696]message
[br[697]args
[br[698]args
[br[699]actor
[br[700]args
[br[701]step
[br[702r701]pattern execute a v p i y 
[br[703]dummy
[br[704]condition
[br[705]actor
[br[706]pattern execute c y v p
[br[707]procedure
[br[708]procedure
[br[709]pattern execute y i i p v c
[br[710]condition
[br[711]pattern execute v p y c
[br[712]procedure
[br[713]actor
[br[714]condition
[br[715]actor
[br[716]pattern reply x i i i i i i i i i i i i i i i i i i i i y v m a
[br[717]message
[br[718]args
[br[719]step
[br[720]condition
[br[721]condition
[br[722]actor
[br[723]pattern send c c y v m x r c
[br[724]message
[br[725]actor
[br[726]reference
[br[727]condition
[br[728]step
[br[729]actor
[br[730]pattern send x i i i i i i y v m
[br[731]message
[br[732]step
[br[733r732]pattern execute a v p y 
[br[734]dummy
[br[735]actor
[br[736]pattern reply y v m a a x
[br[737]message
[br[738]args
[br[739]args
[br[740]actor
[br[741]pattern execute y i i i i i v i p i a
[br[742]pattern execute y i i i i i i v i p i a
[br[743]procedure 
[br[744r743]procedure 
[br[745]arg
[br[746]args
[br[747]procedure 
[br[748]pattern execute y i i i i i i i i i i i p v a
[br[749]args
[br[750]actor
[br[751]condition
[br[752]actor
[br[753]pattern execute c y v p
[br[754]procedure
[br[755]pattern execute y i i i i v a p
[br[756]args
[br[757]procedure
[br[758]condition
[br[759]actor
[br[760]pattern execute c y v p
[br[761]procedure
[br[762]pattern send a i i y i i v x m
[br[763]actor
[br[764]message
[br[765]pattern execute v a p y
[br[766]args
[br[767]procedure 
[br[768]actor
[br[769]condition
[br[770]actor
[br[771]pattern execute c y v p
[br[772]procedure
[br[773]message
pattern send m v [br[774]a y i x
arg[br[775]
[br[776]actor
[br[777]condition
[br[778]actor
[br[779]pattern execute c y v i i i p
[br[780]pattern send c y i v m x 
[br[781]message
[br[782]actor
[br[783]procedure
[br[784]actor
[br[785]pattern execute c i i i y v p
[br[786]procedure
[br[787]pattern send y i i v m a a x a
[br[788]message
[br[789]args
[br[790]args
[br[791]actor
[br[792]args 
[br[793]actor
[br[794]pattern execute y v p
[br[795]process
[br[796]condition
[br[797]actor
[br[798]pattern execute c y v i i i a i p
[br[799r798]pattern execute c y i v i i i a p
[br[800]pattern execute c y i i v i a i i i p
[br[801]pattern execute c y i i i v i a i i i p
[br[802]args
[br[803]args
[br[804]procedure
[br[805r804]procedure
[br[806]procedure
[br[807]procedure
[br[808]condition
[br[809]condition
[br[810]condition
[br[811]condition
[br[812]actor
[br[813]pattern send c i c i y v i i i m i i i x a
[br[814r813]pattern send c i i c y i v i i i m i i x i a
[br[815r813]pattern send c c i y i i v i i i m i x i i a
[br[816]pattern send c i c y i i i v i i i m x i i i a
[br[817]message csg id not present
[br[818r817]message csg id expired
[br[819r817]message plmn not present
[br[820]message plmn expired
[br[821]actor
[br[822]args
[br[823]args
[br[824r823]args
[br[825r823]args
[br[826]actor
[br[827]pattern execute a i i i y v i i i p c
[br[828r827]pattern execute a i i y i v i i p c
[br[829r827]pattern execute a i y i i v i p c
[br[830]pattern execute a y i i i v p c
[br[831]procedure
[br[832]condition
[br[833]actor
[br[834]condition
[br[835]pattern execute y i i i i i i i i i i i i i i i i i i i i i c v p
[br[836]procedure
[br[837]condition
[br[838]actor
[br[839]pattern execute c y v p
[br[840]procedure
[br[841]step
[br[842]condition
[br[843]actor
[br[844]pattern execute c y v p
[br[845]process
[br[846]actor
[br[847]pattern send y v m a x c
[br[848]message
[br[849]args
[br[850]actor
[br[851]condition
[br[852]condition
[br[853]condition
[br[854]actor
[br[855]pattern send c i y v i m x
[br[856]pattern execute c y i v i i p
[br[857]message
[br[858]actor
[br[859]procedure
[br[860]actor
[br[861]condition
[br[862]pattern send y c v m x
[br[863]message
[br[864]actor
[br[865]args
[br[866]actor
[br[867]condition
[br[868]reference
[br[869]pattern execute c r v p y
[br[870]process
[br[871]actor
[br[872]step
[br[873]actor
[br[874]pattern reply x i i i i i i y v m a
[br[875]message
[br[876]args
[br[877]actor
[br[878]pattern execute y v p
[br[879]process
[br[880]step
[br[881r880]pattern execute a v p i i i i y 
[br[882]dummy
[br[883]condition
[br[884]conditions
[br[885]pattern dummy c i v i y
[br[886r885]pattern dummy c i v y
[br[887]actor
[br[888]pattern send y v i m a x
[br[889]pattern send y i v m a x
[br[890]message
[br[891]args
[br[892]actor
[br[893]condition
[br[894]actor
[br[895]pattern execute c y v i p
[br[896]pattern execute c y i v p
[br[897]process
[br[898]pattern execute c y i i i v i r p
[br[899]pattern execute c y i i i i v r p
[br[900]reference
[br[901]process
[br[902]condition
[br[903]pattern execute y i i i i i i i c v i p
[br[904]pattern execute y i i i i i i i c i v p
[br[905]process
[br[906]actor
[br[907]pattern send y v m a x
[br[908]message
[br[909]args
[br[910]actor
[br[911]condition
[br[912]actor
[br[913]pattern execute c y v p i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i r
[br[914]process
[br[915]pattern constraint y i i v p i c 
[br[916]process
[br[917]actor
[br[918]condition
[br[919]condition
[br[920]refernce
[br[921]pattern execute y i c r v p i i i i i i i i i i i i r r
[br[922]process
[br[923]condition
[br[924]reference
[br[925]pattern execute c r v p y c i i i i i i r r
[br[926]process
[br[927]actor
[br[928]condition
[br[929]condition
[br[930]condition
[br[931]reference
[br[932]pattern execute c i r v i p y c r r
[br[933]pattern execute c r i v p y c r r
[br[934]procedure
[br[935]actor
[br[936]condition
[br[937]reference
[br[938]reference
[br[939]actor
[br[940]pattern constraint y v p
[br[941]procedure
[br[942]actor
[br[943]pattern execute y v p
[br[944]procedure
[br[945]condition
[br[946]actor
[br[947]pattern constraint c y v p
[br[948]procedure
[br[949]reference
[br[950]actor
[br[951]pattern constraint y v p r
[br[952]procedure
[br[953]reference
[br[954]condition
[br[955]pattern constraint y i i i c v p
[br[956]procedure
[br[957]actor
[br[958]pattern constraint y v p r
[br[959]procedure
[br[960]reference
[br[961]condition
[br[962]condition
[br[963]condition
[br[964]actor
[br[965]pattern execute c c i y v i p
[br[966]pattern execute c i c y i v i p
[br[967]procedure
[br[968]procedure
[br[969]actor
[br[970]pattern constraint y v i p c c i r
[br[971]pattern constraint y i v p c i c r
[br[972]procedure
[br[973]condition
[br[974]condition
[br[975]condition
[br[976]reference
[br[977]condition
[br[978]actor
[br[979]pattern send c y v a x m a r
[br[980]args
[br[981]actor
[br[982]message
[br[983]reference
[br[984]actor
[br[985]pattern execute c i i i i i i y v a p
[br[986]args
[br[987]procedure
[br[988]actor
[br[989]pattern execute y v p a
[br[990]procedure
[br[991]args
[br[992]pattern execute y i i i v a p
[br[993]args
[br[994]procedure 
[br[995]actor
[br[996]condition
[br[997]pattern execute y c v p
[br[998]procedure
[br[999]condition
[br[1000]actor
[br[1001]pattern execute c y v p
[br[1002]procedure
[br[1003]condition 
[br[1004]actor
[br[1005]pattern send c y v m x r
[br[1006]message
[br[1007]actor
[br[1008]reference
[br[1009]condition
[br[1010]actor
[br[1011]pattern execute c y v p
[br[1012]procedure
[br[1013]pattern execute c y i i v p i i i i i i c r
[br[1014]procedure
[br[1015]condition
[br[1016]actor
[br[1017]pattern send c y v i m a x c r 
[br[1018]pattern send c y i v m a x i i c r
[br[1019]message
[br[1020]args
[br[1021]actor
[br[1022]condition
[br[1023]reference
[br[1024]condition
[br[1025]reference
[br[1026]note ???
[br[1027]reference ???
[br[1028]note ???
[br[1029]reference ???
[br[1030]note ???
[br[1031]condition
[br[1032]actor
[br[1033]pattern execute c y v p c
[br[1034]procedure
[br[1035]condition
[br[1036]condition
[br[1037]actor
[br[1038]pattern execute c y v p
[br[1039]procedure
[br[1040]condition 
[br[1041]pattern constraint c v y p
[br[1042]actor
[br[1043]process
[br[1044]condition
[br[1045]pattern constraint c v y p
[br[1046]actor
[br[1047]procedure
[br[1048]actor
[br[1049]condition
[br[1050]pattern execute y c v p c c 
[br[1051]procedure
[br[1052]condition
[br[1053]condition
[br[1054]codition
[br[1055]actor
[br[1056]pattern send c y v x a m 
[br[1057]actor
[br[1058]args
[br[1059]message
[br[1060]note???
[br[1061]condition
[br[1062]actor
[br[1063]pattern execute c y v p 
[br[1064]procedure
[br[1065]note???
[br[1066]condition
[br[1067]actor
[br[1068]pattern execute c y v p r
[br[1069]procedure
[br[1070]reference
[br[1071]step
[br[1072]condition
[br[1073]actor
[br[1074]pattern send c y v m x
[br[1075]message
[br[1076]actor
[br[1077]condition
[br[1078]actor
[br[1079]pattern execute c y v p r
[br[1080]procedure
[br[1081]reference
[br[1082]condition
[br[1083]actor
[br[1084]pattern execute c y v p
[br[1085]process
[br[1086]note
[br[1087]note
[br[1088]step


pp ts 23.401 v15.9.0 (2019-09)
410
release 15


3gpp



